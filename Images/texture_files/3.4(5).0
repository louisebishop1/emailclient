YUI.add("photo-data",function(c){var b={};function i(l){var k;if(l instanceof h){k=l}else{if(b[l.id]){k=b[l.id];k.merge_data(l)}else{k=new h(l);b[l.id]=k}}return k}function e(k){if(typeof k==="undefined"){return b}else{return b[k]}}function f(k){if(k==="0"){k=0}return !!k}function d(k){k=parseInt(k,10);if(!c.Lang.isNumber(k)){return undefined}return k}function j(k){k=parseInt(k,10);if(!c.Lang.isNumber(k)||k<0||k>3){return undefined}return k}function a(k){if(!k||!c.Lang.isObject(k)){k={}}return k}function g(k){return c.Lang.isNumber(k)&&parseInt(k,10)===k}c.PhotoData={add:i,get:e};function h(k){h.superclass.constructor.apply(this,arguments)}h.NAME="PhotoData";h.ATTRS={id:{value:""},title:{broadcast:1,value:"",setter:function(l,k){if(!c.Lang.isString(l)){if(c.Lang.isNumber(l)){l=l+""}else{l=""}}return l.replace(/^\s+$/,"")}},description:{broadcast:1,value:""},owner:{value:"",setter:function(k){if(!c.Lang.isString(k)){if(c.Lang.isObject(k)&&k.nsid){k=k.nsid}else{k=""}}return k}},ownername:{value:""},pathalias:{value:""},url:{value:"",getter:function(l,k){return c.urls.get("photo",{photo:this})}},date_posted:{broadcast:1,getter:d},is_public:{broadcast:1,getter:f},is_friend:{broadcast:1,getter:f},is_family:{broadcast:1,getter:f},perm_comment:{broadcast:1,getter:j},perm_addmeta:{broadcast:1,getter:j},perms:{getter:function(){return{is_public:this.get("is_public"),is_friend:this.get("is_friend"),is_family:this.get("is_family"),perm_comment:this.get("perm_comment"),perm_addmeta:this.get("perm_addmeta")}}},license:{broadcast:1,getter:d,setter:d},safety_level:{broadcast:1,getter:d,setter:d},needs_interstitial:{broadcast:1,value:false,getter:f,setter:f},media:{broadcast:1,value:"photo"},is_video:{getter:function(){return(this.get("media")==="video")}},secret:{value:""},deleted:{value:false},dmca_takedown:{value:false},geo:{broadcast:1,getter:function(k){if(!c.Lang.isObject(k)){k={}}return k}},has_geo:{getter:function(){var k=this.get("geo");return(k&&k.latitude&&k.longitude&&k.accuracy)}},perm_viewgeo:{broadcast:1,value:false},is_bad:{broadcast:1,getter:d,setter:d},content_type:{broadcast:1,getter:d,setter:d},is_fave:{broadcast:1,value:false,setter:function(m,k){m=f(m);var l=this.get(k);if(m!==l){if(m){this.increment("fave_count")}else{this.decrement("fave_count")}}if(this.get("fave_changes_pending")===0){this.set("is_confirmed_fave",m)}return m},getter:f},is_confirmed_fave:{value:undefined},fave_changes_pending:{value:0},fave_count:{broadcast:1,value:0,getter:d,setter:d},comment_count:{broadcast:1,value:0,getter:d,setter:d},can_comment:{value:false,getter:function(){if(this.get("is_ignored")){return false}if(this.get("dmca_takedown")){return false}if(!c.config.flickr.user.nsid&&!c.config.flickr.flags.enable_grease){return false}return true}},can_fave:{value:false,getter:function(){if(this.get("is_ignored")){return false}if(this.get("dmca_takedown")){return false}if(this.get("is_owner")){return false}if(!c.config.flickr.user.nsid&&!c.config.flickr.flags.enable_grease){return false}return true}},group_count:{broadcast:1,getter:d,setter:d},people_count:{broadcast:1,getter:d,setter:d},guestpass_count:{broadcast:1,getter:d,setter:d},is_owner:{value:false,getter:function(){return c.config.flickr.user.nsid&&c.config.flickr.user.nsid===this.get("owner")}},is_ignored:{value:false},sizes:{value:{},getter:function(p,l){var m,o,k,n;p=a(p);if(c.config.flickr.flags.enable_2048_images){m=p.o||p.l||p.z;if(m&&(m.width>=2048||m.height>=2048)){o=m.width/m.height;if(o>1){n=2048;k=Math.round(2048/o)}else{k=2048;n=Math.round(2048*o)}p["2048"]={url:p.t.url.replace("_t","_2048"),height:k+"",width:n+"",label:"2048"}}}return p}}};c.extend(h,c.Base,{initializer:function(k){this.merge_data(k)},merge_data:function(l){var m,k;if(typeof l.id!=="undefined"&&l.id!==this.get("id")){this.set("id",l.id)}if(typeof l.title!=="undefined"&&l.title!==this.get("title")){this.set("title",l.title)}if(typeof l.description!=="undefined"&&l.description!==this.get("description")){this.set("description",l.description)}if(typeof l.owner!=="undefined"&&l.owner!==this.get("owner")){this.set("owner",l.owner)}if(typeof l.ownername!=="undefined"&&l.ownername!==this.get("ownername")){this.set("ownername",l.ownername)}if(typeof l.pathalias!=="undefined"&&l.pathalias!==this.get("pathalias")){this.set("pathalias",l.pathalias)}if(typeof l.url!=="undefined"&&l.url!==this.get("url")){this.set("url",l.url)}if(typeof l.date_posted!=="undefined"&&l.date_posted!==this.get("date_posted")){this.set("date_posted",l.date_posted)}if(typeof l.date_taken!=="undefined"&&l.date_taken!==this.get("date_taken")){this.set("date_taken",l.date_taken)}if(typeof l.is_public!=="undefined"&&l.is_public!==this.get("is_public")){this.set("is_public",l.is_public)}if(typeof l.is_friend!=="undefined"&&l.is_friend!==this.get("is_friend")){this.set("is_friend",l.is_friend)}if(typeof l.is_family!=="undefined"&&l.is_family!==this.get("is_family")){this.set("is_family",l.is_family)}if(typeof l.perm_comment!=="undefined"&&l.perm_comment!==this.get("perm_comment")){this.set("perm_comment",l.perm_comment)}if(typeof l.perm_addmeta!=="undefined"&&l.perm_addmeta!==this.get("perm_addmeta")){this.set("perm_addmeta",l.perm_addmeta)}if(typeof l.license!=="undefined"&&l.license!==this.get("license")){this.set("license",l.license)}if(typeof l.needs_interstitial!=="undefined"&&l.needs_interstitial!==this.get("needs_interstitial")){this.set("needs_interstitial",l.needs_interstitial)}if(typeof l.safety_level!=="undefined"&&l.safety_level!==this.get("safety_level")){this.set("safety_level",l.safety_level)}if(typeof l.media!=="undefined"&&l.media!==this.get("media")){this.set("media",l.media)}if(typeof l.secret!=="undefined"&&l.secret!==this.get("secret")){this.set("secret",l.secret)}if(typeof l.is_bad!=="undefined"&&l.is_bad!==this.get("is_bad")){this.set("is_bad",l.is_bad)}if(typeof l.content_type!=="undefined"&&l.content_type!==this.get("content_type")){this.set("content_type",l.content_type)}if(typeof l.is_faved!=="undefined"&&l.is_faved!==this.get("is_fave")){this.set("is_fave",l.is_faved)}if(typeof l.is_fave!=="undefined"&&l.is_fave!==this.get("is_fave")){this.set("is_fave",l.is_fave)}if(typeof l.fave_count!=="undefined"&&l.fave_count!==this.get("fave_count")){this.set("fave_count",l.fave_count)}if(typeof l.count_faves!=="undefined"&&l.count_faves!==this.get("fave_count")){this.set("fave_count",l.count_faves)}if(typeof l.comment_count!=="undefined"&&l.comment_count!==this.get("comment_count")){this.set("comment_count",l.comment_count)}if(typeof l.count_comments!=="undefined"&&l.count_comments!==this.get("comment_count")){this.set("comment_count",l.count_comments)}if(typeof l.geo!=="undefined"&&l.geo!==this.get("geo")){this.set("geo",l.geo)}if(typeof l.perm_viewgeo!=="undefined"&&l.perm_viewgeo!==this.get("perm_viewgeo")){this.set("perm_viewgeo",l.perm_viewgeo)}if(typeof l.woe!=="undefined"&&l.woe!==this.get("woe")){this.set("woe",l.woe)}if(typeof l.group_count!=="undefined"&&l.group_count!==this.get("group_count")){this.set("group_count",l.group_count)}if(typeof l.people_count!=="undefined"&&l.people_count!==this.get("people_count")){this.set("people_count",l.people_count)}if(typeof l.guestpass_count!=="undefined"&&l.guestpass_count!==this.get("guestpass_count")){this.set("guestpass_count",l.guestpass_count)}if(l.sizes&&c.Lang.isObject(l.sizes)){m=l.sizes}else{m={};if(l.url_sq){m.sq={url:l.url_sq,width:parseInt(l.width_sq,10),height:parseInt(l.height_sq,10)}}if(l.url_t){m.t={url:l.url_t,width:parseInt(l.width_t,10),height:parseInt(l.height_t,10)}}if(l.url_s){m.s={url:l.url_s,width:parseInt(l.width_s,10),height:parseInt(l.height_s,10)}}if(l.url_m){m.m={url:l.url_m,width:parseInt(l.width_m,10),height:parseInt(l.height_m,10)}}if(l.url_z){m.z={url:l.url_z,width:parseInt(l.width_z,10),height:parseInt(l.height_z,10)}}if(l.url_l){m.l={url:l.url_l,width:parseInt(l.width_l,10),height:parseInt(l.height_l,10)}}if(l.url_o){m.o={url:l.url_o,width:parseInt(l.width_o,10),height:parseInt(l.height_o,10)}}if(l.media==="video"){if(l.height_v){m.v={width:parseInt(l.width_v,10),height:parseInt(l.height_v,10)}}}}if(c.Object.size(m)){k=this.get("sizes")||{};c.Object.each(k,function(n,o){if(m[o]){m[o]=c.merge(n,m[o])}});this.set("sizes",c.merge(k,m))}},toggle_fave:function(){var l=this,k,o,m,n;if(!this.get("can_fave")){return}if(c.config.flickr.flags.enable_grease&&!c.config.flickr.user.nsid){c.grease.addFave(this.get("id"));c.grease.authenticate();return}k=!this.get("is_fave");o="flickr.favorites."+(k?"add":"remove");m={photo_id:this.get("id")};n={success:function(){var p,q,r,s;p=l.get("id");l.decrement("fave_changes_pending");l.set("is_confirmed_fave",k);if(l.get("fave_changes_pending")===0){l.set("is_fave",k)}q="faves-"+(c.config.flickr.user.pathalias?c.config.flickr.user.pathalias:c.config.flickr.user.nsid);r=c.ContextData.getContext(q);if(r){s=r.getPhotoPosition(p)}if(k){if(r){if(c.ContextData.getPrevLimit(q)===s){c.ContextData.unremovePhoto(q,s)}else{c.ContextData.invalidate(q)}}else{if(c.config.flickr.page_type==="photo"&&l.get("id")===c.config.flickr.photo.id){c.ContextData.add({id:q,user_id:c.config.flickr.user.nsid,type:"faves",title:c.transjax.get("photo","your_favorites"),url:c.config.flickr.user.photos_url+"favorites/",photos:{"0":l}})}}}else{if(r&&c.Lang.isNumber(s)){c.ContextData.removePhoto(q,s)}}},failure:function(){l.decrement("fave_changes_pending");if(l.get("fave_changes_pending")===0){l.set("is_fave",l.get("is_confirmed_fave"))}}};this.set("is_fave",k);this.increment("fave_changes_pending");c.flickrAPI.callMethod(o,m,n)},record_interstitial_clickthrough:function(){var k=this.get("owner");c.Object.each(b,function(l,m){if(l.get("owner")===k){l.set("needs_interstitial",false)}});c.flickrAPI.callMethod("flickr.people.recordInterstitialClickthrough",{user_id:k},function(){})},increment:function(k){if(!g(this.get(k))){return false}return this.add(k,1)},decrement:function(k){if(!g(this.get(k))){return false}return this.add(k,-1)},add:function(l,m){var n=this.get(l),k;if(!c.Lang.isNumber(n)||!c.Lang.isNumber(m)){return false}k=n+m;if(this.set(l,k)){return k}else{return false}}})},"0.0.1",{requires:F.config.modules["photo-data"].requires||[],optional:F.config.modules["photo-data"].optional||[]});YUI.add("context-data",function(a){var h={},t;function m(u){var v=new d(u);h[v.id]=v;v.on("totalChange",function(w){a.fire("ContextData:totalChange",v.id,w)});v.on("photoLoaded",function(w,x){a.fire("ContextData:photoLoaded",v.id,w,x)});v.on("photoRemoved",function(w,x){a.fire("ContextData:photoRemoved",v.id,w,x)});v.on("photoUnremoved",function(w,x){a.fire("ContextData:photoUnremoved",v.id,w,x)});v.on("photoLoadFailure",function(w){a.fire("ContextData:photoLoadFailure",v.id,w)});v.on("prevLimitReached",function(w){a.fire("ContextData:prevLimitReached",v.id,w)});v.on("nextLimitReached",function(w){a.fire("ContextData:nextLimitReached",v.id,w)});if(u.open){l(v.id)}a.fire("ContextData:contextAdded",v);return v}function s(v){var u=h[v];if(!u){return}h[v]=undefined;delete h[v];if(t===v){if(f()&&f()[0]){l(f()[0].id)}}a.fire("ContextData:contextRemoved",v)}function j(u){a.fire("ContextData:contextInvalidated",u)}function o(v,G){var y=i(v),A=y.type,H=y.set_id,D=y.group_id,x=y.for_user,B=y.gallery_id,E=y.user_id,u=y.owner_name_possessive,C=y.title,w=y.url,z=v===t;s(v);m({id:v,set_id:H,group_id:D,for_user:x,gallery_id:B,user_id:E,owner_name_possessive:u,type:A,title:C,url:w,photos:G,open:z})}function i(u){if(u){return h[u]}else{if(t){return h[t]}else{return undefined}}}function f(){return a.Object.values(h)}function p(v,u){if(h[v]){return h[v].loadPhoto(u)}}function k(w,u,v){if(h[w]){h[w].loadPhotoRange(u,v)}}function c(v,u){if(h[v]){return h[v].removePhoto(u)}}function q(v,u){if(h[v]){return h[v].unremovePhoto(u)}}function n(v,u){return h[v]?h[v].getPhoto(u):undefined}function r(v,u){return h[v]?h[v].getPhotoPosition(u):undefined}function g(v){var u={};a.Object.each(h,function(x,y){var w=r(y,v);if(a.Lang.isNumber(w)){u[y]=w}});return u}function b(u){return h[u]?h[u].prev_limit:undefined}function e(u){return h[u]?h[u].next_limit:undefined}function l(u){if(u!==t){t=u;a.fire("ContextData:open",u)}}a.ContextData={add:m,remove:s,reload:o,invalidate:j,getContext:i,getContexts:f,loadPhoto:p,loadPhotoRange:k,removePhoto:c,unremovePhoto:q,getPhoto:n,getPhotoPosition:r,getPhotoPositions:g,getPrevLimit:b,getNextLimit:e,open:l};function d(u){this.id=u.id;this.type=u.type;this.set_id=u.set_id;this.group_id=u.group_id;this.for_user=u.for_user;this.gallery_id=u.gallery_id;this.user_id=u.user_id;this.owner_name_possessive=u.owner_name_possessive;this.title=u.title||"";this.url=u.url||"";this.order_by=u.order_by||"";this.total=parseInt(u.total,10);this.removed={};if(a.config.flickr.filmstrips&&a.config.flickr.filmstrips.enable_filmstrip_timelines){this.start_position=parseInt(u.start_position,10)}this.photos={};if(!a.Lang.isNumber(this.total)){this.total=undefined}this.prev_limit=u.prev_limit;this.next_limit=u.next_limit;a.Object.each(u.photos,function(w,v){this.setPhoto(v,a.PhotoData.add(w))},this);this.next_batch={};this.loading_batches={}}d.prototype={getPhoto:function(u){return this.photos[u+""]},setPhoto:function(u,v){this.photos[u+""]=v},getLoadedPositions:function(){var u=[];a.Object.each(this.photos,function(v,w){u.push(parseInt(w,10))});return u},getPhotoPosition:function(v){var u;a.Object.some(this.photos,function(w,x){if(w.get("id")===v){u=x;return true}});return parseInt(u,10)},loadPhoto:function(u){var w=this.getPhoto(u),v,x;if(w){this.fire("photoLoaded",u,w)}else{v=a.Lang.isNumber(this.prev_limit)&&u<this.prev_limit;x=a.Lang.isNumber(this.next_limit)&&u>this.next_limit;if(v||x){if(v){this.fire("prevLimitReached",this.prev_limit)}if(x){this.fire("nextLimitReached",this.next_limit)}}else{this.fetch(u)}}},loadPhotoRange:function(w,x){var v,u;if(w<x){v=w;u=x}else{v=x;u=w}for(v;v<=u;v++){this.loadPhoto(v)}},removePhoto:function(u){var v=this.getPhoto(u);this.removed[u+""]=true;this.fire("photoRemoved",u,v)},unremovePhoto:function(u){var v=this.getPhoto(u);this.removed[u+""]=undefined;delete this.removed[u+""];this.fire("photoUnremoved",u,v)},inBatchRange:function(v,u){return(v&&v.range&&u>=v.range[0]&&u<=v.range[1])},inNextBatch:function(u){return this.inBatchRange(this.next_batch,u)},inLoadingBatch:function(u){var w,v;for(w in this.loading_batches){if(this.loading_batches.hasOwnProperty(v)){v=this.loading_batches[w];if(this.inBatchRange(v,u)){return true}}}return false},addToNextBatch:function(w){var x,A,z,v,y,u,B;x=this.next_batch.positions||[];x.push(w);A=x.sort(a.Array.numericSort);this.next_batch.positions=A;z=this.getClosestLoadedPosition(x);if(a.Lang.isNumber(z)){v=z;y=this.getPhoto(z).get("id");u=z-A[0];B=A[A.length-1]-z;if(u<0){u=0}if(B<0){B=0}this.next_batch.range=[v-u,v+B];this.next_batch.params={start_pos:v,photo_id:y,num_prev:u,num_next:B};if(!this.next_batch.handle){this.next_batch.handle=a.later(500,this,this.fetchBatch)}}else{a.log("No photo was found in the context. At least one photo is needed to fetch data.","error","context-data")}},fetch:function(u,v){if((!v&&a.Lang.isNumber(this.prev_limit)&&u<this.prev_limit)||(!v&&a.Lang.isNumber(this.next_limit)&&u>this.next_limit)||this.inNextBatch(u)||this.inLoadingBatch(u)){return}this.addToNextBatch(u);return},fetchBatch:function(){var z,D,B,v,w,A,u,x,y,E,C;z=this.next_batch;this.next_batch={};D=z.range.toString();this.loading_batches[D]=z;B=z.params.start_pos;v=z.params.photo_id;w=z.params.num_prev;A=z.params.num_next;switch(this.type){case"contacts":u="flickr.contacts.getContext";x={photo_id:v,num_prev:A,num_next:w};y=true;break;case"contactsfaves":u="flickr.contacts.getContextRecentlyFaved";x={photo_id:v,num_prev:A,num_next:w};if(this.user_id&&a.config.flickr.user.nsid!==this.user_id){x.user_id=this.user_id}y=true;break;case"photosof":u="flickr.photos.people.getContext";x={user_id:this.user_id,photo_id:v,num_prev:A,num_next:w};y=true;break;case"faves":u="flickr.favorites.getContext";x={user_id:this.user_id,photo_id:v,num_prev:A,num_next:w};y=true;break;case"gallery":u="flickr.galleries.getContext";x={gallery_id:this.gallery_id,photo_id:v,num_prev:w,num_next:A};break;case"photolist":u="flickr.photolist.getContext";x={photolist_id:this.id.split("photolist-")[1],photo_id:v,num_prev:w,num_next:A};break;case"pool":u="flickr.groups.pools.getContext";x={group_id:this.group_id,photo_id:v,num_prev:A,num_next:w};if(this.for_user){x.for_user=this.for_user}y=true;break;case"search":break;case"set":u="flickr.photosets.getContext";x={photoset_id:this.set_id,photo_id:v,num_prev:A,num_next:w};y=true;break;case"stream":u="flickr.photos.getContext";x={photo_id:v,num_prev:A,num_next:w,order_by:this.order_by==="datetaken"?"datetaken":(this.order_by==="dateposted"?"dateposted":"")};y=true;break;case"tags":break;case"timescrubber":break}if(!v||(!w&&!A)||!u||!x){return}x.extras="url_sq,url_t,url_s,url_m,url_z,url_l,url_o,video_size,owner_name,path_alias,icon_server,needs_interstitial,count_comments,count_faves";C=this;E={success:function(I){var K,H,M,O,J,G,L,N;C.loading_batches[D]=undefined;delete C.loading_batches[D];N=parseInt(I.data.count._content,10);M=(I.data.prevphotos&&a.Lang.isArray(I.data.prevphotos.photo))?I.data.prevphotos.photo:[];O=(I.data.nextphotos&&a.Lang.isArray(I.data.nextphotos.photo))?I.data.nextphotos.photo:[];if(a.Lang.isNumber(N)){if(N!==parseInt(C.total,10)){C.total=N;C.fire("totalChange",C.total)}}K=y?M:O;H=y?O:M;for(J=K.length-1;J>=0;J--){L=parseInt(B,10)+1+J;if(!C.getPhoto(L)){G=a.PhotoData.add(K[J]);C.setPhoto(L,G);C.fire("photoLoaded",L,G)}}for(J=H.length-1;J>=0;J--){L=parseInt(B,10)-1-J;if(!C.getPhoto(L)){G=a.PhotoData.add(H[J]);C.setPhoto(L,G);C.fire("photoLoaded",L,G)}}if(w>H.length){C.prev_limit=B-H.length;C.fire("prevLimitReached",C.prev_limit)}if(A>K.length){C.next_limit=B+K.length;C.fire("nextLimitReached",C.next_limit)}},failure:function(H){var G=C.getPhotoPosition(z.params.photo_id);a.Array.each(z.positions,function(I){C.fire("photoLoadFailure",I)});if(H&&H.data){if((C.type==="contacts"&&H.data.code===2)||(C.type==="contactsfaves"&&H.data.code===2)||(C.type==="photosof"&&H.data.code===3)||(C.type==="faves"&&H.data.code===3)||(C.type==="gallery"&&H.data.code===3)||(C.type==="pool"&&H.data.code===2)||(C.type==="set"&&H.data.code===2)||(C.type==="stream"&&H.data.code===1)){a.log("The getContext API request failed because the key photo is not in the context","error","context-data");C.removePhoto(G)}else{if((C.type==="contacts"&&H.data.code===1)||(C.type==="contactsfaves"&&H.data.code===1)||(C.type==="photosof"&&H.data.code===1)||(C.type==="faves"&&H.data.code===1)||(C.type==="gallery"&&H.data.code===1)||(C.type==="pool"&&H.data.code===1)||(C.type==="set"&&H.data.code===1)||(C.type==="stream"&&H.data.code===1)||(C.type==="photolist"&&H.data.code===1)){a.log("The getContext API request failed because the key photo does not exist","error","context-data");C.getPhoto(G).set("deleted",true)}}}C.loading_batches[D]=undefined;delete C.loading_batches[D]}};if(u&&x&&E){a.flickrAPI.callMethod(u,x,E)}return this},getClosestLoadedPosition:function(x){var w,v,u,y;w=a.Object.keys(this.photos);v=0;a.Array.each(x,function(z){v+=parseInt(z,10)});u=v/x.length;w.sort(function(A,z){var C,B;C=Math.abs(A-u);B=Math.abs(z-u);return(C-B)});a.Array.some(w,function(z){if(this.photos[z].get("deleted")!==true){y=z;return true}},this);return parseInt(y,10)}};a.augment(d,a.EventTarget)},"0.0.1",{requires:F.config.modules["context-data"].requires||[],optional:F.config.modules["context-data"].optional||[]});YUI.add("event-annotations",function(e){var c={},b=100;function d(g){var f;switch(g.type){case"key":f=g.which+g.pageX+g.pageY;break;default:f=g.type+g.pageX+g.pageY;break}return f}function a(f){delete (c[f])}e.eventAnnotations={add:function(i,h){var g;var f=d(i);if(e.Lang.isObject(i)&&e.Lang.isObject(i._event)&&e.Lang.isObject(h)){var j=e.later(b,this,a,f);g=c[f]||{};e.mix(g,h,true);if(g.timer){g.timer.cancel()}g.timer=j;c[f]=g}},get:function(i,g){var f=d(i);var h=c[f]||{};if(h.timer){h.timer.cancel()}h.timer=e.later(b,this,a,f);if(g){return h[g]}else{return h}}}},"0.0.1",{});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("yui-throttle",function(a){
/*! Based on work by Simon Willison: http://gist.github.com/292562 */
a.throttle=function(c,b){b=(b)?b:(a.config.throttleTime||150);if(b===-1){return(function(){c.apply(null,arguments);});}var d=a.Lang.now();return(function(){var e=a.Lang.now();if(e-d>b){d=e;c.apply(null,arguments);}});};},"3.4.0",{requires:["yui-base"]});
YUI.add("event-mousedrag",function(c){var b,q,l,d,g;q="mousedrag";l={};d=20;g=true;function n(u,t,r,s){c.Array.each(u,function(w){var v={};if(w.notifiers[r]){v.mouseTarget=t;v.start={clientX:s.start[0],clientY:s.start[1],nodeX:h(s.start[0],w.node),nodeY:f(s.start[1],w.node)};v.current={diffX:s.current[0]-s.start[0],diffY:s.current[1]-s.start[1],clientX:s.current[0],clientY:s.current[1],nodeX:h(s.current[0],w.node),nodeY:f(s.current[1],w.node)};v.clientRegion={left:v.start.clientX<v.current.clientX?v.start.clientX:v.current.clientX,top:v.start.clientY<v.current.clientY?v.start.clientY:v.current.clientY,width:Math.abs(v.current.clientX-v.start.clientX),height:Math.abs(v.current.clientY-v.start.clientY)};v.nodeRegion={left:v.start.nodeX<v.current.nodeX?v.start.nodeX:v.current.nodeX,top:v.start.nodeY<v.current.nodeY?v.start.nodeY:v.current.nodeY,width:Math.abs(v.current.nodeX-v.start.nodeX),height:Math.abs(v.current.nodeY-v.start.nodeY)};w.notifiers[r].fire(v)}})}function o(r){var s=r.get("id");o.obj=o.obj||{};o.throttled_reset=o.throttled_reset||c.throttle(function(){o.obj={}},500);o.throttled_reset();if(!o.obj[s]){o.obj[s]=[r.get("docScrollX")-r.getX(),r.get("docScrollY")-r.getY(),parseInt(r.get("offsetWidth"),10),parseInt(r.get("offsetHeight"),10)]}return o.obj[s]}function h(v,u){var t,r,s;t=o(u);r=v+t[0];s=t[2];if(g){if(r<0){r=0}if(r>s){r=s}}return r}function f(t,u){var s,v,r;s=o(u);v=t+s[1];r=s[3];if(g){if(v<0){v=0}if(v>r){v=r}}return v}function a(s,r){return[h(clientX),f(clientY)]}function i(s,r){return Math.sqrt(s*s+r*r)}function e(){var v,s,r,u,t;if(b){return}b=true;v=[];u={start:[],current:[]};t=u;c.one("html").on(q+"|mousedown",c.throttle(function(w){if(c.eventAnnotations.get(w,"ignoreDrag")){return}if(w.button!==1){return}v=j(w.target);s=w.target;if(!v.length){return}r=true;w.preventDefault();t.start=[w.clientX,w.clientY]},d));c.one("html").on(q+"|mousemove",c.throttle(function(w){var x;if(!v.length){return}if(r){t.current=[w.clientX,w.clientY]}c.Array.each(v,function(y){if(y.threshold_met){n(v,s,"mousedrag:step",t)}else{x=i((Math.abs(t.current[0]-t.start[0])),(Math.abs(t.current[1]-t.start[1])));if(x>y.pixel_threshold){n(v,s,"mousedrag:start",t);y.threshold_met=true}}})},d));c.one("html").on(q+"|mouseup",c.throttle(function(w){if(w.button!==1){return}if(!v.length){return}c.Array.each(v,function(x){if(x.threshold_met){n(v,s,"mousedrag:end",t);x.threshold_met=false}});v=[];r=false;t=u},d))}function j(s){var r=[];c.Object.each(l,function(u,t){if(u.node.contains(s)){r.push(u)}});return r}function m(){if(!b){return}b=false;c.detach(q+"|mousedown");c.detach(q+"|mousemove");c.detach(q+"|mouseup")}function k(s,u,r,t){var v=u.get("_yuid");r._evtGuid=t.id;if(!l[v]){l[v]={node:u,notifiers:{},pixel_threshold:1}}if(!l[v].notifiers[s]){l[v].notifiers[s]=t}e()}function p(s,u,r,t){}c.Event.define("mousedrag:start",{on:function(t,r,s){k("mousedrag:start",t,r,s)},detach:function(t,r,s){p("mousedrag:start",t,r,s)}});c.Event.define("mousedrag:step",{on:function(t,r,s){k("mousedrag:step",t,r,s)},detach:function(t,r,s){p("mousedrag:step",t,r,s)}});c.Event.define("mousedrag:end",{on:function(t,r,s){k("mousedrag:end",t,r,s)},detach:function(t,r,s){p("mousedrag:end",t,r,s)}})},"0.0.1",{requires:F.config.modules["event-mousedrag"].requires||[]});YUI.add("history-manager",function(c){var e=window,j=e.location,b=e.history,g=(b.pushState&&b.replaceState),r=!g&&(c.UA.gecko>=1.92),w={},u,y,a,n={photo:true,faves:true,group_pool:true,gallery:true,contacts:true,contactsfaves:true,photostream:true},h=n[c.config.flickr.page_type]&&(g||r);function v(){if(!h){return}s(m());if(g){e.addEventListener("popstate",x,false)}else{if(r){e.addEventListener("hashchange",d,false)}}q(y)}function s(z){c.log("setState","info","history-manager");if(!u){u=z}y=z}function m(){var H,B,E,C,z,I,J,G,D,K,A={};H=c.urls.regexes[c.config.flickr.page_type];B=H&&H.exec(j.pathname);if(B instanceof Array){switch(c.config.flickr.page_type){case"photo":if(B[1]&&B[2]){if(B[3]==="photostream"){a=true}E=B[1];C=B[2];z=B[3]||"photostream";J=B[4]||((j.search.indexOf("page=")>-1)?j.search.split("page=")[1].split("&")[0]:undefined)||1;G=B[5]?true:undefined;D=B[6]?true:undefined;if(E){A.pathalias=decodeURIComponent(E)}if(C){A.photo_id=C}if(z){A.context_id=decodeURIComponent(z)}if(J){A.page=J}if(G){A.lightbox=G}if(D){A.tour=D}}break;case"faves":if(B[1]){E=B[1];C=B[2];G=B[3]?true:undefined;if(E){A.pathalias=decodeURIComponent(E)}if(C){A.photo_id=C}if(G){A.lightbox=G}}break;case"group_pool":if(B[1]){group_id=B[1];I=B[2];C=B[3];J=B[4];G=B[5]?true:undefined;view_mode=B[6];if(group_id){A.group_id=decodeURIComponent(group_id)}if(I){A.owner_id=decodeURIComponent(I)}if(C){A.photo_id=C}if(G){A.lightbox=G}}break;case"gallery":if(B[1]&&B[2]){E=B[1];K=B[2];C=B[3];G=B[4]?true:undefined;if(E){A.pathalias=decodeURIComponent(E)}if(K){A.gallery_id=decodeURIComponent(K)}if(C){A.photo_id=C}if(G){A.lightbox=G}}break;case"photostream":if(B[1]){E=B[1];C=B[2];G=B[3]?true:undefined;if(E){A.pathalias=decodeURIComponent(E)}if(C){A.photo_id=C}if(G){A.lightbox=G}}break;case"contacts":J=B[1];C=B[2];if(J){A.page=B[1]}if(C){A.photo_id=B[2]}break;default:C=B[1];G=B[2]?true:undefined;if(C){A.photo_id=C}if(G){A.lightbox=G}break}}return A}function f(A){var z="";switch(c.config.flickr.page_type){case"photo":z+="/photos/"+A.pathalias+"/"+A.photo_id+"/";if(A.context_id&&(a||A.context_id!=="photostream")){z+="in/"+A.context_id+"/"}if(A.page>1){z+="page"+A.page+"/"}else{if(A.lightbox){z+="lightbox/"}else{if(A.tour||u.tour){z+="tour/"}}}break;case"faves":z+="/photos/"+A.pathalias+"/favorites/";if(A.photo_id){z+="with/"+A.photo_id+"/"}if(A.lightbox){z+="lightbox/"}break;case"group_pool":z+="/groups/"+A.group_id+"/pool/";if(A.owner_id){z+=A.owner_id+"/"}if(A.photo_id){z+="with/"+A.photo_id+"/"}if(A.lightbox){z+="lightbox/"}break;case"gallery":z+="/photos/"+A.pathalias+"/galleries/"+A.gallery_id+"/";if(A.photo_id){z+="with/"+A.photo_id+"/"}if(A.lightbox){z+="lightbox/"}break;case"contacts":z+="/photos/friends/";if(A.photo_id){z+="with/"+A.photo_id+"/"}else{if(c.config.flickr.flags.enable_justified_contacts_photos&&A.page>1){z+="page"+A.page+"/"}}if(A.lightbox){z+="lightbox/"}break;case"photostream":z+="/photos/"+A.pathalias+"/";if(A.photo_id){z+="with/"+A.photo_id+"/"}if(A.lightbox){z+="lightbox/"}break;case"contactsfaves":z+="/photos/contacts/favorites/";if(A.photo_id){z+="with/"+A.photo_id+"/"}if(A.lightbox){z+="lightbox/"}break}return z}function i(B,A){var z;for(z in B){if(B.hasOwnProperty(z)){if(!A.hasOwnProperty(z)||A[z]!==B[z]){return false}}}for(z in A){if(A.hasOwnProperty(z)){if(!B.hasOwnProperty(z)||B[z]!==A[z]){return false}}}return true}function o(C,A){c.log("pushState","info","history-manager");var B,D,z;A=A||{};B=A.replace;D=c.Lang.isString(A.title)?A.title:e.document.title;z=f(C);if(i(C,y)){return}s(C);if(g){if(B){b.replaceState(C,D,z)}else{b.pushState(C,D,z)}l()}else{if(r){w[z]=C;if(z===j.pathname||z===j.pathname+"/"){z=""}if(!z&&!p()){}else{if(!z){z="/"}if(B){j.replace("#"+z)}else{j.assign("#"+z)}}l()}}}function q(A,z){var B;z=z||{};B=z.title;o(A,{replace:true,title:B})}function t(){var z,A={};if(y){for(z in y){if(y.hasOwnProperty(z)){A[z]=y[z]}}}return A}function p(){var z=j.href.indexOf("#");if(z===-1){return""}return j.href.substr(z+1)}function l(){c.fire("historyManager:change",y)}function x(z){c.log("handlePop","info","history-manager");k(z.state)}function d(A){var z=p();if(z==="/"){z=j.pathname}k(w[z])}function k(A){c.log("handleStateChange","info","history-manager");var z;if(!A){A=m()}if(!i(A,y)){z=true}if(z){s(A);l()}}v();c.historyManager={enabled:h,pushState:o,replaceState:q,getState:t}},"0.0.1",{requires:F.config.modules["history-manager"].requires||[],optional:F.config.modules["history-manager"].optional||[]});YUI.add("math",function(a){a.Math={hypotenuse:function(d,c){return Math.sqrt(d*d+c*c)}}},"0.0.1",{});YUI.add("fave-star",function(f){function b(h,k,g){var m,j,i,l;g=(g||f.one("body"));m=h.one(".star");if(!m){return}j=f.Node.create('<img id="zoom-star" src="'+f.config.flickr.images_root+'/flickr-sprite.png.v4">');if(k){j.addClass("unfave")}i=f.Node.create('<div id="zoom-star-container"></div>');i.append(j);g.append(i);i.setXY([m.getX()-m.get("offsetWidth")/2,m.getY()-m.get("offsetHeight")/2]);window.setTimeout(function(){l=new f.Anim({node:j,to:{width:j.get("offsetWidth")*2,height:j.get("offsetHeight")*2,marginLeft:-1053-8,marginTop:(k?-11:-51)-8,opacity:0},duration:0.4,easing:f.Easing.easeOut});l.on("end",function(){i.remove()});l.run()},0)}function e(g){if(f.Lang.isString(g)){g=f.one(g)}if(!g instanceof f.Node){return}return g}function c(h,g){var i;h=e(h);if(!h){return}i=h.one(".star");if(i){b(h,false,g);i.set("innerHTML","&#9733;")}h.addClass("fave")}function d(h,g){var i;h=e(h);if(!h){return}i=h.one(".star");if(i){b(h,true,g);i.set("innerHTML","&#9734;")}h.removeClass("fave")}function a(h,g){h=e(h);if(!h){return}if(h.hasClass("fave")){d(h,g)}else{c(h,g)}}f.faveStar={fave:c,unfave:d,toggle_fave:a}},"0.0.1",{requires:["node","anim"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("widget-stdmod",function(b){var f=b.Lang,q=b.Node,x=b.UA,e=b.Widget,d="",J="hd",G="bd",j="ft",D="header",M="body",K="footer",N="fillHeight",m="stdmod",u="Node",I="Content",C="firstChild",h="childNodes",n="ownerDocument",v="contentBox",z="height",F="offsetHeight",y="auto",l="headerContentChange",B="bodyContentChange",o="footerContentChange",r="fillHeightChange",t="heightChange",O="contentUpdate",w="renderUI",E="bindUI",g="syncUI",H="_applyParsedConfig",s=b.Widget.UI_SRC;function P(L){this._stdModNode=this.get(v);b.before(this._renderUIStdMod,this,w);b.before(this._bindUIStdMod,this,E);b.before(this._syncUIStdMod,this,g);}P.HEADER=D;P.BODY=M;P.FOOTER=K;P.AFTER="after";P.BEFORE="before";P.REPLACE="replace";var k=P.HEADER,A=P.BODY,p=P.FOOTER,a=k+I,c=p+I,i=A+I;P.ATTRS={headerContent:{value:null},footerContent:{value:null},bodyContent:{value:null},fillHeight:{value:P.BODY,validator:function(L){return this._validateFillHeight(L);}}};P.HTML_PARSER={headerContent:function(L){return this._parseStdModHTML(k);},bodyContent:function(L){return this._parseStdModHTML(A);},footerContent:function(L){return this._parseStdModHTML(p);}};P.SECTION_CLASS_NAMES={header:e.getClassName(J),body:e.getClassName(G),footer:e.getClassName(j)};P.TEMPLATES={header:'<div class="'+P.SECTION_CLASS_NAMES[k]+'"></div>',body:'<div class="'+P.SECTION_CLASS_NAMES[A]+'"></div>',footer:'<div class="'+P.SECTION_CLASS_NAMES[p]+'"></div>'};P.prototype={_syncUIStdMod:function(){var L=this._stdModParsed;if(!L||!L[a]){this._uiSetStdMod(k,this.get(a));}if(!L||!L[i]){this._uiSetStdMod(A,this.get(i));}if(!L||!L[c]){this._uiSetStdMod(p,this.get(c));}this._uiSetFillHeight(this.get(N));},_renderUIStdMod:function(){this._stdModNode.addClass(e.getClassName(m));this._renderStdModSections();this.after(l,this._afterHeaderChange);this.after(B,this._afterBodyChange);this.after(o,this._afterFooterChange);},_renderStdModSections:function(){if(f.isValue(this.get(a))){this._renderStdMod(k);}if(f.isValue(this.get(i))){this._renderStdMod(A);}if(f.isValue(this.get(c))){this._renderStdMod(p);}},_bindUIStdMod:function(){this.after(r,this._afterFillHeightChange);this.after(t,this._fillHeight);this.after(O,this._fillHeight);},_afterHeaderChange:function(L){if(L.src!==s){this._uiSetStdMod(k,L.newVal,L.stdModPosition);}},_afterBodyChange:function(L){if(L.src!==s){this._uiSetStdMod(A,L.newVal,L.stdModPosition);}},_afterFooterChange:function(L){if(L.src!==s){this._uiSetStdMod(p,L.newVal,L.stdModPosition);}},_afterFillHeightChange:function(L){this._uiSetFillHeight(L.newVal);},_validateFillHeight:function(L){return !L||L==P.BODY||L==P.HEADER||L==P.FOOTER;},_uiSetFillHeight:function(R){var Q=this.getStdModNode(R);var L=this._currFillNode;if(L&&Q!==L){L.setStyle(z,d);}if(Q){this._currFillNode=Q;}this._fillHeight();},_fillHeight:function(){if(this.get(N)){var L=this.get(z);if(L!=d&&L!=y){this.fillHeight(this._currFillNode);}}},_uiSetStdMod:function(S,R,L){if(f.isValue(R)){var Q=this.getStdModNode(S)||this._renderStdMod(S);this._addStdModContent(Q,R,L);this.set(S+I,this._getStdModContent(S),{src:s});}else{this._eraseStdMod(S);}this.fire(O);},_renderStdMod:function(R){var L=this.get(v),Q=this._findStdModSection(R);if(!Q){Q=this._getStdModTemplate(R);}this._insertStdModSection(L,R,Q);this[R+u]=Q;return this[R+u];},_eraseStdMod:function(Q){var L=this.getStdModNode(Q);if(L){L.remove(true);delete this[Q+u];}},_insertStdModSection:function(L,S,R){var Q=L.get(C);if(S===p||!Q){L.appendChild(R);}else{if(S===k){L.insertBefore(R,Q);}else{var T=this[p+u];if(T){L.insertBefore(R,T);}else{L.appendChild(R);}}}},_getStdModTemplate:function(L){return q.create(P.TEMPLATES[L],this._stdModNode.get(n));},_addStdModContent:function(R,Q,L){switch(L){case P.BEFORE:L=0;break;case P.AFTER:L=undefined;break;default:L=P.REPLACE;}R.insert(Q,L);},_getPreciseHeight:function(R){var L=(R)?R.get(F):0,S="getBoundingClientRect";if(R&&R.hasMethod(S)){var Q=R.invoke(S);if(Q){L=Q.bottom-Q.top;}}return L;},_findStdModSection:function(L){return this.get(v).one("> ."+P.SECTION_CLASS_NAMES[L]);},_parseStdModHTML:function(Q){var L=this._findStdModSection(Q);if(L){if(!this._stdModParsed){this._stdModParsed={};b.before(this._applyStdModParsedConfig,this,H);}this._stdModParsed[Q+I]=1;return L.get("innerHTML");}return null;},_applyStdModParsedConfig:function(S,L,R){var Q=this._stdModParsed;if(Q){Q[a]=!(a in L)&&(a in Q);Q[i]=!(i in L)&&(i in Q);Q[c]=!(c in L)&&(c in Q);}},_getStdModContent:function(L){return(this[L+u])?this[L+u].get(h):null;},setStdModContent:function(R,Q,L){this.set(R+I,Q,{stdModPosition:L});},getStdModNode:function(L){return this[L+u]||null;},fillHeight:function(Q){if(Q){var V=this.get(v),W=[this.headerNode,this.bodyNode,this.footerNode],L,X,Y=0,T=0,S=false;for(var U=0,R=W.length;U<R;U++){L=W[U];if(L){if(L!==Q){Y+=this._getPreciseHeight(L);}else{S=true;}}}if(S){if(x.ie||x.opera){Q.set(F,0);}X=V.get(F)-parseInt(V.getComputedStyle("paddingTop"),10)-parseInt(V.getComputedStyle("paddingBottom"),10)-parseInt(V.getComputedStyle("borderBottomWidth"),10)-parseInt(V.getComputedStyle("borderTopWidth"),10);if(f.isNumber(X)){T=X-Y;if(T>=0){Q.set(F,T);}}}}}};b.WidgetStdMod=P;},"3.4.0",{requires:["base-build","widget"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("widget-stack",function(e){var m=e.Lang,s=e.UA,B=e.Node,f=e.Widget,A="zIndex",o="shim",y="visible",C="boundingBox",v="renderUI",g="bindUI",r="syncUI",p="offsetWidth",d="offsetHeight",l="parentNode",a="firstChild",w="ownerDocument",h="width",u="height",k="px",n="shimdeferred",D="shimresize",x="visibleChange",c="widthChange",j="heightChange",z="shimChange",b="zIndexChange",i="contentUpdate",q="stacked";function t(E){this._stackNode=this.get(C);this._stackHandles={};e.after(this._renderUIStack,this,v);e.after(this._syncUIStack,this,r);e.after(this._bindUIStack,this,g);}t.ATTRS={shim:{value:(s.ie==6)},zIndex:{value:1,setter:function(E){return this._setZIndex(E);}}};t.HTML_PARSER={zIndex:function(E){return E.getStyle(A);}};t.SHIM_CLASS_NAME=f.getClassName(o);t.STACKED_CLASS_NAME=f.getClassName(q);t.SHIM_TEMPLATE='<iframe class="'+t.SHIM_CLASS_NAME+'" frameborder="0" title="Widget Stacking Shim" src="javascript:false" tabindex="-1" role="presentation"></iframe>';t.prototype={_syncUIStack:function(){this._uiSetShim(this.get(o));this._uiSetZIndex(this.get(A));},_bindUIStack:function(){this.after(z,this._afterShimChange);this.after(b,this._afterZIndexChange);},_renderUIStack:function(){this._stackNode.addClass(t.STACKED_CLASS_NAME);},_setZIndex:function(E){if(m.isString(E)){E=parseInt(E,10);}if(!m.isNumber(E)){E=0;}return E;},_afterShimChange:function(E){this._uiSetShim(E.newVal);},_afterZIndexChange:function(E){this._uiSetZIndex(E.newVal);},_uiSetZIndex:function(E){this._stackNode.setStyle(A,E);},_uiSetShim:function(E){if(E){if(this.get(y)){this._renderShim();}else{this._renderShimDeferred();}}else{this._destroyShim();}},_renderShimDeferred:function(){this._stackHandles[n]=this._stackHandles[n]||[];var F=this._stackHandles[n],E=function(G){if(G.newVal){this._renderShim();}};F.push(this.on(x,E));},_addShimResizeHandlers:function(){this._stackHandles[D]=this._stackHandles[D]||[];var F=this.sizeShim,E=this._stackHandles[D];this.sizeShim();E.push(this.after(x,F));E.push(this.after(c,F));E.push(this.after(j,F));E.push(this.after(i,F));},_detachStackHandles:function(E){var F=this._stackHandles[E],G;if(F&&F.length>0){while((G=F.pop())){G.detach();}}},_renderShim:function(){var E=this._shimNode,F=this._stackNode;if(!E){E=this._shimNode=this._getShimTemplate();F.insertBefore(E,F.get(a));if(s.ie==6){this._addShimResizeHandlers();}this._detachStackHandles(n);}},_destroyShim:function(){if(this._shimNode){this._shimNode.get(l).removeChild(this._shimNode);this._shimNode=null;this._detachStackHandles(n);this._detachStackHandles(D);}},sizeShim:function(){var F=this._shimNode,E=this._stackNode;if(F&&s.ie===6&&this.get(y)){F.setStyle(h,E.get(p)+k);F.setStyle(u,E.get(d)+k);}},_getShimTemplate:function(){return B.create(t.SHIM_TEMPLATE,this._stackNode.get(w));}};e.WidgetStack=t;},"3.4.0",{requires:["base-build","widget"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("widget-position-constrain",function(c){var f="constrain",d="constrain|xyChange",b="constrainChange",n="preventOverlap",e="align",o="",g="bindUI",i="xy",a="x",m="y",j=c.Node,p="viewportRegion",l="region",k;function h(q){if(!this._posNode){c.error("WidgetPosition needs to be added to the Widget, before WidgetPositionConstrain is added");}c.after(this._bindUIPosConstrained,this,g);}h.ATTRS={constrain:{value:null,setter:"_setConstrain"},preventOverlap:{value:false}};k=h._PREVENT_OVERLAP={x:{"tltr":1,"blbr":1,"brbl":1,"trtl":1},y:{"trbr":1,"tlbl":1,"bltl":1,"brtr":1}};h.prototype={getConstrainedXY:function(t,s){s=s||this.get(f);var r=this._getRegion((s===true)?null:s),q=this._posNode.get(l);return[this._constrain(t[0],a,q,r),this._constrain(t[1],m,q,r)];},constrain:function(u,r){var t,q,s=r||this.get(f);if(s){t=u||this.get(i);q=this.getConstrainedXY(t,s);if(q[0]!==t[0]||q[1]!==t[1]){this.set(i,q,{constrained:true});}}},_setConstrain:function(q){return(q===true)?q:j.one(q);},_constrain:function(q,r,z,s){if(s){if(this.get(n)){q=this._preventOverlap(q,r,z,s);}var v=(r==a),y=(v)?s.width:s.height,u=(v)?z.width:z.height,t=(v)?s.left:s.top,w=(v)?s.right-u:s.bottom-u;if(q<t||q>w){if(u<y){if(q<t){q=t;}else{if(q>w){q=w;}}}else{q=t;}}}return q;},_preventOverlap:function(r,s,C,t){var w=this.get(e),B=(s===a),z,v,u,y,A,q;if(w&&w.points&&k[s][w.points.join(o)]){v=this._getRegion(w.node);if(v){z=(B)?C.width:C.height;u=(B)?v.left:v.top;y=(B)?v.right:v.bottom;A=(B)?v.left-t.left:v.top-t.top;q=(B)?t.right-v.right:t.bottom-v.bottom;}if(r>u){if(q<z&&A>z){r=u-z;}}else{if(A<z&&q>z){r=y;}}}return r;},_bindUIPosConstrained:function(){this.after(b,this._afterConstrainChange);this._enableConstraints(this.get(f));},_afterConstrainChange:function(q){this._enableConstraints(q.newVal);},_enableConstraints:function(q){if(q){this.constrain();this._cxyHandle=this._cxyHandle||this.on(d,this._constrainOnXYChange);}else{if(this._cxyHandle){this._cxyHandle.detach();this._cxyHandle=null;}}},_constrainOnXYChange:function(q){if(!q.constrained){q.newVal=this.getConstrainedXY(q.newVal);}},_getRegion:function(q){var r;if(!q){r=this._posNode.get(p);}else{q=j.one(q);if(q){r=q.get(l);}}return r;}};c.WidgetPositionConstrain=h;},"3.4.0",{requires:["widget-position"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("overlay",function(a){a.Overlay=a.Base.create("overlay",a.Widget,[a.WidgetStdMod,a.WidgetPosition,a.WidgetStack,a.WidgetPositionAlign,a.WidgetPositionConstrain]);},"3.4.0",{requires:["widget","widget-stdmod","widget-position","widget-stack","widget-position-align","widget-position-constrain"]});YUI.add("gallery-popover",function(c){var t="boundingBox",j="contentBox",b="tl",n="t",a="tr",g="rt",i="r",r="rb",s="br",h="b",m="bl",d="lb",k="l",f="lt",u=27,e=50,o=28,q=18;var l={initializer:function(){},bindUI:function(){this.after("arrowPositionChange",function(w){this._arrow.removeClass(this.getClassName("arrow",w.prevVal));this._arrowMask.removeClass(this.getClassName("arrow","mask",w.prevVal));this._arrow.addClass(this.getClassName("arrow",w.newVal));this._arrowMask.addClass(this.getClassName("arrow","mask",w.newVal))})},renderUI:function(){this._arrow=c.Node.create('<span class="'+this.getClassName("arrow")+'">◣</span>');this._arrowMask=c.Node.create('<span class="'+this.getClassName("arrow","mask")+'"></span>');this.get(t).append(this._arrow).append(this._arrowMask);var w=this.get("arrowPosition");this._arrow.addClass(this.getClassName("arrow",w));this._arrowMask.addClass(this.getClassName("arrow","mask",w));if(c.UA.webkit&&c.UA.os==="windows"){this._arrow.addClass("win-webkit");this._arrow.addClass(c.UA.chrome?"win-chrome":"win-safari")}else{if(c.UA.gecko&&c.UA.os==="windows"){this._arrow.addClass("win-gecko");this._arrow.addClass("win-firefox");if(c.UA.gecko>=1.9&&c.UA.gecko<2){this._arrow.addClass("win-firefox-3")}}}},syncUI:function(){},alignToElement:function(y,J){var x,z,H,I,A,E,B=this.get("arrowPosition"),w,D,G,C;switch(B){case b:x=[c.WidgetPositionAlign.TL,c.WidgetPositionAlign.BC];z={x:-o,y:q};break;case n:x=[c.WidgetPositionAlign.TC,c.WidgetPositionAlign.BC];z={x:0,y:q};break;case a:x=[c.WidgetPositionAlign.TR,c.WidgetPositionAlign.BC];z={x:o,y:q};break;case g:x=[c.WidgetPositionAlign.TR,c.WidgetPositionAlign.LC];z={x:-q,y:-o};break;case i:x=[c.WidgetPositionAlign.RC,c.WidgetPositionAlign.LC];z={x:-q,y:0};break;case r:x=[c.WidgetPositionAlign.BR,c.WidgetPositionAlign.LC];z={x:-q,y:o};break;case s:x=[c.WidgetPositionAlign.BR,c.WidgetPositionAlign.TC];z={x:o,y:-q};break;case h:x=[c.WidgetPositionAlign.BC,c.WidgetPositionAlign.TC];z={x:0,y:-q};break;case m:x=[c.WidgetPositionAlign.BL,c.WidgetPositionAlign.TC];z={x:-o,y:-q};break;case d:x=[c.WidgetPositionAlign.BL,c.WidgetPositionAlign.RC];z={x:q,y:o};break;case k:x=[c.WidgetPositionAlign.LC,c.WidgetPositionAlign.RC];z={x:q,y:0};break;case f:x=[c.WidgetPositionAlign.TL,c.WidgetPositionAlign.RC];z={x:q,y:-o}}v(this._arrow);v(this._arrowMask);this.align(y,x);H=this._posNode.get("region");I=[H.left+z.x,H.top+z.y];this.move(I);if(J){this.constrain(null,J);H=this._posNode.get("region");A=[H.left,H.top];if(B===b||B===n||B===a||B===m||B===h||B===s){if(I[0]!==A[0]){E=I[0]-A[0];this._arrow.setX(this._arrow.getX());this._arrow.setStyle("right","auto");w=this._arrow.getX()+E;if(w+u>H.right){w=H.right-u}else{if(w<H.left){w=H.left}}this._arrow.setX(w);this._arrowMask.setX(this._arrowMask.getX());this._arrowMask.setStyle("right","auto");D=this._arrowMask.getX()+E;if(D+e>H.right){D=H.right-e}else{if(D<H.left){D=H.left}}this._arrowMask.setX(D)}if(I[1]!==A[1]){E=I[1]-A[1];H=this._posNode.get("region");I=[H.left,H.top+E];this.move(I)}}else{if(B===f||B===k||B===d||B===g||B===i||B===r){if(I[1]!==A[1]){E=I[1]-A[1];this._arrow.setY(this._arrow.getY());this._arrow.setStyle("bottom","auto");G=this._arrow.getY()+E;if(G+u>H.bottom){G=H.bottom-u}else{if(G<H.top){G=H.top}}this._arrow.setY(G);this._arrowMask.setY(this._arrowMask.getY());this._arrowMask.setStyle("bottom","auto");C=this._arrowMask.getY()+E;if(C+e>H.bottom){C=H.bottom-e}else{if(C<H.top){C=H.top}}this._arrowMask.setY(G)}if(I[0]!==A[0]){E=I[0]-A[0];H=this._posNode.get("region");I=[H.left+E,H.top];this.move(I)}}}}}};var p={TOPLEFT:b,TOP:n,TOPRIGHT:a,RIGHTTOP:g,RIGHT:i,RIGHTBOTTOM:r,BOTTOMRIGHT:s,BOTTOM:h,BOTTOMLEFT:m,LEFTBOTTOM:d,LEFT:k,LEFTTOP:f,CSS_PREFIX:"yui3-popover",ATTRS:{arrowPosition:{value:n,validator:function(w){return(w===b||w===n||w===a||w===m||w===h||w===s||w===f||w===k||w===d||w===g||w===i||w===r)}}}};function v(w){w.setStyle("top","").setStyle("right","").setStyle("bottom","").setStyle("left","")}c.Popover=c.Base.create("popover",c.Widget,[c.WidgetStdMod,c.WidgetPosition,c.WidgetStack,c.WidgetPositionAlign,c.WidgetPositionConstrain],l,p)},"0.0.1",{requires:F.config.modules["gallery-popover"].requires||[],optional:F.config.modules["gallery-popover"].optional||[]});YUI.add("menus",function(e){var a={};function d(f){a[f.id]=new c(f);return a[f.id]}function b(){e.fire("flickr-menus:hide")}e.menus={add:d,hide:b};function c(f){c.superclass.constructor.apply(this,arguments)}c.NAME="Menu";c.ATTRS={id:{value:""},popover:{},context:{},button_node:{},button_click_listener:{},click_to_hide_handle:{},escape_key_listener:{}};e.extend(c,e.Base,{initializer:function(f){this.set("id",f.id);this.set("popover",f.popover);this.set("context",f.context);if(f.button_node instanceof e.Node){this.set("button_node",f.button_node)}else{f.button_node=undefined;delete f.button_node}e.on("flickr-menus:hide",function(g){this.hide()},this);this.attachButtonClickHandler();this.after("button_nodeChange",this.attachButtonClickHandler,this)},show:function(){if(this.get("popover").get("visible")){return false}if(this.get("button_node")){this.get("button_node").addClass("ActiveButt")}e.fire("flickr-menus:hide");if(this.get("button_node")){this.get("popover").alignToElement(this.get("button_node"),e.one("#main"))}this.get("popover").show();e.contextManager.set(this.get("context"));e.later(20,this,function(){var g,f;if(!this.get("click_to_hide_handle")){g=e.one("body").on("click",function(h){if(this.get("popover").get("boundingBox").contains(h.target)||!h.target.ancestor("body",true)){return}this.hide()},this);this.set("click_to_hide_handle",g)}if(!this.get("escape_key_listener")){f=e.keyboardShortcutManager.register({keystring:"27",handler:function(h){this.hide()},context:this.get("context"),scope:this});this.set("escape_key_listener",f)}})},hide:function(){if(!this.get("popover").get("visible")){return false}if(this.get("button_node")){this.get("button_node").removeClass("ActiveButt")}this.get("popover").hide();e.contextManager.unset(this.get("context"));if(this.get("escape_key_listener")){this.get("escape_key_listener").detach();this.set("escape_key_listener",undefined)}if(this.get("click_to_hide_handle")){this.get("click_to_hide_handle").detach();this.set("click_to_hide_handle",undefined)}},toggle:function(){if(this.get("popover").get("visible")){this.hide()}else{this.show()}},attachButtonClickHandler:function(){var f;if(this.get("button_click_listener")){this.get("button_click_listener").detach();this.set("button_click_listener",undefined)}f=this.get("button_node").on("click",function(h){h.preventDefault();if(h.currentTarget.hasClass("DisabledButt")){return}this.toggle();try{h.currentTarget.blur()}catch(g){}},this);this.set("button_click_listener",f)}})},"0.0.1",{requires:F.config.modules.menus.requires||[],optional:F.config.modules.menus.optional||[]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("event-simulate",function(a){(function(){var k=a.Lang,j=a.Array,f=k.isFunction,d=k.isString,g=k.isBoolean,o=k.isObject,n=k.isNumber,m=a.config.doc,p={click:1,dblclick:1,mouseover:1,mouseout:1,mousedown:1,mouseup:1,mousemove:1},l={keydown:1,keyup:1,keypress:1},c={blur:1,change:1,focus:1,resize:1,scroll:1,select:1},e={scroll:1,resize:1,reset:1,submit:1,change:1,select:1,error:1,abort:1};a.mix(e,p);a.mix(e,l);function i(v,z,u,s,B,r,q,A,x,D,C){if(!v){a.error("simulateKeyEvent(): Invalid target.");}if(d(z)){z=z.toLowerCase();switch(z){case"textevent":z="keypress";break;case"keyup":case"keydown":case"keypress":break;default:a.error("simulateKeyEvent(): Event type '"+z+"' not supported.");}}else{a.error("simulateKeyEvent(): Event type must be a string.");}if(!g(u)){u=true;}if(!g(s)){s=true;}if(!o(B)){B=window;}if(!g(r)){r=false;}if(!g(q)){q=false;}if(!g(A)){A=false;}if(!g(x)){x=false;}if(!n(D)){D=0;}if(!n(C)){C=0;}var y=null;if(f(m.createEvent)){try{y=m.createEvent("KeyEvents");y.initKeyEvent(z,u,s,B,r,q,A,x,D,C);}catch(w){try{y=m.createEvent("Events");}catch(t){y=m.createEvent("UIEvents");}finally{y.initEvent(z,u,s);y.view=B;y.altKey=q;y.ctrlKey=r;y.shiftKey=A;y.metaKey=x;y.keyCode=D;y.charCode=C;}}v.dispatchEvent(y);}else{if(o(m.createEventObject)){y=m.createEventObject();y.bubbles=u;y.cancelable=s;y.view=B;y.ctrlKey=r;y.altKey=q;y.shiftKey=A;y.metaKey=x;y.keyCode=(C>0)?C:D;v.fireEvent("on"+z,y);}else{a.error("simulateKeyEvent(): No event simulation framework present.");}}}function b(A,F,x,u,G,z,w,v,t,r,s,q,E,C,y,B){if(!A){a.error("simulateMouseEvent(): Invalid target.");}if(d(F)){F=F.toLowerCase();if(!p[F]){a.error("simulateMouseEvent(): Event type '"+F+"' not supported.");}}else{a.error("simulateMouseEvent(): Event type must be a string.");}if(!g(x)){x=true;}if(!g(u)){u=(F!="mousemove");}if(!o(G)){G=window;}if(!n(z)){z=1;}if(!n(w)){w=0;}if(!n(v)){v=0;}if(!n(t)){t=0;}if(!n(r)){r=0;}if(!g(s)){s=false;}if(!g(q)){q=false;}if(!g(E)){E=false;}if(!g(C)){C=false;}if(!n(y)){y=0;}B=B||null;var D=null;if(f(m.createEvent)){D=m.createEvent("MouseEvents");if(D.initMouseEvent){D.initMouseEvent(F,x,u,G,z,w,v,t,r,s,q,E,C,y,B);}else{D=m.createEvent("UIEvents");D.initEvent(F,x,u);D.view=G;D.detail=z;D.screenX=w;D.screenY=v;D.clientX=t;D.clientY=r;D.ctrlKey=s;D.altKey=q;D.metaKey=C;D.shiftKey=E;D.button=y;D.relatedTarget=B;}if(B&&!D.relatedTarget){if(F=="mouseout"){D.toElement=B;}else{if(F=="mouseover"){D.fromElement=B;}}}A.dispatchEvent(D);}else{if(o(m.createEventObject)){D=m.createEventObject();D.bubbles=x;D.cancelable=u;D.view=G;D.detail=z;D.screenX=w;D.screenY=v;D.clientX=t;D.clientY=r;D.ctrlKey=s;D.altKey=q;D.metaKey=C;D.shiftKey=E;switch(y){case 0:D.button=1;break;case 1:D.button=4;break;case 2:break;default:D.button=0;}D.relatedTarget=B;A.fireEvent("on"+F,D);}else{a.error("simulateMouseEvent(): No event simulation framework present.");}}}function h(w,v,s,r,q,u){if(!w){a.error("simulateUIEvent(): Invalid target.");}if(d(v)){v=v.toLowerCase();if(!c[v]){a.error("simulateUIEvent(): Event type '"+v+"' not supported.");}}else{a.error("simulateUIEvent(): Event type must be a string.");}var t=null;if(!g(s)){s=(v in e);}if(!g(r)){r=(v=="submit");}if(!o(q)){q=window;}if(!n(u)){u=1;}if(f(m.createEvent)){t=m.createEvent("UIEvents");t.initUIEvent(v,s,r,q,u);w.dispatchEvent(t);}else{if(o(m.createEventObject)){t=m.createEventObject();t.bubbles=s;t.cancelable=r;t.view=q;t.detail=u;w.fireEvent("on"+v,t);}else{a.error("simulateUIEvent(): No event simulation framework present.");}}}a.Event.simulate=function(s,r,q){q=q||{};if(p[r]){b(s,r,q.bubbles,q.cancelable,q.view,q.detail,q.screenX,q.screenY,q.clientX,q.clientY,q.ctrlKey,q.altKey,q.shiftKey,q.metaKey,q.button,q.relatedTarget);}else{if(l[r]){i(s,r,q.bubbles,q.cancelable,q.view,q.ctrlKey,q.altKey,q.shiftKey,q.metaKey,q.keyCode,q.charCode);}else{if(c[r]){h(s,r,q.bubbles,q.cancelable,q.view,q.detail);}else{a.error("simulate(): Event '"+r+"' can't be simulated.");}}}};})();},"3.4.0",{requires:["event-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("node-event-simulate",function(a){a.Node.prototype.simulate=function(c,b){a.Event.simulate(a.Node.getDOMNode(this),c,b);};},"3.4.0",{requires:["node-base","event-simulate"]});YUI.add("photo-button-bar-transjax",function(a){a.transjax.add("photo-button-bar",{pool_limit_reached:'Pool limit reached',pool_limit_reached_msg:'You have already added the maximum amount of allowed photos to this pool.',photo_in_maximum_pools:'Photo in maximum number of pools',photo_in_maximum_pools_msg:'This photo has already been added to the maximum allowed number of pools.',video_in_maximum_pools:'Video in maximum number of pools',video_in_maximum_pools_msg:'This video has already been added to the maximum allowed number of pools.',photo_adding_disabled:'Adding items to %s has been disabled.',photo_limits_1:"You can only add %s items to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_2:"You can only add %s item to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_3_day:"You can only add %s items per day to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_3_week:"You can only add %s items per week to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_3_month:"You can only add %s items per month to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_4_day:"You can only add %s item per day to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_4_week:"You can only add %s item per week to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",photo_limits_4_month:"You can only add %s item per month to %s. (You\'ve already added %s.) Remove something from the pool if you really want to add this.",video_already_invited:'The video has already been invited to this group',video_already_invited_msg:'You cannot invite it again.',photo_already_invited:'The photo has already been invited to this group',photo_already_invited_msg:'You cannot invite it again.',cant_invite_that_video:"You can't invite the video to that group",cant_invite_that_video_msg:'',cant_invite_that_photo:"You can't invite the photo to that group",cant_invite_that_photo_msg:'',video_invite_error:'There was an error inviting the video to this group',video_invite_error_msg:'Please reload the page and try again.',photo_invite_error:'There was an error inviting the photo to this group',photo_invite_error_msg:'Please reload the page and try again.',video_in_queue_error:'This video is already in the moderation queue.',video_in_queue_error_msg:"",photo_in_queue_error:'This photo is already in the moderation queue.',photo_in_queue_error_msg:"",cant_add_photo_set_error:"The photo couldn't be added to this set",cant_add_photo_set_error_msg:"This set no longer exists. This may be because it's been deleted, or because all photos have been removed from it.",cant_add_video_set_error:"The video couldn't be added to this set",cant_add_video_set_error_msg:"This set no longer exists. This may be because it's been deleted, or because all photos have been removed from it.",cant_add_set_over_limit_error:"Whoa it's getting crowded in here!",cant_add_set_over_limit_error_msg:"The {set_name} set is over the limit of {set_limit} photos and videos. You might want to go to the <a href='http://www.flickr.com/photos/organize/?start_tab=one_set{set_id}'>Organizr</a> and clear out a few or start a new set.",close:'Close',pending_approval:'Pending approval by group administrator',invitation_sent:'Invitation sent',photo_not_added_to_pool_restrictions_zeus:'This photo could not be added to the <strong><a href="/groups/%s/pool/">%s</a></strong> group because it violates one or more of the pool rules.',video_not_added_to_pool_restrictions_zeus:'This video could not be added to the <strong><a href="/groups/%s/pool/">%s</a></strong> group because it violates one or more of the pool rules.',photo_see_group_for_info_zeus:'See the <strong><a href="/groups/%s/">%s</a></strong> group page for more information.',this_photo_also_belongs_to:'This photo also appears in',this_video_also_belongs_to:'This video also appears in',are_you_sure_you_want_to_delete_photo:'Are you sure you want to <strong>delete</strong> this photo?',are_you_sure_you_want_to_delete_video:'Are you sure you want to <strong>delete</strong> this video?',cannot_be_undone:'This cannot be undone.',done:'DONE',ok_thanks:'Okay, thanks',cancel:'Cancel',delete_photo_button:'Delete photo',delete_video_button:'Delete video',can_always_find_in_actions_menu:'Just so you know, you can always find an "Add to your map" link in the "Actions" menu.',group_invites:'Group invites',add_to_set:'Add to a set',add_remove_set:'Add to / remove from set',add_to_group:'Add to a group',add_remove_group:'Add to / remove from group',add_to_your_map:'Add to your map',edit_location_on_your_map:'Edit location on your map',remove_from_group_not_a_member:"Are you sure you want to remove the photo from this group? You aren\'t a member of the group, so you will not be able to add it back without an invitation.",remove:'REMOVE',next:'Next',prev:'Prev',older:'Older',newer:'Newer',search_your_sets:'Type to search your sets',search_the_groups:'Type to search the groups',search_your_galleries:'Type to search your galleries',keyboard_shortcut_changed:'That keyboard shortcut has been changed',keyboard_shortcut_set:'The keyboard shortcut for opening the Add to Set interface has been changed from <b>S</b> to <b>E</b>. Sorry for the inconvenience.',open_add_to_group:'Add to a group',open_add_to_gallery:'Add to a gallery',open_add_to_set:'Add to a set',over_member_limit_message:"This group has reached the pool limit. Why not head to <a href='/photos/organize/'>the Organizr</a> to clear out some room?",generic_api_error:'Something went wrong.'})},"0.0.1",{requires:["transjax-base"]});YUI.add("dejaview",function(e){var d,a,c;d="dvz";a={domain:".flickr.com",path:"/"};c=false;function b(){var j,g,i,f,h;if(!e.config.flickr||!e.config.flickr.server_timestamp||!e.config.flickr.dejaview||!e.config.flickr.dejaview.id){return}if(!c){j=e.config.flickr.dejaview.id;g=e.config.flickr.server_timestamp;i=e.Cookie.getSubs(d);if(i){h=e.Object.keys(i).length;while(h>10){f=undefined;e.Object.each(i,function(l,k){if(!f||l<i[f]){f=k}});if(f){delete i[f];h--;e.Cookie.removeSub(d,f,a)}else{break}}}e.Cookie.setSub(d,j,g,a);c=true}}e.dejaview=b},"0.0.1",{requires:["cookie"]});YUI.add("photo-people-transjax",function(a){a.transjax.add("photo-people",{face_or_note:'Are you adding a <strong>note</strong> or a <strong>person</strong>?',edit_face_boundry:'Edit face boundary?',add_face_boundry:'Add a face boundary for this person?',remove_person:'Remove this person?',remove_yourself:'Remove yourself from this photo? No one else will be able to re-add you.',already_marked:'That person already has their face marked in this photo.',cant_add_face:"That person has already been added by someone else. You can't add a face boundary for them.",cant_edit:"You can't edit or delete that person at the moment. Please reload the page and try again.",send_an_email_photo:'<a href="#">Send an email to this address</a>, inviting the recipient to confirm they appear in this photo?',send_an_email_video:'<a href="#">Send an email to this address</a>, inviting the recipient to confirm they appear in this video?',or_send_an_email_photo:'Or, <a href="#">send an email to this address</a>, inviting the recipient to confirm they appear in this photo?',or_send_an_email_video:'Or, <a href="#">send an email to this address</a>, inviting the recipient to confirm they appear in this video?',if_you_enter_email_photo:"If you enter an email address instead of a name, we\'ll send an email inviting the recipient to confirm they appear in this photo.",if_you_enter_email_video:"If you enter an email address instead of a name, we\'ll send an email inviting the recipient to confirm they appear in this video.",if_you_enter_email_photo_2:"If you enter an email address instead of a name, we\'ll send a mail inviting the recipient to confirm they appear in this photo.",if_you_enter_email_video_2:"If you enter an email address instead of a name, we\'ll send a mail inviting the recipient to confirm they appear in this video.",reached_user_limit_photo:"You can\'t add any more people to this photo.",reached_user_limit_video:"You can\'t add any more people to this video.",reached_invite_limit_photo:"You can\'t add any more people to this photo.",reached_invite_limit_video:"You can\'t add any more people to this video.",username_tooltip_your_photos:'View your photos of %s',username_tooltip_photos_of_you:'View %s photos of you',username_tooltip:'View %s photos of %s',cant_tag_general_msg:'You cannot add this user to the photo.',cant_tag_vid_general_msg:'You cannot add this user to the video.',cant_tag_msg:'That member does not allow others to add them to photos.',saving_face_boundry:'Saving face boundary...',deleting_face_boundry:'Deleting face boundary...',not_visible_to_others:'Not visible to others',adding:'Adding...',deleting:'Deleting...',type_person_name:'Type the name of this person:',add_yourself_to_video:"Since this isn\'t your video and isn\'t public, the only person you can add to it is yourself. Are you in the video?",add_yourself_to_photo:"Since this isn\'t your photo and isn\'t public, the only person you can add to it is yourself. Are you in the photo?"})},"0.0.1",{requires:["transjax-base"]});YUI.add("photo-people-controller",function(e){var d;function a(h,g,i){var j,l,k;if(!g){k=e.transjax.get("photo-people","cant_tag_general_msg")}else{if(g.c==="0"){k=e.transjax.get("photo-people","cant_tag_msg")}else{if(!g.n&&!g.e){k=e.transjax.get("photo-people","cant_tag_general_msg")}}}if(k){e.fire("peopleController:addPersonFailure",g,k);return}j={photo_id:h};if(i){j.person_h=i.h;j.person_w=i.w;j.person_x=i.x;j.person_y=i.y}l={success:function(n){var m;e.dejaview();if(g.n){e.fire("peopleController:addPersonSuccess",g,i)}else{if(g.e&&n.data&&n.data.result&&parseInt(n.data.result.flickr_member,10)===1&&n.data.result.flickr_member_nsid){e.flickrAPI.callMethod("flickr.people.getInfo",{user_id:n.data.result.flickr_member_nsid},{success:function(){var o=arguments[0].data.person;e.fire("peopleController:addPersonSuccess",{n:o.id,u:o.username._content,r:o.realname._content,e:g.e,s:o.iconserver,f:o.iconfarm,i:(o.iconfarm&&o.iconfarm!==0&&o.iconserver&&o.iconserver!==0)?"http://farm"+o.iconfarm+".static"+(e.config.flickr.dev?"-dev":"")+".flickr.com/"+o.iconserver+"/buddyicons/"+o.id+".jpg":"http://www.flickr.com/images/buddyicon.jpg",a:o.path_alias,d:o.friend,y:o.family},i)},failure:function(){alert("Couldn't get member data.")}})}else{e.fire("peopleController:addPersonSuccess",g,i)}}m=e.PhotoData.get(h);if(m){m.increment("people_count")}},failure:function(m){e.fire("peopleController:addPersonFailure",g,e.transjax.get("photo-people","cant_tag_general_msg"))}};if(g.n){if(!e.config.flickr.people.skip){e.config.flickr.people.skip={}}e.config.flickr.people.skip[g.n]=g;j.user_id=g.n;e.flickrAPI.callMethod("flickr.photos.people.add",j,l)}else{if(g.e){j.email=g.e;e.flickrAPI.callMethod("flickr.photos.people.addByEmail",j,l)}}}function b(h,g){var i,j;i={photo_id:h};if(g.n){i.user_id=g.n}else{if(g.e){i.email=g.e}}j={success:function(l){var k;e.dejaview();e.fire("peopleController:removePersonSuccess",g);k=e.PhotoData.get(h);if(k){k.decrement("people_count")}},failure:function(){e.fire("peopleController:removePersonFailure",g)}};e.flickrAPI.callMethod("flickr.photos.people.delete",i,j)}function c(){return d}function f(g){d=g}e.peopleController={addPerson:a,removePerson:b,getContactsCache:c,setContactsCache:f}},"0.0.1",{requires:["event","gallery-flickr-api","dejaview","photo-people-transjax"]});YUI.add("input-hint",function(d){var g;function m(n){n.hint.addClass("input-hint-hidden")}function e(n){n.hint.removeClass("input-hint-hidden")}function f(n){var o=n.field.get("value");if(n!==g&&o===""){n.hint.setStyle("position","absolute");n.hint.setXY(n.field.getXY());e(n)}else{m(n)}}function l(){var n;if(!d.Lang.isBoolean(l.is_okay)){n=window.document.createElement("input");l.is_okay=!!("placeholder" in n)}return l.is_okay}function b(r){var o,q,p,n;if(d.Lang.isString(r)){r=d.one(r)}if(r&&r instanceof d.Node){q=r.getAttribute("for");p=d.one("#"+q);if(p&&p instanceof d.Node){if(l()){p.setAttribute("placeholder",r.get("innerHTML"));r.remove();o=undefined}else{n=p.ancestor("form")||d.one("body");o={hint:r,field:p,container:n}}}}return o}function i(o,n){n.field.focus()}function j(o,n){if(o.target===n.field){g=n;m(n)}}function a(o,n){g=undefined;f(n)}function h(o,n){window.setTimeout(function(){f(n)},0)}function c(p){var o,n;for(n=0;n<p.length;n+=1){o=p[n];o.field.blur();f(o)}}function k(r){var o,t,q,s,p,n;if(d.Lang.isString(r)){r=d.one(r)}if(!r instanceof d.Node){return false}q=[];n=0;if(r.get("tagName").toLowerCase()==="label"&&r.hasClass("input-hint")){p=b(r);if(p){q.push(p)}}else{if(r.test("textarea, input[type=text]")){o=d.one("label[for="+r.get("id")+"].input-hint");t=r.getAttribute("placeholder");if(!o&&!l()&&t){o=d.Node.create('<label for="message" class="input-hint input-hint-hidden">'+t+"</label>");r.get("parentNode").insertBefore(o,r)}if(o){p=b(o);if(p){q.push(p)}}}else{r.all("label.input-hint").each(function(w,v,u){p=b(w);if(p){q.push(p)}})}}d.Array.each(q,function(u){if(u.field.test(":focus")||(d.focusTracker.get()===u.field._node)){g=u}u.hint.on("click",i,this,u);u.field.on("drop",function(v){f(u)},this,u);d.one("body").on("click",h,this,u);d.one("body").on("keydown",h,this,u);u.container.on("focus",j,this,u);u.container.on("blur",a,this,u);f(u);n+=1});return{count:n,blurAll:function(){c(q)}}}d.inputHint=k},"0.0.1",{requires:["node","event-focus"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("io-form",function(b){var a=encodeURIComponent;b.mix(b.IO.prototype,{_serialize:function(w,B){var q=[],y=w.useDisabled||false,A=0,g=(typeof w.id==="string")?w.id:w.id.getAttribute("id"),t,r,k,z,u,p,x,l,m,h;if(!g){g=b.guid("io:");w.id.setAttribute("id",g);}r=b.config.doc.getElementById(g);for(p=0,x=r.elements.length;p<x;++p){t=r.elements[p];u=t.disabled;k=t.name;if(y?k:k&&!u){k=a(k)+"=";z=a(t.value);switch(t.type){case"select-one":if(t.selectedIndex>-1){h=t.options[t.selectedIndex];q[A++]=k+a(h.attributes.value&&h.attributes.value.specified?h.value:h.text);}break;case"select-multiple":if(t.selectedIndex>-1){for(l=t.selectedIndex,m=t.options.length;l<m;++l){h=t.options[l];if(h.selected){q[A++]=k+a(h.attributes.value&&h.attributes.value.specified?h.value:h.text);}}}break;case"radio":case"checkbox":if(t.checked){q[A++]=k+z;}break;case"file":case undefined:case"reset":case"button":break;case"submit":default:q[A++]=k+z;}}}return B?q.join("&")+"&"+B:q.join("&");}},true);},"3.4.0",{requires:["io-base","node-base"]});YUI.add("photo-comments-transjax",function(a){a.transjax.add("photo-comments",{error_delete_permission:"Sorry, but you don\'t have permission to delete that comment, or you aren\'t signed into Flickr.",error_delete_generic:'Sorry, but there was a problem deleting the comment.',error_edit_getting:'Sorry, but there was a problem getting the comment to edit.',error_edit_generic:'Sorry, but there was a problem editing the comment.',error_add_rate_limit:'Slow down, partner! To protect the Flickr community against spam, we place a few restrictions on new accounts. You can read more about these restrictions in <a href="http://www.flickr.com/help/website/#870679">this FAQ</a>.',error_add_generic:'We had a problem saving your comment.',reply_wipe_confirmation:'You already started typing a comment. If you continue, that text will be lost!',reply_button_confirm:'OKAY',reply_button_cancel:'CANCEL',delete_confirmation:'Are you sure you want to delete this comment?',delete_button_confirm:'YES, DELETE IT',delete_button_cancel:'CANCEL',hide_formatting_tips:'Hide formatting tips',faves_rollup_placeholder:'...and %s more favorites',block_user:'Block this user from commenting on your stuff in the future.',user_blocked:'You are currently blocking this Flickr member. They cannot add any more comments to any of your stuff. You can remove this via the blocked list on your "Contacts" page.',deleting:'Deleting...',bert_lorem_ipsum:"Lorem Ip\'sum lorem"})},"0.0.1",{requires:["transjax-base"]});if(typeof deconcept=="undefined"){var deconcept=new Object()}if(typeof deconcept.util=="undefined"){deconcept.util=new Object()}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object()}deconcept._playerVersion=null;deconcept.SWFObject=function(f,d,m,g,j,l,o,i,a,e,n){if(!document.getElementById){return}this.DETECT_KEY=e?e:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(f){this.setAttribute("swf",f)}if(d){this.setAttribute("id",d)}if(m){this.setAttribute("width",m)}if(g){this.setAttribute("height",g)}this.setAttribute("base",(n)?n:".");if(j){this.setAttribute("version",new deconcept.PlayerVersion(j.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(l){this.addParam("bgcolor",l)}var b=o?o:"high";this.addParam("quality",b);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var k=(i)?i:window.location;this.setAttribute("xiRedirectUrl",k);this.setAttribute("redirectUrl","");if(a){this.setAttribute("redirectUrl",a)}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"expressinstall.swf":a;this.setAttribute("useExpressInstall",true)},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addParam:function(a,b){this.params[a]=b},getParams:function(){return this.params},addVariable:function(a,b){this.variables[a]=b},getVariable:function(a){return this.variables[a]},getVariables:function(){return this.variables},getVariablePairs:function(){var a=new Array();var b;var c=this.getVariables();for(b in c){a[a.length]=b+"="+c[b]}return a},getSWFHTML:function(e){var d="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}d='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';d+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" base="'+this.getAttribute("base")+'" ';var c=this.getParams();for(var a in c){d+=[a]+'="'+c[a]+'" '}var b=this.getVariablePairs().join("&");if(b.length>0){d+='flashvars="'+b+'"'}d+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}d='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';d+='<param name="movie" value="'+this.getAttribute("swf")+'" />';d+='<param name="base" value="'+this.getAttribute("base")+'" />';var c=this.getParams();for(var a in c){d+='<param name="'+a+'" value="'+c[a]+'" />'}var b=this.getVariablePairs().join("&");if(b.length>0){d+='<param name="flashvars" value="'+b+'" />'}d+="</object>"}d=(typeof e!="undefined"?e:"")+d;return d},write:function(a,d){if(this.getAttribute("useExpressInstall")){var b=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(b)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var c=(typeof a=="string")?document.getElementById(a):a;c.innerHTML=this.getSWFHTML(d);return true}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}return false}};deconcept.SWFObjectUtil.getPlayerVersion=function(){if(deconcept._playerVersion){return deconcept._playerVersion}var c=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var a=navigator.plugins["Shockwave Flash"];if(a&&a.description){a.description.match(/[a-zA-Z\s]([0-9]+)\.([0-9]+)\s*[rbd]([0-9]+)/);var g=[RegExp.$1,RegExp.$2,RegExp.$3];if(navigator.platform.match(/win32/i)&&!g[0]){a.description.match(/[a-zA-Z\s]([0-9]+)\.([0-9]+|([0-9]+.[0-9]+.))\s*[rbd]([0-9]+)/);g=[RegExp.$1,RegExp.$2,RegExp.$3]}c=new deconcept.PlayerVersion(g)}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var d=1;var b=3;while(d){try{b++;d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+b);c=new deconcept.PlayerVersion([b,0,0])}catch(f){d=null}}}else{try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(f){try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");c=new deconcept.PlayerVersion([6,0,21]);d.AllowScriptAccess="always"}catch(f){if(c.major==6){return c}}try{d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(f){}}if(d!=null){c=new deconcept.PlayerVersion(d.GetVariable("$version").split(" ")[1].split(","))}}}deconcept._playerVersion=c;return c};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major){return false}if(this.major>a.major){return true}if(this.minor<a.minor){return false}if(this.minor>a.minor){return true}if(this.rev<a.rev){return false}return true};deconcept.util={getRequestParameter:function(d){var c=document.location.search||document.location.hash;if(d==null){return c}if(c){var b=c.substring(1).split("&");for(var a=0;a<b.length;a++){if(b[a].substring(0,b[a].indexOf("="))==d){return b[a].substring((b[a].indexOf("=")+1))}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var c=document.getElementsByTagName("OBJECT");for(var b=c.length-1;b>=0;b--){c[b].style.display="none";for(var a in c[b]){if(typeof c[b][a]=="function"){c[b][a]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(a){return document.all[a]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;function SWFMacMouseWheel(a){this.so=a;var b=navigator.appVersion.toLowerCase().indexOf("mac")!=-1;if(b){this.init()}}SWFMacMouseWheel.prototype={init:function(){SWFMacMouseWheel.instance=this;if(window.addEventListener){window.addEventListener("DOMMouseScroll",SWFMacMouseWheel.instance.wheel,false)}window.onmousewheel=document.onmousewheel=SWFMacMouseWheel.instance.wheel},handle:function(a){document[this.so.getAttribute("id")].externalMouseEvent(a)},wheel:function(a){var b=0;if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera){b=-b}}else{if(a.detail){b=-a.detail/3}}if(/AppleWebKit/.test(navigator.userAgent)){b/=3}if(b){SWFMacMouseWheel.instance.handle(b)}if(a.preventDefault){a.preventDefault()}a.returnValue=false}};YUI.add("photo-comments",function(b){var l,G,p=[];function L(){G=b.historyManager.getState().page;var S=b.one("#comments"),T=b.one("#message");if(T){f()}if(b.UA.ie&&b.UA.ie<7&&S){S.on("mouseover",z);S.on("mouseout",y)}if(b.config.flickr.flags.enable_grease&&!b.grease.enabled&&!b.config.flickr.user.nsid){var W=b.one(".add-comment-form");if(W){W.set("innerHTML","")}}var R=[["comment-reply",I],["comment-edit",h],["comment-delete",M],["comment-button-edit",e],["comment-button-preview",P],["comment-button-post",Q]],U=R.length;function V(Z){var X=Z.target;if(X.get("id")==="html-info-text"){w(Z);return}for(var Y=0;Y<U;Y++){if(X.hasClass(R[Y][0])){R[Y][1](Z);return}}if(X.ancestor(".comment-fave",true,".comment-block")){D(Z)}}if(S){S.on("click",V)}b.on("historyManager:change",function(X){if(b.contextManager.get()===""&&G!==(X.page||1)){g(X.page)}});H();o();j();return{}}function o(){var U,R,T,S;U=window.location.href.indexOf("#");if(U>-1){R=window.location.href.substr(U+1);T=/comment[0-9]+/.exec(location.hash);if(T&&T[0]){S=b.one("#"+T[0]);if(S){S.addClass("comment-highlighted")}}}}function t(R){B();if(R&&R.test("li")){R.addClass("hover")}else{if(R&&!R.test("ul")){t(R.get("parentNode"))}}}function B(){var R=b.one("#comments").all("li");R.removeClass("hover")}function z(R){t(R.target)}function y(R){B()}function f(){var R=b.one("#message");if(R){R.on("focus",function(S){if(b.keyboardShortcutManager){b.keyboardShortcutManager.disable()}});R.on("blur",function(S){if(b.keyboardShortcutManager){b.keyboardShortcutManager.enable()}})}b.inputHint("#message")}function n(S,W){var V,R,U,T;V=b.Node.getDOMNode(S);if(V.setSelectionRange){U=V.value.substring(V.selectionStart,V.selectionStart-1);T=V.value.substring(V.selectionEnd,V.selectionEnd+1);if(U!==" "&&U!==""){W=" "+W}if(T!==" "){W=W+" "}V.value=V.value.substring(0,V.selectionStart)+W+V.value.substring(V.selectionStart,V.selectionEnd)+V.value.substring(V.selectionEnd,V.value.length)}else{if(document.selection&&document.selection.createRange){W=W+" ";V.focus();R=document.selection.createRange();R.text=W+R.text}}return S}function d(){var R=b.one(".previewing-comment");if(R){R.replaceClass("previewing-comment","adding-comment");E();b.one("#message").focus()}}function A(){var R=b.one("#comments");if(R){R.vis.animScrollIntoView(true,100)}}function K(R){if(R){R.vis.animScrollIntoView()}}function E(){var R=b.one("div.add-comment-form div.buttons");if(R){R.vis.animScrollIntoView()}}function r(S){var R;if(S){R=new b.Anim({node:S,from:{backgroundColor:"#E0FDD1"},to:{backgroundColor:"#fff"},duration:2.5,easing:b.Easing.easeBoth});R.on("end",function(){S.setStyle("backgroundColor","")});R.run()}}function e(R){R.preventDefault();d()}function P(R){R.preventDefault();x(true)}function Q(R){R.preventDefault();x()}function v(U){var S,R,T;U.preventDefault();S=U.currentTarget;R=/page([0-9]+)\/?$/.exec(S.get("href"));T=R?R[1]:1;if(T){if(T===1){T=null}g(T)}}function O(){if(!b.historyManager.enabled){return true}var R=b.historyManager.getState();if(R.page!==G){if(G>1){R.page=G}else{delete R.page}b.historyManager.replaceState(R);return true}}function g(W){var R,V,S,U,T;if(G===W){return}G=W;s();if(O()){R=true}V=b.one("#message");S=V?V.get("value"):"";U=b.config.flickr.photo.id;T={method:"post",data:"magic_cookie="+b.config.flickr.magic_cookie+"&photo="+U+"&page="+W,on:{success:function(Z,Y,X){C();b.one("#comments").set("innerHTML",Y.responseText);N();H();if(R){A()}if(V){V.set("value",S)}f()},failure:function(Z,Y,X){N();c("HUH?")}}};b.io("/photo_comments_fragment.gne?cachebust="+(new Date()).getTime(),T)}function x(S){var R;J();R={method:"post",data:"preview="+(S?1:0),form:{id:b.one(".add-comment-form form")},on:{success:function(W,V,U){var T;C();b.one("#comments").set("innerHTML",V.responseText);H();f();q();if(S){E()}else{T=b.one(".new-comment");K(T);r(T);b.dejaview()}},failure:function(U,V){var T=V&&V.status;q();if(T===409){c(b.transjax.get("photo-comments","error_add_rate_limit"))}else{c(b.transjax.get("photo-comments","error_add_generic"))}}}};if(b.config.flickr.flags.enable_grease){if(!b.config.flickr.user.nsid&&!S&&b.grease.enabled){b.grease.postComment(b.one("#message").get("value"));b.grease.authenticate(function(T){q()});return false}else{if(b.config.flickr.user.nsid){b.io("/photo_comments_fragment.gne?cachebust="+(new Date()).getTime(),R)}}}else{b.io("/photo_comments_fragment.gne?cachebust="+(new Date()).getTime(),R)}}function H(V){var S,U,T,R;U=b.one("ol#photo-activity");T=H.total;R=U&&parseInt(U.getAttribute("data-comments-total"),10)||0;if(!b.Lang.isNumber(T)){T=R}if(V===-1&&R>0){R-=1;U.setAttribute("data-comments-total",R)}if(b.Lang.isNumber(R)&&R>=0&&R!==T){T=R;S=b.PhotoData.get(b.config.flickr.photo.id);if(S){S.set("comment_count",T)}}H.total=T}function j(){var S=b.one("#flash_ver"),R;if(S&&deconcept&&deconcept.SWFObjectUtil&&deconcept.SWFObjectUtil.getPlayerVersion){R=deconcept.SWFObjectUtil.getPlayerVersion();S.set("value","Flash V:"+(R.major+"."+R.minor+"."+R.rev))}}function D(S){var R;if(S.altKey||S.ctrlKey||S.metaKey||S.shiftKey){}else{S.preventDefault();R=false;m(S.target.ancestor(".comment-block"),R)}}function I(T){var R,S;T.preventDefault();R=T.target.ancestor(".comment-block").one(".comment-buddy-icon-link");if(R){S="[http://www.flickr.com/photos/"+R.get("href").replace(/^.*?\/photos\/(.*?)\/$/,"$1")+"]"}if(S){b.one("#message").focus();n(b.one("#message"),S)}}function h(R){if(R.altKey||R.ctrlKey||R.metaKey||R.shiftKey){}else{R.preventDefault();i(R.target.ancestor(".comment-block"))}}function M(R){if(R.altKey||R.ctrlKey||R.metaKey||R.shiftKey){}else{R.preventDefault();u(R.target.ancestor(".comment-block"))}}function J(){b.one("div.add-comment-form form").addClass("spinning")}function q(){b.one("div.add-comment-form form").removeClass("spinning")}function k(R){R.addClass("spinning")}function a(R){R.removeClass("spinning")}function s(){b.global_dialog.remove_existing_dialog();b.global_dialog.show({loading:true,modal:true})}function N(){b.global_dialog.hide()}function c(R){b.global_dialog.create_alert_dialog(R,b.global_dialog.hide,{width:280})}function C(){b.Array.each(p,function(R){if(R&&b.Lang.isFunction(R.destroy)){R.destroy()}});b.all("#comments .comment-editing").removeClass("comment-editing")}function i(X){var U,T,V,S,W,R;X.addClass("comment-editing");T=X.getAttribute("data-comment-id");V=X.one(".comment-body");S=V.get("innerHTML");W={comment_id:T};R={success:function(Y){b.use("insitu",function(aa){var ab,Z;ab="flickr.photos.comments.editComment";Z={comment_id:T,comment_text:Y.data.comment._content};U=aa.insitu.create(ab,Z);p.push(U);U.on("change",function(ac){k(V);aa.io("/photo_comments_fragment.gne?cachebust="+(new Date()).getTime(),{method:"post",data:"single_comment_id="+T+"&magic_cookie="+aa.config.flickr.magic_cookie,on:{success:function(af,ae,ad){U.destroy();V.set("innerHTML",ae.responseText);a(V);r(X)},failure:function(ad){U.destroy();V.set("innerHTML",S);a(V);c(aa.transjax.get("photo-comments","error_edit_generic"))},end:function(){X.removeClass("comment-editing")}}})});U.on("cancel",function(ac){U.destroy();V.set("innerHTML",S);X.removeClass("comment-editing")});U.addInput({node:V,param:"comment_text",input_type:"textarea",is_trigger:false});U.edit(V);a(V)})},failure:function(Y){a(V);c(b.transjax.get("photo-comments","error_edit_getting"));X.removeClass("comment-editing")}};k(V);b.flickrAPI.callMethod("flickr.photos.comments.getComment",W,R)}function u(X){var U,R,V,W,T,S;U=X.getAttribute("data-comment-id");if(U){R=X.getAttribute("data-comment-nsid");V={success:function(){var aa,Z,Y;aa=X.getStyle("height");Z=X.getStyle("minHeight");X.setStyle("overflow","hidden");Y=new b.Anim({node:X,from:{height:aa,minHeight:Z},to:{height:"1px",minHeight:"1px"},duration:0.3,easing:b.Easing.easeIn});Y.on("end",function(){var ab;X.addClass("comment-deleted");X.removeClass("comment-deleting");if(S){ab="/ignore.gne?id="+R+"&redir=photoid&photoid="+b.config.flickr.photo.id;if(b.ContextData&&b.ContextData.getContext()){ab+="&context="+b.ContextData.getContext().id}location.assign(ab)}});Y.run();b.dejaview();H(-1)},failure:function(Z){var Y=Z.data&&Z.data.code;if(Y===2){return V.success.apply(this,arguments)}X.removeClass("comment-deleting");if(Y===99){c(b.transjax.get("photo-comments","error_delete_permission"))}else{c(b.transjax.get("photo-comments","error_delete_generic"))}}};T={CONFIRM:b.transjax.get("photo-comments","delete_button_confirm"),CANCEL:b.transjax.get("photo-comments","delete_button_cancel"),width:283,confirm_butt_class:"DeleteButt"};if(R&&R!==b.config.flickr.user.nsid){T.checkboxes=[b.transjax.get("photo-comments","block_user")];T.width=380}W=function(aa,Y){var Z=!!(Y&&Y.checkboxes&&Y.checkboxes[0]);if(aa){X.addClass("comment-deleting");X.one(".comment-head").append('<small class="deleting">'+b.transjax.get("photo-comments","deleting")+"</small>");if(Z){s();S=true}b.flickrAPI.callMethod("flickr.photos.comments.deleteComment",{comment_id:U},V)}};b.global_dialog.create_confirmation_dialog("<div>"+b.transjax.get("photo-comments","delete_confirmation")+"</div>",W,T)}}function m(U,T){var S,R,W,V;S=U.getAttribute("data-comment-id");if(S){R=U.one(".comment-fave");W={success:function(){alert("instant fave!")},failure:function(){alert("instant fail!");b.faveStar.toggle_fave(R)}};V=T?"flickr.photos.comments.unfaveComment":"flickr.photos.comments.faveComment";b.faveStar.toggle_fave(R);b.flickrAPI.callMethod(V,{comment_id:S},W)}}function w(U){var S,T,R;U.preventDefault();S=U.target.ancestor("a");T=b.one("#html-info-container");if(!T){T=b.Node.create('<div id="html-info-container"><img src="'+b.config.flickr.images_root+'/pulser2.gif" width="32" height="15"></div>');S.get("parentNode").append(T);R={on:{}};R.on.success=function(X,W,V){l=b.one("#html-info-text").get("innerHTML");b.one("#html-info-text").set("innerHTML",b.transjax.get("photo-comments","hide_formatting_tips"));b.one("#html-info-caret").addClass("caret-down");T.set("innerHTML",W.responseText);T.vis.animScrollIntoView()};b.io(S.get("href")+"&only_fragment=1",R)}else{if(T.getStyle("display")==="none"){l=b.one("#html-info-text").get("innerHTML");b.one("#html-info-text").set("innerHTML",b.transjax.get("photo-comments","hide_formatting_tips"));b.one("#html-info-caret").addClass("caret-down");T.setStyle("display","block");T.vis.animScrollIntoView()}else{b.one("#html-info-text").set("innerHTML",l);b.one("#html-info-caret").removeClass("caret-down");T.setStyle("display","none")}}}b.photoComments=L},"0.0.1",{requires:F.config.modules["photo-comments"].requires||[],optional:F.config.modules["photo-comments"].optional||[]});YUI.add("photo-context-menu-transjax",function(b){var a={svn_bump:"",license_copyright_photo:'This photo is %s<a href="%s">All Rights Reserved</a>',license_some_rights_reserved_photo:'This photo has %s<a href="%s">Some Rights Reserved</a>',license_no_known_restrictions_photo:'This photo has %s<a href="%s">no known copyright restrictions</a>',license_government_work_photo:'This photo is %s<a href="%s">United States Government Work</a>',license_copyright_video:'This video is %s<a href="%s">All Rights Reserved</a>',license_some_rights_reserved_video:'This video has %s<a href="%s">Some Rights Reserved</a>',license_no_known_restrictions_video:'This video has %s<a href="%s">no known copyright restrictions</a>',license_government_work_video:'This video is %s<a href="%s">United States Government Work</a>',view_available_sizes:'View all sizes:',size_sq:'Square',size_t:'Thumbnail',size_s:'Small',size_m:'Medium 500',size_z:'Medium 640',size_v:'Extra-medium',size_l:'Large',size_o:'Original'};b.transjax.add("photo-context-menu",a)},"0.0.1",{requires:["transjax-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("io-upload-iframe",function(g){var b=g.config.win,f=g.config.doc,c=(f.documentMode&&f.documentMode>=8),a=decodeURIComponent;function e(h,k,j){var d=g.Node.create('<iframe id="io_iframe'+h.id+'" name="io_iframe'+h.id+'" />');d._node.style.position="absolute";d._node.style.top="-1000px";d._node.style.left="-1000px";g.one("body").appendChild(d);g.on("load",function(){j._uploadComplete(h,k);},"#io_iframe"+h.id);}g.mix(g.IO.prototype,{_addData:function(n,k){var p=[],d=k.split("="),j,h;for(j=0,h=d.length-1;j<h;j++){p[j]=f.createElement("input");p[j].type="hidden";p[j].name=a(d[j].substring(d[j].lastIndexOf("&")+1));p[j].value=(j+1===h)?a(d[j+1]):a(d[j+1].substring(0,(d[j+1].lastIndexOf("&"))));n.appendChild(p[j]);}return p;},_removeData:function(j,k){var h,d;for(h=0,d=k.length;h<d;h++){j.removeChild(k[h]);}},_setAttrs:function(h,i,d){h.setAttribute("action",d);h.setAttribute("method","POST");h.setAttribute("target","io_iframe"+i);h.setAttribute(g.UA.ie&&!c?"encoding":"enctype","multipart/form-data");},_resetAttrs:function(h,d){g.Object.each(d,function(i,j){if(i){h.setAttribute(j,i);}else{h.removeAttribute(j);}});},_startTimeout:function(d,i){var h=this;h._timeout[d.id]=b.setTimeout(function(){d.status=0;d.statusText="timeout";h.complete(d,i);h.end(d,i);},i.timeout);},_clearTimeout:function(h){var d=this;b.clearTimeout(d._timeout[h]);delete d._timeout[h];},_destroy:function(d){g.Event.purgeElement("#io_iframe"+d,false);g.one("body").removeChild(g.one("#io_iframe"+d));},_uploadComplete:function(k,m){var l=this,j=g.one("#io_iframe"+k.id).get("contentWindow.document"),h=j.one("body"),i;if(m.timeout){l._clearTimeout(k.id);}if(h){i=h.one("pre:first-child");k.c.responseText=i?i.get("text"):h.get("text");}else{k.c.responseXML=j._node;}l.complete(k,m);l.end(k,m);b.setTimeout(function(){l._destroy(k.id);},0);},_upload:function(k,i,m){var l=this,j=(typeof m.form.id==="string")?f.getElementById(m.form.id):m.form.id,h={action:j.getAttribute("action"),target:j.getAttribute("target")},d;l._setAttrs(j,k.id,i);if(m.data){d=l._addData(j,m.data);}if(m.timeout){l._startTimeout(k,m);}j.submit();l.start(k,m);if(m.data){l._removeData(j,d);}l._resetAttrs(j,h);return{id:k.id,abort:function(){k.status=0;k.statusText="abort";if(g.one("#io_iframe"+k.id)){l._destroy(k.id);l.complete(k,m);l.end(k,m);}else{return false;}},isInProgress:function(){return g.one("#io_iframe"+k.id)?true:false;},io:l};},upload:function(h,d,i){e(h,i,this);return this._upload(h,d,i);}});},"3.4.0",{requires:["io-base","node-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("queue-promote",function(a){a.mix(a.Queue.prototype,{indexOf:function(b){return a.Array.indexOf(this._q,b);},promote:function(c){var b=this.indexOf(c);if(b>-1){this._q.unshift(this._q.splice(b,1)[0]);}},remove:function(c){var b=this.indexOf(c);if(b>-1){this._q.splice(b,1);}}});},"3.4.0",{requires:["yui-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("io-queue",function(b){var c=b.io._map["io:0"]||new b.IO();b.mix(b.IO.prototype,{_q:new b.Queue(),_qActiveId:null,_qInit:false,_qState:1,_qShift:function(){var e=this,d=e._q.next();e._qActiveId=d.id;e._qState=0;e.send(d.uri,d.cfg,d.id);},queue:function(d,g){var f=this,e={uri:d,cfg:g,id:this._id++};if(!f._qInit){b.on("io:complete",function(i,h){f._qNext(i);},f);f._qInit=true;}f._q.add(e);if(f._qState===1){f._qShift();}return e;},_qNext:function(e){var d=this;d._qState=1;if(d._qActiveId===e&&d._q.size()>0){d._qShift();}},qPromote:function(d){this._q.promote(d);},qRemove:function(d){this._q.remove(d);},qStart:function(){var d=this;d._qState=1;if(d._q.size()>0){d._qShift();}},qStop:function(){this._qState=0;},qSize:function(){return this._q.size();}},true);function a(d,e){return c.queue.apply(c,[d,e]);}a.start=function(){c.qStart();};a.stop=function(){c.qStop();};a.promote=function(d){c.qPromote(d);};a.remove=function(d){c.qRemove(d);};a.size=function(){c.qSize();};b.io.queue=a;},"3.4.0",{requires:["io-base","queue-promote"]});YUI.add("number-transjax",function(b){var a={thou_sep:',',dec_sep:'.'};b.transjax.add("number",a)},"0.0.1",{requires:["transjax-base"]});YUI.add("number",function(a){a.Number={pretty_num:function(g){var h=a.transjax.get("number","dec_sep");var f=a.transjax.get("number","thou_sep");var c=g.toString();var b=c.split(".");var e=b[0];var j=(b[1])?h+b[1]:"";if(e.length<4){return c}var k="";for(var d=e.length-1;d>-1;d--){if(d<e.length-1&&(e.length-1-d)%3==0){k=f+k}k=e.charAt(d)+k}return k+j}}},"0.0.1",{requires:["number-transjax"]});YUI.add("photo-filmstrip-transjax",function(a){a.transjax.add("photo-filmstrip",{context_widgets_groups_placeholder_photo:'...and %s more groups',context_widgets_groups_placeholder_video:'...and %s more groups',youre_at_most_recent_photo:"Newest photo",youre_at_oldest_photo:"Oldest photo",youre_at_last_photo:"Last photo",youre_at_first_photo:"First photo",set:'Set',pool:'Group',gallery:'Gallery',are_you_sure_you_want_to_remove_group_video:'Are you sure you want to remove this video from the group %s?',are_you_sure_you_want_to_remove_group_photo:'Are you sure you want to remove this photo from the group %s?',are_you_sure_you_want_to_remove_set_video:'Are you sure you want to remove this video from the %s set?',are_you_sure_you_want_to_remove_set_photo:'Are you sure you want to remove this photo from the %s set?',are_you_sure_you_want_to_remove_gallery_yours:'Are you sure you want to remove this from your %s gallery?',are_you_sure_you_want_to_remove_gallery_notyours:'Are you sure you want to remove this from %1$s %2$s gallery?',confirm_remove_your_photo_from_specific_members_favorites:"Are you sure you want to remove your photo from %s favorites?",confirm_remove_your_photo_from_this_members_favorites:"Are you sure you want to remove your photo from this member's favorites?",confirm_remove_their_photo_from_your_favorites:'Are you sure you want to remove this photo from your favorites?',yes_remove_it:'YES, REMOVE IT',cancel:'CANCEL',api_success:'Success!',api_failure:'There was a problem saving that setting. Please reload the page and try again.',untitled:'Untitled',move_filmstrip_left:'Move the filmstrip to the left',move_filmstrip_right:'Move the filmstrip to the right',open_context_above:'Open the previous filmstrip',open_context_below:'Open the next filmstrip'})},"0.0.1",{requires:["transjax-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("transition",function(b){var i="",h="",f=b.config.doc,r="documentElement",s="transition",k="Transition",m,j,p,a,n,c,l,t,q={},g=["Webkit","Moz"],e={Webkit:"webkitTransitionEnd"},d=function(){this.init.apply(this,arguments);};d._toCamel=function(u){u=u.replace(/-([a-z])/gi,function(w,v){return v.toUpperCase();});return u;};d._toHyphen=function(u){u=u.replace(/([A-Z]?)([a-z]+)([A-Z]?)/g,function(y,x,w,v){var z=((x)?"-"+x.toLowerCase():"")+w;if(v){z+="-"+v.toLowerCase();}return z;});return u;};d.SHOW_TRANSITION="fadeIn";d.HIDE_TRANSITION="fadeOut";d.useNative=false;b.Array.each(g,function(v){var u=v+k;if(u in f[r].style){i=v;h=d._toHyphen(v)+"-";d.useNative=true;d.supported=true;d._VENDOR_PREFIX=v;}});k=i+k;m=i+"TransitionProperty";j=h+"transition-property";p=h+"transition-duration";a=h+"transition-timing-function";n=h+"transition-delay";c="transitionend";l="on"+i.toLowerCase()+"transitionend";c=e[i]||c;t=i+"Transform";d.fx={};d.toggles={};d._hasEnd={};d._reKeywords=/^(?:node|duration|iterations|easing|delay|on|onstart|onend)$/i;b.Node.DOM_EVENTS[c]=1;d.NAME="transition";d.DEFAULT_EASING="ease";d.DEFAULT_DURATION=0.5;d.DEFAULT_DELAY=0;d._nodeAttrs={};d.prototype={constructor:d,init:function(v,u){var w=this;w._node=v;if(!w._running&&u){w._config=u;v._transition=w;w._duration=("duration" in u)?u.duration:w.constructor.DEFAULT_DURATION;w._delay=("delay" in u)?u.delay:w.constructor.DEFAULT_DELAY;w._easing=u.easing||w.constructor.DEFAULT_EASING;w._count=0;w._running=false;}return w;},addProperty:function(v,x){var A=this,y=this._node,C=b.stamp(y),B=b.one(y),F=d._nodeAttrs[C],z,E,u,D,w;if(!F){F=d._nodeAttrs[C]={};}D=F[v];if(x&&x.value!==undefined){w=x.value;}else{if(x!==undefined){w=x;x=q;}}if(typeof w==="function"){w=w.call(B,B);}if(D&&D.transition){if(D.transition!==A){D.transition._count--;}}A._count++;u=((typeof x.duration!="undefined")?x.duration:A._duration)||0.0001;F[v]={value:w,duration:u,delay:(typeof x.delay!="undefined")?x.delay:A._delay,easing:x.easing||A._easing,transition:A};z=b.DOM.getComputedStyle(y,v);E=(typeof w==="string")?z:parseFloat(z);if(d.useNative&&E===w){setTimeout(function(){A._onNativeEnd.call(y,{propertyName:v,elapsedTime:u});},u*1000);}},removeProperty:function(w){var v=this,u=d._nodeAttrs[b.stamp(v._node)];if(u&&u[w]){delete u[w];v._count--;}},initAttrs:function(v){var u,w=this._node;if(v.transform&&!v[t]){v[t]=v.transform;delete v.transform;}for(u in v){if(v.hasOwnProperty(u)&&!d._reKeywords.test(u)){this.addProperty(u,v[u]);if(w.style[u]===""){b.DOM.setStyle(w,u,b.DOM.getComputedStyle(w,u));}}}},run:function(y){var x=this,v=x._node,u=x._config,w={type:"transition:start",config:u};if(!x._running){x._running=true;if(u.on&&u.on.start){u.on.start.call(b.one(v),w);}x.initAttrs(x._config);x._callback=y;x._start();}return x;},_start:function(){this._runNative();},_prepDur:function(u){u=parseFloat(u);return u+"s";},_runNative:function(w){var C=this,x=C._node,E=b.stamp(x),v=x.style,A=getComputedStyle(x),I=d._nodeAttrs[E],y="",J=A[d._toCamel(j)],H=j+": ",B=p+": ",G=a+": ",D=n+": ",z,F,u;if(J!=="all"){H+=J+",";B+=A[d._toCamel(p)]+",";G+=A[d._toCamel(a)]+",";D+=A[d._toCamel(n)]+",";}for(u in I){z=d._toHyphen(u);F=I[u];if((F=I[u])&&F.transition===C){if(u in x.style){B+=C._prepDur(F.duration)+",";D+=C._prepDur(F.delay)+",";G+=(F.easing)+",";H+=z+",";y+=z+": "+F.value+"; ";}else{this.removeProperty(u);}}}H=H.replace(/,$/,";");B=B.replace(/,$/,";");G=G.replace(/,$/,";");D=D.replace(/,$/,";");if(!d._hasEnd[E]){x.addEventListener(c,C._onNativeEnd,"");d._hasEnd[E]=true;}v.cssText+=H+B+G+D+y;},_end:function(u){var y=this,w=y._node,A=y._callback,v=y._config,x={type:"transition:end",config:v,elapsedTime:u},z=b.one(w);y._running=false;y._callback=null;if(w){if(v.on&&v.on.end){setTimeout(function(){v.on.end.call(z,x);if(A){A.call(z,x);}},1);}else{if(A){setTimeout(function(){A.call(z,x);},1);}}}},_endNative:function(u){var v=this._node,w=v.ownerDocument.defaultView.getComputedStyle(v,"")[d._toCamel(j)];if(typeof w==="string"){w=w.replace(new RegExp("(?:^|,\\s)"+u+",?"),",");w=w.replace(/^,|,$/,"");v.style[k]=w;}},_onNativeEnd:function(B){var x=this,A=b.stamp(x),u=B,v=d._toCamel(u.propertyName),E=u.elapsedTime,D=d._nodeAttrs[A],C=D[v],y=(C)?C.transition:null,z,w;if(y){y.removeProperty(v);y._endNative(v);w=y._config[v];z={type:"propertyEnd",propertyName:v,elapsedTime:E,config:w};if(w&&w.on&&w.on.end){w.on.end.call(b.one(x),z);}if(y._count<=0){y._end(E);}}},destroy:function(){var v=this,u=v._node;if(u){u.removeEventListener(c,v._onNativeEnd,false);v._node=null;}}};b.Transition=d;b.TransitionNative=d;b.Node.prototype.transition=function(w,v,A){var u=d._nodeAttrs[b.stamp(this._node)],y=(u)?u.transition||null:null,x,z;if(typeof w==="string"){if(typeof v==="function"){A=v;v=null;}x=d.fx[w];if(v&&typeof v!=="boolean"){v=b.clone(v);for(z in x){if(x.hasOwnProperty(z)){if(!(z in v)){v[z]=x[z];}}}}else{v=x;}}else{A=v;v=w;}if(y&&!y._running){y.init(this,v);}else{y=new d(this._node,v);}y.run(A);return this;};b.Node.prototype.show=function(v,u,w){this._show();if(v&&b.Transition){if(typeof v!=="string"&&!v.push){if(typeof u==="function"){w=u;u=v;}v=d.SHOW_TRANSITION;}this.transition(v,u,w);}return this;};var o=function(v,u,w){return function(){if(u){u.call(v);}if(w){w.apply(v._node,arguments);}};};b.Node.prototype.hide=function(v,u,w){if(v&&b.Transition){if(typeof u==="function"){w=u;u=null;}w=o(this,this._hide,w);if(typeof v!=="string"&&!v.push){if(typeof u==="function"){w=u;u=v;}v=d.HIDE_TRANSITION;}this.transition(v,u,w);}else{this._hide();}return this;};b.NodeList.prototype.transition=function(v,y){var u=this._nodes,w=0,x;while((x=u[w++])){b.one(x).transition(v,y);}return this;};b.Node.prototype.toggleView=function(v,u,w){this._toggles=this._toggles||[];w=arguments[arguments.length-1];if(typeof v=="boolean"){u=v;v=null;}v=v||b.Transition.DEFAULT_TOGGLE;if(typeof u=="undefined"&&v in this._toggles){u=!this._toggles[v];}u=(u)?1:0;if(u){this._show();}else{w=o(this,this._hide,w);}this._toggles[v]=u;
this.transition(b.Transition.toggles[v][u],w);return this;};b.NodeList.prototype.toggleView=function(w,u,z){var v=this._nodes,x=0,y;while((y=v[x++])){b.one(y).toggleView(w,u,z);}return this;};b.mix(d.fx,{fadeOut:{opacity:0,duration:0.5,easing:"ease-out"},fadeIn:{opacity:1,duration:0.5,easing:"ease-in"},sizeOut:{height:0,width:0,duration:0.75,easing:"ease-out"},sizeIn:{height:function(u){return u.get("scrollHeight")+"px";},width:function(u){return u.get("scrollWidth")+"px";},duration:0.5,easing:"ease-in",on:{start:function(){var u=this.getStyle("overflow");if(u!=="hidden"){this.setStyle("overflow","hidden");this._transitionOverflow=u;}},end:function(){if(this._transitionOverflow){this.setStyle("overflow",this._transitionOverflow);delete this._transitionOverflow;}}}}});b.mix(d.toggles,{size:["sizeOut","sizeIn"],fade:["fadeOut","fadeIn"]});d.DEFAULT_TOGGLE="fade";},"3.4.0",{requires:["node-style"]});YUI.add("photo-filmstrip",function(c){var K={},A={},r,i,l={},x,t=c.config.flickr.filmstrips.photos_per_page,o=50,s=(c.config.flickr.is_touch_device&&c.config.flickr.flags.enable_advanced_gestures),H=2;function J(){if(!J.is_init){J.is_init=true;i=c.photo.getCurrentPhoto();c.Array.each(c.ContextData.getContexts(),function(L){e(L.id)});c.on("ContextData:open",u);c.on("ContextData:totalChange",b);c.on("ContextData:photoLoaded",E);c.on("ContextData:photoRemoved",C);c.on("ContextData:photoUnremoved",n);c.on("ContextData:prevLimitReached",h);c.on("ContextData:nextLimitReached",B);c.on("ContextData:contextAdded",a);c.on("ContextData:contextRemoved",j);c.on("ContextData:contextInvalidated",g);c.after("PhotoData:needs_interstitialChange",k);c.one(c.config.flickr.filmstrips.container).on("click",function(L){if(L.target.ancestor(".context-link",true)){if(!s){D(L)}else{D(L);L.preventDefault()}}else{if(L.target.ancestor(".remove-from-context",true)){f(L)}}});c.keyboardShortcutManager.register({keystring:"94,226",handler:G,context:""});c.keyboardShortcutManager.register({keystring:"190,59",handler:G,context:"",legend:{key:">",description:c.transjax.get("photo-filmstrip","move_filmstrip_right"),group:c.transjax.get("keyboard-shortcut-legend","navigation"),order:10}});c.keyboardShortcutManager.register({keystring:"188",handler:G,context:"",legend:{key:"<",description:c.transjax.get("photo-filmstrip","move_filmstrip_left"),group:c.transjax.get("keyboard-shortcut-legend","navigation"),order:10}});c.keyboardShortcutManager.register({keystring:"221",handler:G,context:"",legend:{key:"]",description:c.transjax.get("photo-filmstrip","open_context_below"),group:c.transjax.get("keyboard-shortcut-legend","navigation"),order:20}});c.keyboardShortcutManager.register({keystring:"219",handler:G,context:"",legend:{key:"[",description:c.transjax.get("photo-filmstrip","open_context_above"),group:c.transjax.get("keyboard-shortcut-legend","navigation"),order:20}});(function(){var L=c.one("#group-placeholder-link");if(L){L.on("click",function(M){if(M.altKey||M.ctrlKey||M.metaKey||M.shiftKey){}else{M.preventDefault();v()}})}}())}}function p(){var L;if(c.config.flickr.filmstrips&&c.config.flickr.filmstrips.preload_page_count){L=Math.ceil(t/2+t*c.config.flickr.filmstrips.preload_page_count)}else{L=0}return L}function q(){var M,L;J();M=c.one("#group-placeholder-link");if(M){L=c.all("#sidebar-contexts li.rolled-up").size();if(L>1){M.set("innerHTML",c.transjax.get("photo-filmstrip","context_widgets_groups_placeholder_"+(i.get("is_video")?"video":"photo"),L))}else{v()}}}function v(){var L=c.one("#group-placeholder");if(L){L.remove();c.all("#sidebar-contexts li.rolled-up").removeClass("rolled-up")}}function j(L){y(L)}function a(M){var L={};if(x&&x===M.id){L.open_immediately=true;x=undefined}e(M.id,L)}function u(L){w(L)}function b(N,M){var L=K[N];if(!L){return}if(L.get("total")!==M){L.set("total",M)}}function D(O){var M,N,L;M=O.target.ancestor(".sidebar-context");if(!M){return}N=M.getAttribute("data-context-id");if(!N){return}if(M.hasClass("sidebar-context-open")||O.altKey||O.ctrlKey||O.metaKey||O.shiftKey){if(s){O.preventDefault();L=O.target.ancestor("a.context-link",true);if(L){window.location=L.get("href")}}}else{O.preventDefault();w(N)}}function f(O){var M,N,L;J();M=O.target.ancestor(".sidebar-context");if(!M){return}N=M.getAttribute("data-context-id");L=c.ContextData.getContext();if(!N||N!==L.id){return}O.preventDefault();z(N)}function z(M){var N,P,O,L,R,Q,T,S;N=c.ContextData.getContext(M);P=i.get("sizes")?i.get("sizes").s:undefined;if(!P){return}O=i.get("id");switch(N.type){case"pool":L="flickr.groups.pools.remove";R={group_id:N.group_id,photo_id:O};S=c.transjax.get("photo-filmstrip",i.get("is_video")?"are_you_sure_you_want_to_remove_group_video":"are_you_sure_you_want_to_remove_group_photo","<b>"+c.StringFilters.escape_entities(N.title)+"</b>");break;case"faves":L="flickr.favorites.remove";R={photo_id:O};if(i.get("owner")===c.config.flickr.user.nsid){R.user_id=N.user_id;if(N.owner_name_possessive){S=c.transjax.get("photo-filmstrip","confirm_remove_your_photo_from_specific_members_favorites","<b>"+c.StringFilters.escape_entities(N.owner_name_possessive)+"</b>")}else{S=c.transjax.get("photo-filmstrip","confirm_remove_your_photo_from_this_members_favorites")}}else{S=c.transjax.get("photo-filmstrip","confirm_remove_their_photo_from_your_favorites")}break;case"set":L="flickr.photosets.removePhoto";R={photoset_id:N.set_id,photo_id:O};S=c.transjax.get("photo-filmstrip",i.get("is_video")?"are_you_sure_you_want_to_remove_set_video":"are_you_sure_you_want_to_remove_set_photo","<b>"+c.StringFilters.escape_entities(N.title)+"</b>");break;case"gallery":L="flickr.galleries.removePhoto";R={gallery_id:N.gallery_id,photo_id:O};if(i.get("owner")===c.config.flickr.user.nsid){S=c.transjax.get("photo-filmstrip","are_you_sure_you_want_to_remove_gallery_notyours","<b>"+c.StringFilters.escape_entities(N.owner_name_possessive)+"</b>","<b>"+c.StringFilters.escape_entities(N.title)+"</b>")}else{S=c.transjax.get("photo-filmstrip","are_you_sure_you_want_to_remove_gallery_yours","<b>"+c.StringFilters.escape_entities(N.title)+"</b>")}break}if(!L||!R||!S){c.log("missing method, params, or confirmation_msg","error","photo-filmstrip");return false}Q={CONFIRM:c.transjax.get("photo-filmstrip","yes_remove_it"),CANCEL:c.transjax.get("photo-filmstrip","cancel"),width:330,photo:{url:P.url,width:P.width,height:P.height},confirm_butt_class:"DeleteButt"};T=function(U){if(U){c.global_dialog.remove_existing_dialog();c.global_dialog.show({loading:true,modal:true});c.flickrAPI.callMethod(L,R,{success:function(){var V='<span class="short-msg-success"></span>',W=c.transjax.get("photo-filmstrip","api_success");c.global_dialog.remove_existing_dialog();c.global_dialog.create_dialog(V+W,{width:"auto"}).show({loading:false,modal:true,short_message:true});setTimeout(function(){c.global_dialog.hide();c.contextManager.unset("remove-photo-from-context")},2500);c.ContextData.removePhoto(M,c.ContextData.getPhotoPosition(M,O));switch(N.type){case"pool":i.decrement("group_count");break;case"faves":if(N.user_id===c.config.flickr.user.nsid){i.set("is_fave",false)}else{i.decrement("fave_count")}break;case"set":break;case"gallery":c.fire("photo:galleryRemove");break}},failure:function(){var V='<span class="short-msg-warning"></span>';var W=c.transjax.get("photo-filmstrip","api_failure");c.global_dialog.remove_existing_dialog();c.global_dialog.create_dialog(V+W,{width:"auto"}).show({loading:false,modal:true,short_message:true});setTimeout(function(){c.global_dialog.hide();c.contextManager.unset("remove-photo-from-context")},2500)}})}else{c.contextManager.unset("remove-photo-from-context")}};c.global_dialog.create_confirmation_dialog(S,T,Q);c.contextManager.set("remove-photo-from-context")}function G(P){var M,O,L,R,N,Q;M=c.ContextData.getContext();if(M&&K[M.id]){O=K[M.id]}if(!O){return}P.preventDefault();switch(P.keyCode){case 94:case 188:case 190:case 59:case 226:if(P.keyCode===190||P.keyCode===59||(P.shiftKey&&(P.keyCode===94||P.keyCode===226))){O.goTo(O.get("position")+t)}else{if(P.keyCode===188||P.keyCode===94||P.keyCode===226){O.goTo(O.get("position")-t)}}break;case 219:case 221:L=c.one(c.config.flickr.filmstrips.container).all(".sidebar-context:not(.sidebar-context-placeholder)");R=L.indexOf(O.get("node"));if(c.Lang.isNumber(R)&&R>-1){N=R+((P.keyCode===221)?1:-1);if(N>L.size()-1){N=0}if(N<0){N=L.size()-1}if(N!==R){Q=L.item(N).getAttribute("data-context-id")}}if(Q){c.ContextData.open(Q)}break}}function e(N,L){var M;if(!c.config.flickr.user.useragent_fully_supported){return}if(!N){return}L=L||{};J();if(!K[N]){M=L.node;if(M&&c.Lang.isString(M)){M=c.one(M)}if(!M){M=c.one('li.sidebar-context[data-context-id="'+N+'"]')}if(!M||!M instanceof c.Node){m(N,L);return}L.node=M;if(L.defer_initialization!==false){if(L.open_immediately||(c.ContextData.getContext()&&c.ContextData.getContext().id===N)){L.defer_initialization=false}}if(L.defer_initialization!==false){if(A[N]){return}L.defer_initialization=false;A[N]=M;c.once("mouseover",function(O){if(A[N]){A[N]=undefined;delete A[N];e(N,L)}},M)}else{if(A[N]){A[N]=undefined;delete A[N]}L.context_id=N;K[N]=new d(L);if(L.open_immediately){w(N)}}}}function m(N,L){if(c.contextManager.get()==="touch-lightbox"){return}L=L||{};var M={on:{}};J();M.on.success=function(P,Q,T){if(c.contextManager.get()==="touch-lightbox"){return}var O,V,S,U,R,W;if(!c.one('li.sidebar-context[data-context-id="'+N+'"]')){S=c.Node.create(Q.responseText);if(N==="photostream"){c.one("#primary-context").append(S)}else{if(!c.one("#secondary-contexts")){O=c.Node.create('<h4 class="secondary-contexts-label">'+c.transjax.get("photo-button-bar",i.get("is_video")?"this_video_also_belongs_to":"this_photo_also_belongs_to")+"</h4>");V=c.Node.create('<ul id="secondary-contexts"></ul>');c.one("#sidebar-contexts").append(O);c.one("#sidebar-contexts").append(V)}R=c.one("#secondary-contexts");U=S.getAttribute("data-context-type");switch(U){case"set":W=R.one('li[data-context-type="faves"]')||R.one('li[data-context-type="gallery"]')||R.one('li[data-context-type="pool"]');break;case"faves":W=R.one('li[data-context-type="gallery"]')||R.one('li[data-context-type="pool"]');break;case"gallery":W=R.one('li[data-context-type="pool"]');break;case"pool":W=c.one("#group-placeholder");break}if(W){R.insertBefore(S,W)}else{R.prepend(S)}}L.node=S;e(N,L)}};c.io("/context_fragment.gne?id="+i.get("id")+"&context="+N+"&open="+(L.open_immediately?1:0),M)}function y(O){if(c.contextManager.get()==="touch-lightbox"){return}if(!c.config.flickr.user.useragent_fully_supported){return}var N,M,L;J();N=K[O];if(N){M=N.get("node");K[O]=undefined;delete K[O]}else{if(A[O]){M=A[O];A[O]=undefined;delete A[O]}}if(M){L=M.hasClass("rolled-up");M.remove();if(L){q()}}if(c.one("#secondary-contexts")&&!c.one("#secondary-contexts .sidebar-context")){c.one("#secondary-contexts").remove();c.one("#sidebar-contexts .secondary-contexts-label").remove()}}function E(N,L,M){if(c.contextManager.get()==="touch-lightbox"){return}if(K[N]){K[N].handlePositionLoaded(L,M)}}function C(N,L,M){if(M.get("id")===i.get("id")&&(!K[N]||!K[N].get("is_open"))){c.ContextData.remove(N);return}l[N]=l[N]||{};l[N][M.get("id")]=true;if(K[N]){K[N].insertImage(L,true)}}function n(N,L,M){if(K[N]&&l[N]&&l[N][M.get("id")]){l[N][M.get("id")]=undefined;delete l[N][M.get("id")];K[N].insertImage(L,true)}}function g(L){if(c.lightbox&&c.lightbox.isOpen()){return}l[L]=undefined;delete l[L];if(K[L]&&K[L].get("is_open")){x=L}c.ContextData.reload(L,{"0":i})}function h(M,L){if(K[M]){K[M].handlePrevLimitReached(L)}}function B(M,L){if(K[M]){K[M].handleNextLimitReached(L)}}function k(N){var L,M,O;if(N.newVal){return}L=N.target;M=L.get("id");O=c.ContextData.getPhotoPositions(M);if(O){c.Object.each(O,function(P,R){var Q=K[R];if(Q){Q.insertImage(P,true)}})}}function I(M,L){if(K[M]){K[M].goTo(L)}}function w(N){var M,L;if(c.contextManager.get()==="touch-lightbox"){return}if(x&&x!==N){return}M=K[N];if(!M){e(N,{open_immediately:true});return}if(M&&!M.get("is_open")){L=c.one("#sidebar-contexts");L.setStyle("height",L.get("offsetHeight")+"px");c.later(400,window,function(){L.setStyle("height","")});if(c.ContextData.getContext()&&c.ContextData.getContext().id===N){c.Object.each(K,function(O){if(O.get("is_open")){O.close()}});M.open()}else{c.ContextData.open(N)}}}c.photoFilmstrip={init:J};function d(N){var O,L,M,P,R,S;O=N.node;if(O&&c.Lang.isString(O)){O=c.one(O)}if(!O instanceof c.Node){return undefined}L=N.context_id;if(!L||!c.Lang.isString(L)){return undefined}d.superclass.constructor.apply(this,arguments);N=N||{};this.set("node",O);this.set("context_id",L);this.set("is_open",O.hasClass("sidebar-context-open"));if(c.config.flickr.is_touch_device){this.set("disable_anim",true)}if(c.Lang.isNumber(N.position)){this.set("position",N.position)}M={};this.getUlNode().all("li.loaded").each(function(U){P=parseInt(U.getAttribute("data-context-position"),10);M[P]=P});this.set("loaded_positions",M);R=c.ContextData.getContext(L);if(R){this.set("total",R.total)}this.updateTimeline();if(c.DOM.winWidth()<1029){c.one("#sidebar-contexts").addClass("narrow")}c.on("resize",c.betterThrottle(function(U){if(c.contextManager.get()==="touch-lightbox"){return}if(c.DOM.winWidth()<1029){c.one("#sidebar-contexts").addClass("narrow")}else{c.one("#sidebar-contexts").removeClass("narrow")}},300));O.append('<a href="#" class="left-arrow ywa-track" data-ywa-name="Context Widget scroll arrows"><span></span></a>');O.append('<a href="#" class="right-arrow ywa-track" data-ywa-name="Context Widget scroll arrows"><span></span></a>');this.truncate_to_one_line(O.one(".context-link"));if(!c.config.flickr.is_touch_device){O.on("mouseover",this.handleNodeHover,this);O.on("mouseout",this.handleNodeHover,this)}O.on("click",function(U){if(U.target.ancestor('a[href="#"]',true)){U.preventDefault()}else{if(s){if(U.target.ancestor(".context-thumb-link",true)){U.preventDefault()}}}},this);if(s){var T=c.bind(function(X){var V,aa;this.getUlNode().setStyle("-webkit-transform","translate(0px, 0px)");var U=X.bind(function(ab){if(this.get("inmotion")){return}this.set("inmotion",true);V=ab.pageX;var Y=this.getUlNode().getStyle("-webkit-transform").match(/translate\((\-?[0-9]+)px/);this.set("leftPos",Y?Y[1]:0);aa=O.on("gesturemove",Z)},this);var Z=X.bind(function(ac){if(this.get("inmotion")){var ab=0,Y=this.get("leftPos");ab=parseInt(Y,10)+(ac.pageX-V);this.getUlNode().setStyle("-webkit-transform","translate3d("+ab+"px, 0px, 0px)")}},this);var W=X.bind(function(Y){if(aa){aa.detach()}if(this.get("inmotion")){var ab=(Y.pageX-V);if((Math.abs(ab)>o)){if((Math.abs(ab)===ab)&&ab!==0){this.goTo(parseInt(this.get("position"),10)-t)}else{this.goTo(parseInt(this.get("position"),10)+t)}}else{if(Math.abs(ab)>H){this.goTo(parseInt(this.get("position"),10))}else{if(Y.target.ancestor(".context-thumb-link",true)){Y.preventDefault();window.location=Y.target.ancestor(".context-thumb-link",true).get("href")}else{if(Y.target.ancestor(".context-link",true)){Y.preventDefault();D(Y)}}}}X.later(10,this,function(){this.set("inmotion",false)})}else{if(Y.target.ancestor(".context-link",true)){Y.preventDefault();D(Y)}}},this);O.on("gesturemovestart",U,{preventDefault:true});O.on("gesturemoveend",W)},this);c.use("event-gestures",T)}var Q=(s)?"click":"mousedown";O.on(Q,function(V){var U=V.target;if(this.get("inmotion")){return}if(U.hasClass("left-arrow")||U.get("parentNode").hasClass("left-arrow")){if(V.button!==1){return}V.preventDefault();this.goTo(this.get("position")-t)}else{if(U.hasClass("right-arrow")||U.get("parentNode").hasClass("right-arrow")){if(V.button!==1){return}V.preventDefault();this.goTo(this.get("position")+t)}}},this);this.on("loaded_positionsChange",function(){this.set("pruning",false)},this);if(F.actionQueue){S=O.one(".context-link").get("id");if(!F.actionQueue["photo-filmstrip"]){F.actionQueue["photo-filmstrip"]={}}F.actionQueue["photo-filmstrip"][S]={display:function(){window.setTimeout(function(){w(L)},0)}};F.actionQueue.module_loaded("photo-filmstrip",S)}}d.NAME="filmstrip";d.ATTRS={node:{value:undefined},context_id:{value:undefined},disable_anim:{value:false},position:{value:0},li_width:{value:61},loaded_positions:{value:{}},prune_threshold:{value:30},prune_buffer:{value:10},pruning:{value:false},is_open:{value:false},anim_slide:{value:undefined},anim_open:{value:undefined},anim_close:{value:undefined},total:{value:undefined,setter:function(O,M){var L,N,P;O=parseInt(O,10);if(c.Lang.isNumber(O)&&O!==this.get(M)){L=this.get("node").one(".context-num");N=c.ContextData.getContext(this.get("context_id"));P=N.type;if(P==="pool"||P==="set"||P==="gallery"){L.set("innerHTML","("+c.transjax.get("photo-filmstrip",P)+": "+c.Number.pretty_num(O)+")")}else{L.set("innerHTML","("+c.Number.pretty_num(O)+")")}this.truncate_to_one_line(this.get("node").one(".context-link"))}return O}}};c.extend(d,c.Base,{open:function(M){var Q,P,N,L,O,R;Q=this.get("node");if(Q.hasClass("rolled-up")){v()}this.set("is_open",true);if(this.get("disable_anim")){Q.setStyle("height","").addClass("sidebar-context-open").addClass("sidebar-context-mobile").addClass("sidebar-context-mobile-open")}else{if(!this.get("anim_open")){N=this.get("anim_close");if(N){N.pause();this.set("anim_close",undefined)}L=parseInt(Q.getStyle("height"),10)||22;O=84;R=L?Math.abs(L-O)/220:0.25;Q.setStyle("height",L+"px").addClass("sidebar-context-open");P=new c.Anim({node:Q,from:L?{height:L}:undefined,to:{height:O},duration:R,easing:c.Easing.easeOut});P.on("end",function(){Q.setStyle("height","");this.set("anim_open",undefined)},this);this.set("anim_open",P);P.run()}}if(!c.Lang.isNumber(M)){M=this.get("position")}this.goTo(M)},close:function(){var P,O,M,L,N,Q;P=this.get("node");this.set("is_open",false);if(this.get("disable_anim")){P.removeClass("sidebar-context-open").setStyle("height","").addClass("sidebar-context-mobile").addClass("sidebar-context-mobile-closed")}else{if(!this.get("anim_close")){O=this.get("anim_open");if(O){O.pause();this.set("anim_open",undefined)}L=parseInt(P.getStyle("height"),10)||undefined;N=21;Q=L?Math.abs(L-N)/220:0.25;M=new c.Anim({node:P,from:L?{height:L}:undefined,to:{height:N},duration:Q,easing:c.Easing.easeOut});M.on("end",function(){P.removeClass("sidebar-context-open").setStyle("height","");this.set("anim_close",undefined)},this);this.set("anim_close",M);M.run()}}},handleNodeHover:function(N){var M,L;M=this.get("node");if(N.target.hasClass("left-arrow")||N.target.get("parentNode").hasClass("left-arrow")){this.loadPosition(this.get("position")-p(),this.get("position"))}else{if(N.target.hasClass("right-arrow")||N.target.get("parentNode").hasClass("right-arrow")){this.loadPosition(this.get("position"),this.get("position")+p())}}if(N.type==="mouseover"){this.checkArrows();M.all(".left-arrow, .right-arrow").addClass("visible");if(!this.get("is_open")){L=this.get("position");this.loadPosition(L-2,L+2)}}else{M.all(".left-arrow, .right-arrow").removeClass("visible")}},handlePrevLimitReached:function(L){this.handleLimitReached("prev",L)},handleNextLimitReached:function(L){this.handleLimitReached("next",L)},handleLimitReached:function(R,O){var M,N,T,S,L,Q,P;M=c.ContextData.getContext();if(!M){return}L={"prev-stream":"youre_at_most_recent_photo","next-stream":"youre_at_oldest_photo","prev-pool":"youre_at_most_recent_photo","next-pool":"youre_at_oldest_photo","prev-contacts":"youre_at_most_recent_photo","next-contacts":"youre_at_oldest_photo","prev-photosof":"youre_at_most_recent_photo","next-photosof":"youre_at_oldest_photo","prev-timescrubber":"youre_at_most_recent_photo","next-timescrubber":"youre_at_oldest_photo","prev-set":"youre_at_first_photo","next-set":"youre_at_last_photo","prev-faves":"youre_at_first_photo","next-faves":"youre_at_last_photo","prev-gallery":"youre_at_first_photo","next-gallery":"youre_at_last_photo","prev-photolist":"youre_at_first_photo","next-photolist":"youre_at_last_photo","prev-contactsfaves":"youre_at_first_photo","next-contactsfaves":"youre_at_last_photo"};Q={"prev-stream":"newest","next-stream":"oldest","prev-pool":"newest","next-pool":"oldest","prev-contacts":"newest","next-contacts":"oldest","prev-photosof":"newest","next-photosof":"oldest","prev-timescrubber":"newest","next-timescrubber":"oldest","prev-set":"first","next-set":"last","prev-faves":"first","next-faves":"last","prev-gallery":"first","next-gallery":"last","prev-photolist":"first","next-photolist":"last","prev-contactsfaves":"first","next-contactsfaves":"last"};T=M.type;if(R==="prev"){S='<span class="bound-msg"><span class="'+Q["prev-"+T]+'">'+c.transjax.get("photo-filmstrip",L["prev-"+T])+" &rarr;</span></span>"}else{S='<span class="bound-msg"><span class="'+Q["next-"+T]+'">&larr; '+c.transjax.get("photo-filmstrip",L["next-"+T])+"</span></span>"}this.insertPlaceholder(O+1*(R==="prev"?-1:1),S);for(P=2;P<=t;P++){this.insertPlaceholder(O+P*(R==="prev"?-1:1))}N=R==="prev"?this.getPrevLimitPosition():this.getNextLimitPosition();if(c.Lang.isNumber(N)){if((R==="prev"&&N>this.get("position"))||(R==="next"&&N<this.get("position"))){this.goTo(N)}}this.checkArrows()},getPrevLimitPosition:function(){var L=c.ContextData.getPrevLimit(this.get("context_id"));if(c.Lang.isNumber(L)){return Math.ceil((L-2)/t)*t}},getNextLimitPosition:function(){var L=c.ContextData.getNextLimit(this.get("context_id"));if(c.Lang.isNumber(L)){return Math.floor((L+2)/t)*t}},transitionRunning:false,goTo:function(N){var Q,S,O,T,M,P;Q=this.getPrevLimitPosition();if(c.Lang.isNumber(Q)&&Q>N){return this.goTo(Q)}S=this.getNextLimitPosition();if(c.Lang.isNumber(S)&&S<N){return this.goTo(S)}this.set("position",N);this.loadPosition(N-p(),N+p());this.checkArrows();this.updateTimeline();this.insertImages();O=this.getUlNode();T=this.get("li_width")*(2-N);var R=false;if(c.config.flickr.flags.enable_advanced_gestures&&c.config.flickr.is_touch_device){T=-(this.get("li_width")*(N));var L=this.getUlNode().getStyle("-webkit-transform").match(/translate\(([0-9]+)px/);if(L){R=(T===parseInt(L[1],10))}}else{R=parseInt(O.getStyle("marginLeft"),10)===T}if(!R){if(this.get("disable_anim")){if(this.transitionRunning){return}O.setStyle("transform","translate3d("+parseInt(O.getStyle("-webkit-transform").match(/translate\(([0-9]+)px/),10)+"px, 0px, 0px)");this.set("inmotion",true);this.transitionRunning=true;P=this;O.transition({easing:"ease-out",duration:0.3,transform:"translate3d("+T+"px, 0px, 0px)"},function(U){P.set("inmotion",false);O.setStyle("transform","translate("+T+"px, 0px)");P.transitionRunning=false})}else{M=this.get("anim_slide");if(M&&M.get("running")){M.pause()}M=new c.Anim({node:O,to:{marginLeft:T},duration:0.3,easing:c.Easing.easeOut});M.on("end",function(){this.set("anim_slide",undefined)},this);this.set("anim_slide",M);M.run()}}},handlePositionLoaded:function(L,M){var N;N=this.get("loaded_positions");N[L]=L;this.set("loaded_positions",N);if(L>=this.get("position")-p()&&L<=this.get("position")+p()){this.insertImage(L)}},insertImages:function(){var L,M;L=this.get("position");for(M=L-2;M<=L+2;M++){this.insertImage(M)}for(M=L+3;M<=L+p();M++){this.insertImage(M)}for(M=L-3;M>=L-p();M--){this.insertImage(M)}},insertImage:function(ab,L){var V,U,Q,Y,P,O,T,Z,aa,R,ac,M,S,N,X,W;V=this.getPositionNode(ab);if(!V){return}U=V.hasClass("loaded");if(U&&!L){return}Q=V.one("a.context-thumb-link");if(!Q){return}Y=Q.one("img");if(!Y){return}if(!L&&!Y.getAttribute("src").match(/spaceout/i)){return}P=this.get("context_id");O=c.ContextData.getPhoto(P,ab);if(!O){return}T=O.get("sizes").sq;if(!T||!T.url){return}if(l[P]&&l[P][O.get("id")]){ac=true;if(!V.getData("removed")){V.setData("removed",true);if(U){M=new c.Anim({node:V,from:{opacity:V.getStyle("opacity")||1},to:{opacity:0.2},duration:0.3,easing:c.Easing.easeOut});M.run()}S=V.ancestor(".sidebar-context");if(S&&S.one(".remove-from-context")){N=new c.Anim({node:S.one(".remove-from-context"),to:{opacity:0},duration:0.3,easing:c.Easing.easeOut});N.on("end",function(){S.one(".remove-from-context").setStyle("display","none")});N.run()}}}else{ac=false;if(V.getData("removed")){V.setData("removed",false);if(U){M=new c.Anim({node:V,from:{opacity:V.getStyle("opacity")||0.2},to:{opacity:1},duration:0.3,easing:c.Easing.easeOut});M.run()}S=V.ancestor(".sidebar-context");if(S&&S.one(".remove-from-context")){N=new c.Anim({node:S.one(".remove-from-context"),to:{opacity:1},duration:0.3,easing:c.Easing.easeOut});S.one(".remove-from-context").setStyle("display","");N.run()}}}if(!U){c.imageFader.attach(Y,ac?0.2:1)}V.addClass("loaded");W=c.urls.get("photo",{photo:O,context:P});Q.setAttribute("href",W);X=O.get("title")?O.get("title"):c.transjax.get("photo","untitled");Q.setAttribute("title",X);if(O.get("needs_interstitial")){aa=c.config.flickr.images_root+"/fuzzy/photo-fuzzy-s.png"}else{aa=T.url}R=O.get("title")||c.transjax.get("photo-filmstrip","untitled");c.retryImageOnError(Y,aa);Y.setAttribute("src",aa);Y.setAttribute("alt",R);if(O.get("media")==="video"){Z=c.Node.create('<img src="'+c.config.flickr.images_root+'/video_play_icon_tiny.png" class="trans_png nextprev_stew_indicator">');Q.append(Z)}},insertPlaceholder:function(L,M){if(!c.Lang.isString(M)){M=""}this.getPositionNode(L).set("innerHTML",'<span class="context-thumb-link context-thumb-placeholder">'+M+"</span>")},getUlNode:function(){return this.get("node").one("ul.context-photos-list")},updateTimeline:function(){if(!c.config.flickr.filmstrips.enable_filmstrip_timelines){return}var Q,N,M,O,P,L;Q=this.get("context_id");if(!Q||!c.ContextData.getContext(Q)){return}N=this.get("total");M=c.ContextData.getContext(Q).start_position;if(!c.Lang.isNumber(N)||!c.Lang.isNumber(M)){return}O=M+this.get("position");P=(100*O/this.get("total"))+"%";if(P<0){P=0}else{if(P>100){P=100}}L=this.get("node").one(".timeline");if(!L){L=c.Node.create('<span class="timeline"><span></span></span>');this.get("node").append(L)}L.one("span").setStyle("left",P)},checkArrows:function(){var L,P,O,N,M;L=this.get("position");P=this.getPrevLimitPosition();O=this.get("node").one(".left-arrow");if(c.Lang.isNumber(P)&&P>=L-2){O.addClass("disabled-arrow")}else{O.removeClass("disabled-arrow")}N=this.getNextLimitPosition();M=this.get("node").one(".right-arrow");if(c.Lang.isNumber(N)&&N<=L+2){M.addClass("disabled-arrow")}else{M.removeClass("disabled-arrow")}},getPositionNode:function(M,L){var N,O;N=this.getUlNode();if(!N){return undefined}if(!c.Lang.isBoolean(L)){L=true}O=N.one('li[data-context-position="'+M+'"]');if(!O&&L){N.setStyle("width",parseInt(N.getStyle("width"),10)+this.get("li_width")+"px");O=c.Node.create('<li data-context-position="'+M+'"><a class="context-thumb-link" href="#"><img class="nextprev_thumb fade-in" width="56" height="56" src="'+c.config.flickr.images_root+'/spaceout.gif" alt=""></a></li>');O.setStyle("left",M*this.get("li_width")+"px");N.append(O)}return O},prune:function(){if(!this.get("pruning")){this.set("pruning",true);c.later(2000,this,function(){if(!this.get("pruning")){return}this.set("pruning",false);var L,P,N,M,O,Q,R;L=this.get("position");P=this.get("loaded_positions");N=c.Object.keys(P);if(N.length>this.get("prune_threshold")){N.sort(function(T,S){var V,U;V=Math.abs(T-L);U=Math.abs(S-L);return(V-U)});c.log("pruning! loaded_position_keys = ",N);O=N.length-this.get("prune_threshold")+this.get("prune_buffer");for(M=1;M<=O;M++){Q=N.length-M;R=this.getPositionNode(Q,false);if(R){R.remove()}}N=N.splice(N.length-O,O);c.log("remove deleted positions",N.length,N);c.Array.each(N,function(S){P[S]=undefined;delete P[S]});c.log("set loaded_positions via prune",c.Object.keys(P).length);this.set("loaded_positions",P)}})}},truncate_to_one_line:function(N){r=r||{};var R=false,V=N.one(".context-title"),L=N.ancestor(".sidebar-context"),T=false;if(!N){return}N.setStyle("overflow","hidden");N.setStyle("whiteSpace","nowrap");if(L.hasClass("rolled-up")&&R){L.removeClass("rolled-up");T=true}var Y=r.max_width||parseInt(N.ancestor(".context-header").get("offsetWidth"),10),W=N.one(".context-wrapper"),S=N.one(".caret"),P=c.StringFilters.unescape_entities(V.getAttribute("title")),U="",M=0,Q=null,O=12,X=20;if(!r.max_width){r.max_width=Y}S.setStyle("display","inline-block");V.set("innerHTML",c.StringFilters.escape_entities(P));if(parseInt(W.get("offsetWidth"),10)<Y){S.setStyle("display","");if(T&&R){L.addClass("rolled-up")}return}if(Y>0){do{M++;U=P.substring(0,P.length-M)+"...";V.set("innerHTML",c.StringFilters.escape_entities(U));Q=(parseInt(W.get("offsetWidth"),10)>=(Y-O)||(U.charAt(U.length-5)===" "||U.charAt(U.length-4)===" "));if(Q&&U.length<X){Q=false}}while(Q)}N.setStyle("overflow","visible");N.setStyle("whiteSpace","normal");S.setStyle("display","");if(T&&R){L.addClass("rolled-up")}},loadPosition:function(M,N){var L,O;if(!c.Lang.isNumber(M)){return}if(!c.Lang.isNumber(N)){N=M}if(N<M){L=N;N=M;M=L;L=undefined}O=this.get("loaded_positions");for(L=M;L<=N;L++){if(!c.Lang.isNumber(O[L])){c.ContextData.loadPhoto(this.get("context_id"),L)}}}})},"0.0.1",{requires:F.config.modules["photo-filmstrip"].requires||[],optional:F.config.modules["photo-filmstrip"].optional||[]});YUI.add("photo-keyboard-shortcuts-transjax",function(a){a.transjax.add("photo-keyboard-shortcuts",{previous_photo:'Previous photo',next_photo:'Next photo',fave_this_photo:'Fave this photo',jump_to_add_person_field:'Jump to the Add a Person field',jump_to_add_tag_field:'Jump to the Add a Tag field',jump_to_comment_field:'Jump to the Comment field'})},"0.0.1",{requires:F.config.modules["photo-keyboard-shortcuts-transjax"].requires||[]});YUI.add("photo-keyboard-shortcuts",function(b){function a(c){if(!b.Lang.isObject(c)){c={}}var d=b.keyboardShortcutManager;if(d.isEnabled()){d.register({keystring:"39,74",handler:function(f){var g=b.one("#nav-bar-next");if(!g.hasClass("DisabledButt")){f.preventDefault();g.addClass("ActiveButt");window.location=g.get("href")}},context:"",legend:{key:"&rarr;",description:b.transjax.get("photo-keyboard-shortcuts","next_photo"),group:b.transjax.get("keyboard-shortcut-legend","navigation"),order:0}});d.register({keystring:"37,75",handler:function(g){var f=b.one("#nav-bar-prev");if(!f.hasClass("DisabledButt")){g.preventDefault();f.addClass("ActiveButt");window.location=f.get("href")}},context:"",legend:{key:"&larr;",description:b.transjax.get("photo-keyboard-shortcuts","previous_photo"),group:b.transjax.get("keyboard-shortcut-legend","navigation"),order:0}});if(b.config.flickr.flags.enable_fave_keyboard_shortcut){d.register({keystring:"70",handler:function(g){if(!b.PhotoData){return}var f=b.PhotoData.get(b.config.flickr.photo.id);if(f&&f.get("can_fave")){g.preventDefault();f.toggle_fave()}},context:"",legend:{key:"F",description:b.transjax.get("photo-keyboard-shortcuts","fave_this_photo"),group:b.transjax.get("keyboard-shortcut-legend","actions"),order:0}})}if(b.config.flickr.flags.enable_comments_keyboard_shortcut){d.register({keystring:"67",handler:function(g){var f=b.one("#message");if(f){g.preventDefault();b.use("node-visibility",function(e){f.vis.animScrollIntoView(true,100);f.focus()})}},context:"",legend:{key:"C",description:b.transjax.get("photo-keyboard-shortcuts","jump_to_comment_field"),group:b.transjax.get("keyboard-shortcut-legend","actions"),order:60}})}if(b.config.flickr.flags.enable_tags_keyboard_shortcut){d.register({keystring:"84",handler:function(f){if(b.modalTagRS&&b.modalTagRS.add_a_tag){f.preventDefault();b.contextManager.set("tagrs-form-pending");window.setTimeout(function(){b.contextManager.unset("tagrs-form-pending")},200);b.modalTagRS.add_a_tag()}},context:"",legend:{key:"T",description:b.transjax.get("photo-keyboard-shortcuts","jump_to_add_tag_field"),group:b.transjax.get("keyboard-shortcut-legend","actions"),order:60}})}if(b.config.flickr.flags.enable_addperson_keyboard_shortcut){d.register({keystring:"80",handler:function(f){f.preventDefault();b.contextManager.set("addperson-form-pending");window.setTimeout(function(){b.contextManager.unset("addperson-form-pending")},200);b.use("photo-people-list",function(e){e.peopleList.showForm()})},context:"",legend:{key:"P",description:b.transjax.get("photo-keyboard-shortcuts","jump_to_add_person_field"),group:b.transjax.get("keyboard-shortcut-legend","actions"),order:60}})}b.one("#shortcuts").addClass("enabled")}else{b.one("#shortcuts")&&b.one("#shortcuts").removeClass("enabled")}}b.photoKeyboardShortcuts={init:a}},"0.0.1",{requires:F.config.modules["photo-keyboard-shortcuts"].requires||[],optional:F.config.modules["photo-keyboard-shortcuts"].optional||[]});YUI.add("box-host",function(g){function e(h){if(!h.one(".box-stroke-outer")){h.append('<span class="box-stroke box-stroke-outer"></span>')}if(!h.one(".box-stroke-main")){h.append('<span class="box-stroke box-stroke-main"></span>')}if(!h.one(".box-stroke-inner")){h.append('<span class="box-stroke box-stroke-inner"></span>')}}function a(h){if(!h.one(".resize-nw")){h.append('<span class="resize resize-nw"><span></span></span>')}if(!h.one(".resize-ne")){h.append('<span class="resize resize-ne"><span></span></span>')}if(!h.one(".resize-se")){h.append('<span class="resize resize-se"><span></span></span>')}if(!h.one(".resize-sw")){h.append('<span class="resize resize-sw"><span></span></span>')}}function c(k,j){var i,h;i=parseInt(k.getStyle("width"),10)*parseInt(k.getStyle("height"),10);h=parseInt(j.getStyle("width"),10)*parseInt(j.getStyle("height"),10);if(i>h){return -1}else{if(h>i){return 1}else{return 0}}}function d(i,h){i.setStyle("zIndex",h+1)}function b(h){h.sort(c);g.Array.each(h,d)}function f(x,i){var z,j=[],r,n,p,y,h,q,t,s,w,u,v,k;n=n||{};z={pixel_threshold:20,can_draw:true,box_tag_name:"div",newBoxCoords:{x:10,y:10,w:20,h:20}};if(!g.Lang.isObject(i)){i={}}z=g.mix(i,z);if(g.Lang.isString(x)){x=g.one(x)}if(!x instanceof g.Node){return false}if(!x.hasClass("boxes")){x.addClass("boxes")}x.all(".box").each(function(B){e(B);a(B);j.push(B)});b(j);x.on("mousedrag:start",function(C){var B=C.mouseTarget;if(B.test(".box-editable, .box-editable .box-stroke")){p=B.hasClass("box")?B:B.ancestor(".box");p.addClass("active-box");x.addClass("moving");q=true;w=parseInt(p.getStyle("left"),10);u=parseInt(p.getStyle("top"),10);l("move:start",p,C)}else{if(B.test(".resize, .resize span")){p=B.ancestor(".boxes .box");p.addClass("active-box");x.addClass("resizing");t=true;if(B.test(".resize-nw, .resize-nw span")){s="nw";x.addClass("resizing-nw")}else{if(B.test(".resize-ne, .resize-ne span")){s="ne";x.addClass("resizing-ne")}else{if(B.test(".resize-se, .resize-se span")){s="se";x.addClass("resizing-se")}else{if(B.test(".resize-sw, .resize-sw span")){s="sw";x.addClass("resizing-sw")}}}}w=parseInt(p.getStyle("left"),10);u=parseInt(p.getStyle("top"),10);v=parseInt(p.getStyle("width"),10);k=parseInt(p.getStyle("height"),10);l("resize:start",p,C)}else{if(!r&&z.can_draw&&!B.hasClass("box")&&!B.ancestor(".box")){y=true}}}});x.on("mousedrag:step",function(H){var I,C,G,E,D,B;I=10;C=10;if(y&&!p&&z.pixel_threshold<g.Math.hypotenuse((Math.abs(H.current.clientX-H.start.clientX)),(Math.abs(H.current.clientY-H.start.clientY)))){p=g.Node.create("<"+z.box_tag_name+' class="box active-box box-editable"></'+z.box_tag_name+">");e(p);a(p);x.appendChild(p);j.push(p);x.addClass("drawing");y=false;h=true;l("draw:start",p,H)}if(p){if(h){G=H.nodeRegion.left;E=H.nodeRegion.top;D=H.nodeRegion.width;B=H.nodeRegion.height;if(D<I){D=I}if(B<C){B=C}}else{if(t){switch(s){case"nw":G=w+H.current.diffX;E=u+H.current.diffY;D=v-H.current.diffX;B=k-H.current.diffY;break;case"ne":G=w;E=u+H.current.diffY;D=v+H.current.diffX;B=k-H.current.diffY;break;case"se":G=w;E=u;D=v+H.current.diffX;B=k+H.current.diffY;break;case"sw":G=w+H.current.diffX;E=u;D=v-H.current.diffX;B=k+H.current.diffY;break}if(G+D>parseInt(x.getStyle("width"),10)){D=parseInt(x.getStyle("width"),10)-G}if(G<0){D=D+G;G=0}if(E+B>parseInt(x.getStyle("height"),10)){B=parseInt(x.getStyle("height"),10)-E}if(E<0){B=B+E;E=0}if(G>w+v-I){G=w+v-I;D=I}if(G+D<w+I){D=I}if(E>u+k-C){E=u+k-C;B=C}if(E+B<u+C){B=C}}else{if(q){G=w+H.current.diffX;E=u+H.current.diffY;D=parseInt(p.getStyle("width"),10);B=parseInt(p.getStyle("height"),10)}}}if(G<0){G=0}if(E<0){E=0}if(G+D>parseInt(x.getStyle("width"),10)){G=parseInt(x.getStyle("width"),10)-D}if(E+B>parseInt(x.getStyle("height"),10)){E=parseInt(x.getStyle("height"),10)-B}if(g.Lang.isNumber(G)){p.setStyle("left",G+"px")}if(g.Lang.isNumber(E)){p.setStyle("top",E+"px")}if(g.Lang.isNumber(D)){p.setStyle("width",D+"px")}if(g.Lang.isNumber(B)){p.setStyle("height",B+"px")}if(h){l("draw:step",p,H)}else{if(t){l("resize:step",p,H)}else{if(q){l("move:step",p,H)}}}}});x.on("mousedrag:end",function(B){if(!p){return}if(t){x.removeClass("resizing");x.removeClass("resizing-nw");x.removeClass("resizing-ne");x.removeClass("resizing-se");x.removeClass("resizing-sw");t=false;l("resize:end",p,B)}else{if(h){x.removeClass("drawing");h=false;l("draw:end",p,B)}else{if(q){x.removeClass("moving");q=false;l("move:end",p,B)}}}b(j);p.removeClass("active-box");p=undefined});function l(B,C,D){if(n[B]){g.Object.each(n[B],function(E){E.apply(window,[C,D])})}}function m(D,C){var B=g.guid();if(!n[D]){n[D]={}}n[D][B]=C;return B}function A(B){g.Object.each(n,function(C){if(C[B]){C[B]=undefined;delete C[B]}})}function o(){var B=g.Node.create("<"+z.box_tag_name+' class="box box-editable"></'+z.box_tag_name+">");B.setStyle("left",z.newBoxCoords.x+"px");B.setStyle("top",z.newBoxCoords.y+"px");B.setStyle("width",z.newBoxCoords.w+"px");B.setStyle("height",z.newBoxCoords.h+"px");e(B);a(B);x.append(B);j.push(B);b(j);return B}return{on:m,detach:A,create:o,disableDraw:function(){r=true},enableDraw:function(){r=false}}}g.boxHost=f},"0.0.1",{requires:F.config.modules["box-host"].requires||[],optional:F.config.modules["box-host"].optional||[]});YUI.add("photo-notes-transjax",function(a){a.transjax.add("photo-notes",{svn_bump:"",saving:'Saving...',loading:'Loading...',deleting:'Deleting...',error_retrieving_note_to_edit:'There was a problem retrieving your note to edit.',error_retrieving_new_note:'There was a problem retrieving your new note.',error_deleting_note:"Uh oh, deleting that note didn't work.",error_deleting_person:"Uh oh, deleting that person didn't work.",error_saving_face_boundary:"Uh oh, saving that face boundary didn't work.",error_saving_note:"Uh oh, saving that note didn't work.",error_empty_note:"That won't work. Your note is empty!",error_too_many_notes:"Sorry, there are too many notes on this photo already.",error_invalid_email:"Oops! That doesn't look like a real email address. Try again?",button_save:"SAVE",button_cancel:"CANCEL",button_note:"NOTE",button_person:"PERSON",button_delete:"DELETE",button_yes_add_me:"YES, ADD ME",button_no_cancel:"NO, CANCEL"})},"0.0.1",{requires:["transjax-base"]});YUI.add("photo-notes",function(ad){var a5,D,aJ,ao,aW,u,ab,aH,l,aU,aI,am,ag,aF,aa,W,e,a3,aj,x,L,aN,a2,q,S,z,b,k,i,t,aP,aB,o,T,H,al,aD,g,G,ak,an,ap;function au(){aI=ad.transjax.get("photo-notes","button_save");am=ad.transjax.get("photo-notes","button_cancel");ag=ad.transjax.get("photo-notes","button_note");aF=ad.transjax.get("photo-notes","button_person");aa=ad.transjax.get("photo-notes","button_delete");W=ad.transjax.get("photo-notes","button_yes_add_me");e=ad.transjax.get("photo-notes","button_no_cancel");a3=ad.transjax.get("photo-notes","loading");aj=ad.transjax.get("photo-notes","saving");x=ad.transjax.get("photo-notes","deleting");L=ad.transjax.get("photo-notes","error_retrieving_note_to_edit");aN=ad.transjax.get("photo-notes","error_retrieving_new_note");a2=ad.transjax.get("photo-notes","error_saving_face_boundary");q=ad.transjax.get("photo-notes","error_empty_note");S=ad.transjax.get("photo-notes","error_saving_note");z=ad.transjax.get("photo-notes","error_deleting_note");b=ad.transjax.get("photo-notes","error_deleting_person");k=ad.transjax.get("photo-notes","error_too_many_notes");i=ad.transjax.get("photo-notes","error_invalid_email");t=ad.transjax.get("photo-people","type_person_name");aP=ad.transjax.get("photo-people","face_or_note");aB=ad.transjax.get("photo-people","not_visible_to_others");o=ad.transjax.get("photo-people","or_send_an_email_video");T=ad.transjax.get("photo-people","or_send_an_email_photo");H=ad.transjax.get("photo-people","send_an_email_video");al=ad.transjax.get("photo-people","send_an_email_photo");aD=ad.transjax.get("photo-people","if_you_enter_email_video");g=ad.transjax.get("photo-people","if_you_enter_email_photo");G=ad.transjax.get("photo-people","add_yourself_to_video");ak=ad.transjax.get("photo-people","add_yourself_to_photo");an=ad.transjax.get("bo-selecta","uber_contact_list_no_realname");ap=ad.transjax.get("bo-selecta","uber_contact_list_default_text");var a7,a6,Y;if(!a5){aJ=ad.one("#notes");if(!aJ){return undefined}a5=true;ab=ad.config.flickr.notes.photo_id;aH=ad.config.flickr.notes.ratio;l=ad.config.flickr.notes.count;aU=ad.config.flickr.notes.max_count;if(ad.config.flickr.user.nsid){D=ad.boxHost(aJ,{can_draw:ad.config.flickr.notes.can_add_note||ad.config.flickr.notes.can_add_person,box_tag_name:"li",newBoxCoords:{x:20,y:20,w:40,h:40}});D.on("draw:start",a4);D.on("draw:end",w);D.on("move:start",I);D.on("move:step",a0);D.on("move:end",aG);D.on("resize:start",I);D.on("resize:step",c);D.on("resize:end",aG)}aJ.on("mouseover",p);aJ.on("mouseout",p);ad.delegate("mouseover",U,aJ,".note");ad.delegate("mouseout",U,aJ,".note");ad.one("body").on("mousedown",O);ad.one("body").on("mouseup",O);ad.delegate("click",function(a8){ad.eventAnnotations.add(a8,{preventLightbox:true});aY(a8)},aJ,".note-buttons input");ad.on("peopleController:addPersonSuccess",ae);ad.on("peopleController:addPersonFailure",aq);ad.on("peopleController:removePersonSuccess",Q);ad.on("peopleController:removePersonFailure",M);aC()}}function O(a6){var Y;if(a6.button!==1){return}if(a6.target.ancestor(".note-text")){ad.eventAnnotations.add(a6,{ignoreDrag:true})}switch(a6.type){case"mousedown":O.mousedown_event=undefined;Y=a6.target.ancestor(".note",true);if(Y&&!a6.target.test("a, a *")){if(a1(Y)&&!Y.test(".note-new, .note-editing, .note-saving")&&!Y.siblings(".note-new, .note-editing, .note-saving").size()){d(Y)}O.mousedown_event=a6}break;case"mouseup":if(O.mousedown_event){if(a6.target===O.mousedown_event.target&&a6.target.test(".note .note-buttons input[type=button]")){aY(a6)}O.mousedown_event=undefined}break}}function aY(a6){if(a6.button!==1){return}var Y=a6.target.ancestor(".note");if(a6.target.hasClass("note-button-add-cancel")){K(Y,"");V(Y)}if(a6.target.hasClass("note-button-add-note")){K(Y,"");ar(Y)}if(a6.target.hasClass("note-button-add-person")){K(Y,"");ah(null,Y)}if(a6.target.hasClass("note-button-add-note-save")){aO(Y)}if(a6.target.hasClass("note-button-add-person-cancel")){V(Y)}if(a6.target.hasClass("note-button-add-person-yes-self")){P(Y)}if(a6.target.hasClass("note-button-add-face-save")){aO(Y);ad.fire("photoNote:addFace",{n:Y.getAttribute("data-person-nsid"),e:Y.getAttribute("data-person-email")})}if(a6.target.hasClass("note-button-add-face-cancel")){V(Y);ad.fire("photoNote:addFaceCancelled",{n:Y.getAttribute("data-person-nsid"),e:Y.getAttribute("data-person-email")})}if(a6.target.hasClass("note-button-edit-note-save")){aO(Y)}if(a6.target.hasClass("note-button-edit-note-delete")){aS(Y)}if(a6.target.hasClass("note-button-edit-note-cancel")){af(Y)}}function p(Y){if(ao){return}switch(Y.type){case"mouseover":if(Y.target===aJ){Y.target.addClass("notes-visible");E();p.hovered_node=Y.target}break;case"mouseout":if(p.hovered_node&&!p.hovered_node.contains(Y.relatedTarget)){p.hovered_node.removeClass("notes-visible");av();p.hovered_node=undefined}break}}function U(a6){var Y=a6.target.ancestor(".note",true);switch(a6.type){case"mouseover":if(ao){return}if(Y.hasClass("note")){A(Y);U.little_notes_pushed_down=[];aJ.all(".note").each(function(a9,a7,a8){if(Y!==a9&&a9.getStyle("zIndex")>Y.getStyle("zIndex")&&a9.inRegion(Y.one(".note-content"),false)){U.little_notes_pushed_down.push([a9,a9.getStyle("zIndex")]);a9.setStyle("zIndex",Y.getStyle("zIndex")-1)}});if(a1(Y)){Y.addClass("note-editable")}U.hovered_node=Y}break;case"mouseout":if(U.hovered_node&&!U.hovered_node.contains(a6.relatedTarget)){ac(U.hovered_node);U.hovered_node.removeClass("note-editable");U.hovered_node=undefined;if(U.little_notes_pushed_down){ad.Array.each(U.little_notes_pushed_down,function(a9,a8,a7){a9[0].setStyle("zIndex",a9[1]);a7[a8]=undefined});U.little_notes_pushed_down=undefined}}break}}function J(a7){var a6,Y,a9,a8;a6=y(a7);Y=a7.get("region");a9=a6.get("region");a8=aJ.get("region");if(Y.bottom+a9.height>a8.bottom&&Y.top-a9.height>a8.top){a6.setStyle("top","auto").setStyle("bottom","100%")}else{a6.setStyle("bottom","auto").setStyle("top","100%")}}J=ad.betterThrottle(J,50);function c(Y){J(Y)}function a0(Y){J(Y)}function a4(Y){X(Y);ao=true}function w(Y){J(Y);m(Y)}function I(Y){if(!Y.hasClass("note-new")){aW=aW||{left:Y.getStyle("left"),top:Y.getStyle("top"),width:Y.getStyle("width"),height:Y.getStyle("height")}}}function aG(Y){if(!Y.hasClass("note-new")){u={left:Y.getStyle("left"),top:Y.getStyle("top"),width:Y.getStyle("width"),height:Y.getStyle("height")};aR()}}function X(Y){Y.addClass("note").addClass("note-new");Y.setAttribute("data-note-user_id",ad.config.flickr.user.dbid);if(ad.config.flickr.photo.isOwner){Y.addClass("note-byowner")}return Y}function y(Y){var a6=Y.one(".note-content");if(!a6){a6=ad.Node.create('<span class="note-content"></span>');Y.append(a6)}return a6}function C(a8,Y){var a7,a6;if(!ad.Lang.isBoolean(Y)){Y=true}a7=y(a8);a6=a7.one(".note-text");if(!a6&&Y){a6=ad.Node.create('<span class="note-text"><span class="note-wrap"></span></span>');if(a7.one(".note-buttons")){a7.insertBefore(a6,a7.one(".note-buttons"))}else{a7.append(a6)}}return a6}function R(a7){var a6,Y;a6=C(a7);if(!ad.config.flickr.people.can_only_add_self){if(!a6.one("span.note-selecta-hint")){a6.append('<span class="note-selecta-hint">'+t+"</span>")}if(!a6.one("input.note-selecta")){Y=ad.Node.create('<input type="text" class="note-selecta" id="'+ad.guid()+'">');a6.append(Y)}N(a7)}else{if(!a6.one("span.note-selecta-hint")){a6.append('<span class="note-selecta-hint">'+(ad.config.flickr.photo.is_video?G:ak)+"</span>")}}}function aT(ba){var a6,a9,Y,a8,a7,bb,bc;a6=C(ba);a9=ba.one("textarea");if(!a9){a8=true;a9=ad.Node.create("<textarea></textarea>");a6.append(a9);a7=ba.getAttribute("data-note-id")}if(a8&&a7){Y=ba.one(".note-buttons");if(Y){Y.setStyle("display","none")}a9.set("value",a3);bb={note_id:a7};bc={success:function(bd){if(bd.data&&bd.data.note&&bd.data.note._content){a9.set("value",bd.data.note._content);a9.focus();if(Y){Y.setStyle("display","")}}else{bc.failure(bd)}},failure:function(bd){a9.set("value",L)}};ad.flickrAPI.callMethod("flickr.photos.notes.getInfo",bb,bc)}a9.focus()}function at(a8,a6){var a7,Y;a7=y(a8);Y=a8.one(".note-buttons");if(!Y){Y=ad.Node.create('<span class="note-buttons"></span>');a7.append(Y)}Y.set("innerHTML",a6)}function aM(a6){var Y="";Y+='<input type="button" class="SmallCancelButt note-button-edit-note-cancel" value="'+am+'">';Y+='<input type="button" class="SmallDeleteButt note-button-edit-note-delete" value="'+aa+'">';at(a6,Y)}function aK(a6){var Y="";Y+='<input type="button" class="SmallButt note-button-edit-note-save" value="'+aI+'">';Y+='<input type="button" class="SmallCancelButt note-button-edit-note-cancel" value="'+am+'">';Y+='<input type="button" class="SmallDeleteButt note-button-edit-note-delete" value="'+aa+'">';at(a6,Y)}function aL(a6){var Y="";if(ad.config.flickr.notes.can_add_note){Y+='<input type="button" class="SmallButt note-button-add-note" value="'+ag+'">'}if(ad.config.flickr.notes.can_add_person){Y+='<input type="button" class="SmallButt note-button-add-person" value="'+aF+'">'}Y+='<input type="button" class="SmallCancelButt note-button-add-cancel" value="'+am+'">';at(a6,Y)}function h(a6){var Y="";Y+='<input type="button" class="SmallButt note-button-add-note-save" value="'+aI+'">';Y+='<input type="button" class="SmallCancelButt note-button-add-cancel" value="'+am+'">';at(a6,Y)}function ai(a6){var Y="";Y+='<input type="button" class="SmallButt note-button-add-face-save" value="'+aI+'">';Y+='<input type="button" class="SmallCancelButt note-button-add-face-cancel" value="'+am+'">';at(a6,Y)}function r(a7,Y){var a6="";if(!ad.config.flickr.people.can_only_add_self){a6+='<input type="button" class="SmallCancelButt note-button-add-person-cancel" value="'+am+'">'}else{a6+='<input type="button" class="SmallButt note-button-add-person-yes-self" value="'+W+'">';a6+='<input type="button" class="SmallCancelButt note-button-add-person-cancel" value="'+e+'">'}at(a7,a6)}function B(Y){at(Y,"")}function a1(Y){if(ad.config.flickr.photo.isOwner){return true}if(ad.config.flickr.user.dbid&&Y.getAttribute("data-note-user_id")===ad.config.flickr.user.dbid){return true}if(ad.config.flickr.user.nsid&&Y.getAttribute("data-person-added_by")===ad.config.flickr.user.nsid){return true}if(ad.config.flickr.user.nsid&&(Y.getAttribute("data-person-nsid")===ad.config.flickr.user.nsid)){return true}return false}function ax(Y){Y.remove();Y=undefined}function V(Y){az(Y);ax(Y)}function af(a6){var Y;B(a6);a6.removeClass("note-editing");a6.removeClass("box-editable");if(aW){a6.setStyle("left",aW.left);a6.setStyle("top",aW.top);a6.setStyle("width",aW.width);a6.setStyle("height",aW.height)}az(a6)}function aQ(){return X(aE())}function aE(){if(D){return D.create()}}function aA(){if(D){D.enableDraw()}}function aR(){if(D){D.disableDraw()}}function m(Y){K(Y,aP);aL(Y);aR()}function ah(Y,a6){if(!a5){au();if(!a5){return undefined}}ao=true;aR();av();aJ.addClass("notes-visible");if(!a6){a6=f(Y);if(a6){if(a1(a6)){d(a6);a6.vis.animScrollIntoView(true,20)}return}else{a6=aQ()}}a6.addClass("person-note");a6.setAttribute("data-person-added_by",ad.config.flickr.user.nsid);a6.vis.animScrollIntoView(true,20);if(Y&&Y.n){a6.setAttribute("data-person-nsid",Y.n)}else{a6.setAttribute("data-person-nsid","")}if(Y&&Y.e){a6.setAttribute("data-person-email",Y.e)}else{a6.setAttribute("data-person-email","")}if(Y){v(a6,Y);d(a6);ai(a6)}else{R(a6);r(a6)}}function ar(Y){if(!a5){au();if(!a5){return undefined}}if(l>=aU){aV(k);return undefined}ao=true;aR();av();aJ.addClass("notes-visible");if(!Y){Y=aQ()}h(Y);aT(Y)}function d(a7){var Y,a6;Y=!a7.getAttribute("data-note-id");if(Y&&a7.getAttribute("data-person-added_by")!==ad.config.flickr.user.nsid){a6=true}a7.addClass("note-editing");ac(a7);ao=true;aR();av();aJ.addClass("notes-visible");if(a6){a7.all(".resize").setStyle("display","none");aM(a7)}else{a7.addClass("box-editable");aK(a7)}if(Y){a7.addClass("person-note")}else{aT(a7)}}function az(Y){K(Y,"");ao=false;aW=undefined;u=undefined;Y.removeClass("note-deleting");Y.removeClass("note-saving");Y.removeClass("note-new");Y.removeClass("note-editing");ad.focusTracker.blur();s(Y);aA()}function ay(Y){var a6,a7;a6={note_id:Y.getAttribute("data-note-id")};a7={success:function(ba){var a9,a8;if(ba.data&&ba.data.note&&ba.data.note._content){a8=ba.data.note.author===ad.config.flickr.photo.ownerNsid?"":' - <a href="/photos/'+ba.data.note.author+'/" class="note-author">'+ba.data.note.authorname+"</a>";a9=ba.data.note._content;a9=ad.StringFilters.linkify(a9);a9=ad.StringFilters.nl2br(a9);a9=a9+a8;C(Y).one("span.note-wrap").set("innerHTML",a9);if(C(Y).one("textarea")){C(Y).one("textarea").set("value",ba.data.note._content)}az(Y);aC(Y)}else{a7.failure(ba)}},failure:function(a8){K(Y,aN);az(Y)}};ad.flickrAPI.callMethod("flickr.photos.notes.getInfo",a6,a7)}function aX(Y){return{x:parseInt(Y.getStyle("left"),10)/aH,y:parseInt(Y.getStyle("top"),10)/aH,w:parseInt(Y.getStyle("width"),10)/aH,h:parseInt(Y.getStyle("height"),10)/aH}}function aO(a9){var bd,bb,a7,Y,a6,bc,ba,a8;bd=a9.getAttribute("data-note-id");a7=n(a9);ba=C(a9);bb=aX(a9);B(a9);a9.removeClass("note-new").removeClass("note-editing");a9.addClass("note-saving");a9.removeClass("box-editable");K(a9,aj);if(a7&&(a7.n||a7.e)){a6={photo_id:ab,person_x:bb.x,person_y:bb.y,person_w:bb.w,person_h:bb.h};if(a7.n){a6.user_id=a7.n}else{if(a7.e){a6.email=a7.e}}bc={success:function(be){v(a9,a7);az(a9);aC(a9)},failure:function(be){h(a9);a9.addClass("note-editing");a9.removeClass("note-saving");K(a9,"");aV(a2)}};ad.flickrAPI.callMethod("flickr.photos.people.editCoords",a6,bc)}else{Y=ad.Lang.trim(a9.one("textarea").get("value"));if(Y===""){aV(q);h(a9);a9.addClass("note-new");a9.removeClass("note-saving");K(a9,"");return}a6={note_x:bb.x,note_y:bb.y,note_w:bb.w,note_h:bb.h,note_text:Y};if(bd){a6.note_id=bd;bc={success:function(be){ay(a9)},failure:function(be){d(a9);aV(S)}};ad.flickrAPI.callMethod("flickr.photos.notes.edit",a6,bc)}else{a6.photo_id=ab;bc={success:function(be){l++;a9.setAttribute("data-note-id",be.data.note.id);ay(a9)},failure:function(be){h(a9);a9.addClass("note-new");a9.removeClass("note-saving");K(a9,"");switch(be.data.code){case 4:error_message=k;break;default:error_message=S}aV(error_message)}};ad.flickrAPI.callMethod("flickr.photos.notes.add",a6,bc)}}}function K(a7,a8){var a6,Y;a6=C(a7);Y=a6.one("span.msg");if(!Y){Y=ad.Node.create('<span class="msg"></span>');a6.append(Y)}Y.set("innerHTML",a8)}function aS(a8){var a7,a6,a9,ba,Y;a7=a8.getAttribute("data-note-id");B(a8);a8.removeClass("note-editing");a8.addClass("note-deleting");K(a8,x);if(a7){a9={note_id:a7};ba={success:function(bb){l--;az(a8);ax(a8)},failure:function(bb){aV(z);a8.removeClass("note-deleting");d(a8)}};ad.flickrAPI.callMethod("flickr.photos.notes.delete",a9,ba)}else{a6=n(a8);if(a6){ad.peopleController.removePerson(ad.config.flickr.photo.id,a6)}}}function n(Y){var a7,a6;a7=Y.getAttribute("data-person-nsid");a6=Y.getAttribute("data-person-email");return(a7||a6)?{n:a7,e:a6}:undefined}function f(Y){var a6;if(!Y){return undefined}if(Y.n){a6=aJ.one('.note[data-person-nsid="'+Y.n+'"]')}if(!a6&&Y.e){a6=aJ.one('.note[data-person-email="'+Y.e+'"]')}return a6}function ae(Y,a7){var a6;if(!a7){return}a6=f(Y);if(a6){v(a6,Y);az(a6);aC(a6)}}function aq(Y,a7){var a6=f(Y);if(a6&&a6.hasClass("note-saving")){j(a6,Y);ah(null,a6);aV(a7)}}function Q(Y){var a6=f(Y);if(a6){j(a6,Y);az(a6);ax(a6)}}function M(Y){var a6=f(Y);if(a6&&a6.hasClass("note-deleting")){a6.removeClass("note-deleting");K(a6,"");d(a6);aV(b)}}function aw(a6,Y){var a7;if(Y.n){a6.setAttribute("data-person-nsid",Y.n)}else{if(Y.e){a6.setAttribute("data-person-email",Y.e)}}a6.setAttribute("data-person-added_by",ad.config.flickr.user.nsid);a7={x:parseInt(a6.getStyle("left"),10)/aH,y:parseInt(a6.getStyle("top"),10)/aH,w:parseInt(a6.getStyle("width"),10)/aH,h:parseInt(a6.getStyle("height"),10)/aH};B(a6);a6.removeClass("note-new");a6.addClass("note-saving");a6.removeClass("box-editable");ad.peopleController.addPerson(ad.config.flickr.photo.id,Y,a7)}function P(a7){var Y,a6;Y=ad.config.flickr.user;a6={n:Y.nsid,u:Y.name,i:Y.icon_url,a:Y.pathalias};aw(a7,a6)}function a(a7,a6){var Y;Y=N(a7);setTimeout(function(){Y.clear(true)},0);Y.skipContact(a6);aw(a7,a6)}function v(ba,a7){var a9,a8,Y,a6;if(!ba.one(".note-wrap .person")){if(a7.n){a8=(a7.a||a7.n)?(ad.config.flickr.photo.ownersUrl+"people/"+(a7.a?a7.a:a7.n)+"/"):"";Y=ad.BoSelecta3.sanitizeString(a7.u);if(Y.length>20){Y=Y.substr(0,20)+"..."}}else{if(a7.e){a6=ad.BoSelecta3.sanitizeString(a7.e);if(a6.length>20){a6=a6.substr(0,20)+"\u2026"}}}a9=((a7.n)?'<span class="person">'+(a8?'<a href="'+a8+'">':"")+'<img src="'+a7.i+'" width="24" height="24"><strong class="username">'+Y+'</strong><span class="realname">'+(a7.r?ad.BoSelecta3.sanitizeString(a7.r):an)+"</span>"+(a8?"</a>":"")+"</span>":'<span class="person email"><img src="'+ad.config.flickr.images_root+'/icon_unread.gif" width="16" height="16" class="bs-email-icon"><strong class="username">'+a6+'</strong><span class="realname">'+aB+"</span></span>");C(ba).one(".note-wrap").set("innerHTML",a9)}}function j(a7,a6){var Y=N(a7,false);if(Y){Y.unskipContact(a6)}if(a6.n&&ad.config.flickr.people.skip&&ad.config.flickr.people.skip[a6.n]){delete ad.config.flickr.people.skip[a6.n]}if(a6.e&&ad.config.flickr.people.skip&&ad.config.flickr.people.skip[a6.e]){delete ad.config.flickr.people.skip[a6.e]}}function s(a6){var Y,a7;Y=N(a6,false);if(Y){Y.destroy()}a7=a6.one(".note-selecta-hint");if(a7){a7.remove()}}function N(bd,Y){var a7,bc,ba,a8,a6,a9,bb;if(!ad.Lang.isBoolean(Y)){Y=true}a7=N.selectas||{};bc=bd.one("input[type=text]");if(bc){a8=bc.get("id");ba=a7[a8]}if(!ba&&Y&&!ad.config.flickr.people.can_only_add_self){bb=function(be){if(ad.StringFilters.is_email_address(ba.getQuery())){a(bd,{e:ba.getQuery()})}};a6=ad.peopleController.getContactsCache();a9=[{message:"<span>"+ad.config.flickr.photo.is_video?o:T+"</span>",className:"bs-send-email-link",onclick:bb,validator:function(be){return(ad.StringFilters.is_email_address(be.getQuery())&&!be.searchingGlobally)}},{message:"<span>"+ad.config.flickr.photo.is_video?H:al+"</span>",className:"bs-send-email-link",onclick:bb,validator:function(be){return(ad.StringFilters.is_email_address(be.getQuery())&&be.searchingGlobally)}},{message:"<span>"+ad.config.flickr.photo.is_video?aD:g+"</span>",className:"bs-enter-email-link",onclick:bb,validator:function(be){return(!ad.StringFilters.is_email_address(be.getQuery())&&be.searchingGlobally)}}];ba=new ad.BoSelecta3(bc,{showSubtitle:true,showIcon:true,searchOnUsername:true,searchOnRealname:true,searchOnEmail:true,searchOnPathAlias:true,includeAddressBook:true,includeUser:true,defaultText:ap,focusOnFetch:true,fetchDataImmediately:!a6,selectFirstItem:true,allowFormSubmit:false,respectCanTagFlag:true,enableGlobalSearch:true,zeroResultsMessages:a9,apiURL:ad.config.flickr.people.api_url});if(a6){ba.contacts=a6;ba.clear(true)}else{ba.on("BoSelecta:dataFetchComplete",function(){ad.peopleController.setContactsCache(ba.contacts)})}ba.on("BoSelecta:resultSelect",function(be){a(bd,be)});ba.on("BoSelecta:inputEnter",bb);if(ad.config.flickr.people.skip){ad.Object.each(ad.config.flickr.people.skip,function(bg,be,bf){ba.skipContact(bg)})}a7[a8]=ba;N.selectas=a7}return ba}function aV(Y){ad.global_dialog.create_alert_dialog(Y,ad.global_dialog.hide,{width:280})}function aC(Y){var a6,a7;if(Y){a6=Y;a7="note-flash"}else{a6=aJ;a7="notes-flash"}a6.addClass(a7);setTimeout(function(){a6.removeClass(a7)},1300)}function A(Y){Y.addClass("note-visible");av();E(Y)}function ac(Y){Y.removeClass("note-visible");E();av(Y)}function E(Y){var a6=Y||aJ.all(".note:not(.person-note)");a6.addClass("note-highlight")}function av(Y){var a6=Y||aJ.all(".note:not(.person-note)");a6.removeClass("note-highlight")}function Z(Y){var a6;if(!a5){return undefined}a6=f(Y);if(a6){A(a6)}}function aZ(Y){var a6;if(!a5){return undefined}a6=f(Y);if(a6){ac(a6)}}ad.photoNotes={init:au,addNote:ar,addPerson:ah,highlightPerson:Z,unhighlightPerson:aZ}},"0.0.1",{requires:F.config.modules["photo-notes"].requires||[],optional:F.config.modules["photo-notes"].optional||[]});YUI.add("bitmap-text",function(a){a.BitmapText={convert:function(b,s){var k=b.innerHTML;b.innerHTML="";var c=document.createElement("canvas");b.appendChild(c);var l=a.BitmapText.tokenize(k);var D=s.scale||1;var y=s.lineSpacing||1;var m=s.font||Fonts.Silkscreen;var d=a.BitmapText.calculateLength(l,m,D,y);var r=s.width||d.totalWidth;var o=d.lineHeight*Math.ceil(d.totalWidth/r);for(var f=0,C=0,i=1,h=l.length;f<h;f++){var g=l[f],j=m[g];for(var q=f,w=l.length;q<w;q++){if(l[q]==="space"){break}}var B=q;var z=a.BitmapText.calculateLength(l.slice(f,B),m,D).totalWidth;var p=a.BitmapText.calculateLength(l.slice(f,f+1),m,D).totalWidth;if((C+z>r)&&((l[f-1]==="space"&&z<=r)||(C+p>r))){i++;C=0}C+=(j[0].length+1)*D}o=d.lineHeight*i;var x=s.angle||0;c.width=(x===90||x===270)?o:r;c.height=(x===90||x===270)?r:o;var t=c.getContext("2d");var v=window.getComputedStyle(b,"");var u=v.getPropertyValue("color");t.fillStyle=u;var A=0,e=0;for(var q=0,w=l.length;q<w;q++){C=a.BitmapText.translate(l,q,A,e,r,d.lineHeight,t,m,x,D,r);A=C[0];e=C[1]}},addStringToCanvas:function(l,u,t){var j=t.x||0;var h=t.y||0;var o=t.font||Fonts.Silkscreen;var F=t.scale||1;var A=t.lineSpacing||1;var z=t.angle||0;var v=t.color||"#000";var c=t.textAlign||"left";var m=a.BitmapText.tokenize(l);var b=a.BitmapText.calculateLength(m,o,F,A);var s=t.width||b.totalWidth;var p=b.lineHeight*Math.ceil(b.totalWidth/s);for(var e=0,E=0,i=1,g=m.length;e<g;e++){var f=m[e],k=o[f];for(var r=e,w=m.length;r<w;r++){if(m[r]==="space"){break}}var D=r;var B=a.BitmapText.calculateLength(m.slice(e,D),o,F).totalWidth;var q=a.BitmapText.calculateLength(m.slice(e,e+1),o,F).totalWidth;if((E+B>s)&&((m[e-1]==="space"&&B<=s)||(E+q>s))){i++;E=0}E+=(k[0].length+1)*F}p=b.lineHeight*i;u.fillStyle=v;var C=0,d=0;if(c==="right"&&p===b.lineHeight&&b.totalWidth<s){C=s-b.totalWidth}for(var r=0,w=m.length;r<w;r++){E=a.BitmapText.translate(m,r,C,d,s,b.lineHeight,u,o,z,F,s,j,h);C=E[0];d=E[1]}},tokenize:function(f){f=f.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");for(var g=0,b=f.length,e=[],c,d;g<b;g++,c=""){d=f.charAt(g);if(d.match(/[a-zA-Z]/)){c=d}else{switch(d){case" ":c="space";break;case"1":c="one";break;case"2":c="two";break;case"3":c="three";break;case"4":c="four";break;case"5":c="five";break;case"6":c="six";break;case"7":c="seven";break;case"8":c="eight";break;case"9":c="nine";break;case"0":c="zero";break;case"!":c="exclaimationPoint";break;case"@":c="at";break;case"#":c="hash";break;case"$":c="dollar";break;case"%":c="percentage";break;case"^":c="caret";break;case"&":c="ampersand";break;case"*":c="star";break;case"(":c="leftParen";break;case")":c="rightParen";break;case"_":c="underscore";break;case"-":c="dash";break;case"+":c="plus";break;case"=":c="equals";break;case"`":c="backtick";break;case"~":c="tilde";break;case"[":c="leftBracket";break;case"]":c="rightBracket";break;case"\\":c="leftSlash";break;case"{":c="leftCurlyBracket";break;case"}":c="rightCurlyBracket";break;case"|":c="pipe";break;case";":c="semiColon";break;case":":c="colon";break;case"'":c="singleQuote";break;case'"':c="doubleQuote";break;case",":c="comma";break;case".":c="period";break;case"/":c="rightSlash";break;case"<":c="leftAngleBracket";break;case">":c="rightAngleBracket";break;case"?":c="questionMark";break;case"©":c="copyright";break;default:c=""}}if(c!==""){e.push(c)}}return e},calculateLength:function(e,c,g,f){var d={totalWidth:0};for(var h=0,b=e.length;h<b;h++){d.totalWidth+=c[e[h]][0].length+g}d.totalWidth=d.totalWidth*g;d.lineHeight=(c.space.length+f)*g;return d},translate:function(j,e,z,d,q,l,s,k,u,A,b,h,g){if(h===undefined){h=0}if(g===undefined){g=0}var f=j[e],i=k[f];for(var p=e,t=j.length;p<t;p++){if(j[p]==="space"){break}}var w=p;var v=a.BitmapText.calculateLength(j.slice(e,w),k,A).totalWidth;var o=a.BitmapText.calculateLength(j.slice(e,e+1),k,A).totalWidth;if((z+v>q)&&((j[e-1]==="space"&&v<=q)||(z+o>q))){d++;z=0}var c=0;for(var p=0,t=i.length*A;p<t;p+=A){for(var r=0,c=i[p/A].length*A;r<c;r+=A){if(!i[p/A][r/A]){continue}switch(u){case 90:s.fillRect(t-p+h,r+z+g,A,A);break;case 180:s.fillRect(b-(r+z)-1+h,t-p+g,A,A);break;case 270:s.fillRect(p+h,b-(r+z)-1+g,A,A);break;default:s.fillRect(r+z+h,p+(d*l)+g,A,A);break}}}return[z+c+A,d]}}},"0.0.1",{requires:[]});YUI.add("bitmap-type-silkscreen",function(a){a.BitmapTypeSilkscreen={a:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1],[0,0,0,0]],b:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,1,1,0],[0,0,0,0]],c:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,0],[1,0,0,1],[0,1,1,0],[0,0,0,0]],d:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,0],[0,0,0,0]],e:[[0,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[0,0,0,0]],f:[[0,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[1,0,0,0],[1,0,0,0],[0,0,0,0]],g:[[0,0,0,0],[0,1,1,1],[1,0,0,0],[1,0,1,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],h:[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1],[0,0,0,0]],i:[[0],[1],[1],[1],[1],[1],[0]],j:[[0,0,0,0],[0,0,0,1],[0,0,0,1],[0,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],k:[[0,0,0,0],[1,0,0,1],[1,0,1,0],[1,1,0,0],[1,0,1,0],[1,0,0,1],[0,0,0,0]],l:[[0,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,1,1],[0,0,0,0]],m:[[0,0,0,0,0],[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],n:[[0,0,0,0,0],[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[0,0,0,0,0]],o:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],p:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]],q:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,1]],r:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,1,0],[1,0,0,1],[0,0,0,0]],s:[[0,0,0,0],[0,1,1,1],[1,0,0,0],[0,1,1,0],[0,0,0,1],[1,1,1,0],[0,0,0,0]],t:[[0,0,0],[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,0]],u:[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],v:[[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0],[0,0,0,0,0]],w:[[0,0,0,0,0],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0],[0,0,0,0,0]],x:[[0,0,0,0,0],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[0,0,0,0,0]],y:[[0,0,0,0,0],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],z:[[0,0,0],[1,1,1],[0,0,1],[0,1,0],[1,0,0],[1,1,1],[0,0,0]],A:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1],[0,0,0,0]],B:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,1,1,0],[0,0,0,0]],C:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,0],[1,0,0,1],[0,1,1,0],[0,0,0,0]],D:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,1,1,0],[0,0,0,0]],E:[[0,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[0,0,0,0]],F:[[0,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,1],[1,0,0,0],[1,0,0,0],[0,0,0,0]],G:[[0,0,0,0],[0,1,1,1],[1,0,0,0],[1,0,1,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],H:[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,1,1,1],[1,0,0,1],[1,0,0,1],[0,0,0,0]],I:[[0],[1],[1],[1],[1],[1],[0]],J:[[0,0,0,0],[0,0,0,1],[0,0,0,1],[0,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],K:[[0,0,0,0],[1,0,0,1],[1,0,1,0],[1,1,0,0],[1,0,1,0],[1,0,0,1],[0,0,0,0]],L:[[0,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,1,1],[0,0,0,0]],M:[[0,0,0,0,0],[1,0,0,0,1],[1,1,0,1,1],[1,0,1,0,1],[1,0,0,0,1],[1,0,0,0,1],[0,0,0,0,0]],N:[[0,0,0,0,0],[1,0,0,0,1],[1,1,0,0,1],[1,0,1,0,1],[1,0,0,1,1],[1,0,0,0,1],[0,0,0,0,0]],O:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],P:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,0,0],[1,0,0,0],[0,0,0,0]],Q:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,1]],R:[[0,0,0,0],[1,1,1,0],[1,0,0,1],[1,1,1,0],[1,0,1,0],[1,0,0,1],[0,0,0,0]],S:[[0,0,0,0],[0,1,1,1],[1,0,0,0],[0,1,1,0],[0,0,0,1],[1,1,1,0],[0,0,0,0]],T:[[0,0,0],[1,1,1],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,0]],U:[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],V:[[0,0,0,0,0],[1,0,0,0,1],[1,0,0,0,1],[0,1,0,1,0],[0,1,0,1,0],[0,0,1,0,0],[0,0,0,0,0]],W:[[0,0,0,0,0],[1,0,0,0,1],[1,0,1,0,1],[1,0,1,0,1],[1,0,1,0,1],[0,1,0,1,0],[0,0,0,0,0]],X:[[0,0,0,0,0],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,1,0,1,0],[1,0,0,0,1],[0,0,0,0,0]],Y:[[0,0,0,0,0],[1,0,0,0,1],[0,1,0,1,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],Z:[[0,0,0],[1,1,1],[0,0,1],[0,1,0],[1,0,0],[1,1,1],[0,0,0]],space:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],one:[[0,0,0],[1,1,0],[0,1,0],[0,1,0],[0,1,0],[1,1,1],[0,0,0]],two:[[0,0,0,0],[1,1,1,0],[0,0,0,1],[0,1,1,0],[1,0,0,0],[1,1,1,1],[0,0,0,0]],three:[[0,0,0,0],[1,1,1,0],[0,0,0,1],[0,1,1,0],[0,0,0,1],[1,1,1,0],[0,0,0,0]],four:[[0,0,0,0],[1,0,1,0],[1,0,1,0],[1,1,1,1],[0,0,1,0],[0,0,1,0],[0,0,0,0]],five:[[0,0,0,0],[1,1,1,1],[1,0,0,0],[1,1,1,0],[0,0,0,1],[1,1,1,0],[0,0,0,0]],six:[[0,0,0,0],[0,1,1,0],[1,0,0,0],[1,1,1,0],[1,0,0,1],[0,1,1,0],[0,0,0,0]],seven:[[0,0,0,0],[1,1,1,1],[0,0,0,1],[0,0,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],eight:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[0,1,1,0],[1,0,0,1],[0,1,1,0],[0,0,0,0]],nine:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[0,1,1,1],[0,0,0,1],[0,1,1,0],[0,0,0,0]],zero:[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[1,0,0,1],[0,1,1,0],[0,0,0,0]],exclaimationPoint:[[0],[1],[1],[1],[0],[1],[0]],at:[[0,0,0,0,0],[0,1,1,1,0],[1,0,1,0,1],[1,0,1,1,0],[1,0,0,0,0],[0,1,1,1,0],[0,0,0,0,0]],hash:[[0,0,0,0,0],[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0],[1,1,1,1,1],[0,1,0,1,0],[0,0,0,0,0]],dollar:[[0,0,1,0],[0,1,1,1],[1,0,0,0],[0,1,1,0],[0,0,0,1],[1,1,1,0],[0,1,0,0]],percentage:[[0,0,0,0,0],[1,1,0,1,0],[1,1,0,1,0],[0,0,1,0,0],[0,1,0,1,1],[0,1,0,1,1]],caret:[[0,1,0],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ampersand:[[0,0,1,0],[0,1,1,1],[1,0,0,0],[0,1,1,0],[1,0,0,0],[0,1,1,1],[0,0,1,0]],star:[[0,0,0,0,0],[0,0,1,0,0],[1,0,1,0,1],[0,1,1,1,0],[1,0,1,0,1],[0,0,1,0,0],[0,0,0,0,0]],leftParen:[[0,0],[0,1],[1,0],[1,0],[1,0],[0,1],[0,0]],rightParen:[[0,0],[1,0],[0,1],[0,1],[0,1],[1,0],[0,0]],underscore:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,1,1,1]],dash:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]],plus:[[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[1,1,1,1,1],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],equals:[[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],backtick:[[0,0],[1,0],[0,1],[0,0],[0,0],[0,0],[0,0]],tilde:[[0,0,0,0],[0,1,0,1],[1,0,1,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],leftBracket:[[0,0],[1,1],[1,0],[1,0],[1,0],[1,1],[0,0]],rightBracket:[[0,0],[1,1],[0,1],[0,1],[0,1],[1,1],[0,0]],leftSlash:[[0,0,0],[1,0,0],[1,0,0],[0,1,0],[0,0,1],[0,0,1],[0,0,0]],leftCurlyBracket:[[0,0,0],[0,1,1],[0,1,0],[1,0,0],[0,1,0],[0,1,1],[0,0,0]],rightCurlyBracket:[[0,0,0],[1,1,0],[0,1,0],[0,0,1],[0,1,0],[1,1,0],[0,0,0]],pipe:[[1],[1],[1],[1],[1],[1],[1]],semiColon:[[0,0],[0,0],[0,1],[0,0],[0,1],[1,0],[0,0]],colon:[[0,0],[0,0],[0,1],[0,0],[0,1],[0,0],[0,0]],singleQuote:[[0,0],[1,0],[1,0],[0,0],[0,0],[0,0],[0,0]],doubleQuote:[[0,0,0],[1,0,1],[1,0,1],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],comma:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,0],[0,0]],period:[[0],[0],[0],[0],[0],[1],[0]],rightSlash:[[0,0,0],[0,0,1],[0,0,1],[0,1,0],[1,0,0],[1,0,0],[0,0,0]],leftAngleBracket:[[0,0,0],[0,0,1],[0,1,0],[1,0,0],[0,1,0],[0,0,1],[0,0,0]],rightAngleBracket:[[0,0,0],[1,0,0],[0,1,0],[0,0,1],[0,1,0],[1,0,0],[0,0,0]],questionMark:[[0,0,0,0],[1,1,1,0],[0,0,0,1],[0,1,1,0],[0,0,0,0],[0,1,0,0],[0,0,0,0]],copyright:[[0,1,1,1,1,1,0],[1,0,0,0,0,0,1],[1,0,0,1,1,0,1],[1,0,1,0,0,0,1],[1,0,0,1,1,0,1],[1,0,0,0,0,0,1],[0,1,1,1,1,1,0]]}},"0.0.1",{requires:[]});YUI.add("flapid",function(c){var b="flickr.metrics.increment";function a(d,g,f,e){var h={key:d,addValue:(g||1)};if(f){h.data=f}if(e){h.source=e}c.flickrAPI.callMethod(b,h)}c.flapid={track:a}},"0.0.1",{requires:["gallery-flickr-api"]});YUI.add("photo-sidebar-transjax",function(a){a.transjax.add("photo-sidebar",{tags_placeholder_photo:'...and %s more tags',tags_placeholder_video:'...and %s more tags',comments_zero:'%s <span class="full-text">comments</span>',comments_one:'%s <span class="full-text">comment</span>',comments_two_or_more:'%s <span class="full-text">comments</span>',favorites_zero:'%s <span class="full-text">favorites</span>',favorites_one:'%s <span class="full-text">favorite</span>',favorites_two_or_more:'%s <span class="full-text">favorites</span>',galleries_zero:'%s <span class="full-text">galleries</span>',galleries_one:'%s <span class="full-text">gallery</span>',galleries_two_or_more:'%s <span class="full-text">galleries</span>'})},"0.0.1",{requires:["transjax-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("stylesheet",function(b){var k=b.config.doc,c=k.createElement("p"),g=c.style,e=b.Lang.isString,n={},j={},l=("cssFloat" in g)?"cssFloat":"styleFloat",h,a,m,o="opacity",q="float",f="";a=(o in g)?function(d){d.opacity=f;}:function(d){d.filter=f;};g.border="1px solid red";g.border=f;m=g.borderLeft?function(d,s){var r;if(s!==l&&s.toLowerCase().indexOf(q)!=-1){s=l;}if(e(d[s])){switch(s){case o:case"filter":a(d);break;case"font":d.font=d.fontStyle=d.fontVariant=d.fontWeight=d.fontSize=d.lineHeight=d.fontFamily=f;break;default:for(r in d){if(r.indexOf(s)===0){d[r]=f;}}}}}:function(d,p){if(p!==l&&p.toLowerCase().indexOf(q)!=-1){p=l;}if(e(d[p])){if(p===o){a(d);}else{d[p]=f;}}};function i(x,s){var A,v,z,y={},p,B,u,w,d,t;if(!(b.instanceOf(this,i))){return new i(x,s);}if(x){if(b.Node&&x instanceof b.Node){v=x._node;}else{if(x.nodeName){v=x;}else{if(e(x)){if(x&&j[x]){return j[x];}v=k.getElementById(x.replace(/^#/,f));}}}if(v&&j[b.stamp(v)]){return j[b.stamp(v)];}}if(!v||!/^(?:style|link)$/i.test(v.nodeName)){v=k.createElement("style");v.type="text/css";}if(e(x)){if(x.indexOf("{")!=-1){if(v.styleSheet){v.styleSheet.cssText=x;}else{v.appendChild(k.createTextNode(x));}}else{if(!s){s=x;}}}if(!v.parentNode||v.parentNode.nodeName.toLowerCase()!=="head"){A=(v.ownerDocument||k).getElementsByTagName("head")[0];A.appendChild(v);}z=v.sheet||v.styleSheet;p=z&&("cssRules" in z)?"cssRules":"rules";u=("deleteRule" in z)?function(r){z.deleteRule(r);}:function(r){z.removeRule(r);};B=("insertRule" in z)?function(D,C,r){z.insertRule(D+" {"+C+"}",r);}:function(D,C,r){z.addRule(D,C,r);};for(w=z[p].length-1;w>=0;--w){d=z[p][w];t=d.selectorText;if(y[t]){y[t].style.cssText+=";"+d.style.cssText;u(w);}else{y[t]=d;}}i.register(b.stamp(v),this);if(s){i.register(s,this);}b.mix(this,{getId:function(){return b.stamp(v);},enable:function(){z.disabled=false;return this;},disable:function(){z.disabled=true;return this;},isEnabled:function(){return !z.disabled;},set:function(E,D){var G=y[E],F=E.split(/\s*,\s*/),C,r;if(F.length>1){for(C=F.length-1;C>=0;--C){this.set(F[C],D);}return this;}if(!i.isValidSelector(E)){return this;}if(G){G.style.cssText=i.toCssText(D,G.style.cssText);}else{r=z[p].length;D=i.toCssText(D);if(D){B(E,D,r);y[E]=z[p][r];}}return this;},unset:function(E,D){var G=y[E],F=E.split(/\s*,\s*/),r=!D,H,C;if(F.length>1){for(C=F.length-1;C>=0;--C){this.unset(F[C],D);}return this;}if(G){if(!r){D=b.Array(D);g.cssText=G.style.cssText;for(C=D.length-1;C>=0;--C){m(g,D[C]);}if(g.cssText){G.style.cssText=g.cssText;}else{r=true;}}if(r){H=z[p];for(C=H.length-1;C>=0;--C){if(H[C]===G){delete y[E];u(C);break;}}}}return this;},getCssText:function(D){var E,C,r;if(e(D)){E=y[D.split(/\s*,\s*/)[0]];return E?E.style.cssText:null;}else{C=[];for(r in y){if(y.hasOwnProperty(r)){E=y[r];C.push(E.selectorText+" {"+E.style.cssText+"}");}}return C.join("\n");}}});}h=function(r,t){var s=r.styleFloat||r.cssFloat||r[q],d=b.Lang.trim,v;try{g.cssText=t||f;}catch(u){c=k.createElement("p");g=c.style;g.cssText=t||f;}if(s&&!r[l]){r=b.merge(r);delete r.styleFloat;delete r.cssFloat;delete r[q];r[l]=s;}for(v in r){if(r.hasOwnProperty(v)){try{g[v]=d(r[v]);}catch(p){}}}return g.cssText;};b.mix(i,{toCssText:((o in g)?h:function(d,p){if(o in d){d=b.merge(d,{filter:"alpha(opacity="+(d.opacity*100)+")"});delete d.opacity;}return h(d,p);}),register:function(d,p){return !!(d&&p instanceof i&&!j[d]&&(j[d]=p));},isValidSelector:function(p){var d=false;if(p&&e(p)){if(!n.hasOwnProperty(p)){n[p]=!/\S/.test(p.replace(/\s+|\s*[+~>]\s*/g," ").replace(/([^ ])\[.*?\]/g,"$1").replace(/([^ ])::?[a-z][a-z\-]+[a-z](?:\(.*?\))?/ig,"$1").replace(/(?:^| )[a-z0-6]+/ig," ").replace(/\\./g,f).replace(/[.#]\w[\w\-]*/g,f));}d=n[p];}return d;}},true);b.StyleSheet=i;},"3.4.0");YUI.add("photo-sidebar",function(h){var e,f=false;function b(){var j=h.one("#photo-story-map");if(!j){return}else{f=true}d(6,true);var i=false;j.on("mouseover",function(p){try{var n=h.one("#photo-story-map-zoom-in"),m=h.one("#photo-story-map-zoom-out");if(n&&m){var l=new h.Anim({node:n,to:{opacity:1},duration:0.15,easing:h.Easing.easeOut});l.run();var k=new h.Anim({node:m,to:{opacity:0},duration:0.15,easing:h.Easing.easeOut});k.run()}if(n){d(5)}}catch(o){}});j.on("mousemove",function(q){try{var t=q.pageX-q.target.getX(),r=q.pageY-q.target.getY(),o,u,m=134,l=166,v=35,s=67,k=h.one("#photo-story-map-zoom-street"),p=h.one("#photo-story-map-zoom-in");if(t>m&&t<l&&r>v&&r<s&&!i){if(k){o=new h.Anim({node:k,to:{opacity:1},duration:0.15,easing:h.Easing.easeOut});o.run()}if(p){u=new h.Anim({node:p,to:{opacity:0},duration:0.15,easing:h.Easing.easeOut});u.run()}if(k){d(4);i=true}}if((t<=m||t>=l||r<=v||r>=s)&&i){if(p){o=new h.Anim({node:p,to:{opacity:1},duration:0.15,easing:h.Easing.easeOut});o.run()}if(k){u=new h.Anim({node:k,to:{opacity:0},duration:0.15,easing:h.Easing.easeOut});u.run()}if(k){d(5);i=false}}}catch(n){}});j.on("mouseout",function(q){try{var n=h.one("#photo-story-map-zoom-out"),o=h.one("#photo-story-map-zoom-in"),r=h.one("#photo-story-map-zoom-street");if(n){var l=new h.Anim({node:n,to:{opacity:1},duration:0.15,easing:h.Easing.easeOut});l.run()}if(o){var k=new h.Anim({node:o,to:{opacity:0},duration:0.15,easing:h.Easing.easeOut});k.run()}if(r){var m=new h.Anim({node:r,to:{opacity:0},duration:0.15,easing:h.Easing.easeOut});m.run()}d(6)}catch(p){}});a("")}function g(k){if(!h.Lang.isObject(k)){k={}}var p=h.all("#thetags li");var q=35;var l=q-1;if(p&&p.size()>q){p.each(function(t,s){if(s>l){t.setStyle("display","none")}});var n=h.Node.create("<li></li>");n.set("innerHTML",'<a href="#" id="tags-placeholder-link">'+h.transjax.get("photo-sidebar","tags_placeholder_"+(h.config.flickr.photo.is_video?"video":"photo"),p.size()-q)+"</a>");h.one("#thetags").appendChild(n);h.one("#tags-placeholder-link").on("click",function(s){s.halt();n.remove();p.setStyle("display","")})}b();h.after("PhotoData:comment_countChange",function(w){var t,v,u,x,s;t=w.target;if(h.config.flickr.photo.id===t.get("id")){v=h.one("#comment-count");u=w.newVal;if(v){x=(u===0)?"comments_zero":((u===1)?"comments_one":"comments_two_or_more");s='<span class="stat-icon"></span>'+h.transjax.get("photo-sidebar",x,u);v.set("innerHTML",s);if(u>0){v.removeClass("zero")}else{v.addClass("zero")}c()}}});h.on("contact_changer:change",function(t){var s={method:"get",data:"badge=1&magic_cookie="+h.config.flickr.magic_cookie+"&nsid="+h.PhotoData.get(h.config.flickr.photo.id).get("owner"),on:{success:function(w,v,u){h.one(".realname").set("innerHTML",v.responseText);h.one(".realname").addClass("contact-highlight");h.later(1000,this,function(){h.one(".realname").removeClass("contact-highlight")});if(i){i=undefined;h.flapid.track("facegrease_contact_added_link");h.rapidTracker.addModules("contact-changer");h.rapidTracker.beaconClick("contact-changer","add-from-badge")}},failure:function(w,v,u){}}};h.io("/photos_relationship_fragment.gne?cachebust="+(new Date()).getTime(),s)});var r=h.one(".realname");var i;if(r){r.on("click",function(u){if(u.target.hasClass("contact-changer-trigger")){u.preventDefault();if(u.target.hasClass("badge_add_contact")){i=true}else{i=false}var t=h.PhotoData.get(h.config.flickr.photo.id);var s=t.get("owner");h.use("contact-changer",function(v){v.contact_changer.show(s)})}})}h.after("PhotoData:fave_countChange",function(w){var t,v,u,x,s;t=w.target;if(h.config.flickr.photo.id===t.get("id")){v=h.one("#fave-count");u=w.newVal;if(v){x=(u===0)?"favorites_zero":((u===1)?"favorites_one":"favorites_two_or_more");s='<span class="stat-icon"></span>'+h.transjax.get("photo-sidebar",x,u);v.set("innerHTML",s);if(u>0){v.removeClass("zero")}else{v.addClass("zero")}c()}}});h.on("photo:galleryAdd",function(){j(1)});h.on("photo:galleryRemove",function(){j(-1)});function j(s){var v,u,w,t;v=h.one("#gallery-count");if(v){u=parseInt(v.getAttribute("data-gallery-count"),10)+s;v.setAttribute("data-gallery-count",u);w=(u===0)?"galleries_zero":((u===1)?"galleries_one":"galleries_two_or_more");t='<span class="stat-icon"></span>'+h.transjax.get("photo-sidebar",w,u);v.set("innerHTML",t);if(u>0){v.removeClass("zero")}else{v.addClass("zero")}c()}}c();var o=h.one("#comment-count");if(o){o.on("click",function(t){var s=h.one("#comments");if(s){s.vis.animScrollIntoView(true,20)}t.preventDefault()})}var m=h.one("#offensive");if(m){m.on("click",function(s){h.one("#offensive-form").submit()})}}function d(n,m){var l=h.one("#photo-story-map"),q;if(l){if(m){var j=document.createElement("canvas");e=(j.getContext)?j:document.createElement("div");e.id="photo-story-dot";l.one("a").append(e);q=h.one(e);if(typeof G_vmlCanvasManager!=="undefined"&&e&&e.tagName!=="DIV"){q.set("width",16);q.set("height",16);G_vmlCanvasManager.initElement(j);q=h.one(document.getElementById("photo-story-dot"))}}else{q=h.one("#photo-story-dot")}q.set("width",16);q.set("height",16);var i=h.one("#photo-story-image-dot");if(e&&e.tagName!=="DIV"){var o=h.Node.getDOMNode(q).getContext("2d");var p=[7,7,7,7,7,5.5,4.5,3,3,3,2,2,2,3,3,3,3,3];var k=[5,5,5,5,5,4,3.2,2,2,2,1,1,1,2,2,2,2,2];if(n===6){i.removeClass("hide");o.clearRect(0,0,16,16)}else{i.addClass("hide");o.fillStyle="rgba(0, 0, 0, .75)";o.beginPath();o.arc(9,9,p[n],0,2*Math.PI,false);o.fill();o.fillStyle="#fff";o.beginPath();o.arc(8,8,p[n],0,2*Math.PI,false);o.fill();o.fillStyle="#fe40a3";o.beginPath();o.arc(8,8,k[n],0,2*Math.PI,false);o.fill()}}else{if(n===6){i.removeClass("hide")}else{i.addClass("hide")}}}}function a(m){var l=h.one("#photo-story-map");if(l){var j=document.createElement("canvas");j.id="photo-story-copyright";var i=h.one(j);l.one("a").append(i);if(typeof G_vmlCanvasManager!=="undefined"){i.setAttribute("width",300);i.setAttribute("height",100);G_vmlCanvasManager.initElement(j);i=h.one(document.getElementById("photo-story-copyright"))}if(j.getContext){var k=h.Node.getDOMNode(i).getContext("2d");i.setAttribute("width",300);i.setAttribute("height",100);h.BitmapText.addStringToCanvas(m,k,{x:212,y:93,font:h.BitmapTypeSilkscreen,color:"#000"})}}}function c(){var j=h.one("#photo-story-stats"),k=parseInt(j.getStyle("lineHeight"),10),i=j.all(".stat-item");i.removeClass("minimal");if(parseInt(j.getStyle("height"),10)>k){i.addClass("minimal")}}h.photoSidebar={init:g};h.photoSidebar.story={refresh:function(){b();d(6,true);a("")}}},"0.0.1",{requires:F.config.modules["photo-sidebar"].requires||[],optional:F.config.modules["photo-sidebar"].optional||[]});if(typeof YWA==="undefined"){YWA={};YWA.initialize=function(){var a;YWA.ud="undefined";YWA.EXCLPRM="";YWA.ONLOAD=true;YWA.PID=YWA.ud;YWA.flashVer="";YWA.isOnloadOverwrite=false;YWA.windowOnload=null;YWA.errorId="";YWA.isNewYWATEnabled=false;YWA.windowOnerror=null;if(typeof window.ITTs==="undefined"){window.ITTs=[]}a=navigator.appName;YWA.net=(a==="Netscape");YWA.mic=(a.substring(0,9)==="Microsoft"&&(typeof navigator.plugins===YWA.ud||navigator.plugins.length===0));YWA.mac=(navigator.userAgent.indexOf("Mac")>=0);YWA.gec=(navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("Netscape")>=0);YWA.addOLH()};YWA.ywaOLH=function(a){if(YWA.windowOnload){YWA.windowOnload.call(window,a)}YWA.addOCHs()};YWA.addOLH=function(){if(!YWA.ONLOAD||YWA.isOnloadOverwrite){return}var b=[];if(window.screen||b.toSource||(b.shift&&YWA.mic)){if(window.onload){if(!YWA.windowOnload){YWA.windowOnload=window.onload}}window.onload=YWA.ywaOLH}YWA.isOnloadOverwrite=true};YWA.initialize()}YWA.ywaOCH=function(b){var a,d,c;d=true;for(a=0,c=window.ITTs.length;a<c;a+=1){window.ITTs[a].oco(this)}if(this.ywaOnClick){d=this.ywaOnClick(b)}return d};YWA.addOCHs=function(){var a,b;for(a=0,b=document.links.length;a<b;a+=1){if(!document.links[a].ywaOnclickOverride){document.links[a].ywaOnclickOverride=true;if(document.links[a].onclick){document.links[a].ywaOnClick=document.links[a].onclick}document.links[a].onclick=YWA.ywaOCH}}};YWA.ywaOEH=function(){if(YWA.errorId!==""){window.ITTs[YWA.errorId].track(false,true)}};YWA.getTrackerIdx=function(b){var a,c;for(a=0,c=window.ITTs.length;a<c;a+=1){if(window.ITTs[a].PID===b){return a}}return -1};YWA.getTracker=function(b){var c,a;YWA.isNewYWATEnabled=true;if(!YWA.is(b)){b=YWA.PID}a=YWA.getTrackerIdx(b);if(a>=0){c=window.ITTs[a]}else{c=new YWAT(b)}YWA.isNewYWATEnabled=false;return c};YWA.is=function(a){return(typeof a!==YWA.ud)};YWA.getExcludePrm=function(){return YWA.EXCLPRM};YWA.setExcludePrm=function(a){YWA.EXCLPRM=YWA.is(a)?a:""};YWA.getOnload=function(){return YWA.ONLOAD};YWA.setOnload=function(a){YWA.ONLOAD=YWA.is(a)?a:true};YWA.getPID=function(){if(YWA.is(document.scripts)){var b,e,d,c,a;d="ywa.js";c="ywa-";for(a=document.scripts.length,b=a-1;b>=0;b-=1){e=document.scripts[b].src;if(YWA.is(e)&&e.indexOf(d)===e.length-d.length){e=e.substr(0,e.length-d.length-1);e=e.substr(e.lastIndexOf("/")+1+c.length);return"1000"+e}}}return YWA.ud};YWA.getPID();YWA.getExcludeDomains=function(){return""};YWA.getExcludeProtocol=function(){return""};YWA.getDownloadExts=function(){return"\\.pdf$|\\.doc$|\\.dot$|\\.xls$|\\.xlt$|\\.xlw$|\\.ppt$|\\.pps$|\\.zip$|\\.rar$|\\.gz$|\\.gzip$|\\.wav$|\\.mp[3-4]?$|\\.mpeg$"};YWA.getErrorObj=function(b){var a;a=new Error(b);if(!a.msg){a.msg=b}return a};YWA.gcpn=function(a){var c,b,f,e,d;f=location.search;e=f.indexOf("?"+a+"=");d=f.indexOf("&"+a+"=");if((e===0)||(d>-1)){c=(e===0)?0:d;b=f.indexOf("&",c+1);return f.substring(c+2+a.length,(b>-1)?b:f.length)}return""};YWA.getFileName=function(a){var b;b=a.indexOf("?");if(b>0){a=a.substring(0,b)}return a.substring(a.lastIndexOf("/")+1,a.length)};YWA.gh=function(a){var b;b=a.host.indexOf(":");return(b>=0)?a.host.substring(0,b):a.host};YWA.ghs=function(a){var b;b=a.indexOf("//");if(b>=0){a=a.substring(b+2,a.length);b=a.indexOf("/");if(b>=0){return a.substring(0,b)}return a.substring(b+2,a.length)}return""};YWA.gpr=function(a){var c,b;c=a.protocol;b=c.indexOf(":");return(b>=0)?c:c+":"};YWA.gp=function(a){var c,b;c=a.pathname;b=c.indexOf("/");return(b===0)?c:"/"+c};YWA.mxDmnRGXP=function(a){if(a.toUpperCase().indexOf("REGEXP:")===0){return new RegExp(a.substring(7),"i")}else{return new RegExp(YWA.mxRgXpStr(a),"i")}};YWA.mxRgXpStr=function(l){while(l.indexOf(" ")>=0){l=l.replace(" ","")}var g,f,c,m,h,d,k;h="";d=l.split(",");for(g=0,k=d.length;g<k;g+=1){c=d[g].split(".");for(f=0,m=c.length;f<m;f+=1){if(c[f].indexOf("*")>=0){c[f]=".+"}}if(m>0){d[g]=c.join("\\.")}}if(k>0){h+=d.join("$|^")}if(h.length>0){return"^"+h+"$"}return""};function YWAT(a){if(!YWA.isNewYWATEnabled){throw YWA.getErrorObj("Invalid method to get a tracking object.")}var b,c;this.version="5.09";this.EXCLDOMAINS="";this.DWNLEXTS="";this.EXCLPRM=YWA.getExcludePrm();this.EXCLPRTCL="";this.ONLOAD=YWA.getOnload();this.DOMAINS="";this.DEBUG=false;this.RUN=false;if(!YWA.is(a)){this.PID=YWA.getPID();this.RUN=this.PID===YWA.ud}else{this.PID=a}this.BD=(window.location.protocol.indexOf("https:")===0?"https://":"http://")+"a.analytics.yahoo.com";this.BU=this.BD+"/p.pl?a="+this.PID+"&v="+this.version;this.FU="";this.URL=this.getClnUrl(document.URL?document.URL:document.location);this.REFERRER="";this.TOPLOCATION="";this.cfn=[];this.cfv=[];this.IT="";this.date=new Date();this.PIXELDELAY=false;this.DOCUMENTNAME=document.title;this.CAMPAIGN="";this.CMPPARM="";this.PROMO="";this.PROMOPARM="";this.TPSC=true;this.EXCL="";this.FPCR="";this.FPCN="fpc"+this.PID;this.FPCV="";this.FPCD="";this.ENC="";this.itvs="";this.itsid="";this.itvid="";this.place=document.body;try{c=document.getElementsByTagName("head");if(YWA.is(c)&&c.length>0){this.place=c[0]}}catch(d){}this.FLV=this.flash();if(!YWA.is(window.ITTs)){window.ITTs=[]}this.idx=window.ITTs.length;window.ITTs[this.idx]=this;this.ita=["DOCUMENTNAME","b","DOCUMENTGROUP","c","MEMBERID","m","URL","f","ACTION","x","AMOUNT","xa","ORDERID","oc","TAX","xt","SHIPPING","xs","DISCOUNT","xd","SKU","p","PRODUCTS","u","UNITS","q","AMOUNTS","r","CMPQUERY","cq","ISK","isk","ISR","isr"];this.prmord=["a","v","b","c","m","f","e","t","n","d","cp","cq","scp","ci","enc","x","sid","ca","oc","p","q","r","xa","xd","xs","xt","el","fn","flv","fpc","isk","isr","g","h","ittidx","ix","j","k","l","tp","nr","js","cf01","cf02","cf03","cf04","cf05","cf06","cf07","cf08","cf09","cf10","cf11","cf12","cf13","cf14","cf15","cf16","cf17","cf18","cf19","cf20","cf21","cf22","cf23","cf24","cf25","cf26","cf27","cf28","cf29","cf30","cf31","cf32","cf33","cf34","cf35","cf36","cf37","cf38","cf39","cf40","cf41","cf42","cf43","cf44","cf45","cf46","cf47","cf48","cf49","cf50","cf51","cf52","cf53","cf54","cf55","cf56","cf57","cf58","cf59","cf60","cf61","cf62","cf63","cf64","cf65","cf66","cf67","cf68","cf69","cf70","cf71","cf72","cf73","cf74","cf75","cf76","cf77","cf78","cf79","cf80","cf81","cf82","cf83","cf84","cf85","cf86","cf87","cf88","cf89","cf90","cf91","cf92","cf93","cf94","cf95","cf96","cf97","cf98","cf99","cf100"];for(b=0;b<10;b+=1){this.ita[this.ita.length]="P"+(1+b);this.ita[this.ita.length]="p"+(1+b)}for(b=0;b<99;b+=1){this.ita[this.ita.length]="CF"+((b<9)?"0":"")+(1+b);this.ita[this.ita.length]="cf"+(1+b)}this.imgsl=0;if(YWA.is(document.charset)){this.ENC=document.charset}else{if(YWA.is(document.characterSet)){this.ENC=document.characterSet}else{this.ENC=""}}this.FPCR="&ittidx="+this.idx+"&fpc="+encodeURIComponent(this.getCookie(this.FPCN));this.hasFPC=false}YWAT.prototype.getDocumentName=function(){return this.DOCUMENTNAME};YWAT.prototype.setDocumentName=function(a){this.DOCUMENTNAME=a};YWAT.prototype.getDocumentGroup=function(){return this.DOCUMENTGROUP};YWAT.prototype.setDocumentGroup=function(a){this.DOCUMENTGROUP=a};YWAT.prototype.getMemberId=function(){return this.MEMBERID};YWAT.prototype.setMemberId=function(a){this.MEMBERID=a};YWAT.prototype.getAction=function(){return this.ACTION};YWAT.prototype.setAction=function(b){this.ACTION=b};YWAT.prototype.getAmount=function(){return this.AMOUNT};YWAT.prototype.setAmount=function(b){this.AMOUNT=b};YWAT.prototype.getOrderId=function(){return this.ORDERID};YWAT.prototype.setOrderId=function(a){this.ORDERID=a};YWAT.prototype.getTax=function(){return this.TAX};YWAT.prototype.setTax=function(a){this.TAX=a};YWAT.prototype.getShipping=function(){return this.SHIPPING};YWAT.prototype.setShipping=function(a){this.SHIPPING=a};YWAT.prototype.getDiscount=function(){return this.DISCOUNT};YWAT.prototype.setDiscount=function(a){this.DISCOUNT=a};YWAT.prototype.getSKU=function(){return this.SKU};YWAT.prototype.setSKU=function(a){this.SKU=a};YWAT.prototype.getUnits=function(){return this.UNITS};YWAT.prototype.setUnits=function(a){this.UNITS=a};YWAT.prototype.getAmounts=function(){return this.AMOUNTS};YWAT.prototype.setAmounts=function(b){this.AMOUNTS=b};YWAT.prototype.getCmpQuery=function(){return this.CMPQUERY};YWAT.prototype.setCmpQuery=function(a){this.CMPQUERY=a};YWAT.prototype.getISK=function(){return this.ISK};YWAT.prototype.setISK=function(a){this.ISK=a};YWAT.prototype.getISR=function(){return this.ISR};YWAT.prototype.setISR=function(a){this.ISR=a};YWAT.prototype.getEF=function(a){a=parseInt(a,10);return this["P"+a]};YWAT.prototype.setEF=function(b,a){b=parseInt(b,10);this["P"+b]=a};YWAT.prototype.getCF=function(a){a=parseInt(a,10);return this["CF"+((a<10)?"0":"")+a]};YWAT.prototype.setCF=function(b,a){b=parseInt(b,10);this["CF"+((b<10)?"0":"")+b]=a};YWAT.prototype.getDebug=function(){return this.DEBUG};YWAT.prototype.setDebug=function(a){this.DEBUG=YWA.is(a)?a:false};YWAT.prototype.getRun=function(){return this.RUN};YWAT.prototype.setRun=function(a){if(!YWA.is(a)||a){this.RUN=this.PID!==YWA.ud}else{this.RUN=false}};YWAT.prototype.getUrl=function(){return this.URL};YWAT.prototype.setUrl=function(a){this.URL=this.getClnUrl(a)};YWAT.prototype.getEncoding=function(){return this.ENC};YWAT.prototype.setEncoding=function(a){if(YWA.is(a)){this.ENC=a}else{this.ENC=""}};YWAT.prototype.getCookieDomain=function(){return this.FPCD};YWAT.prototype.setCookieDomain=function(a){if(YWA.is(a)&&a!==""){this.FPCD=a}else{this.FPCD=""}};YWAT.prototype.getTPSC=function(){return this.TPSC};YWAT.prototype.setTPSC=function(a){this.TPSC=YWA.is(a)?a:true};YWAT.prototype.getReferrer=function(){return this.REFERRER};YWAT.prototype.setReferrer=function(a){if(YWA.is(a)&&a.length>0){this.REFERRER=a}};YWAT.prototype.getPixelDelay=function(){return this.PIXELDELAY};YWAT.prototype.setPixelDelay=function(a){this.PIXELDELAY=YWA.is(a)?a:false};YWAT.prototype.getDomains=function(){return this.DOMAINS};YWAT.prototype.setDomains=function(a){this.DOMAINS=(YWA.is(a)&&a!=="")?a:YWA.ud};YWAT.prototype.getFlashUrl=function(){return this.FU};YWAT.prototype.setFlashUrl=function(a){this.FU=YWA.is(a)?a:""};YWAT.prototype.getExcludeDomains=function(){var a;a=YWA.getExcludeDomains();a+=(a.length>0&&this.EXCLDOMAINS.length>0?",":"")+this.EXCLDOMAINS;return a};YWAT.prototype.addExcludeDomain=function(a){this.EXCLDOMAINS+=(this.EXCLDOMAINS.length>0?",":"")+a};YWAT.prototype.removeExcluseDomain=function(c){var b,a,f,e;a=this.EXCLDOMAINS.split(",");f=[];for(b=0,e=a.length;b<e;b+=1){if(a[b]!==c){f[f.length]=a[b]}}this.EXCLDOMAINS=f.join(",")};YWAT.prototype.getDownloadExts=function(){var a;a=YWA.getDownloadExts();a+=(a.length>0&&this.DWNLEXTS.length>0?"|":"")+this.DWNLEXTS;return a};YWAT.prototype.addDownloadExt=function(f){var b,h,g,d,a;g=f.toLowerCase();d="";for(b=0,a=g.length;b<a;b+=1){h=g.charAt(b);if((h>="a"&&h<="z")||(h>="0"&&h<="9")||h==="-"||h==="_"){d+=h}}this.DWNLEXTS+=(this.DWNLEXTS.length>0?"|":"")+"\\."+d+"$"};YWAT.prototype.removeDownloadExt=function(f){var a,d,b,c;d=this.DWNLEXTS.split("|");b=[];for(a=0,c=d.length;a<c;a+=1){if(d[a]!=="\\."+f.toLowerCase()+"$"){b[b.length]=d[a]}}this.DWNLEXTS=b.join("|")};YWAT.prototype.getExcludeProtocol=function(){var a;a=YWA.getExcludeProtocol();a+=(a.length>0&&this.EXCLPRTCL.length>0?",":"")+this.EXCLPRTCL;return a};YWAT.prototype.addExcludeProtocol=function(a){this.EXCLPRTCL+=(this.EXCLPRTCL.length>0?",":"")+a.toLowerCase()};YWAT.prototype.removeExcludeProtocol=function(f){var a,d,b,c;d=this.EXCLPRTCL.split(",");b=[];for(a=0,c=d.length;a<c;a+=1){if(d[a]!==f.toLowerCase()){b[b.length]=d[a]}}this.EXCLPRTCL=b.join(",")};YWAT.prototype.isProtocolExcluded=function(){var a;a=","+this.getExcludeProtocol()+",";return a.indexOf(","+window.location.protocol+",")>=0};YWAT.prototype.pp=function(){var b,c,a;a=[];for(b=0,c=this.ita.length;b+1<c;b+=2){if((YWA.is(this[this.ita[b]]))&&(this[this.ita[b]]!=="")){a[b]="&"+this.ita[b+1]+"="+encodeURIComponent(this[this.ita[b]])}}this.IT+=a.join("")};YWAT.prototype.reset=function(){var a,b;for(a=8,b=this.ita.length;a+1<b;a+=2){if((YWA.is(this[this.ita[a]]))&&(this[this.ita[a]]!=="")){this[this.ita[a]]=""}}};YWAT.prototype.flash=function(){if(YWA.flashVer===""){var c,b,a,d;a="";d=navigator.plugins;if(d!==null&&d.length>0){if(d["Shockwave Flash 2.0"]||d["Shockwave Flash"]){c=d["Shockwave Flash 2.0"]?" 2.0":"";a=d["Shockwave Flash"+c].description}}else{b=document.createElement("script");b.language="VBScript";b.text='\nFunction sVBSwfVer(i)\non error resume next\nDim swC,swV\nswV=0\nset swC=CreateObject("ShockwaveFlash.ShockwaveFlash."+CStr(i))\nif(IsObject(swC))then\nswV=swC.GetVariable("$version")\nend if\nsVBSwfVer=swV\nEnd Function\n';this.place.appendChild(b);a=sVBSwfVer(1)}YWA.flashVer=a}return YWA.flashVer};YWAT.prototype.setCookie=function(a,e,g){var c,b,f;f=new Date();f.setTime(f.getTime()+(g*1000));c=(g>0)?"; expires="+f.toGMTString():"";if(g<0){c="; expires=Thu, 01-Jan-1970 00:00:01 GMT"}b=a+"="+e+c+"; path=/"+((this.FPCD!=="")?("; domain="+this.FPCD):(""));document.cookie=b};YWAT.prototype.deleteCookie=function(a){return this.setCookie(a,"1",-1)};YWAT.prototype.getCookie=function(c){var e,b,a,d;a=document.cookie;d=a.indexOf(c+"=");if(d!==-1){e=d+c.length+1;b=a.indexOf(";",e);if(b===-1){b=a.length}return a.substring(e,b)}return""};YWAT.prototype.FPCSupport=function(){if(this.getCookie(this.FPCN)!==""){return true}var c,a,e,b;a="itfpctmp";e=new Date();b="fpc-"+e.getTime();this.setCookie(a,b,180);c=this.getCookie(a);if(c===b){this.deleteCookie(a);return true}return false};YWAT.prototype.trunc=function(k,j){var a,h,i,b,e,d,c,g,f;if(k.length<=j){return k}a=k.split("?");if(a.length>1){b=a[0]+"?";h=a[1];i=h.split("&");i.sort();c=false;f=i.length;for(e=0,g=this.prmord.length;e<g;e+=1){for(d=0;d<f;d+=1){if(i[d].indexOf(this.prmord[e]+"=")===0){if(b.length+"&".length+i[d].length>j){return b+"&trnc=1"}b+=(c?"&":"")+i[d];c=true;break}}}return b}else{return k}};YWAT.prototype.chkl0=function(s,p,o,c,a){var j,n,g,f,h,q,m,t,b,l,e;for(j=0,e=p.length,l=s.length;j<e&&l>o;j+=1){n=s.length-o;g=s.indexOf("&"+p[j]+"=");if(g>0){g+=p[j].length+2;f=s.indexOf("&",g);if(f>0){q=g;m=s.toLowerCase().indexOf("%3f",g);t=s.toLowerCase().indexOf("%3d",g);if(f-g>n+a.length+c){g+=f-g-n-a.length;for(h=1;h<10;h+=1){if(s.charAt(g-h)==="%"){g-=h;break}}}else{if(f-g>c){g+=c;for(h=1;h<10;h+=1){if(s.charAt(g-h)==="%"){g-=h;break}}}else{continue}}b=s.substring(0,g);if(m>0&&m<f){if(t<0||t>f){b+="%3D"}b+="%26"}b+=a;b+=s.substring(f);s=b}}}if(s.length>o){return this.chkl(s,p,o,c/2,a)}return s};YWAT.prototype.chkl=function(a,e,d,c,b){a=this.chkl0(a,e,d,c,b);if(a.length>d){a=this.chkl0(a,e,d,c/2,b)}return a};YWAT.prototype.trk=function(c){var a,b;a=this.trunc(this.BU+(!this.TPSC?"&tp=0":"")+"&enc="+encodeURIComponent(this.ENC)+this.IT+c+"&ix="+this.imgsl+this.FPCR,2000);if(!this.isProtocolExcluded()){this.imgsl+=1;if(this.DEBUG){window.alert(a)}else{b=new Image();if(YWA.net||this.PIXELDELAY){window.setTimeout(function(){b.src=a},1)}else{b.src=a}window.setTimeout(function(){b=null},10000)}}else{if(this.DEBUG){window.alert("'"+a+"' isn't tracked because of excluded protocol.")}}this.reset();this.IT="";return a};YWAT.prototype.gcpn=function(a){return YWA.gcpn(a)};YWAT.prototype.getFileName=function(a){return YWA.getFileName(a)};YWAT.prototype.gh=function(a){return YWA.gh(a)};YWAT.prototype.ghs=function(a){return YWA.ghs(a)};YWAT.prototype.gpr=function(a){return YWA.gpr(a)};YWAT.prototype.gp=function(a){return YWA.gp(a)};YWAT.prototype.mxDmnRGXP=function(a){return YWA.mxDmnRGXP(a)};YWAT.prototype.mxRgXpStr=function(a){return YWA.mxRgXpStr(a)};YWAT.prototype.customfield_reset=function(){this.cfn.length=0;this.cfv.length=0};YWAT.prototype.customfield_set=function(b,a){this.cfn[this.cfn.length]=b;this.cfv[this.cfv.length]=a};YWAT.prototype.cf_ts=function(){var c,b,a,d;b="&cf=1";for(c=0,a=this.cfn.length,d=this.cfv.length;c<a&&c<d;c+=1){b+="&cn"+c+"="+encodeURIComponent(this.cfn[c])+"&cv"+c+"="+encodeURIComponent(this.cfv[c])}return b};YWAT.prototype.submit_customfield=function(){if(this.cfn.length>0&&this.cfv.length>0){var a;a=this.cf_ts();this.customfield_reset();this.pp();this.trk(a)}};YWAT.prototype.submit_action=function(){this.pp();this.trk("&ca=1")};YWAT.prototype.submit_icmp=function(){this.pp();this.trk("&ci=1")};YWAT.prototype.exitlink=function(a){this.pp();this.trk("&el="+encodeURIComponent(a))};YWAT.prototype.el=function(a){var b;if(YWA.gh(location)===YWA.gh(a)){return true}if(!this.isProtocolExcluded()){b=(YWA.is(this.DOMAINS)&&this.DOMAINS!=="")?YWA.mxDmnRGXP(this.DOMAINS):YWA.mxDmnRGXP(YWA.gh(location))}else{b=YWA.mxDmnRGXP("protocolexclusion")}if(b.test(YWA.gh(a))){return true}if(a.href.indexOf("java")!==0){this.exitlink(a.href)}return true};YWAT.prototype.download=function(a){this.pp();this.trk("&fn="+encodeURIComponent(a))};YWAT.prototype.oco=function(a){var c,b,d;d=this.getExcludeDomains();if(d!==""){c=YWA.mxDmnRGXP(d);if(c.test(YWA.gh(a))){if(this.DEBUG){window.alert("'"+YWA.gh(a)+"' isn't tracked as exitlink.")}return true}}if(YWA.is(a.pathname)){b=YWA.getFileName(a.pathname);if(b!==""){c=new RegExp(this.getDownloadExts(),"i");if(c.test(b)&&(b.indexOf(".")!==-1)){if(((this.EXCL!=="")&&(!YWA.mxDmnRGXP(this.EXCL).test(a.pathname)))||(this.EXCL.length===0)){this.download(a.href)}}else{this.el(a)}}else{this.el(a)}}};YWAT.prototype.track=function(j,b){var f,m,h,l,a,c;l="";a=document.referrer;YWA.errorId=this.idx;c=[];if(YWA.is(this.REFERRER)&&this.REFERRER.length>0){a=this.REFERRER}else{if((navigator.userAgent.indexOf("Mac")>=0)&&(navigator.userAgent.indexOf("MSIE 4")>=0)){a=document.referrer}else{if(j){YWA.windowOnerror=window.onerror;window.onerror=YWA.ywaOEH;h=true;try{l=top.location.href;l=""}catch(k){h=false}if(h&&document.location!==top.location){a=top.document.referrer;l=top.location.href}}else{c[0]="&nr=t"}}}if(YWA.windowOnerror){window.onerror=YWA.windowOnerror}else{window.onerror=null}this.pp();if(a.length>0){m=YWA.is(this.DOMAINS)?YWA.mxDmnRGXP(this.DOMAINS):YWA.mxDmnRGXP(YWA.gh(location));c[1]="&e="+encodeURIComponent(m.test(YWA.ghs(a))?this.getClnUrl(a):a)}if(l.length>0){c[2]="&t="+encodeURIComponent(l)}f=this.FPCSupport();this.date=new Date();c[3]="&flv="+encodeURIComponent(this.FLV);c[4]="&d="+encodeURIComponent(this.date.toGMTString());c[5]="&n="+encodeURIComponent(parseInt(this.date.getTimezoneOffset()/60,10));c[6]="&g="+encodeURIComponent(YWA.net?navigator.language:navigator.userLanguage);c[7]="&h="+encodeURIComponent((navigator.javaEnabled()?"Y":"N"));try{c[8]="&j="+encodeURIComponent(screen.width+"x"+screen.height);c[9]="&k="+encodeURIComponent(YWA.mic?screen.colorDepth:screen.pixelDepth)}catch(g){}c[10]="&l="+((f)?"true":"false");if(this.CAMPAIGN!==""){c[11]="&cp="+encodeURIComponent(this.CAMPAIGN)}if(this.CMPPARM!==""){c[12]="&cp="+encodeURIComponent(YWA.gcpn(this.CMPPARM))}if(this.PROMO!==""){c[13]="&scp="+encodeURIComponent(this.PROMO)}if(this.PROMOPARM!==""){c[14]="&scp="+encodeURIComponent(YWA.gcpn(this.PROMOPARM))}this.IT+=c.join("");if(this.RUN){return}if(f&&b){this.fpc()}else{this.trk("")}YWA.errorId=""};YWAT.prototype.submitPT=function(){return this.submit(false)};YWAT.prototype.submit=function(a){var b;b=(typeof a).toLowerCase();if(b==="undefined"||b!=="boolean"){a=true}a=(this.hasFPC?false:a);return this.track(true,a)};YWAT.prototype.fpc=function(){this.getFPCvars()};YWAT.prototype.ywaW3C=function(d){var a,c,b;b=[];b[0]=this.BD;b[1]="/fpc.pl?a=";b[2]=this.PID;b[3]="&v=";b[4]=this.version;if(!this.TPSC){b[5]="&tp=0"}b[6]="&enc=";b[7]=encodeURIComponent(this.ENC);b[8]=this.IT;b[9]=this.FPCR;c=this.trunc(b.join(""),2000);if(!this.isProtocolExcluded()){if(d===0){if(!this.DEBUG){a=document.createElement("SCRIPT");a.defer=true;a.type="text/javascript";a.src=c;this.place.appendChild(a);this.hasFPC=true}else{window.alert(c)}}else{this.trk("")}}else{if(this.DEBUG){window.alert("'"+c+"' isn't tracked because of excluded protocol.")}}this.reset();this.IT=""};YWAT.prototype.getFPCvars=function(){var a=this.FPCSupport();if(a&&!this.hasFPC){this.ywaW3C(0)}else{this.ywaW3C(1)}};YWAT.prototype.setFPCookies=function(){if(this.FPCV!==""){this.setCookie(this.FPCN,this.FPCV,31536000)}};YWAT.prototype.page=function(e,c,f,d,b){var a;a=this.URL;this.URL=this.FU!==""?this.FU:"FLASH";this.DOCUMENTNAME=e;this.DOCUMENTGROUP=c;this.MEMBERID=f;this.ACTION=d;this.AMOUNT=b;this.submit();this.URL=a};YWAT.prototype.getClnUrl=function(n){var c,b,o,d,m,l,a,j,e,q,g,h,f;g="_S_PEPOS,_S_PEPRM";if(!YWA.is(this.EXCLPRM)){return n}c=n.split("?");if(c.length===1){return n}b=c[1].split("&");o=((this.EXCLPRM.indexOf(";")>=0)?this.EXCLPRM.split(";"):this.EXCLPRM.split(","));d=[];l=0;for(j=0,m=o.length;j<m;j+=1){if(j<m-1||j===m-1&&o[j]!==""){d[l]=o[j];l+=1}}m=l;a="";for(j=0,h=b.length;j<h;j+=1){e=b[j].split("=")[0];f=true;q=new RegExp("\\b"+e+"\\b","gi");for(l=0;l<m;l+=1){f=f&&(e.length>0&&!q.test(d[l])||e.length===0&&d[l]!=="")}if(f){a+=((a.length>0)?"&":"")+b[j]}}return c[0]+((a.length>0)?"?"+a:"")};YUI.add("photo-ywa-tracking",function(b){var a;var c={"Context Widget (any photo)":13,"Context Widget scroll arrows":14,"Owner Setting (show more)":15,"Current context next":16,"Current context prev":17,"Other context next":18,"Other context prev":19,"All Sizes":20,"Blog This":21,Browse:22,"Comment, Post":23,"Favorites star":24,"Next, previous":25,"Person, Add":26,"Person, In photo":27,"Sign in (top)":28,"Sign in (bottom)":29,"Sign up (top)":30,"Sign up (bottom)":31,"Sign in (comment form)":32,"Sign up (comment form)":33,Share:34,"Account name":35,"Camera, Taken with":36,"Commenter names":37,"Edit photos":38,"Galleries, Add to":39,"Groups, Send to":40,"Location, Taken in, Places":42,"Order prints":43,"Context Title":44,Slideshow:45,"Tag(s), Add to":46,"Tag(s)":47,"Tag(s), Global":41,"Camera, More properties":48,"Date, Taken on":49,"Tour Dismiss":50,Explore:51,"Favorites count":52,"Location, Taken in, Map":53,"Search box":54,"Stats, Photo":55,Tour:56,Actions:57,"Lightbox Icon":58,"Lightbox Close":59,"Location, Add to Map":60};b.photoYwaTracking={init:function(e,d,f){a=YWA.getTracker(e);a.setDocumentName(d);a.setUrl("http://www.flickr.com/photo");a.setCF(1,f);a.submit();b.delegate("click",function(i){var h=i.currentTarget;var g=h.getAttribute("data-ywa-name");b.photoYwaTracking.log_action(g)},"body",".ywa-track")},log_action:function(d){if(a&&d&&c[d]){a.setAction(c[d]);a.setUrl("http://www.flickr.com/photo");a.submit_action()}}}},"0.0.1",{requires:["event","yahoo-web-analytics"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("event-touch",function(d){var c="scale",a="rotation",b="identifier";d.DOMEventFacade.prototype._touch=function(n,m,o){var g,f,h,k,j;if(n.touches){this.touches=[];j={};for(g=0,f=n.touches.length;g<f;++g){k=n.touches[g];j[d.stamp(k)]=this.touches[g]=new d.DOMEventFacade(k,m,o);}}if(n.targetTouches){this.targetTouches=[];for(g=0,f=n.targetTouches.length;g<f;++g){k=n.targetTouches[g];h=j&&j[d.stamp(k,true)];this.targetTouches[g]=h||new d.DOMEventFacade(k,m,o);}}if(n.changedTouches){this.changedTouches=[];for(g=0,f=n.changedTouches.length;g<f;++g){k=n.changedTouches[g];h=j&&j[d.stamp(k,true)];this.changedTouches[g]=h||new d.DOMEventFacade(k,m,o);}}if(c in n){this[c]=n[c];}if(a in n){this[a]=n[a];}if(b in n){this[b]=n[b];}};if(d.Node.DOM_EVENTS){d.mix(d.Node.DOM_EVENTS,{touchstart:1,touchmove:1,touchend:1,touchcancel:1,gesturestart:1,gesturechange:1,gestureend:1});}},"3.4.0",{requires:["node-base"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("event-flick",function(c){var i=("ontouchstart" in c.config.win&&!c.UA.chrome)?{start:"touchstart",end:"touchend",move:"touchmove"}:{start:"mousedown",end:"mouseup",move:"mousemove"},j="start",m="end",d="move",b="ownerDocument",k="minVelocity",f="minDistance",a="preventDefault",e="_fs",g="_fsh",n="_feh",h="_fmh",l="nodeType";c.Event.define("flick",{on:function(p,o,r){var q=p.on(i[j],this._onStart,this,p,o,r);o[g]=q;},detach:function(q,p,s){var r=p[g],o=p[n];if(r){r.detach();p[g]=null;}if(o){o.detach();p[n]=null;}},processArgs:function(o){var p=(o.length>3)?c.merge(o.splice(3,1)[0]):{};if(!(k in p)){p[k]=this.MIN_VELOCITY;}if(!(f in p)){p[f]=this.MIN_DISTANCE;}if(!(a in p)){p[a]=this.PREVENT_DEFAULT;}return p;},_onStart:function(u,r,x,p){var o=true,w,q,v,t=x._extra.preventDefault,s=u;if(u.touches){o=(u.touches.length===1);u=u.touches[0];}if(o){if(t){if(!t.call||t(u)){s.preventDefault();}}u.flick={time:new Date().getTime()};x[e]=u;w=x[n];v=(r.get(l)===9)?r:r.get(b);if(!w){w=v.on(i[m],c.bind(this._onEnd,this),null,r,x,p);x[n]=w;}x[h]=v.once(i[d],c.bind(this._onMove,this),null,r,x,p);}},_onMove:function(r,p,o,q){var s=o[e];if(s&&s.flick){s.flick.time=new Date().getTime();}},_onEnd:function(C,w,D,s){var A=new Date().getTime(),q=D[e],o=!!q,E=C,r,v,B,y,z,p,x,u,t=D[h];if(t){t.detach();delete D[h];}if(o){if(C.changedTouches){if(C.changedTouches.length===1&&C.touches.length===0){E=C.changedTouches[0];}else{o=false;}}if(o){y=D._extra;B=y[a];if(B){if(!B.call||B(C)){E.preventDefault();}}r=q.flick.time;A=new Date().getTime();v=A-r;z=[E.pageX-q.pageX,E.pageY-q.pageY];if(y.axis){u=y.axis;}else{u=(Math.abs(z[0])>=Math.abs(z[1]))?"x":"y";}p=z[(u==="x")?0:1];x=(v!==0)?p/v:0;if(isFinite(x)&&(Math.abs(p)>=y[f])&&(Math.abs(x)>=y[k])){C.type="flick";C.flick={time:v,distance:p,velocity:x,axis:u,start:q};s.fire(C);}D[e]=null;}}},MIN_VELOCITY:0,MIN_DISTANCE:0,PREVENT_DEFAULT:false});},"3.4.0",{requires:["node-base","event-touch","event-synthetic"]});/*
YUI 3.4.0 (build 3928)
Copyright 2011 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/
YUI.add("event-move",function(e){var j=("ontouchstart" in e.config.win&&!e.UA.chrome)?{start:"touchstart",move:"touchmove",end:"touchend"}:{start:"mousedown",move:"mousemove",end:"mouseup"},x="start",C="move",h="end",l="gesture"+C,a=l+h,i=l+x,B="_msh",m="_mh",w="_meh",r="_dmsh",o="_dmh",c="_dmeh",g="_ms",s="_m",z="minTime",t="minDistance",u="preventDefault",b="button",v="ownerDocument",n="currentTarget",p="target",q="nodeType",k=function(H,F,G){var D=(G)?4:3,E=(F.length>D)?e.merge(F.splice(D,1)[0]):{};if(!(u in E)){E[u]=H.PREVENT_DEFAULT;}return E;},f=function(E,D){return D._extra.root||(E.get(q)===9)?E:E.get(v);},y=function(D,F,E){D.pageX=F.pageX;D.pageY=F.pageY;D.screenX=F.screenX;D.screenY=F.screenY;D.clientX=F.clientX;D.clientY=F.clientY;D[p]=D[p]||F[p];D[n]=D[n]||F[n];D[b]=(E&&E[b])||1;},A=function(E,D){if(D){if(!D.call||D(E)){E.preventDefault();}}},d=e.Event.define;d(i,{on:function(E,D,F){D[B]=E.on(j[x],this._onStart,this,E,D,F);},delegate:function(F,E,H,D){var G=this;E[r]=F.delegate(j[x],function(I){G._onStart(I,F,E,H,true);},D);},detachDelegate:function(F,E,H,D){var G=E[r];if(G){G.detach();E[r]=null;}},detach:function(E,D,G){var F=D[B];if(F){F.detach();D[B]=null;}},processArgs:function(D,E){var F=k(this,D,E);if(!(z in F)){F[z]=this.MIN_TIME;}if(!(t in F)){F[t]=this.MIN_DISTANCE;}return F;},_onStart:function(J,E,P,D,L){if(L){E=J[n];}var F=P._extra,O=true,G=F[z],N=F[t],H=F.button,I=F[u],M=f(E,P),K;if(J.touches){if(J.touches.length===1){y(J,J.touches[0],F);}else{O=false;}}else{O=(H===undefined)||(H===J.button);}if(O){A(J,I);if(G===0||N===0){this._start(J,E,D,F);}else{K=[J.pageX,J.pageY];if(G>0){F._ht=e.later(G,this,this._start,[J,E,D,F]);F._hme=M.on(j[h],e.bind(function(){this._cancel(F);},this));}if(N>0){F._hm=M.on(j[C],e.bind(function(Q){if(Math.abs(Q.pageX-K[0])>N||Math.abs(Q.pageY-K[1])>N){this._start(J,E,D,F);}},this));}}}},_cancel:function(D){if(D._ht){D._ht.cancel();D._ht=null;}if(D._hme){D._hme.detach();D._hme=null;}if(D._hm){D._hm.detach();D._hm=null;}},_start:function(F,D,E,G){if(G){this._cancel(G);}F.type=i;D.setData(g,F);E.fire(F);},MIN_TIME:0,MIN_DISTANCE:0,PREVENT_DEFAULT:false});d(l,{on:function(F,E,H){var D=f(F,E),G=D.on(j[C],this._onMove,this,F,E,H);E[m]=G;},delegate:function(F,E,H,D){var G=this;E[o]=F.delegate(j[C],function(I){G._onMove(I,F,E,H,true);},D);},detach:function(E,D,G){var F=D[m];if(F){F.detach();D[m]=null;}},detachDelegate:function(F,E,H,D){var G=E[o];if(G){G.detach();E[o]=null;}},processArgs:function(D,E){return k(this,D,E);},_onMove:function(J,H,G,I,F){if(F){H=J[n];}var D=G._extra.standAlone||H.getData(g),E=G._extra.preventDefault;if(D){if(J.touches){if(J.touches.length===1){y(J,J.touches[0]);}else{D=false;}}if(D){A(J,E);J.type=l;I.fire(J);}}},PREVENT_DEFAULT:false});d(a,{on:function(G,F,H){var E=f(G,F),D=E.on(j[h],this._onEnd,this,G,F,H);F[w]=D;},delegate:function(F,E,H,D){var G=this;E[c]=F.delegate(j[h],function(I){G._onEnd(I,F,E,H,true);},D);},detachDelegate:function(F,E,H,D){var G=E[c];if(G){G.detach();E[c]=null;}},detach:function(F,E,G){var D=E[w];if(D){D.detach();E[w]=null;}},processArgs:function(D,E){return k(this,D,E);},_onEnd:function(J,H,F,I,E){if(E){H=J[n];}var G=F._extra.standAlone||H.getData(s)||H.getData(g),D=F._extra.preventDefault;if(G){if(J.changedTouches){if(J.changedTouches.length===1){y(J,J.changedTouches[0]);}else{G=false;}}if(G){A(J,D);J.type=a;I.fire(J);H.clearData(g);H.clearData(s);}}},PREVENT_DEFAULT:false});},"3.4.0",{requires:["node-base","event-touch","event-synthetic"]});YUI.add("lightbox-transjax",function(a){a.transjax.add("lightbox",{by:'By %s',close:'Close',prev:'Prev',next:'Next',newer:'Newer',older:'Older',view_photo_page:'View photo page',view_video_page:'View video page',favorite_with_count_one:'1 favorite',favorite_with_count_more_than_one:'%s favorites',favorite:'Favorite',comment_with_count_one:'1 comment',comment_with_count_more_than_one:'%s comments',comment:'Comment',allsizes:'View all sizes',must_be_signed_in:'You must be signed in to see this content.',sign_in:'SIGN IN',outside_safesearch:'This photo falls outside your current SafeSearch filter.',you_can_click_through:'You can click through to see it if you want.',show_the_photo:'YES PLEASE, SHOW ME THE PHOTO',view_photo_in_lightbox:'View this photo in a light box',close_the_lightbox:'Close the Light Box',prev_photo:'Previous photo',next_photo:'Next photo',start_or_stop_slideshow_mode:'Start or stop slideshow mode',fave_the_current_photo:'Fave the current photo',fullscreen:'Fullscreen'})},"0.0.1",{requires:F.config.modules["lightbox-transjax"].requires||[],optional:F.config.modules["lightbox-transjax"].optional||[]});if(typeof YAHOO=="undefined"){YAHOO={}}if(!YAHOO.ULT){YAHOO.ULT={}}if(!YAHOO.ULT.BEACON){YAHOO.ULT.BEACON="http://geo.yahoo.com/t"}if(!YAHOO.ULT.IMG){YAHOO.ULT.IMG=new Image()}YAHOO.ULT.SRC_SPACEID_KEY="_S";YAHOO.ULT.DEST_SPACEID_KEY="_s";YAHOO.ULT.YLC_LIBSRC=2;YAHOO.ULT.CTRL_C="\x03";YAHOO.ULT.CTRL_D="\x04";YAHOO.ULT.BASE64_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._-";(function(){YAHOO.ULT.track_click=function(c,g){if(!c||!g){return c}g._r=YAHOO.ULT.YLC_LIBSRC;var h=[];var d=0;for(var b in g){var a=g[b];if(typeof(a)=="undefined"){a=g[b]=""}if(b.length<1){return c}if(b.length>8){return c}if(b.indexOf(" ")!=-1){return c}if(YAHOO.ULT.has_ctrl_char(b)||YAHOO.ULT.has_ctrl_char(a)){return c}h[d++]=b}h=h.sort();var e=[];for(d=0;d<h.length;d++){e[d]=h[d]+YAHOO.ULT.CTRL_C+g[h[d]]}e=e.join(YAHOO.ULT.CTRL_D);if(e.length<1||e.length>1024){return c}e=";_ylc="+YAHOO.ULT.encode64(e);d=c.indexOf("/*");if(d==-1){d=c.indexOf("/?")}if(d==-1){d=c.indexOf("?")}if(d==-1){return c+e}else{return c.substr(0,d)+e+c.substr(d)}};YAHOO.ULT.beacon_click=function(c,b){if(!b){b=YAHOO.ULT.IMG}if(c){var a=YAHOO.ULT.track_click(YAHOO.ULT.BEACON,c);a+="?t="+Math.random();b.src=a}return true};YAHOO.ULT.has_ctrl_char=function(b){for(var a=0;a<b.length;a++){if(b.charCodeAt(a)<32){return true}}return false};YAHOO.ULT.encode64=function(c){var a="";var k,h,f="";var j,g,e,d="";var b=0;do{k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+YAHOO.ULT.BASE64_STR.charAt(j)+YAHOO.ULT.BASE64_STR.charAt(g)+YAHOO.ULT.BASE64_STR.charAt(e)+YAHOO.ULT.BASE64_STR.charAt(d);k=h=f="";j=g=e=d=""}while(b<c.length);return a}})();YUI.add("photo",function(a){var d;function i(){return d}function k(l,n){if(!a.Lang.isObject(l)){l={}}if(!a.Lang.isObject(n)){n={}}l=a.merge(l,n);a.config.flickr.photo=l;d=a.PhotoData.add(l);e();if(a.config.flickr.flags.enable_onepage_photogne){g()}c();a.photoButtonBar.init();a.photoSidebar.init();if(!d.get("is_video")){a.photoNotes.init()}if(a.config.flickr.user.nsid||a.config.flickr.flags.enable_grease){a.photoComments()}a.photoKeyboardShortcuts.init();a.photoFilmstrip.init();h();f();if(a.config.flickr.flags.enable_geo_exif_backfill){b()}j();if(a.adMasker){a.adMasker.init()}if(!d.get("is_video")&&!d.get("dmca_takedown")&&a.one("#notes")){a.one("#notes").on("click",function(o){if(a.one("#notes").one(".note-editing, .note-new, .note-saving")||o.target.test(".note-editable, .note-content, .note-editable *, .note-content *")){a.eventAnnotations.add(o,{preventLightbox:true})}});if(!a.config.flickr.is_touch_device){a.one("#notes").on("mouseover",function(o){if(a.one("#notes").one(".note-editing, .note-new, .note-saving")||o.target.test(".note-editable, .note-content, .note-editable *, .note-content *")){a.one("#photo-drag-proxy").removeClass("zoom-trigger")}else{a.one("#photo-drag-proxy").addClass("zoom-trigger")}});a.one("#notes").on("mouseout",function(p){var o=a.one("#photo-drag-proxy");if(o){o.addClass("zoom-trigger")}})}}a.on("ContextData:open",function(p){if(a.historyManager.enabled){var o=a.historyManager.getState();if(o.context_id!==p){o.context_id=p;a.historyManager.replaceState(o)}}});a.on("historyManager:change",function(p){var o=a.ContextData.getContext();if(p.context_id&&(!o||p.context_id!==o.id)){a.ContextData.open(p.context_id)}});var m=a.all("a.get-pro-link");if(m){m.on("click",function(o){YAHOO.ULT.beacon_click({tm_lnk:"U1101527",tm_ppty:"photos",tm_dmech:"text",tm_net:"yahoo"})})}a.after("PhotoData:date_postedChange",function(p){var o=p.target;if(o.get("id")===d.get("id")){if(a.ContextData&&a.ContextData.getContext("photostream")){a.ContextData.invalidate("photostream")}}});a.after("PhotoData:titleChange",function(s){var o=s.target,r,q,p;if(o.get("id")===d.get("id")){if(a.lightbox&&a.lightbox.getOpenPhoto()&&a.lightbox.getOpenPhoto()!==o){}else{r=a.one("body").get("ownerDocument");q=s.newVal||a.transjax.get("photo","untitled");p=a.transjax.get("photo","window_title",q);if(a.Lang.isString(p)){r.set("title",p)}}}})}function c(){var l=a.one(".photo-div img"),o,n,m=F&&F.imageChecker;if(d&&!d.get("is_video")&&l&&m){o=l._node;n=l.getAttribute("src");if(o&&n){if(m.check(o)===false){a.retryImageOnError(l,n,true)}else{if(!o.complete||o.naturalWidth===0){setTimeout(function(){if(m.check(o)===false){a.retryImageOnError(l,n,true)}},2000)}}}}}function j(){var l=a.one("#referral-welcome-upsell");function m(){l.removeClass("end");a.later(2,this,function(){l.addClass("end");a.later(90000,this,m)})}if(l){m()}}function b(){var l=function(){return a.one(".geo-exif-backfill-progress-indicator")};a.on("geoExifBackfill:start",function(){var m=l();if(m){m.addClass("geo-exif-backfill-running")}});a.on("geoExifBackfill:failure",function(){var m=l();if(m){m.removeClass("geo-exif-backfill-running").addClass("geo-exif-backfill-error");m.set("innerHTML",a.transjax.get("geo-exif-backfill","backfill_error"))}});a.on("geoExifBackfill:complete",function(n){var m,p,o,q;if(d){if(n.photo.geoperms.ispublic){m=0}else{if(n.photo.geoperms.iscontact){m=1}else{if(n.photo.geoperms.isfriend&&n.photo.geoperms.isfamily){m=2}else{if(n.photo.geoperms.isfriend){m=3}else{if(n.photo.geoperms.isfamily){m=4}else{m=5}}}}}p={latitude:n.photo.location.latitude,longitude:n.photo.location.longitude,accuracy:n.photo.location.accuracy};q={};if(n.photo.location.country&&n.photo.location.country._content){q.country={name:n.photo.location.country._content}}if(n.photo.location.region&&n.photo.location.region._content){q.region={name:n.photo.location.region._content}}if(n.photo.location.locality&&n.photo.location.locality._content){q.locality={name:n.photo.location.locality._content}}if(n.photo.location.neighbourhood&&n.photo.location.neighbourhood._content){q.neighbourhood={name:n.photo.location.neighbourhood._content}}o={woeid:n.photo.location.woeid,breadcrumb:q};d.set("perm_viewgeo",m);d.set("geo",p);d.set("woe",o)}a.use("photo-geolocation",function(r){r.photoGeolocation.syncGeopanelPhotoInfo();r.photoGeolocation.syncPhotoPage()})});a.on("geoExifBackfill:progress",function(m){var n=l();if(n){n.set("innerHTML",a.transjax.get("geo-exif-backfill","backfill_running"))}})}function e(){a.occult.register("photo",{getTitle:function(){return d.get("title")},setTitle:function(l){a.flickrAPI.callMethod("flickr.photos.setMeta",{photo_id:d.get("id"),title:l,description:d.get("description")},{success:function(){a.flickrAPI.callMethod("flickr.photos.getInfo",{photo_id:d.get("id")},{success:function(m){d.set("title",m.data.photo.title._content)}})}})},getId:function(){return d.get("id")},getOwner:function(){return d.get("owner")},getDescription:function(){return d.get("description")},setDescription:function(l){a.flickrAPI.callMethod("flickr.photos.setMeta",{photo_id:d.get("id"),title:d.get("title"),description:l},{success:function(){a.flickrAPI.callMethod("flickr.photos.getInfo",{photo_id:d.get("id")},{success:function(m){d.set("description",m.data.photo.description._content)}})}})},getSizes:function(){return d.get("sizes")},getDatePosted:function(){return d.get("date_posted")},setDatePosted:function(l){if(!d.get("is_owner")){return false}l=parseInt(l,10);if(!a.Lang.isNumber(l)||l<a.config.flickr.user.date_creation||l>Math.round(new Date().getTime()/1000)){return false}if(a.config.flickr.flags.enable_rapid_tracking){a.use("rapid-tracker",function(m){m.rapidTracker.beaconEvent("occult-photo-setDatePosted",{photo_id:d.get("id"),date_posted:l})})}a.global_dialog.remove_existing_dialog();a.global_dialog.show({loading:true,modal:true});a.flickrAPI.callMethod("flickr.photos.setDates",{photo_id:d.get("id"),date_posted:l},{success:function(){a.global_dialog.hide();d.set("date_posted",l)}})},getPerms:function(l){if(!d.get("is_owner")){return false}return d.get("perms")},setPerms:function(m){var n,l;if(!d.get("is_owner")){return false}n=d.get("perms");n.is_public=n.is_public?1:0;n.is_friend=n.is_friend?1:0;n.is_family=n.is_family?1:0;m=m||{};l={};m.photo_id=d.get("id");m.is_public=typeof m.is_public==="undefined"?n.is_public:(m.is_public?1:0);m.is_friend=m.is_public?0:(typeof m.is_friend==="undefined"?n.is_friend:(m.is_friend?1:0));m.is_family=m.is_public?0:(typeof m.is_family==="undefined"?n.is_family:(m.is_family?1:0));m.perm_comment=(typeof m.perm_comment==="undefined"||parseInt(m.perm_comment,10)<0||parseInt(m.perm_comment,10)>3)?n.perm_comment:parseInt(m.perm_comment,10);m.perm_addmeta=(typeof m.perm_addmeta==="undefined"||parseInt(m.perm_addmeta,10)<0||parseInt(m.perm_addmeta,10)>3)?n.perm_addmeta:parseInt(m.perm_addmeta,10);l.is_public=(n.is_public!==m.is_public);l.is_friend=(n.is_friend!==m.is_friend);l.is_family=(n.is_family!==m.is_family);l.perm_comment=(n.perm_comment!==m.perm_comment);l.perm_addmeta=(n.perm_addmeta!==m.perm_addmeta);if(!l.is_public&&!l.is_friend&&!l.is_family&&!l.perm_comment&&!l.perm_addmeta){return}a.global_dialog.remove_existing_dialog();a.global_dialog.show({loading:true,modal:true});a.flickrAPI.callMethod("flickr.photos.setPerms",m,{success:function(){if(l.is_public){d.set("is_public",m.is_public)}if(l.is_friend){d.set("is_friend",m.is_friend)}if(l.is_family){d.set("is_family",m.is_family)}if(l.perm_comment){d.set("perm_comment",m.perm_comment)}if(l.perm_addmeta){d.set("perm_addmeta",m.perm_addmeta)}a.global_dialog.hide()}})}})}function g(){var n={};var m=function(s,r,p){var q=r.responseText.split("<!--#MAIN#-->")[1];n[p.url]=q};function l(){var o=a.one("#nav-bar-next").get("href");if(n[o]){return}a.io(o,{on:{success:m},"arguments":{url:o}})}l();a.one("#main").on("click",function(p){p.preventDefault();if(p.target.ancestor("#nav-bar-next, #nav-bar-prev",true)){p.preventDefault();var o=p.target.ancestor("#nav-bar-next, #nav-bar-prev",true).get("href");if(n[o]){a.one("#main").set("innerHTML",n[o])}else{a.io(o,{on:{success:function(s,r,q){m(s,r,q);a.one("#main").set("innerHTML",n[q.url]);l()}},"arguments":{url:o}})}}})}function h(){if(!d.get("is_video")&&!d.get("dmca_takedown")){a.on("contextmenu",function(l){if(l.target.ancestor(".note-content, .note resize",true)){return}a.photoContextMenu.show(l,d)},"#photo-drag-proxy")}}function f(){if(!d.get("dmca_takedown")&&(a.lightbox||a.touchLightbox)&&a.config.flickr.lightbox.enable){var l,m;m=function(n){if(l||a.contextManager.get()!==""||a.eventAnnotations.get(n,"preventLightbox")||a.eventAnnotations.get(n,"closingLightbox")||n.altKey||n.ctrlKey||n.metaKey||n.shiftKey){return}n.preventDefault();a.eventAnnotations.add(n,{openingLightbox:true});if(a.config.flickr.is_touch_device&&a.config.flickr.flags.enable_advanced_gestures_lightbox){a.touchLightbox.open()}else{a.lightbox.open()}a.photoYwaTracking.log_action("Lightbox Icon")};a.one("#nav-bar-lightbox").on("click",m);a.keyboardShortcutManager.register({keystring:"76",handler:function(n){n.preventDefault();a.fire("flickr-menus:hide");m(n)},context:"",legend:{key:"L",description:a.transjax.get("lightbox","view_photo_in_lightbox"),group:a.transjax.get("keyboard-shortcut-legend","lightbox"),order:0}});if(!d.get("is_video")){a.on("mousedrag:step",function(n){if(!l&&a.Math.hypotenuse((Math.abs(n.current.clientX-n.start.clientX)),(Math.abs(n.current.clientY-n.start.clientY)))>3){l=true}},"#photo-drag-proxy");a.on("mousedrag:end",function(n){setTimeout(function(){l=undefined},50)},"#photo-drag-proxy");a.on("click",m,"#photo-drag-proxy")}}else{if(a.config.flickr.is_touch_device&&a.config.flickr.flags.enable_advanced_gestures_lightbox){a.touchLightbox.init()}}}a.photo={init:k,getCurrentPhoto:i}},"0.0.1",{requires:F.config.modules.photo.requires||[],optional:F.config.modules.photo.optional||[]});YUI.add("photo-people-list",function(c){var k;function w(){if(!w.is_init){w.is_init=true;c.delegate("click",h,".photos-people",".add-person-link");c.delegate("click",u,".photos-people",".face-icon-editable");c.delegate("click",D,".photos-people",".delete-icon");c.delegate("mouseover",A,".photos-people","#people-tags li");c.delegate("mouseout",A,".photos-people","#people-tags li");c.on("peopleController:addPersonSuccess",x);c.on("peopleController:addPersonFailure",E);c.on("peopleController:removePersonSuccess",z);c.on("peopleController:removePersonFailure",H);c.on("photoNote:addFaceCancelled",m);c.on("photoNote:addFace",C)}}function h(I){I.preventDefault();r()}function u(K){var I,J;K.preventDefault();I=v(K.target);J=o(I);J.one(".face-icon").addClass("face-icon-adding");c.global_dialog.set_loading(true);c.use("photo-notes",function(L){L.global_dialog.hide();L.photoNotes.addPerson(I)})}function D(J){var I=v(J.target);J.preventDefault();s(I);if(k){k.unskipContact(I)}if(I.n&&c.config.flickr.people.skip&&c.config.flickr.people.skip[I.n]){delete c.config.flickr.people.skip[I.n]}if(I.e&&c.config.flickr.people.skip&&c.config.flickr.people.skip[I.e]){delete c.config.flickr.people.skip[I.e]}c.peopleController.removePerson(c.config.flickr.photo.id,I)}function A(K){var J,I;J=K.currentTarget;if(!c.photoNotes||!J.one(".face-icon-active")){return}switch(K.type){case"mouseover":if(J.test("#people-tags li")){I=v(J);c.photoNotes.highlightPerson(I);A.hovered_node=J}break;case"mouseout":if(A.hovered_node&&!A.hovered_node.contains(K.relatedTarget)){I=v(A.hovered_node);c.photoNotes.unhighlightPerson(I);A.hovered_node=undefined}break}}function x(I,J){if(!o(I)){l(I,!!J)}if(j(I)){g(I)}if(c.one(".photos-people .no-people")){c.one(".photos-people .no-people").setStyle("display","none")}}function E(I,J){if(j(I)){g(I);e(J)}f(I)}function z(K){var J=o(K);if(J){var O,N,I,M,L;O=J.getStyle("height");N=J.getStyle("minHeight");J.setStyle("overflow","hidden");M={height:O};L={height:"1px"};if(c.Lang.isNumber(parseInt(N,10))){M.minHeight=N;L.minHeight="1px"}I=new c.Anim({node:J,from:M,to:L,duration:0.3,easing:c.Easing.easeIn});I.on("end",function(){J.remove();var P=c.all("#people-tags li");if((!P||P.size()===0)&&c.one(".photos-people .no-people")){if(c.one("#people-tagging-ui").getStyle("display")!=="block"){c.one(".photos-people .no-people").setStyle("display","")}}});I.run()}}function H(J){var I=o(J);if(I&&I.hasClass("deleting")){e("It seems there was a problem removing that person from the photo.");y(J)}}function C(I){var J=o(I);if(J){J.one(".face-icon").removeClass("face-icon-adding").addClass("face-icon-active")}}function m(I){var J=o(I);if(J){J.one(".face-icon").removeClass("face-icon-adding")}}function q(I){if(k&&c.StringFilters.is_email_address(k.getQuery())){b({e:k.getQuery()})}}function f(I){if(k){k.unskipContact(I)}if(I.n&&c.config.flickr.people.skip&&c.config.flickr.people.skip[I.n]){delete c.config.flickr.people.skip[I.n]}if(I.e&&c.config.flickr.people.skip&&c.config.flickr.people.skip[I.e]){delete c.config.flickr.people.skip[I.e]}}function o(I){var J=B(I);return c.one('#people-tags li[data-person-n="'+J+'"], #people-tags li[data-person-e="'+J+'"]')}function e(I){c.global_dialog.create_alert_dialog(I,c.global_dialog.hide,{width:280})}function v(I){I=I.test("#people-tags li")?I:I.ancestor("#people-tags li");return(!I)?undefined:{n:I?I.getAttribute("data-person-n"):undefined,e:I?a(I.getAttribute("data-person-e")):undefined,i:I?I.one("img").get("src"):undefined,u:I?I.one(".username").get("innerHTML"):undefined,r:I?I.one(".realname").get("innerHTML"):undefined}}function B(I){return I.n?I.n:n(I.e)}function i(I){return I.e?n(I.e):undefined}function j(J){var L,M,K,I;L=B(J);M=c.all(".photos-people .badge-spinner");if(M&&M.size&&M.size()){M.some(function(N){if(N.getAttribute("data-person-n")===L||N.getAttribute("data-person-e")===L){K=N;return true}})}if(!K){I=i(J);if(I){if(M&&M.size&&M.size()){M.some(function(N){if(N.getAttribute("data-person-e")===I){K=N;return true}})}}else{}}return K}function t(I){var J,K;if(!j(I)){J=B(I);K=c.Node.create('<div class="badge-spinner"'+(I.n?' data-person-n="'+J+'"':"")+(I.e?' data-person-e="'+J+'"':"")+">"+c.transjax.get("photo-people","adding")+"</div>");c.one(".photos-people").insertBefore(K,c.one("#people-tagging-ui-container"))}}function g(I){var J=j(I);if(J){J.remove()}}function s(I){var J=o(I);J.addClass("deleting");J.one(".controls").append('<small class="deleting">'+c.transjax.get("photo-people","deleting")+"</small>")}function y(I){var J=o(I);J.removeClass("deleting");J.one(".controls .deleting").remove()}function b(I){if(I){t(I);if(k){setTimeout(function(){k.clear(true)},0);k.skipContact(I)}c.peopleController.addPerson(c.config.flickr.photo.id,I)}}function a(I){return c.BoSelecta3.unsanitizeString(I)}function n(I){return c.BoSelecta3.sanitizeString(I)}function l(M,P,Q,L){var I,K,R,N,O,J;I=c.one("#people-tags");if(!I){I=c.Node.create('<ul id="people-tags"></ul>');c.one(".photos-people").insertBefore(I,c.one("#people-tagging-ui-container"))}if(!c.config.flickr.user.useragent_fully_supported&&!c.config.flickr.user.useragent_partially_supported){L=true}K=B(M);if(M.n){R=c.BoSelecta3.sanitizeString(M.u);if(R.length>20){R=R.substr(0,20)+"..."}}else{if(M.e){N=c.BoSelecta3.sanitizeString(M.e);if(N.length>20){N=N.substr(0,20)+"\u2026"}}}O=c.config.flickr.photo.ownersUrl+"people/"+(M.a?M.a:M.n)+"/";J="<li"+(!M.n?' class="email-invite"':"")+(M.n?' data-person-n="'+K+'"':"")+(M.e?' data-person-e="'+K+'"':"")+">"+((M.n)?'<a href="'+O+'" class="flickr-user"><span class="name"><img src="'+M.i+'" width="24" height="24"><strong class="username">'+R+'</strong><span class="realname">'+(M.r?c.BoSelecta3.sanitizeString(M.r):c.transjax.get("bo-selecta","uber_contact_list_no_realname"))+"</span></span>"+(Q?"":'<span class="controls">'+(c.config.flickr.photo.is_video?"":(L?'<span class="face-icon'+(P?" face-icon-active":"")+'"></span>':'<span class="face-icon face-icon-editable'+(P?" face-icon-active":"")+'" title="'+(P?c.transjax.get("photo-people","edit_face_boundry"):c.transjax.get("photo-people","add_face_boundry"))+'"></span>'))+'<span class="delete-icon delete-x" title="'+c.transjax.get("photo-people",(M.n===c.config.flickr.user.nsid)?"remove_yourself":"remove_person")+'"></span></span>')+"</a>":'<span class="flickr-user email-contact" title="'+c.transjax.get("photo-people","tagged_by_you").replace(/"/g,'\\"')+'"><span class="name"><img src="'+c.config.flickr.images_root+'/icon_unread.gif" width="16" height="16" class="bs-email-icon"><strong class="username email">'+N+'</strong><span class="realname">'+c.transjax.get("photo-people","not_visible_to_others")+"</span></span>"+(Q?"":'<span class="controls">'+(c.config.flickr.photo.is_video?"":(L?'<span class="face-icon'+(P?" face-icon-active":"")+'"></span>':'<span class="face-icon face-icon-editable'+(P?" face-icon-active":"")+'" title="'+(P?c.transjax.get("photo-people","edit_face_boundry"):c.transjax.get("photo-people","add_face_boundry"))+'"></span>'))+'<span href="#" class="delete-icon delete-x" title="'+c.transjax.get("photo-people",(M.n===c.config.flickr.user.nsid)?"remove_yourself":"remove_person")+'"></span></span>')+"</span>")+"</li>";I.append(J)}function d(){var J,I;J=c.peopleController.getContactsCache();if(!k&&!c.config.flickr.people.can_only_add_self){I=[{message:"<span>"+c.transjax.get("photo-people",c.config.flickr.photo.is_video?"or_send_an_email_video":"or_send_an_email_photo")+"</span>",className:"bs-send-email-link",onclick:q,validator:function(K){return(c.StringFilters.is_email_address(K.getQuery())&&!K.searchingGlobally)}},{message:"<span>"+c.transjax.get("photo-people",c.config.flickr.photo.is_video?"send_an_email_video":"send_an_email_photo")+"</span>",className:"bs-send-email-link",onclick:q,validator:function(K){return(c.StringFilters.is_email_address(K.getQuery())&&K.searchingGlobally)}},{message:"<span>"+c.transjax.get("photo-people",c.config.flickr.photo.is_video?"if_you_enter_email_video":"if_you_enter_email_photo")+"</span>",className:"bs-enter-email-link",onclick:q,validator:function(K){return(!c.StringFilters.is_email_address(K.getQuery())&&K.searchingGlobally)}}];k=new c.BoSelecta3("#photos-people-field",{minListWidth:300,showSubtitle:true,showIcon:true,searchOnUsername:true,searchOnRealname:true,searchOnEmail:true,searchOnPathAlias:true,includeAddressBook:true,includeUser:true,defaultText:c.transjax.get("bo-selecta","uber_contact_list_default_text"),focusOnFetch:true,fetchDataImmediately:true,selectFirstItem:true,allowFormSubmit:false,respectCanTagFlag:true,enableGlobalSearch:true,zeroResultsMessages:I,apiURL:c.config.flickr.people.api_url});if(J){k.contacts=J;k.clear(true)}else{k.on("BoSelecta:dataFetchComplete",function(){c.peopleController.setContactsCache(k.contacts)})}k.on("BoSelecta:resultSelect",b);k.on("BoSelecta:inputEnter",q);if(c.config.flickr.people.skip){c.Object.each(c.config.flickr.people.skip,function(M,K,L){k.skipContact(M)})}}return k}function p(){var J,I;J=c.config.flickr.user;I={n:J.nsid,u:J.name,i:J.icon_url,a:J.pathalias};c.one("#people-tagging-ui").setStyle("display","");b(I)}function G(){c.one(".photos-people .add-person").setStyle("display","");if(c.one(".photos-people .no-people")){c.one(".photos-people .no-people").setStyle("display","")}c.one("#people-tagging-ui").setStyle("display","")}function r(){if(!c.one(".photos-people .add-person")||!c.one("#people-tagging-ui")){return}c.one(".photos-people .add-person").setStyle("display","none");if(c.one(".photos-people .no-people")){c.one(".photos-people .no-people").setStyle("display","none")}c.one("#people-tagging-ui").setStyle("display","block");c.one("#people-tagging-ui").vis.animScrollIntoView();if(c.one("#photos-people-field")){d();c.one("#photos-people-field").focus()}else{if(c.one("#add-yourself-buttons")){if(!r.self_buttons_init){r.self_buttons_init=true;c.delegate("click",function(I){I.preventDefault();p()},".photos-people",".self-yes");c.delegate("click",function(I){I.preventDefault();G()},".photos-people",".self-no")}}}}c.peopleList={init:w,showForm:r}},"0.0.1",{requires:F.config.modules["photo-people-list"].requires||[],optional:F.config.modules["photo-people-list"].optional||[]});YUI.add("photo-button-bar",function(f){var b,w,d,j;function x(J){if(!f.Lang.isObject(J)){J={}}var L,K,M;L=f.one("#button-bar-options");K=f.one("#button-bar-fave");M=new f.Popover({srcNode:"#options-menu",visible:false,width:"233px"});M.render();b=f.menus.add({id:"options-menu",popover:M,context:"action-menu",button_node:L});if(K){K.on("click",k)}f.delegate("click",q,"#options-menu","ul li a");f.delegate("click",function(N){if(N.currentTarget.hasClass("DisabledButt")){N.preventDefault()}},"#nav-bar","#nav-bar-next, #nav-bar-prev");f.on("ContextData:open",function(R){if(f.contextManager.get()==="touch-lightbox"){return}var O=f.ContextData.getContext();if(!O){return}var Q=f.urls.get("photo",{photo:f.photo.getCurrentPhoto(),sizes:true,context:true});if(Q){if(f.one("a#nav-bar-lightbox")){f.one("a#nav-bar-lightbox").setAttribute("href",Q)}if(f.one("#options-menu a.option-all-sizes")){f.one("#options-menu a.option-all-sizes").setAttribute("href",Q)}}var N=O.url?O.url+"show/with/"+f.photo.getCurrentPhoto().get("id"):"";if(N){if(f.one("#options-menu a.option-slideshow")){f.one("#options-menu a.option-slideshow").setAttribute("href",N)}}var P=f.urls.get("photo",{photo:f.photo.getCurrentPhoto(),exif:true,context:true});if(P){if(f.one("#options-menu a.option-meta")){f.one("#options-menu a.option-meta").setAttribute("href",P)}}f.one("#nav-bar-next").replaceClass("Butt","DisabledButt");f.one("#nav-bar-prev").replaceClass("Butt","DisabledButt");f.ContextData.loadPhoto(1);f.ContextData.loadPhoto(-1)});f.on("ContextData:photoLoaded",function(Q,N,O){if(f.contextManager.get()==="touch-lightbox"){return}var P=f.ContextData.getContext();if(Q===P.id){if(N===1){if(O){f.one("#nav-bar-next").setAttribute("href",f.urls.get("photo",{photo:O,context:true})).replaceClass("DisabledButt","Butt")}}else{if(N===-1){if(O){f.one("#nav-bar-prev").setAttribute("href",f.urls.get("photo",{photo:O,context:true})).replaceClass("DisabledButt","Butt")}}}if(P.type==="set"||P.type==="faves"||P.type==="gallery"||P.type==="photolist"||P.type==="contactsfaves"){f.one("#nav-bar-next span.text").set("innerHTML",f.transjax.get("photo-button-bar","next"));f.one("#nav-bar-prev span.text").set("innerHTML",f.transjax.get("photo-button-bar","prev"))}else{f.one("#nav-bar-next span.text").set("innerHTML",f.transjax.get("photo-button-bar","older"));f.one("#nav-bar-prev span.text").set("innerHTML",f.transjax.get("photo-button-bar","newer"))}}});if(f.config.flickr.flags.enable_groups_keyboard_shortcut){f.keyboardShortcutManager.register({keystring:"71",handler:function(N){N.preventDefault();B(N)},context:"",legend:{key:"G",description:f.transjax.get("photo-button-bar","open_add_to_group"),group:f.transjax.get("keyboard-shortcut-legend","actions"),order:10}})}if(f.config.flickr.flags.enable_sets_keyboard_shortcut){f.keyboardShortcutManager.register({keystring:"69",handler:function(N){N.preventDefault();c(N)},context:"",legend:{key:"E",description:f.transjax.get("photo-button-bar","open_add_to_set"),group:f.transjax.get("keyboard-shortcut-legend","actions"),order:10}})}if(f.config.flickr.flags.enable_gallery_keyboard_shortcut){f.keyboardShortcutManager.register({keystring:"65",handler:function(N){N.preventDefault();o(N)},context:"",legend:{key:"A",description:f.transjax.get("photo-button-bar","open_add_to_gallery"),group:f.transjax.get("keyboard-shortcut-legend","actions"),order:10}})}if(F.actionQueue&&f.Lang.isObject(F.actionQueue)){F.actionQueue["photo-button-bar"]={display_action:function(){if(b){b.show()}},toggle_fave:function(){f.photo.getCurrentPhoto().toggle_fave()}};F.actionQueue.module_loaded("photo-button-bar")}f.after("PhotoData:is_faveChange",function(O){var N=O.target;if(N.get("id")===f.photo.getCurrentPhoto().get("id")){if(O.newVal){f.faveStar.fave("#button-bar-fave")}else{f.faveStar.unfave("#button-bar-fave")}}});f.after("PhotoData:group_countChange",t);f.on("photo:addedToSet",g);f.on("photo:removedFromSet",function(){});f.on("flickrMap:locationSelected",function(){u(true)});f.on("flickrMap:locationRemoved",function(){u(false)})}function k(J){J.preventDefault();f.one("#button-bar-fave").blur();f.photo.getCurrentPhoto().toggle_fave();if(f.config.flickr.flags.enable_rapid_tracking){f.use("rapid-tracker",function(K){K.rapidTracker.beaconClick("button-bar","Toggle Fave")})}}function q(L){var J=L.currentTarget;var K={"option-add-tag":function(){f.modalTagRS.add_a_tag()},"option-add-note":function(){f.global_dialog.set_loading(true);f.use("photo-notes",function(N){N.global_dialog.hide();N.photoNotes.addNote()})},"option-add-person":function(){if(f.photo.getCurrentPhoto().get("is_video")){f.peopleList.showForm()}else{f.global_dialog.set_loading(true);f.use("photo-notes",function(N){N.global_dialog.hide();N.photoNotes.addPerson()})}},"option-add-to-gallery":o,"option-add-to-set":c,"option-invite-to-group":B,"option-add-to-group":B,"option-order-prints":function(){f.global_dialog.set_loading(true);f.use("flickr-printing",function(O){try{O.printing.order_products({photo_ids:O.photo.getCurrentPhoto().get("id"),show_other_products:true})}catch(N){O.log("error in Y.printing.order_products(): "+N.toString())}})},"option-replace":function(){f.global_dialog.set_loading(true);f.use("photo-replace",function(N){N.photoReplace.init(L);N.photoReplace.show_replace_form()})},"option-rotate":function(){f.global_dialog.set_loading(true);f.use("photo-rotate",function(N){N.photo_rotate.show_rotate_dialog()})},"option-edit-in-picnik":function(){f.global_dialog.set_loading(true);f.use("picnik",function(N){N.global_dialog.hide();N.picnik.start()})},"option-delete":a};if(f.config.flickr.user.useragent_partially_supported){delete K["option-add-to-gallery"];delete K["option-add-to-set"];delete K["option-invite-to-group"];delete K["option-add-to-group"]}var M=J.get("className").replace(/\s*ywa-track\s*/,"");if(typeof K[M]==="function"){f.menus.hide();L.preventDefault();K[M]()}}function t(J){if(J.prevVal===0){var K=f.one("#options-menu .option-add-to-group");if(K){K.set("innerHTML","<span></span>"+f.transjax.get("photo-button-bar","add_remove_group"))}}else{}}function g(J){var K=f.one("#options-menu .option-add-to-set");if(K){K.set("innerHTML","<span></span>"+f.transjax.get("photo-button-bar","add_remove_set"))}}function u(J){var K=f.one("#options-menu .option-add-location");if(K){K.set("innerHTML","<span></span>"+f.transjax.get("photo-button-bar",J?"edit_location_on_your_map":"add_to_your_map"))}}function I(K,J){if(K.get("value")===J){K.set("value","")}}function C(J){var K=f.all(".donebutt");if(!f.Lang.isUndefined(K)){K.removeClass("CancelButt");K.set("value",f.transjax.get("photo-button-bar","done"))}else{f.log("Couldn't find cancel button","warn","photo-button-bar")}}function v(M){var J=M.currentTarget;var L=J.getAttribute("data-set-id");var K=J.one(".status-icon");K.removeClass("delete-x").addClass("icon-spinner").setStyle("display","block");J.addClass("item-in-progress");if(J.hasClass("item-selected")){y(f.photo.getCurrentPhoto().get("id"),L,J)}else{h(f.photo.getCurrentPhoto().get("id"),L,J)}C()}function h(J,L,M){var K=M.one(".status-icon");C();f.flickrAPI.callMethod("flickr.photosets.addPhoto",{photoset_id:L,photo_id:J},{success:function(){var O=f.PhotoData.get(J),R="set-"+L,Q,P=M.one(".item-name").get("innerHTML"),N="/photos/"+((O.get("pathalias")?O.get("pathalias"):O.get("owner")))+"/sets/"+L+"/";K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x");M.removeClass("item-in-progress").addClass("item-selected")},1500);M.addClass("item-in-progress");if(f.ContextData.getContext(R)){Q=f.ContextData.getPhotoPosition(R,J);if(f.ContextData.getNextLimit(R)===Q){f.ContextData.unremovePhoto(R,Q)}else{f.ContextData.invalidate(R)}}else{f.ContextData.add({id:R,set_id:L,type:"set",title:P,url:N,photos:{"0":O}})}f.fire("photo:addedToSet")},failure:function(Q,P){var O=Q.data;var N={set_name:M.one(".item-name").get("innerHTML"),set_id:L,set_limit:"100,000"};var S;var R;K.addClass("icon-warn");setTimeout(function(){K.removeClass("icon-warn").setStyle("display","")},1500);if(O.code===1){S=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"cant_add_video_set_error":"cant_add_photo_set_error");R=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"cant_add_video_set_error_msg":"cant_add_photo_set_error_msg");m(S,R,c)}else{if(O.code===10){S=f.transjax.get("photo-button-bar","cant_add_set_over_limit_error");R=f.substitute(f.transjax.get("photo-button-bar","cant_add_set_over_limit_error_msg"),N);m(S,R,c)}else{R=f.substitute(f.transjax.get("photo-button-bar","cant_add_photo_set_error"),N);m(null,R,c)}}}})}function y(J,L,M){C();var K=M.one(".status-icon");f.flickrAPI.callMethod("flickr.photosets.removePhoto",{photoset_id:L,photo_id:J},{success:function(){var N;K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").setStyle("display","");M.removeClass("item-in-progress")},1500);M.removeClass("item-selected").addClass("item-in-progress");N="set-"+L;f.ContextData.removePhoto(N,f.ContextData.getPhotoPosition(N,J));f.fire("photo:removedFromSet")},failure:function(){K.addClass("icon-warn");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x")},1500)}})}function l(J){f.all(".creating-msg, .no-title-msg, .error-msg").setStyle("display","");var L=f.one("#set-title-field").get("value"),K=f.one("#set-desc-field").get("value");if(L===""){f.one(".no-title-msg").setStyle("display","block");return}f.one(".creating-msg").setStyle("display","block");J.target.addClass("DisabledButt").set("disabled",true);f.flickrAPI.callMethod("flickr.photosets.create",{title:L,description:K,primary_photo_id:f.photo.getCurrentPhoto().get("id")},{success:function(P,U){var O=P.data.photoset,N=f.photo.getCurrentPhoto(),V=O.id,M="set-"+V,Q,S=L,R=O.url;var T={"arguments":{newset:1}};f.mix(T,w);f.io("/add_to_set_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime(),T);if(f.ContextData.getContext(M)){Q=f.ContextData.getPhotoPosition(M,photo_id);if(f.ContextData.getNextLimit(M)===Q){f.ContextData.unremovePhoto(M,Q)}else{f.ContextData.invalidate(M)}}else{f.ContextData.add({id:M,set_id:V,type:"set",title:S,url:R,photos:{"0":N}})}},failure:function(){f.one(".creating-msg").setStyle("display","");f.one(".error-msg").setStyle("display","block");J.target.removeClass("DisabledButt").set("disabled",false)}});J.halt()}function c(L){if(!f.photo.getCurrentPhoto().get("is_owner")){return}j=j||{};var J="/add_to_set_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime();function K(N){f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog(N,{width:330}).show({loading:false,modal:true});f.delegate("click",function(P){v(P);j[J]=undefined},"ul.add-to-selector","li.set");if(f.one("#add-to-set-search")&&f.one("#global-dialog-container .create-set").getStyle("display")!=="block"){f.one("#add-to-set-search").focus();f.one("#add-to-set-search").select()}var O=f.one("#add-to-set-search");if(O){O.on("keyup",D);var M=O.on("focus",function(P){P.target.removeClass("grey");P.target.set("value","");M.detach()});O.once("keyup",function(P){P.target.removeClass("grey");M.detach();I(P.target,f.transjax.get("photo-button-bar","search_your_sets"))})}f.all("#add-to-set-done, #cancel-new-set").on("click",function(P){f.contextManager.unset("button-bar-dialog");f.global_dialog.remove_existing_dialog();f.global_dialog.hide();P.halt()});f.all("#add-to-set-new").on("click",function(P){f.one(".add-to-set").setStyle("display","none");f.one(".create-set").setStyle("display","block");f.all(".creating-msg, .no-title-msg, .error-msg").setStyle("display","");f.one("#create-new-set").removeClass("DisabledButt").set("disabled",false);P.halt()});f.all("#create-new-set").on("click",function(P){j[J]=undefined;l(P)})}f.contextManager.set("button-bar-dialog");if(j[J]){K(j[J])}else{f.global_dialog.remove_existing_dialog();f.global_dialog.show({loading:true,modal:true});w={on:{}};w.on.success=function(O,N,M){j[J]=N.responseText;K(j[J]);if(M&&M.newset){C()}};f.io(J,w)}}function B(M){j=j||{};var J="/add_to_group_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime();function L(O){f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog(O,{width:330}).show({loading:false,modal:true});if(f.one("#global_dialog .no-groups")){f.all("#add-to-group-done").on("click",function(Q){f.contextManager.unset("button-bar-dialog");f.global_dialog.remove_existing_dialog();f.global_dialog.hide();Q.halt()});return}f.delegate("click",function(Q){p(Q);j[J]=undefined},"ul.add-to-selector","li.group");var P=f.one("#add-to-group-search");if(P){P.focus();P.select();P.on("keyup",D);var N=P.on("focus",function(Q){Q.target.removeClass("grey");Q.target.set("value","");N.detach()});P.once("keyup",function(Q){Q.target.removeClass("grey");N.detach();I(Q.target,f.transjax.get("photo-button-bar","search_the_groups"))})}if(!f.photo.getCurrentPhoto().get("is_public")&&f.photo.getCurrentPhoto().get("is_owner")){f.one("#photo-private-msg").setStyle("display","block");f.one(f.photo.getCurrentPhoto().get("is_video")?"#add-to-group-private-video":"#add-to-group-private-photo").setStyle("display","inline")}else{f.one("#photo-private-msg").setStyle("display","")}f.all("#add-to-group-done, #cancel-new-set").on("click",function(Q){f.contextManager.unset("button-bar-dialog");f.global_dialog.remove_existing_dialog();f.global_dialog.hide();Q.halt()})}f.contextManager.set("button-bar-dialog");if(j[J]){L(j[J])}else{f.global_dialog.remove_existing_dialog();f.global_dialog.show({loading:true,modal:true});var K={on:{}};K.on.success=function(P,O,N){j[J]=O.responseText;L(j[J])};f.io(J,K)}}function p(M){C();var J=M.currentTarget;var L=J.getAttribute("data-group-id");var K=J.one(".status-icon");K.removeClass("delete-x").addClass("icon-spinner").setStyle("display","block");J.addClass("item-in-progress");if(J.hasClass("item-selected")){if((f.photo.getCurrentPhoto().get("is_owner")||J.hasClass("administered")||J.hasClass("moded"))&&!J.hasClass("invited")){i(f.photo.getCurrentPhoto().get("id"),L,J)}else{H(f.photo.getCurrentPhoto().get("id"),L,J)}}else{if(f.photo.getCurrentPhoto().get("is_owner")){G(f.photo.getCurrentPhoto().get("id"),L,J)}else{A(f.photo.getCurrentPhoto().get("id"),L,J)}}}function m(K,J,M){var L=(K)?'<p class="msg"><span></span>'+K+"</p>":"";f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog('<div class="rule-violation"><div class="bd">'+L+"<p>"+J+'</p><div class="button-container"><input type="button" id="error-close" class="Butt" value="'+f.transjax.get("photo-button-bar","close")+'"></div></div></div>',{width:330}).show({loading:false,modal:true});f.all("#error-close").on("click",function(N){f.global_dialog.remove_existing_dialog();f.global_dialog.hide();N.halt();if(typeof M==="function"){M()}})}function G(J,L,M){C();var K=M.one(".status-icon");f.flickrAPI.callMethod("flickr.groups.pools.add",{group_id:L,photo_id:J},{success:function(){var O=f.PhotoData.get(J),Q="pool-"+L,P,R=M.one(".item-name").get("innerHTML"),N="/groups/"+L+"/";K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x");M.removeClass("item-in-progress").addClass("item-selected")},1500);M.addClass("item-in-progress");if(f.ContextData.getContext(Q)){P=f.ContextData.getPhotoPosition(Q,J);if(f.ContextData.getPrevLimit(Q)===P){f.ContextData.unremovePhoto(Q,P)}else{f.ContextData.invalidate(Q)}}else{f.ContextData.add({id:Q,group_id:L,type:"pool",title:R,url:N,photos:{"0":O}})}O.increment("group_count")},failure:function(P,O){var N=P.data,S,R,Q;if(N.code===4){S=f.transjax.get("photo-button-bar",(f.photo.getCurrentPhoto().get("is_video")?"video":"photo")+"_in_maximum_pools");R=f.transjax.get("photo-button-bar",(f.photo.getCurrentPhoto().get("is_video")?"video":"photo")+"_in_maximum_pools_msg");m(S,R,B)}else{if(N.code===5){f.flickrAPI.callMethod("flickr.groups.getInfo",{group_id:L},{success:function(W,V){var Y=W.data.group.throttle,T=Y.count,U=Y.mode,aa=W.data.group.name._content,Z=f.transjax.get("photo-button-bar","pool_limit_reached"),X=f.transjax.get("photo-button-bar","pool_limit_reached_msg");if(U==="disabled"){Z=f.transjax.get("photo-button-bar","photo_adding_disabled",aa);X=""}else{if(U==="ever"){X=f.transjax.get("photo-button-bar",(T*1>1)?"photo_limits_1":"photo_limits_2",T,aa,T)}else{X=f.transjax.get("photo-button-bar",(T*1>1)?"photo_limits_3_"+U:"photo_limits_4_"+U,T,aa,T)}}m(Z,X,B)},failure:function(U,T){S=f.transjax.get("photo-button-bar","pool_limit_reached");R=f.transjax.get("photo-button-bar","pool_limit_reached_msg");m(S,R,B)}})}else{if(N.code===6||N.code===7){K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x");M.removeClass("item-in-progress").addClass("item-selected")},1500);M.addClass("item-in-progress");M.one(".num-items").set("innerHTML",f.transjax.get("photo-button-bar","pending_approval"))}else{if(N.code===8){Q={on:{}};Q.on.success=function(W,U,T){K.removeClass("icon-warn").setStyle("display","");var V=M.one(".item-name").get("innerHTML");f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog('<div class="rule-violation"><div class="bd"><p class="msg"><span></span>'+f.transjax.get("photo-button-bar",(f.photo.getCurrentPhoto().get("is_video")?"video":"photo")+"_not_added_to_pool_restrictions_zeus",L,V)+'</p><ul class="pool-restrictions">'+U.responseText+"</ul><p>"+f.transjax.get("photo-button-bar","photo_see_group_for_info_zeus",L,V)+'</p><div class="button-container"><input type="button" id="rule-violation-close" class="Butt" value="'+f.transjax.get("photo-button-bar","close")+'"></div></div></div>',{width:330}).show({loading:false,modal:true});f.all("#rule-violation-close").on("click",function(X){f.global_dialog.remove_existing_dialog();f.global_dialog.hide();X.halt()})};f.io("/fragment_groups_pool_restrictions.gne?nsid="+L+"&cachebust="+(new Date()).getTime(),Q)}else{if(N.code===10){R=f.transjax.get("photo-button-bar","over_member_limit_message");m(null,R,B)}else{R=f.transjax.get("photo-button-bar","generic_api_error");m(null,R,B)}}}}}}})}function A(J,L,M){C();var K=M.one(".status-icon");f.flickrAPI.callMethod("flickr.groups.invite.photo.invite",{group_id:L,photo_id:J},{success:function(){K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x");M.removeClass("item-in-progress").addClass("item-selected").addClass("invited");M.one(".num-items").set("innerHTML",f.transjax.get("photo-button-bar","invitation_sent"))},1500);M.addClass("item-in-progress");var N={on:{}};N.on.success=function(Q,P,O){if(P.responseText.replace(/^\s*/,"").replace(/\s*$/,"")!==""){f.one("#invites").removeClass("collapsed").set("innerHTML",P.responseText)}};f.io("/photo_group_invites_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime(),N)},failure:function(P,O){var N=P.data;var S,R;if(N.code===5){S=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_already_invited":"photo_already_invited");R=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_already_invited_msg":"photo_already_invited_msg");m(S,R,B)}else{if(N.code===8){var Q={on:{}};Q.on.success=function(W,U,T){K.removeClass("icon-warn").setStyle("display","");var V=M.one(".item-name").get("innerHTML");f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog('<div class="rule-violation"><div class="bd"><p class="msg"><span></span>'+f.transjax.get("photo-button-bar",(f.photo.getCurrentPhoto().get("is_video")?"video":"photo")+"_not_added_to_pool_restrictions_zeus",L,V)+'</p><ul class="pool-restrictions">'+U.responseText+"</ul><p>"+f.transjax.get("photo-button-bar","photo_see_group_for_info_zeus",L,V)+'</p><div class="button-container"><input type="button" id="rule-violation-close" class="Butt" value="'+f.transjax.get("photo-button-bar","close")+'"></div></div></div>',{width:330}).show({loading:false,modal:true});f.all("#rule-violation-close").on("click",function(X){f.global_dialog.remove_existing_dialog();f.global_dialog.hide();X.halt()})};f.io("/fragment_groups_pool_restrictions.gne?nsid="+L+"&cachebust="+(new Date()).getTime(),Q)}else{if(N.code<=6){S=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"cant_invite_that_video":"cant_invite_that_photo");R=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"cant_invite_that_video_msg":"cant_invite_that_photo_msg")}else{if(N.code<=7){S=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_in_queue_error":"photo_in_queue_error");R=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_in_queue_error_msg":"photo_in_queue_error_msg")}else{S=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_invite_error":"photo_invite_error");R=f.transjax.get("photo-button-bar",f.photo.getCurrentPhoto().get("is_video")?"video_invite_error_msg":"photo_invite_error_msg")}}m(S,R,B)}}}})}function i(J,L,N,O){C();var K=N.one(".status-icon");if(N.hasClass("not-member")&&!O){var M=f.transjax.get("photo-button-bar","remove_from_group_not_a_member");f.global_dialog.create_confirmation_dialog(M,function(Q,P){if(Q){i(J,L,N,Q)}},{confirm_butt_class:"DeleteButt",CONFIRM:f.transjax.get("photo-button-bar","remove")});return}f.flickrAPI.callMethod("flickr.groups.pools.remove",{group_id:L,photo_id:J},{success:function(){var Q,P=f.PhotoData.get(J);if(N.hasClass("not-member")||N.hasClass("moded")){N.remove()}else{N.one(".num-items").set("innerHTML","");K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").setStyle("display","");N.removeClass("item-in-progress")},1500);N.removeClass("item-selected").addClass("item-in-progress")}Q="pool-"+L;f.ContextData.removePhoto(Q,f.ContextData.getPhotoPosition(Q,J));P.decrement("group_count")},failure:function(){K.addClass("icon-warn");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x")},1500)}})}function H(J,L,M){C();var K=M.one(".status-icon");f.flickrAPI.callMethod("flickr.groups.invite.photo.cancel",{group_id:L,photo_id:J},{success:function(){M.one(".num-items").set("innerHTML","");K.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){K.removeClass("icon-confirm").setStyle("display","");M.removeClass("item-in-progress")},1500);M.removeClass("item-selected").addClass("item-in-progress");var N={on:{}};N.on.success=function(Q,P,O){f.one("#invites").removeClass("collapsed").set("innerHTML",P.responseText)};f.io("/photo_group_invites_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime(),N)},failure:function(){K.addClass("icon-warn");setTimeout(function(){K.removeClass("icon-confirm").addClass("delete-x")},1500)}})}function o(J){if(f.photo.getCurrentPhoto().get("is_owner")){return}f.contextManager.set("button-bar-dialog");f.global_dialog.remove_existing_dialog();f.global_dialog.show({loading:true,modal:true});d={on:{}};d.on.success=function(O,N,K){f.global_dialog.remove_existing_dialog();f.global_dialog.create_dialog(N.responseText,{width:330}).show({loading:false,modal:true});f.delegate("click",n,"ul.add-to-selector","li.gallery");var M=f.one("#add-to-gallery-search");if(M&&f.one("#global-dialog-container .create-gallery").getStyle("display")!=="block"){M.focus();M.select();M.on("keyup",D);var L=M.on("focus",function(P){P.target.removeClass("grey");P.target.set("value","");L.detach()});M.once("keyup",function(P){P.target.removeClass("grey");L.detach();I(P.target,f.transjax.get("photo-button-bar","search_your_galleries"))})}f.all("#add-to-gallery-done, #cancel-new-gallery").on("click",function(P){f.contextManager.unset("button-bar-dialog");f.global_dialog.remove_existing_dialog();f.global_dialog.hide();P.halt()});f.all("#add-to-gallery-new").on("click",function(P){f.one(".add-to-gallery").setStyle("display","none");f.one(".create-gallery").setStyle("display","block");f.all(".creating-msg, .no-title-msg, .error-msg").setStyle("display","");f.one("#create-new-gallery").removeClass("DisabledButt").set("disabled",false);P.halt()});f.all("#create-new-gallery").on("click",z)};f.io("/add_to_gallery_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime(),d)}function n(M){var J=M.currentTarget;var K=J.getAttribute("data-gallery-id");var L=J.one(".status-icon");L.removeClass("delete-x").addClass("icon-spinner").setStyle("display","block");J.addClass("item-in-progress");if(J.hasClass("item-selected")){e(f.photo.getCurrentPhoto().get("id"),K,J)}else{s(f.photo.getCurrentPhoto().get("id"),K,J)}}function s(K,J,M){var L=M.one(".status-icon");f.flickrAPI.callMethod("flickr.galleries.addPhoto",{gallery_id:J,photo_id:K},{success:function(){L.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){L.removeClass("icon-confirm").addClass("delete-x");M.removeClass("item-in-progress").addClass("item-selected")},1500);M.addClass("item-in-progress");E(K,J,M.one(".item-name").get("innerHTML"),true);f.fire("photo:galleryAdd")},failure:function(){L.addClass("icon-warn");setTimeout(function(){L.removeClass("icon-warn").setStyle("display","")},1500)}})}function e(K,J,M){var L=M.one(".status-icon");f.flickrAPI.callMethod("flickr.galleries.removePhoto",{gallery_id:J,photo_id:K},{success:function(){L.removeClass("icon-spinner").addClass("icon-confirm");setTimeout(function(){L.removeClass("icon-confirm").setStyle("display","");M.removeClass("item-in-progress")},1500);M.removeClass("item-selected").addClass("item-in-progress");E(K,J,M.one(".item-name").get("innerHTML"),false);f.fire("photo:galleryRemove")},failure:function(){L.addClass("icon-warn");setTimeout(function(){L.removeClass("icon-confirm").addClass("delete-x")},1500)}})}function E(N,R,P,L){var M=R;if(!f.config.flickr.flags.enable_galleries_context){return}R=R.split("-")[1];var K=f.PhotoData.get(N),Q="/photos/"+((K.get("pathalias")?K.get("pathalias"):K.get("owner")))+"/galleries/"+R+"/",J="gallery-"+(f.config.flickr.user.pathalias||f.config.flickr.user.nsid)+"-"+R,O;if(L){if(f.ContextData.getContext(J)){O=f.ContextData.getPhotoPosition(J,N);if(f.ContextData.getNextLimit(J)===O){f.ContextData.unremovePhoto(J,O)}else{f.ContextData.invalidate(J)}}else{f.ContextData.add({id:J,gallery_id:M,type:"gallery",title:P,url:Q,photos:{"0":K}})}}else{f.ContextData.removePhoto(J,f.ContextData.getPhotoPosition(J,N))}}function z(J){f.all(".creating-msg, .no-title-msg, .no-desc-msg, .error-msg").setStyle("display","");var L=f.one("#gallery-title-field").get("value"),K=f.one("#gallery-desc-field").get("value");if(L===""){f.one(".no-title-msg").setStyle("display","block");return}f.one(".creating-msg").setStyle("display","block");J.target.addClass("DisabledButt").set("disabled",true);f.flickrAPI.callMethod("flickr.galleries.create",{title:L,description:K,primary_photo_id:f.photo.getCurrentPhoto().get("id")},{success:function(O,N){f.io("/add_to_gallery_fragment.gne?id="+f.photo.getCurrentPhoto().get("id")+"&cachebust="+(new Date()).getTime(),d);if(O.data.gallery.id){var Q=f.photo.getCurrentPhoto().get("id"),M=O.data.gallery.id,P=L;E(Q,M,P,true)}f.fire("photo:galleryAdd")},failure:function(){f.one(".creating-msg").setStyle("display","");f.one(".error-msg").setStyle("display","block");J.target.removeClass("DisabledButt").set("disabled",false)}});J.halt()}function a(){var K,M,J,N,L;K=f.photo.getCurrentPhoto();M='<div class="delete-photo"><p class="msg"><span></span>'+f.transjax.get("photo-button-bar",K.get("is_video")?"are_you_sure_you_want_to_delete_video":"are_you_sure_you_want_to_delete_photo")+"</p><p>"+f.transjax.get("photo-button-bar","cannot_be_undone")+"</p></div>";J={confirm_butt_class:"DeleteButt",CONFIRM:f.transjax.get("photo-button-bar",K.get("is_video")?"delete_video_button":"delete_photo_button").toUpperCase()};if(K.get("sizes")&&K.get("sizes").s){L=K.get("sizes").s;J.photo={url:L.url,width:L.width,height:L.height}}N=function(P,O){if(P){document.location=f.urls.get("delete_photo",{photo_id:K.get("id"),path_alias:(K.get("pathalias")?K.get("pathalias"):K.get("owner"))})}};f.global_dialog.create_confirmation_dialog(M,N,J)}function D(O){var L=O.target.get("value");var K=f.one(".add-to-selector li.no-match");K.setStyle("display","");var J=f.all(".add-to-selector li.item");if(f.Lang.trim(L)===""||L===f.transjax.get("photo-button-bar","search_your_sets")||L===f.transjax.get("photo-button-bar","search_the_groups")||L===f.transjax.get("photo-button-bar","search_your_galleries")){J.setStyle("display","")}else{var M=new RegExp(r(L).toLowerCase().replace(/&/,"&amp;"));var N=false;J.setStyle("display","none");J.each(function(P){if(P.one(".item-name").get("innerHTML").toLowerCase().search(M)!==-1){P.setStyle("display","");N=true}});if(!N){K.setStyle("display","block")}}}function r(J){J=decodeURIComponent(J);J=J.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,"\\*").replace(/\$/g,"\\$").replace(/\^/g,"\\^").replace(/\?/g,"\\?");J=J.replace(/\|/g,"\\|").replace(/\+/g,"\\+").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\[/g,"\\[").replace(/\]/g,"\\]");return J}f.photoButtonBar={init:x,delete_photo:a}},"0.0.1",{requires:F.config.modules["photo-button-bar"].requires||[],optional:F.config.modules["photo-button-bar"].optional||[]});YUI.add("photo-context-menu",function(a){var f,b,d,l,g=["license_copyright","license_some_rights_reserved","license_some_rights_reserved","license_some_rights_reserved","license_some_rights_reserved","license_some_rights_reserved","license_some_rights_reserved","license_no_known_restrictions","license_government_work"],c=["/help/general/#147","http://creativecommons.org/licenses/by-nc-sa/2.0/deed.en","http://creativecommons.org/licenses/by-nc/2.0/deed.en","http://creativecommons.org/licenses/by-nc-nd/2.0/deed.en","http://creativecommons.org/licenses/by/2.0/deed.en","http://creativecommons.org/licenses/by-sa/2.0/deed.en","http://creativecommons.org/licenses/by-nd/2.0/deed.en","/help/general/#147","http://www.usa.gov/copyright.shtml"];var j;function i(p,n){var o,q;if(f){a.fire("flickr-menus:hide");return}l=n;p.preventDefault();o=p.target;var m=p;if(l.when){l.when(function(r){l=r;f=false;i(m,l)});menu_template='<div class="photo-context-menu context-menu-placeholder"><img style="margin:10px 25px" height="8" width="16" src="http://l.yimg.com/g/images/progress/balls-16x8-white.gif"></div>';q=a.Node.create(menu_template);a.one("body").append(q);j=q}else{a.all(".context-menu-placeholder").remove();q=h()}if(!o||!q){return}q.setStyle("display","block");q.setXY([p.clientX+o.get("docScrollX"),p.clientY+o.get("docScrollY")]);f=true;b=a.one("document").on("click",function(r){if(q.contains(r.target)){return}a.fire("flickr-menus:hide")});d=a.on("key",function(r){a.fire("flickr-menus:hide")},window,"down:27")}function e(m){if(!l){return}a.Object.each(k(),function(n){n.setStyle("display","")});f=false;if(b){b.detach()}if(d){d.detach()}}function k(){return h.memo}function h(){var s,m,q,p,v,r,t,u,o,n;if(!l){return}h.memo=h.memo||{};q=l.get("license");m=l.get("id")+"-"+q+"-"+a.urls.get("photo",{photo:l,context:true});if(!h.memo[m]){if(!a.Lang.isNumber(q)){p=""}else{t='<span class="ccIcn ccIcnSmall">';if(q===0){t+='<span class="ccIcn ccIcnSmall"><img src="'+a.config.flickr.images_root+'/spaceout.gif" height="15" width="15" class="f-sprite fs-icon_all_rights"></span>'}else{if(q===7){t+='<span class="ccIcn ccIcnSmall"><img src="'+a.config.flickr.images_root+'/spaceout.gif" width="16" height="16" class="f-sprite fs-icon_no_known_restrictions"></span>'}else{if(q===8){t+='<span class="ccIcn ccIcnSmall"><img src="'+a.config.flickr.images_root+'/icon_government_work.png" width="16" height="16" class="f-sprite fs-icon_no_known_restrictions"></span>'}else{t+='<span class="ccIcn ccIcnSmall"><img src="'+a.config.flickr.images_root+'/spaceout.gif" class="f-sprite fs-cc_icon_attribution_small">';if(q===1||q===2||q===3){t+='<img src="'+a.config.flickr.images_root+'/spaceout.gif" class="f-sprite fs-cc_icon_noncomm_small">'}if(q===1||q===5){t+='<img src="'+a.config.flickr.images_root+'/spaceout.gif" class="f-sprite fs-cc_icon_sharealike_small">'}if(q===3||q===6){t+='<img src="'+a.config.flickr.images_root+'/spaceout.gif" class="f-sprite fs-cc_icon_noderivs_small">'}t+="</span>"}}}t+="</span>";v=c[q];if(q===7&&a.one("#photo-sidebar-can-use a.license-highlight")){v=a.one("#photo-sidebar-can-use a.license-highlight").get("href")}p=a.transjax.get("photo-context-menu",g[q]+((l.get("media")==="video")?"_video":"_photo"),t,v)}u=[];for(o in l.get("sizes")){if(l.get("sizes").hasOwnProperty(o)&&((o!=="sq"&&o!=="t"&&o!=="s")||(!l.get("sizes").m&&(o==="s"))||(!l.get("sizes").s&&(o==="t")))){r=a.urls.get("photo",{photo:l,sizes:o,context:true});u.push('<a href="'+r+'" data-ywa-name="All Sizes">'+a.transjax.get("photo-context-menu","size_"+o)+"</a>")}}n=a.transjax.get("photo-context-menu","view_available_sizes")+" "+u.join(' <span class="sep">•</span> ');s='<div class="photo-context-menu"><div class="photo-context-menu-license">'+p+'</div><div class="photo-context-menu-sizes">'+n+"</div></div>";h.memo[m]=a.Node.create(s);a.one("body").append(h.memo[m])}return h.memo[m]}a.on("flickr-menus:hide",e);a.photoContextMenu={show:i,hide:e,is_open:function(){return f}}},"0.0.1",{requires:["event","node","photo","photo-context-menu-css","photo-context-menu-transjax","photo-data","urls"]});YUI.add("lightbox",function(ab){var a4,an=window,f=an.location,B=an.document,aA=ab.transjax.get("photo","untitled"),au,k,c,aX={},aT,J,o,m,aH="closed",aK=0,af=(ab.config.flickr.is_touch_device&&ab.config.flickr.flags.enable_advanced_gestures_lightbox),a="/apps/video/stewart.swf.v"+ab.config.flickr.video_player_version,h=[],aR,G,aB=ab.config.flickr.page_type,N={};function am(){if(!a4){a4=true;if(!k){H()}c=k.get("ownerDocument");k.on("click",aV);ab.on("ContextData:open",l);ab.on("ContextData:photoLoaded",ar);ab.on("ContextData:photoLoadFailure",aC);ab.on("ContextData:prevLimitReached",d);ab.on("ContextData:nextLimitReached",Q);ab.on("ContextData:contextInvalidated",L);if(ab.config.flickr.lightbox.enable_faves){ab.after("PhotoData:is_faveChange",w);ab.after("PhotoData:fave_countChange",aS)}if(ab.config.flickr.lightbox.enable_comments){ab.after("PhotoData:comment_countChange",q)}ab.keyboardShortcutManager.register({keystring:"27,76,37,39,74,75,32,70",handler:aM,context:"lightbox"});if(ab.config.flickr.flags.enable_keyboard_shortcut_legend&&ab.keyboardShortcutLegend&&ab.keyboardShortcutLegend.register){ab.keyboardShortcutLegend.register({keyCodes:[76],key:"L",description:ab.transjax.get("lightbox","close_the_lightbox"),context:"lightbox",group:ab.transjax.get("keyboard-shortcut-legend","lightbox"),order:0});ab.keyboardShortcutLegend.register({keyCodes:[39,74],key:"&rarr;",description:ab.transjax.get("lightbox","next_photo"),context:"lightbox",group:ab.transjax.get("keyboard-shortcut-legend","navigation"),order:0});ab.keyboardShortcutLegend.register({keyCodes:[37,75],key:"&larr;",description:ab.transjax.get("lightbox","prev_photo"),context:"lightbox",group:ab.transjax.get("keyboard-shortcut-legend","navigation"),order:0});ab.keyboardShortcutLegend.register({keyCodes:[32],key:"space",description:ab.transjax.get("lightbox","start_or_stop_slideshow_mode"),context:"lightbox",group:ab.transjax.get("keyboard-shortcut-legend","lightbox"),order:10});ab.keyboardShortcutLegend.register({keyCodes:[70],key:"F",description:ab.transjax.get("lightbox","fave_the_current_photo"),context:"lightbox",group:ab.transjax.get("keyboard-shortcut-legend","actions"),order:0})}aT=(new Date()).getTime();ab.on("resize",ab.betterThrottle(ax,20));ab.delegate("contextmenu",function(a7){var Y=e();if(Y&&Y.get("media")!=="video"){ab.photoContextMenu.show(a7,Y)}},"#lightbox",".facade-of-protection");if(ab.config.flickr.lightbox.enable_previews){ab.lightboxPreviews.init()}if(ab.config.flickr.lightbox.enable_fullscreen){B.body.onwebkitfullscreenchange=av}if(ab.config.flickr.is_touch_device===true&&!af){B.addEventListener("touchstart",n,false);B.addEventListener("touchmove",n,false);B.addEventListener("touchend",n,false);B.addEventListener("touchcancel",n,false)}if(af){B.addEventListener("touchstart",ag,false);B.addEventListener("touchmove",ag,false);B.addEventListener("touchend",ag,false);B.addEventListener("touchcancel",ag,false);k.on("click",function(a7){var Y=a7.target.ancestor(".Butt",true);if(Y){a7.preventDefault();var a8=Y.get("id");if(a8.toString()==="lightbox-next"){a6(ay(),ae()+1)}else{if(a8==="lightbox-prev"){a6(ay(),ae()-1)}else{}}}else{a7.preventDefault()}})}}}function aV(a7){var Y=[];if(!af){Y.push({selector:"#lightbox-prev",handler:function(a8){if((n&&n.touching)||a8.altKey||a8.ctrlKey||a8.metaKey||a8.shiftKey){}else{a8.preventDefault();a6(ay(),ae()-1)}}});Y.push({selector:"#lightbox-next",handler:function(a8){if((n&&n.touching)||a8.altKey||a8.ctrlKey||a8.metaKey||a8.shiftKey){}else{a8.preventDefault();a6(ay(),ae()+1)}}});Y.push({selector:"#lightbox-close",handler:function(a8){if((n&&n.touching)||a8.altKey||a8.ctrlKey||a8.metaKey||a8.shiftKey){}else{a8.preventDefault();if(aB==="photo"){ab.photoYwaTracking.log_action("Lightbox Close")}U()}}});Y.push({selector:".img-wrap a.photo-link, .lightbox-meta-title-link",handler:function(a8){if((n&&n.touching)||a8.altKey||a8.ctrlKey||a8.metaKey||a8.shiftKey){}else{if(aB==="photo"){a8.preventDefault();ab.photoYwaTracking.log_action("Lightbox Close");U()}}}});Y.push({selector:"#lightbox-play",handler:function(a8){a8.preventDefault();ac()}});if(ab.config.flickr.lightbox.enable_fullscreen){Y.push({selector:"#lightbox-fullscreen",handler:function(a8){a8.preventDefault();ah()}})}Y.push({selector:"#lightbox-allsizes, #lightbox-logo, .lightbox-meta-title, .lightbox-meta-owner",handler:Z})}if(ab.config.flickr.lightbox.enable_lightbox_context_switcher){Y.push({selector:"#lightbox-context-list",handler:function(bb){var ba,a9,a8;if((n&&n.touching)||bb.altKey||bb.ctrlKey||bb.metaKey||bb.shiftKey){}else{ba=bb.target.getAttribute("data-context-id");if(ba){if(ab.ContextData.getContext(ba)){a9=e();if(a9){a8=ab.ContextData.getPhotoPosition(ba,a9.get("id"))}if(ab.Lang.isNumber(a8)){bb.preventDefault();k.one("#lightbox-context-list ul").removeClass("open");ab.ContextData.open(ba)}}else{Z(bb)}}else{bb.preventDefault();k.one("#lightbox-context-list ul").toggleClass("open");if(k.one("#lightbox-context-list ul").hasClass("open")){a5()}}}}})}if(ab.config.flickr.lightbox.enable_faves){Y.push({selector:".lightbox-fave",handler:function(a9){var a8;if(ab.config.flickr.lightbox.enable_favorites_count){a8=e();if(a8.get("fave_count")>0&&a9.target.hasClass("text")){Z(a9)}else{a9.preventDefault();a3()}}else{a9.preventDefault();a3()}}})}if(ab.config.flickr.lightbox.enable_comments){Y.push({selector:".lightbox-comments",handler:function(a9){var a8=e();if(a8&&aB==="photo"&&ak(a8)){a9.preventDefault();U();an.setTimeout(function(){var ba=ab.one("#comments");if(ba){if(ba.one("#message")&&(a8.get("comment_count")===0||a9.target.test(".icon"))){ba=ba.one("#message");ba.focus()}ba.vis.animScrollIntoView(true,20)}},30)}else{Z(a9)}}})}Y.push({selector:'a[href="#"]',handler:function(a8){a8.preventDefault()}});ab.Array.each(Y,function(a8){if(a7.target.ancestor(a8.selector,true)){a8.handler.call(null,a7)}})}function ag(bg){bg.preventDefault();var bd=ag.startX||0,be=ag.position,ba=ag.position_node,Y=ag.context_id,a8=ag.distance,bh=ag.last_position_node,bi=ag.next_position_node,bf=ag.targetNode,a7=ag.moving,bc,bb,a9;switch(bg.type){case"touchstart":if(bg.touches[0]){a7=true;bd=bg.touches[0].pageX;bf=bg.touches[0].target;Y=ay();be=ae();ba=X(Y,be);bh=X(Y,be-1);bi=X(Y,be+1);bi._node.style.webkitTransform="translate3d(1200px, 0px, 0px)";bh._node.style.webkitTransform="translate3d(-1200px, 0px, 0px)";ba.setStyle("-webkit-transition-property","");ba.setStyle("-webkit-transition","")}break;case"touchmove":if(a7&&ba&&bg.touches[0]){a8=bg.touches[0].pageX-bd;ba._node.style.webkitTransform="translate3d("+a8+"px, 0px, 0px)";bi._node.style.webkitTransform="translate3d("+(a8+1200)+"px, 0px, 0px)";bh._node.style.webkitTransform="translate3d("+(a8-1200)+"px, 0px, 0px)"}break;case"touchend":if(a7&&ba){bc=Math.abs(a8);if(bc>50){if(bc===a8){aK=-1}else{aK=1}a6(ay(),ae()+aK)}else{if(bc<10){bb=ab.one(bg.target).ancestor(".Butt",true);if(bb){a9=bb.get("id");if(a9==="lightbox-next"){a6(ay(),ae()+1)}else{if(a9==="lightbox-prev"){a6(ay(),ae()-1)}else{if(a9==="lightbox-close"){U()}}}}}else{aK=0;a6(ay(),ae())}}a7=false;a8=0;bd=0}break}ag.startX=bd;ag.position=be;ag.position_node=ba;ag.context_id=Y;ag.distance=a8;ag.last_position_node=bh;ag.next_position_node=bi;ag.targetNode=bf;ag.moving=a7}function p(){ab.on("historyManager:change",function(a8){ab.log("historyManager:change","info","lightbox");var a7,a9,Y,ba;a7=a8.photo_id;a9=a8.context_id||ay();Y=ab.ContextData.getPhotoPosition(a9,a7);switch(aB){case"photo":if(a9!==ay()||Y!==ae()||!!a8.lightbox!==z()){ba=true}break;default:if(Y!==ae()||!!a8.lightbox!==z()){ba=true}break}if(ba){if(z()){if(a8.lightbox){a6(a9,Y)}else{U(a9,Y)}}else{if(a8.lightbox){O(a9,Y)}else{if(ab.config.flickr.flags.enable_justified_contacts_photos&&!a8.photo_id){return}else{if(ak(a8.photo_id)){if(a9){aj(a9);if(ab.Lang.isNumber(Y)){aQ(a9,Y)}}}else{j(f.href,true)}return}}}}})}function H(){k=ab.Node.create('<div id="lightbox"><div class="hd"><ul class="button-list button-list-dim" id="lightbox-nav"><li class="first"><a href="#" class="Butt" id="lightbox-prev"><span></span></a></li><li class="divider"><span> <span></span></span></li><li><a href="#" class="Butt" id="lightbox-play"><span></span></a></li><li class="divider"><span> <span></span></span></li><li class="last"><a href="#" class="Butt" id="lightbox-next"><span></span></a></li></ul><ul class="button-list button-list-dim" id="lightbox-other-controls"><li class="first"><a href="#" class="Butt" id="lightbox-allsizes"><span></span> '+ab.transjax.get("lightbox","allsizes")+'</a></li><li class="divider"><span> <span></span></span></li>'+(ab.config.flickr.lightbox.enable_lightbox_context_switcher?'<li id="lightbox-context-list"></li><li class="divider"><span> <span></span></span></li>':"")+(ab.config.flickr.lightbox.enable_fullscreen?'<li><a href="#" class="Butt" id="lightbox-fullscreen"><span></span> '+ab.transjax.get("lightbox","fullscreen")+'</a></li><li class="divider"><span> <span></span></span></li>':"")+'<li class="last"><a href="#" class="Butt ywa-track" data-ywa-name="Lightbox Close" id="lightbox-close"><span class="close-button-x">&times;</span> '+ab.transjax.get("lightbox","close")+'</a></li></ul><a href="/"><span class="logo" id="lightbox-logo"></span><span class="logo" id="lightbox-from-yahoo"></span></a><div id="lightbox-spinner" class="global_dialog_spinner"></div></div><div class="bd"><ul class="contexts"></ul></div><div class="ft"></div></div>');if(af){k.addClass("touch")}ab.one("body").append(k)}function Z(a7){var Y;Y=a7.target.ancestor("a",true).getAttribute("href");if(Y&&Y!=="#"){if(a7.altKey||a7.ctrlKey||a7.metaKey||a7.shiftKey){}else{a7.preventDefault();j(Y)}}else{a7.preventDefault()}}function a3(){var Y=e();if(!Y.get("can_fave")){return}if(aB==="faves"&&ab.config.flickr.page_owner===ab.config.flickr.user.nsid&&Y.get("is_fave")){ab.use("search-results-display-transjax","global-dialog",function(bc){var a8,a9,bd,ba,a7,bb;a8={CONFIRM:bc.transjax.get("search-results-display","yes_remove_it"),width:330,confirm_butt_class:"DeleteButt"};ba=Y.get("sizes")&&Y.get("sizes").s&&Y.get("sizes").s.url;a7=ba&&Y.get("sizes").s.width;bb=ba&&Y.get("sizes").s.height;if(ba&&a7&&bb){a8.photo={url:ba,width:a7,height:bb}}a9=function(be){if(be){Y.toggle_fave()}};bd=bc.transjax.get("search-results-display","confirm_remove_their_photo_from_your_favorites");bc.global_dialog.create_confirmation_dialog("<div>"+bd+"</div>",a9,a8)})}else{Y.toggle_fave()}}function aM(a7){var Y;if(!z()||ab.eventAnnotations.get(a7,"openingLightbox")||a7.altKey||a7.ctrlKey||a7.metaKey||a7.shiftKey){return}a7.preventDefault();switch(a7.keyCode){case 32:ac();break;case 27:case 76:a7.preventDefault();if(a7.keyCode===27&&ab.photoContextMenu.is_open()){ab.photoContextMenu.hide();return}ab.eventAnnotations.add(a7,{closingLightbox:true});if(ab.contextManager.get()==="lightbox-redirecting"){v()}else{if(aB==="photo"){ab.photoYwaTracking.log_action("Lightbox Close")}U()}break;case 37:case 39:case 74:case 75:a7.preventDefault();Y=(a7.keyCode===37||a7.keyCode===75)?-1:1;a6(ay(),ae()+Y);break;case 70:if(ab.config.flickr.flags.enable_fave_keyboard_shortcut){a3()}break}}function n(bc){var bb,a7,bd,Y,a9,a8,ba;if(!z()){return}bb=ay();a7=ae();bd=X(bb,a7);Y=5;switch(bc.type){case"touchstart":if(bc.touches.length===1&&(bc.target===bd||bd.contains(bc.target))){n.touching=true;n.distance_moved=0;n.oX=bc.touches[0].pageX;n.do_not_goto=false}break;case"touchmove":bc.preventDefault();if(n.touching){if(bc.touches.length===1){a9=bc.touches[0].pageX-n.oX;if(a9===0||(n.distance_moved>0&&a9<n.distance_moved)||(n.distance_moved<0&&a9>n.distance_moved)){n.do_not_goto=true}n.distance_moved=a9;bd.setStyle("left",n.distance_moved+"px");a8=n.distance_moved+bd.get("offsetWidth");ba=n.distance_moved-bd.get("offsetWidth");X(bb,a7+1).setStyle("left",a8+"px").setStyle("visibility","visible");X(bb,a7-1).setStyle("left",ba+"px").setStyle("visibility","visible")}else{bd.setStyle("left","0");X(bb,a7+1).setStyle("left","100%").setStyle("visibility","hidden");X(bb,a7-1).setStyle("left","100%").setStyle("visibility","hidden");n.touching=false;n.distance_moved=0;n.oX=0;n.do_not_goto=false}}break;case"touchend":case"touchcancel":if(n.touching){if(!n.do_not_goto&&Math.abs(n.distance_moved)>Y){if(n.distance_moved>0){a6(bb,a7-1)}else{a6(bb,a7+1)}}else{bd.setStyle("left","0");X(bb,a7+1).setStyle("left","100%").setStyle("visibility","hidden");X(bb,a7-1).setStyle("left","100%").setStyle("visibility","hidden")}n.touching=false;n.distance_moved=0;n.oX=0;n.do_not_goto=false}break}}function ax(Y){aT=(new Date()).getTime();i()}function ao(a7,Y){return(a7===ay()&&Y===ae())}function l(a8){var Y,a7;if(!z()||ay()===a8){return}a7=e();if(a7){Y=ab.ContextData.getPhotoPosition(a8,a7.get("id"))}if(!ab.Lang.isNumber(Y)){Y=a1(a8)}ab.log("changeContext","info","lightbox");if(ab.Lang.isNumber(Y)){a6(a8,Y)}}function az(){return"faves-"+(ab.config.flickr.user.pathalias?ab.config.flickr.user.pathalias:ab.config.flickr.user.nsid)}function L(Y){aR=true}function w(a8){var Y,a7,a9;Y=a8.target;a7=Y.get("id");a9=ab.ContextData.getPhotoPositions(a7);if(a9){ab.Object.each(a9,function(ba,bc){var bd,bb;bd=X(bc,ba,false);if(bd){bb=bd.one(".lightbox-fave");ab.faveStar.toggle_fave(bb,k)}})}}function aS(a8){var Y,a7,a9;Y=a8.target;a7=Y.get("id");a9=ab.ContextData.getPhotoPositions(a7);if(a9){ab.Object.each(a9,function(ba,bb){ad(bb,ba,Y)})}}function q(a8){var Y,a7,a9;Y=a8.target;a7=Y.get("id");a9=ab.ContextData.getPhotoPositions(a7);if(a9){ab.Object.each(a9,function(ba,bb){aU(bb,ba,Y)})}}function ad(ba,Y,a8){var bd,a7,a9,bc,bb;bd=X(ba,Y,false);if(bd){a8=a8||ab.ContextData.getPhoto(ba,Y);if(a8){a7=bd.one(".lightbox-fave");if(a7){a9=a8.get("fave_count");if(ab.config.flickr.lightbox.enable_favorites_count){switch(a9){case 0:bc="favorite";break;case 1:bc="favorite_with_count_one";break;default:bc="favorite_with_count_more_than_one";break}}else{bc="favorite"}if(a8.get("can_fave")||(ab.config.flickr.lightbox.enable_favorites_count&&a9>0)){a7.setStyle("display","")}else{a7.setStyle("display","none")}if(ab.config.flickr.lightbox.enable_favorites_count){bb='<span class="text">'+ab.transjax.get("lightbox",bc,a9)+"</span>"}else{bb='<span class="text">'+ab.transjax.get("lightbox",bc)+"</span>"}if(a9>0){href=ab.urls.get("photo",{photo:a8,context:ba,faves:true})}else{href="#"}if(a8.get("is_fave")){a7.addClass("fave").one("a").setAttribute("href",href).set("innerHTML",'<span class="star">&#9733;</span>'+bb)}else{a7.removeClass("fave").one("a").setAttribute("href",href).set("innerHTML",'<span class="star">&#9734;</span>'+bb)}}}}}function aU(ba,a7,a9){var bd,bb,Y,bc,a8;bd=X(ba,a7,false);if(bd){a9=a9||ab.ContextData.getPhoto(ba,a7);if(a9){bb=bd.one(".lightbox-comments");if(bb){Y=a9.get("comment_count");if(a9.get("can_comment")||Y>0){bb.setStyle("display","")}else{bb.setStyle("display","none")}switch(Y){case 0:bc="comment";break;case 1:bc="comment_with_count_one";break;default:bc="comment_with_count_more_than_one";break}a8='<span class="icon">&nbsp;</span><span class="icon icon-shadow">&nbsp;</span><span class="text">'+ab.transjax.get("lightbox",bc,Y)+"</span>";bb.one("a").set("innerHTML",a8);bb.one("a").setAttribute("href",ab.urls.get("photo",{photo:a9,context:ay(),hash:"comments"}))}}}}function aC(a7,Y){var a8=X(a7,Y);if(a8&&a8.hasClass("loading")){a8.removeClass("loading")}}function ar(a9,Y,a8){var ba,a7;ba=X(a9,Y,false);if(ba){aw(a9,Y);a7=ba.one(".lightbox-meta-title-link");a7.setAttribute("href",ab.urls.get("photo",{photo:a8,context:ay()}));a7.setAttribute("title",a8.get("title")||aA);if(a8.get("title")){a7.set("innerHTML",a8.get("title")).removeClass("untitled")}else{a7.set("innerHTML",aA).addClass("untitled")}ba.one(".lightbox-meta-owner").set("innerHTML",ab.transjax.get("lightbox","by",'<a href="'+ab.urls.get("photostream",{path_alias:(a8.get("pathalias")?a8.get("pathalias"):a8.get("owner")),photo:a8})+'">'+a8.get("ownername")+"</a>"));if(ab.config.flickr.lightbox.enable_faves){ad(a9,Y,a8)}if(ab.config.flickr.lightbox.enable_comments){aU(a9,Y,a8)}if(ao(a9,Y)){aO(a9,Y);al();i()}else{if(ao(a9,Y+1)){C()}else{if(ao(a9,Y-1)){a0()}}}t()}}function d(a7,Y){if(a7===ay()&&Y>ae()){ab.log("we are beyond the prev limit, so jump to that position","info","lightbox");a6(a7,Y)}}function Q(a7,Y){if(a7===ay()&&Y<ae()){ab.log("we are beyond the next limit, so jump to that position","info","lightbox");a6(a7,Y)}}function P(bc,a9,a8){var bb,Y=0,ba,a7;P.fading=P.fading||{};bb=bc.getAttribute("id");if(!bb){bb=ab.guid();bc.setAttribute("id",bb)}if(P.fading[bb]&&!a8){return}if(a9.size()){a9=a9.filter("img:not(#"+bb+")");a9.each(function(bd){ba=y(bd.getStyle("zIndex"));if(ba>Y){Y=ba}})}if(!Y||y(bc.getStyle("zIndex"))<=Y){bc.setStyle("zIndex",Y+1);if(y(bc.getStyle("opacity"))!==1){bc.setStyle("opacity","0");if(!af){P.fading[bb]=true;a7=new ab.Anim({node:bc,to:{opacity:1},duration:0.2});a7.on("end",function(){a9.setStyle("opacity","0");P.fading[bb]=undefined;delete P.fading[bb]});a7.run()}else{a9.setStyle("opacity",0);bc.setStyle("opacity",1)}}}}function aO(a8,bq){var a7,bf,Y,bj,be,bd,a9,bg,bm,bo,ba,bk,bc,bb,bp,bn,bl=false,bi,bh;a7=ab.ContextData.getPhoto(a8,bq);Y=A(a8,bq);bj=X(a8,bq);be=bj.one(".img-wrap");if(a7.get("media")==="video"&&a7.get("sizes").v&&a7.get("sizes").v.width){bm=be.one(".lightbox-video");if(!bm){bf=ao(a8,bq)&&(ab.config.flickr.lightbox.video_autoplay||o);bm=ab.Node.create('<div class="lightbox-video"></div>');ba=ab.stamp(bm);bm.set("id",ba);be.append(bm);if(ab.config.flickr.is_touch_device&&false){bc=ab.Node.create('<video width="100%" height="100%" preload autobuffer controls></video>');bc.set("src",Y.url);bc.set("poster",a7.get("sizes").z.url);bm.append(bc)}else{bk=new deconcept.SWFObject(a,ba+"-swf","100%","100%",9,"#000000");bk.addParam("allowFullScreen","true");bk.addParam("allowScriptAccess","always");bk.addParam("bgcolor","#000000");bk.addParam("wmode","opaque");bk.addVariable("intl_lang",ab.config.flickr.lang);bk.addVariable("onsite","true");bk.addVariable("intl_lang",ab.config.flickr.lang);bk.addVariable("photo_secret",a7.get("secret"));bk.addVariable("photo_id",a7.get("id"));bk.addVariable("flickr_noAutoPlay",!bf);bk.addVariable("hd_default",ab.config.flickr.lightbox.hd_default?"true":"false");bk.write(ba);h[a7.get("id")]=B.getElementById(ba+"-swf");if(!bf&&false){b(a7,true)}}bj.removeClass("loading").addClass("loaded");if(ao(a8,bq)){aa(a7)}}}else{bd=be.one("a.photo-link");if(!bd){bd=ab.Node.create('<a href="'+ab.urls.get("photo",{photo:a7,context:ay()})+'" class="photo-link"><span class="facade-of-protection"></span></a>');be.append(bd)}if(a7.get("needs_interstitial")){bp=ab.config.flickr.images_root+"/spaceout.gif";bl=true}else{bp=Y.url;if(!ab.config.flickr.lightbox.disable_lowsrc){bb=(aB==="photo"&&bq===0&&a7.get("sizes").z)?a7.get("sizes").z:a7.get("sizes").t;if(y(Y.width)>y(bb.width)){bn=bb.url}}}bm=bd.one('img[data-size-id="'+bp+'"]');if(bm){if(y(bm.getStyle("opacity"))===0&&!bm.hasClass("loading")){P(bm,bd.all("img"))}}else{bm=ab.Node.create('<img data-size-id="'+bp+'">');bm.addClass("loading");if(bl){bm.addClass("fuzzy")}bm.setStyle("opacity","0");bg=new Image();bg.onload=function(){if(bh){return}bh=true;bm.setAttribute("src",bp);bj.removeClass("loading").addClass("loaded");bm.removeClass("loading").addClass("loaded");P(bm,bd.all("img"),bl);if(ao(a8,bq)){aa(a7)}};bg.onerror=function(){bm.remove()};if(bn&&bd.all("img").size()===0){a9=new Image();a9.onload=function(){if(bh||bi){return}bi=true;var br=ab.Node.create('<img src="'+bn+'">');bd.append(br);P(br,bd.all("img"),bl)}}bd.append(bm);if(a9){a9.src=bn}bg.src=bp;if(bg.complete){bg.onload()}else{if(a9&&a9.complete){a9.onload()}}}if(bl&&!be.one(".interstitial")){if(ab.config.flickr.user.user_ok){bo=ab.Node.create('<div class="interstitial"><h4>'+ab.transjax.get("lightbox","outside_safesearch")+" "+ab.transjax.get("lightbox","you_can_click_through")+'</h4><a href="#" class="Butt interstitial-button">'+ab.transjax.get("lightbox","show_the_photo")+"</a></div>");bo.one("a.Butt").on("click",function(br){br.preventDefault();a7.record_interstitial_clickthrough()})}else{bo=ab.Node.create('<div class="interstitial"><h4>'+ab.transjax.get("lightbox","must_be_signed_in")+'</h4><a href="/signin/" class="Butt signin-button">'+ab.transjax.get("lightbox","sign_in")+"</a></div>")}ab.after("PhotoData:needs_interstitialChange",function(br){if(br.target===a7&&!br.newVal){u();bm.setStyle("opacity","0");bm.on("load",function(){bj.removeClass("loading").addClass("loaded");bm.removeClass("loading").addClass("loaded");P(bm,bd.all("img"));aa(a7)});bm.removeClass("fuzzy");bm.setAttribute("src",Y.url);bm.addClass("loading");bo.remove()}});be.append(bo)}}return Y}function y(Y){return parseInt(Y,10)}function A(Y,bb){var a7,bc,a9,bg,ba,a8,bf,be,bd,bh;bc=R(Y,bb);a9=bc[0];bg=bc[1];a7=a9+"x"+bg;A.memo=A.memo||{};A.memo[Y]=A.memo[Y]||{};A.memo[Y][bb]=A.memo[Y][bb]||{};if(!A.memo[Y][bb][a7]){ba=ab.ContextData.getPhoto(Y,bb);if(ba.get("media")==="video"&&ba.get("sizes").v&&ba.get("sizes").v.width){bh=ba.get("sizes").v}else{ab.Object.each(ba.get("sizes"),function(bj,bi){if(bj&&bi!=="o"){a8=y(bj.width);bf=y(bj.height);if((a8>=a9||bf>=bg)&&(!be||bj.height<y(be.height))){be=bj}if(!bd||(a8>y(bd.width)||bf>y(bd.height))){bd=bj}}bh=be||bd})}A.memo[Y][bb]={};A.memo[Y][bb][a7]=bh}return A.memo[Y][bb][a7]}function R(a9,Y){var ba,a8,a7;R.last_calc_time=R.last_calc_time||0;if(R.last_calc_time<aT){ba=X(a9,Y);a8=ba.get("offsetWidth");a7=ba.get("offsetHeight")-ba.one(".lightbox-meta").get("offsetHeight")-k.one(".hd").get("offsetHeight")-y(k.one(".hd").getStyle("top"))-k.one(".ft").get("offsetHeight");R.current=[a8,a7];R.last_calc_time=(new Date()).getTime()}return R.current}function i(){var a8,Y,a7;if(!z()){return}a8=ay();Y=ae();if(ab.UA.ie>6&&ab.UA.ie<8){a7=k.one(".bd");a7.setStyle("height",ab.DOM.winHeight()+"px");a7.setStyle("width",ab.DOM.winWidth()+"px")}ai(a8,Y);ai(a8,Y+1);ai(a8,Y-1)}function ai(a9,bp){var a8,bi,be,ba,bo,bc,a7,bk,bl,bh,bf,bm,Y,bg,bd,bj,bn,bb;a8=ab.ContextData.getPhoto(a9,bp);if(!a8){return}bi=X(a9,bp);be=bi.one(".img-wrap");ba=R(a9,bp);bo=ba[0];bc=ba[1];Y=aO(a9,bp);a7=y(Y.height);bk=y(Y.width);bl=(a7<bc)?a7:bc;bh=bl*bk/a7;if(bh>bo||bl>bc){bh=(bk<bo)?bk:bo;bl=bh*a7/bk}bf=(bh/-2);bm=(bl/-2);be.setStyle("height",bl+"px").setStyle("width",bh+"px").setStyle("marginLeft",bf+"px").setStyle("marginTop",bm+"px");bg=bi.one(".lightbox-meta");bj=bg.one(".lightbox-meta-title-link");bn=bj.getAttribute("title");bj.set("innerHTML",bn);bd=bg.get("offsetWidth");bg.setStyle("marginTop",(-1*bm)+"px");if(bd<=bh){bg.setStyle("marginLeft",bf+"px")}else{if(bd>bo){bb=1;while(bd>bo&&bb<200){bj.set("innerHTML",bn.substring(0,bn.length-bb)+"&hellip;");bd=bg.get("offsetWidth");bb++}}bg.setStyle("marginLeft",(-1*bd/2)+"px")}}function aQ(a7,Y){aX[a7]=Y}function a1(Y){return aX[Y]||0}function aZ(){return k.all("ul.contexts li.context")}function aD(a8,a7){if(!ab.Lang.isBoolean(a7)){a7=true}var Y=k.one('ul.contexts li.context[data-lightbox-context="'+a8+'"]');if(!Y&&a7){Y=ab.Node.create('<li class="context" data-lightbox-context="'+a8+'"><ul class="positions"></ul></li>');k.one("ul.contexts").append(Y)}return Y}function D(a7){var Y;if(ab.Lang.isNumber(a7)){Y=aD(a7);return Y.all("ul.positions li.position")}else{return k.all("ul.positions li.position")}}function X(a9,a8,a7){var Y,ba;if(!ab.Lang.isBoolean(a7)){a7=true}Y=aD(a9,a7);if(Y){ba=Y.one('li.position[data-context-position="'+a8+'"]');if(!ba&&a7){ba=ab.Node.create('	<li class="position" data-context-position="'+a8+'"><div class="img-wrap"></div><div class="lightbox-meta"><div class="lightbox-meta-attribution"><span class="lightbox-meta-title"><a href="#" class="lightbox-meta-title-link"></a></span><span class="lightbox-meta-owner"></span>'+(ab.config.flickr.lightbox.enable_faves?'<span class="lightbox-fave fave-button"><a href="#" class="lightbox-fave-link"></a></span>':"")+(ab.config.flickr.lightbox.enable_comments?'<span class="lightbox-comments comments-button"><a href="#" class="lightbox-comments-link"></a></span>':"")+"</div></div></li>");Y.one("ul.positions").append(ba);if(af){ba.setStyle("transform","translate3d(110%,0px,0px)")}an.setTimeout(function(){V(a9)},1000)}}return ba}function V(bb){var a7,ba,Y,a9,a8;a7=ab.config.flickr.lightbox.node_prune_threshold;ba=ab.config.flickr.lightbox.node_prune_amount;if(!ab.Lang.isNumber(a7)||!ab.Lang.isNumber(ba)){return}Y=ae(bb);a9=D(bb);if(a9.size()>a7){ba=a9.size()-a7+ba;a8=a9.getAttribute("data-context-position");a8.sort(function(bd,bc){var bf,be;bf=Math.abs(bd-Y);be=Math.abs(bc-Y);return(be-bf)});ab.Array.some(a8,function(be,bc){if(bc>=ba){return true}var bd=X(bb,be,false);if(bd&&bd.remove){aw(bb,be,false);bd.remove()}})}}V=ab.throttle(V,5000);function a6(Y,bc){ab.log("goTo ("+Y+" / "+bc+")","info","lightbox");var bf,bg,bd,ba,be,bb,a9,bi,a7;if(!Y||!ab.Lang.isNumber(bc)){return}v();bf=ab.ContextData.getPrevLimit(Y);if(ab.Lang.isNumber(bf)&&bf>bc){return a6(Y,bf)}bg=ab.ContextData.getNextLimit(Y);if(ab.Lang.isNumber(bg)&&bg<bc){return a6(Y,bg)}bb=ay();be=ae();if(bb===Y){if(bc>be){aK=1}else{if(bc<be){aK=-1}else{aK=0}}}else{aK=0}aj(Y);aQ(Y,bc);ba=X(Y,bc);a9=X(Y,be);ab.photoContextMenu.hide();if(bb!==Y||be!==bc){bi=ab.ContextData.getPhoto(bb,be);if(bi&&bi.get("media")==="video"){b(bi)}}if(af){aZ().setStyle("top","100%").setStyle("visibility","hidden");aD(Y).setStyle("top","0").setStyle("visibility","visible");D().setStyle("left","0").setStyle("visibility","visible");ba.setStyle("left","0").setStyle("visibility","visible");var bh,a8;if(aK===1){bh="150%";a8="-150%"}else{if(aK===-1){bh="-150%";a8="150%"}else{a8="0px";bh="0px"}}if(a6.ran_once){ba.transition({duration:0.3,transform:"translate3d(0px, 0px, 0px)"},function(){ba.setStyle("-webkit-transition-property","")});if(aK){a9.transition({duration:0.3,transform:"translate3d("+a8+", 0px, 0px)"},function(){a9.setStyle("transform","translate3d(-110%, 0px, 0px)");X(Y,bc+1).setStyle("transform","translate3d(110%, 0px, 0px)")})}}else{ba.setStyle("transform","translate3d(0px, 0px, 0px)");X(Y,bc+1).setStyle("transform","translate3d(-150%, 0px, 0px)");X(Y,bc-1).setStyle("transform","translate3d(150%, 0px, 0px)");a6.ran_once=true}}else{bd=aD(Y,false);aZ().each(function(bj){if(bj!==bd){bj.setStyle("visibility","hidden").setStyle("top","100%")}});aD(Y).setStyle("top","0").setStyle("visibility","visible");if(ab.config.flickr.lightbox.enable_slideshow_crossfade&&o&&be!==bc){ap(a9,ba)}else{D(Y).each(function(bj){if(bj!==ba){bj.setStyle("visibility","hidden").setStyle("left","100%")}});ba.setStyle("left","0").setStyle("visibility","visible");if(ab.UA.webkit){a9.setStyle("backgroundColor","");ba.setStyle("backgroundColor","#141414")}}}al();at(Y,bc);x();if(ba.hasClass("loading")){u()}else{a7=e();aa(a7)}i()}function x(){var a8,bb,bc,bd,Y,a7,a9,be,ba;a8=ab.config.flickr.lightbox.position_preload_limit||0;bb=ab.config.flickr.lightbox.position_preload_threshold||a8;if(!ab.Lang.isNumber(a8)||!ab.Lang.isNumber(bb)){return}bc=ay();bd=ae();if(aK>0){a7=Math.floor(bd/a8)+1;Y=bd+1;a9=a7*a8;if((a9-Y)<bb){a9+=bb}be=[Y,a9]}else{if(aK<0){a7=Math.ceil(bd/a8)-1;Y=bd-1;a9=a7*a8;if(Math.abs(a9-Y)<bb){a9-=bb}be=[a9,Y]}else{Y=bd-Math.ceil(a8/2);a9=bd-Math.floor(a8/2)+a8;be=[Y,a9]}}for(ba=be[0];ba<=be[1];ba++){if(ba!==bd){at(bc,ba)}}}function t(){var a9,a8,a7,ba,Y;a9=ab.config.flickr.lightbox.image_preload_limit;if(!ab.Lang.isNumber(a9)){return}ba=ay();Y=ae();if(aK>0){a8=[Y,Y+a9]}else{if(aK<0){a8=[Y-a9,Y]}else{a8=[Y-Math.ceil(a9/2),Y+Math.ceil(a9/2)]}}for(a7=a8[0];a7<=a8[1];a7++){if(a7!==Y){if(ab.ContextData.getPhoto(ba,a7)){aO(ba,a7)}}}}function aa(Y){aN();t();S(Y);if(o){if(Y.get("media")==="video"){aL(Y)}else{aP()}}else{if(Y.get("media")==="video"&&ab.config.flickr.lightbox.video_autoplay){aL(Y)}}}function ap(a8,ba){var a9=0.5,Y,a7;ba.setStyle("opacity","0").setStyle("left","0").setStyle("visibility","visible");setTimeout(function(){ba.setStyle("webkitTransitionProperty","opacity").setStyle("webkitTransitionDuration",a9+"s");a8.setStyle("webkitTransitionProperty","opacity").setStyle("webkitTransitionDuration",a9+"s");ba._node.addEventListener("webkitTransitionEnd",function(bb){if(!Y){Y=true;ba.setStyle("webkitTransitionProperty","").setStyle("webkitTransitionDuration","")}},false);a8._node.addEventListener("webkitTransitionEnd",function(bb){if(!a7){a7=true;a8.setStyle("webkitTransitionProperty","").setStyle("webkitTransitionDuration","");a8.setStyle("left","100%").setStyle("visibility","hidden").setStyle("opacity","1")}},false);setTimeout(function(){ba.setStyle("opacity","1");a8.setStyle("opacity","0")},0)},0)}function C(){var ba,a9,Y,bc,bb,a8,a7;ba=ay();a9=ae()-1;Y=(ab.ContextData.getPrevLimit(ba)>a9);bc=k.one("#lightbox-prev");a8="#";if(Y){bc.removeClass("Butt").addClass("DisabledButt")}else{bc.addClass("Butt").removeClass("DisabledButt");bb=ab.ContextData.getPhoto(ba,a9);if(bb){a7=ab.urls.parse(aB,f.pathname);switch(aB){case"faves":a8=ab.urls.get("faves",{photo:bb,path_alias:a7.path_alias,lightbox:true});break;case"group_pool":a8=ab.urls.get("group_pool",{photo:bb,group_id:a7.group_id,owner_id:a7.owner_id,lightbox:true});break;case"gallery":a8=ab.urls.get("gallery",{photo:bb,path_alias:a7.path_alias,gallery_id:a7.gallery_id,lightbox:true});break;case"contacts":a8=ab.urls.get("contacts",{photo:bb,lightbox:true});break;case"contactsfaves":a8=ab.urls.get("contactsfaves",{photo:bb,lightbox:true});break;case"photostream":a8=ab.urls.get("photostream",{photo:bb,path_alias:a7.path_alias,lightbox:true});break;default:a8=ab.urls.get("photo",{photo:bb,context:ay(),lightbox:true});break}}}bc.setAttribute("href",a8)}function a0(){var bb,a7,bc,ba,a9,Y,a8;bb=ay();a7=ae()+1;bc=(ab.ContextData.getNextLimit(bb)<a7);ba=k.one("#lightbox-next");Y="#";if(bc){ba.removeClass("Butt").addClass("DisabledButt")}else{ba.addClass("Butt").removeClass("DisabledButt");a9=ab.ContextData.getPhoto(bb,a7);if(a9){a8=ab.urls.parse(aB,f.pathname);switch(aB){case"faves":Y=ab.urls.get("faves",{photo:a9,path_alias:a8.path_alias,lightbox:true});break;case"group_pool":Y=ab.urls.get("group_pool",{photo:a9,group_id:a8.group_id,owner_id:a8.owner_id,lightbox:true});break;case"gallery":Y=ab.urls.get("gallery",{photo:a9,path_alias:a8.path_alias,gallery_id:a8.gallery_id,lightbox:true});break;case"contacts":Y=ab.urls.get("contacts",{photo:a9,lightbox:true});break;case"contactsfaves":Y=ab.urls.get("contactsfaves",{photo:a9,lightbox:true});break;case"photostream":Y=ab.urls.get("photostream",{photo:a9,path_alias:a8.path_alias,lightbox:true});break;default:Y=ab.urls.get("photo",{photo:a9,context:ay(),lightbox:true});break}}}ba.setAttribute("href",Y)}function T(a8){ab.log("logHistory","info","lightbox");var bb,ba,a7,Y,a9,bc;if(ab.historyManager.enabled){a8=a8||{};bb=a8.title;a7=a8.photo||e();ba=a8.replace||m;m=false;Y=ab.historyManager.getState();switch(aB){case"faves":if(Y.photo_id!==a7.get("id")||!!Y.lightbox!==z()){bc=true;a9={pathalias:Y.pathalias,photo_id:a7.get("id"),lightbox:z()}}break;case"group_pool":if(Y.photo_id!==a7.get("id")||!!Y.lightbox!==z()){bc=true;a9={group_id:Y.group_id,owner_id:Y.owner_id,photo_id:a7.get("id"),lightbox:z()}}break;case"gallery":if(Y.photo_id!==a7.get("id")||!!Y.lightbox!==z()){bc=true;a9={pathalias:Y.pathalias,gallery_id:Y.gallery_id,photo_id:a7.get("id"),lightbox:z()}}break;case"photostream":if(Y.photo_id!==a7.get("id")||!!Y.lightbox!==z()){bc=true;a9={pathalias:Y.pathalias,photo_id:a7.get("id"),lightbox:z()}}break;case"photo":if(Y.photo_id!==a7.get("id")||Y.context_id!==ay()||!!Y.lightbox!==z()){bc=true;a9={photo_id:a7.get("id"),pathalias:(a7.get("pathalias")?a7.get("pathalias"):a7.get("owner")),context_id:ay(),lightbox:z()}}break;default:if(Y.photo_id!==a7.get("id")||!!Y.lightbox!==z()){bc=true;a9={photo_id:a7.get("id"),lightbox:z()}}break}if(bc){if(ba){ab.historyManager.replaceState(a9,{title:bb})}else{ab.historyManager.pushState(a9,{title:bb})}}}}function al(){ab.log("updateUI","info","lightbox");var a7,bc,bf,bd,Y,a8,bh,bg,be,ba;a7=ay();bc=ae();bf=ab.ContextData.getContext(a7);if(!bf){return}k.one("#lightbox-prev").set("innerHTML","<span></span> "+ab.transjax.get("lightbox",((bf.type==="set"||bf.type==="faves"||bf.type==="gallery"||bf.type==="photolist"||bf.type==="contactsfaves")?"prev":"newer")));k.one("#lightbox-next").set("innerHTML",ab.transjax.get("lightbox",((bf.type==="set"||bf.type==="faves"||bf.type==="gallery"||bf.type==="photolist"||bf.type==="contactsfaves")?"next":"older"))+" <span></span>");C();a0();if(ab.config.flickr.lightbox.enable_lightbox_context_switcher){bd=k.one("#lightbox-context-list");Y=bf.title;if(bf.type==="set"){Y+=" (set)"}else{if(bf.type==="pool"){Y+=" (group)"}}bd.removeClass("error").removeClass("loaded").removeClass("loading").set("innerHTML",'<a class="Butt" href="'+bf.url+'"><span>▽</span> '+Y+"</a><ul></ul>")}a8=e();if(a8){be=a8.get("title")||aA;ba=ab.transjax.get("photo","window_title",be);T({replace:false,title:ba});if(ab.Lang.isString(ba)){c.set("title",ba);au=be}}bh=k.one("#lightbox-close");if(a8){bh.setAttribute("href",I(a8))}else{}bg=k.one("#lightbox-allsizes");if(a8){if(a8.get("media")==="video"){bg.setAttribute("href","#").removeClass("Butt").addClass("DisabledButt")}else{bg.setAttribute("href",ab.urls.get("photo",{photo:a8,context:ay(),sizes:true})).addClass("Butt").removeClass("DisabledButt")}}else{bg.setAttribute("href","#").addClass("Butt").removeClass("DisabledButt")}if(a8&&a8.get("media")==="video"&&o){aL(a8);var a9=94;var bb=setInterval(function(){if(!aE(a8)||--a9<=0){clearInterval(bb);aP()}},1000)}}function at(a7,Y){var a8=X(a7,Y);if(!aY(a7,Y)){if(!a8.hasClass("loading")&&!a8.hasClass("loaded")){a8.addClass("loading")}ab.ContextData.loadPhoto(a7,Y)}}function O(a8,Y){ab.log("open ("+a8+" / "+Y+")","info","lightbox");var a7;if(!ab.config.flickr.user.useragent_fully_supported){return}ab.contextManager.set("lightbox");if(!a4){am()}ab.one("body").addClass("lightbox");G=c.get("title");if(ab.UA.webkit){ab.all(".ad-lrec-ad").addClass("obscured")}if(O.waiting_for_context){O.waiting_for_context.detach();O.waiting_for_context=undefined}if(ab.ContextData.getContext()){if(a8){if(a8!==ab.ContextData.getContext().id){ab.ContextData.open(a8)}if(a8!==ay()){aj(a8)}}a8=ay();Y=ab.Lang.isNumber(Y)?Y:a1(a8);a6(a8,Y)}else{u(0);a7=arguments;O.waiting_for_context=ab.on("ContextData:contextAdded",function(){O.waiting_for_context.detach();O.waiting_for_context=undefined;O.apply(null,a7)});return}}function ak(a7){var bh;if(ab.Lang.isObject(a7)&&ab.Lang.isFunction(a7.get)){a7=a7.get("id")}if(!a7){return undefined}switch(aB){case"photo":if(ab.config.flickr.photo&&ab.config.flickr.photo.id){bh=ab.config.flickr.photo.id}if(!bh){return undefined}return(bh===a7);default:var be,bb,bd,bg,Y,bc,a8,ba,bf,a9;be=ab.ContextData.getContext(ay());bd=parseInt(be.prev_limit,10);bg=parseInt(be.total,10);if(!ab.Lang.isNumber(bd)||!ab.Lang.isNumber(bg)){return undefined}bb=ab.ContextData.getPhotoPosition(ay(),a7);bb=parseInt(bb,10);Y=ab.config.flickr.per_page||72;bc=bb-bd+1;a8=0-bd+1;ba=Math.ceil(a8/Y);bf=Y*(ba-1)+1;a9=bf+Y-1;if(a9>bg){a9=bg}return(bc>=bf&&bc<=a9)}}function U(bc,Y){ab.log("close ("+bc+" / "+Y+")","info","lightbox");var a7,ba,bb,a9,a8;if(ab.config.flickr.lightbox.enable_fullscreen){aI()}M();v();if(bc){aj(bc);if(ab.Lang.isNumber(Y)){aQ(bc,Y)}}bc=bc||ay();Y=ab.Lang.isNumber(Y)?Y:a1(bc);a7=0;while(!ba&&a7<200){ba=ab.ContextData.getPhoto(bc,Y);if(!ba){Y+=(Y<=0?1:-1);a7++}}if(aR||(ba&&!ak(ba))){a8=I(ba);if(aB==="photo"){aG(ba)}j(a8,false)}else{ab.one("body").removeClass("lightbox");bb=ab.DOM.docScrollX();a9=ab.DOM.docScrollY();an.scrollTo(bb,a9+1);an.scrollTo(bb,a9);c.set("title",G);if(ab.UA.webkit){ab.all(".ad-lrec-ad").removeClass("obscured")}ab.contextManager.unset("lightbox");ab.fire("lightbox:closed",{photo:ba});T({replace:false,photo:ba})}}function j(Y,a7){ab.contextManager.set("lightbox-redirecting");aW();u();if(a7&&f.replace){f.replace(Y)}else{f.href=Y}}function v(){if(ab.contextManager.get()==="lightbox-redirecting"&&an.stop){an.stop();aN();g();ab.contextManager.unset("lightbox-redirecting")}}function u(Y){if(!k){return}if(!ab.Lang.isNumber(Y)){Y=500}var a7=(new Date()).getTime()+Y;if(u.timeout){if(a7<u.next_spin_time){an.clearTimeout(u.timeout)}else{return}}u.next_spin_time=a7;u.timeout=an.setTimeout(function(){k.one("#lightbox-spinner").setStyle("display","block");u.timeout=undefined},Y)}function aN(){an.clearTimeout(u.timeout);u.timeout=undefined;k.one("#lightbox-spinner").setStyle("display","")}function z(){return(ab.contextManager.get().indexOf("lightbox")===0)}function ay(){if(!J&&ab.ContextData.getContext()){aj(ab.ContextData.getContext().id)}return J}function aj(Y){J=Y}function ae(){return a1(ay())||0}function e(){return ab.ContextData.getPhoto(ay(),ae())}function a5(){var ba,Y,a7,a8,a9,bd,bb,bc;a5.cache=a5.cache||{};ba=ay();Y=ae();a7=e();if(a7){a9=k.one("#lightbox-context-list");a8=a7.get("id");a9.removeClass("error").addClass("loading");bd="flickr.photos.getAllContexts";bb={photo_id:a8};bc={success:function(bk){a5.cache[a8]=bk;var bg={},bi,bj,bh,be,bf;if(ao(ba,Y)){a9.removeClass("loading").addClass("loaded");be="";bi=function(bm,bl){if(bg[bm]||ba===bm){return""}bg[bm]=bm;return'<li><a href="'+ab.urls.get("photo",{photo:a7,context:bm,lightbox:true})+'" data-context-id="'+bm+'">'+bl+"</a></li>"};be+=bi("photostream",(a7.get("is_owner")?"Your":ab.StringFilters.possess(a7.get("ownername")))+" Photostream");if(a7.get("is_fave")){bj=az();if(!ab.ContextData.getContext(bj)&&ak(a7)){ab.ContextData.add({id:bj,user_id:ab.config.flickr.user.nsid,type:"faves",title:ab.transjax.get("photo","your_favorites"),url:ab.config.flickr.user.photos_url+"favorites/",photos:{"0":a7}})}be+=bi(bj,"Your Favorites")}if(bh){be+=bi("contacts","Your Contacts")}if(bk.data.pool&&bk.data.pool.length){ab.Array.each(bk.data.pool,function(bl){be+=bi("pool-"+bl.id,bl.title+" (group)")})}if(bk.data.set&&bk.data.set.length){ab.Array.each(bk.data.set,function(bl){be+=bi("set-"+bl.id,bl.title+" (set)")})}bf=ab.ContextData.getPhotoPositions(a8);if(bf){ab.Object.each(bf,function(bm,bl){be+=bi(bl,ab.ContextData.getContext(bl).title)})}if(!be){be="<li>No other contexts are available</li>"}a9.one("ul").set("innerHTML",be)}},failure:function(be){if(ao(ba,Y)){a9.removeClass("loading").addClass("error")}}};if(a5.cache[a8]){bc.success(a5.cache[a8])}else{ab.flickrAPI.callMethod(bd,bb,bc)}}}function ac(){if(o){M()}else{aF()}}function aF(){var Y;o=true;k.one("#lightbox-play").addClass("playing");Y=X(ay(),ae());s(Y)}function M(){o=false;aq();k.one("#lightbox-play").removeClass("playing")}function aP(){if(o){aq();aP.timeout_handle=an.setTimeout(function(){if(o){a6(ay(),ae()+1)}},4000)}}function aq(){an.clearTimeout(aP.timeout_handle)}function s(Y){aq();if(Y.hasClass("loading")||Y.one("img.loading")){}else{aP()}}function I(a7){var Y=ab.urls.parse(aB,f.pathname);switch(aB){case"faves":return ab.urls.get("faves",{photo:a7,path_alias:Y.path_alias});case"group_pool":return ab.urls.get("group_pool",{photo:a7,group_id:Y.group_id,owner_id:Y.owner_id});case"gallery":return ab.urls.get("gallery",{photo:a7,path_alias:Y.path_alias,gallery_id:Y.gallery_id});case"contacts":return ab.urls.get("contacts",{photo:a7});case"contactsfaves":return ab.urls.get("contactsfaves",{photo:a7});case"photostream":return ab.urls.get("photostream",{photo:a7,path_alias:Y.path_alias});default:return ab.urls.get("photo",{photo:a7,context:ay()})}}function av(Y){ab.log("handleFullScreenChange","info","lightbox");if(aH==="opening"){aH="open"}else{aH="closed"}}function ah(){if(aH==="open"){aI()}else{if(aH==="closed"){K()}}}function K(){ab.log("enterFullScreen","info","lightbox");if(aH==="closed"){if(B.body.webkitRequestFullScreen){aH="opening";B.body.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}}function aI(){ab.log("exitFullScreen","info","lightbox");if(aH==="open"){if(B.webkitCancelFullScreen){aH="closing";B.webkitCancelFullScreen()}}}var W={};var aJ={};var E={};function S(a8){var a7,Y;if(!a8||!a8.get("id")||a8.get("is_owner")||W[a8.get("id")]||aJ[a8.get("id")]||E[a8.get("id")]){return false}Y=ab.urls.parse(aB,f.pathname);switch(aB){case"faves":a7=ab.urls.get("faves",{photo:a8,path_alias:Y.path_alias});break;case"group_pool":a7=ab.urls.get("group_pool",{photo:a8,group_id:Y.group_id,owner_id:Y.owner_id});break;case"gallery":a7=ab.urls.get("gallery",{photo:a8,path_alias:Y.path_alias,gallery_id:Y.gallery_id});break;case"contacts":a7=ab.urls.get("contacts",{photo:a8});break;case"contactsfaves":a7=ab.urls.get("contactsfaves",{photo:a8});break;case"photostream":a7=ab.urls.get("photostream",{photo:a8,path_alias:Y.path_alias});break;default:if(ak(a8)){return false}if(!S.previous_referrer_path){S.previous_referrer_path=ab.urls.get("photo",{photo:ab.ContextData.getPhoto(ay(),0),context:ay(),lightbox:true})}a7=S.previous_referrer_path;S.previous_referrer_path=ab.urls.get("photo",{photo:a8,context:ay(),lightbox:true});break}a2({photo_id:a8.get("id"),path:a7})}function a2(Y){W[Y.photo_id]=Y;if(!r.handle){r.handle=an.setTimeout(function(){r.handle=undefined;r()},750)}}function g(){aG(null)}function aG(a8){var a7,Y;a7="flignoreview";Y={domain:".flickr.com",path:"/",expires:(new Date((new Date()).getTime()+1000*60*5))};if(a8&&a8.get("id")){ab.Cookie.set(a7,a8.get("id"),Y)}else{ab.Cookie.remove(a7,Y)}}function aW(){if(r.handle){an.clearTimeout(r.handle);r()}}function r(){var a7,Y,a8,bd,bc,a9,bb,ba;a7=ab.config.flickr.max_photo_ids_per_api_call;Y=W;W={};a8=ab.Object.keys(Y);if(a7&&a7<a8.length){ab.Array.each(a8,function(bf,be){if(be>=a7){a2(Y[bf]);Y[bf]=undefined;delete Y[bf]}})}ab.mix(aJ,Y);bc="flickr.photos.addView";bd=ab.Object.values(Y);a9={views:ab.JSON.stringify(bd)};bb={success:function(be){ab.mix(E,Y);ba()},failure:function(be){ba()}};ba=function(){ab.Object.each(Y,function(be,bf){aJ[bf]=undefined;delete aJ[bf]})};ab.flickrAPI.callMethod(bc,a9,bb)}function aL(a7){if(!h[a7.get("id")]){return}var Y=h[a7.get("id")];if(!aE(a7)&&typeof Y.playVideo==="function"){try{Y.playVideo()}catch(a8){}}}function b(a8,a9){if(!h[a8.get("id")]){return}var a7=h[a8.get("id")];if(aE(a8)&&typeof a7.pauseVideo==="function"){a7.pauseVideo()}else{if(a9){var Y=200;var ba=setInterval(function(){if(--Y<=0){clearInterval(ba)}if(typeof a7.pauseVideo==="function"){clearInterval(ba);a7.pauseVideo()}},100)}}}function aE(a7){if(!h[a7.get("id")]){return false}var Y=h[a7.get("id")];if(typeof Y.getIsPlaying==="function"&&Y.getIsPlaying()){return true}return false}function aY(a7,Y){return N[a7]&&N[a7][Y]}function aw(a8,Y,a7){if(!ab.Lang.isBoolean(a7)){a7=true}if(a7){if(!N[a8]){N[a8]={}}N[a8][Y]=true}else{if(aY(a8,Y)){delete N[a8][Y]}}}ab.lightbox={open:O,isOpen:z,getOpenPhoto:e,getOpenContext:ay,getOpenPosition:ae};p();if(F.actionQueue){F.actionQueue.lightbox={open:O};F.actionQueue.module_loaded("lightbox")}},"0.0.1",{requires:F.config.modules.lightbox.requires||[],optional:F.config.modules.lightbox.optional||[]});YUI.add("flickr-tagrs-transjax",function(a){a.transjax.add("flickr-tagrs",{tagrs_ok:'OK',tagrs_tag_not_added:'Tag not added!',tagrs_tag_not_deleted:'Tag not deleted!',tagrs_max_limit:"Hey! It looks like you're trying to add more than %s tags. Unfortunately, there's a limit of %s tags per item.",tagrs_max_limit_short:"You've entered more than %s tags, which is the maximum number allowed.",tagrs_click_icon_all_public:'Click this icon to see everything on Flickr tagged with %s',tagrs_delete_this_tag:'Delete this tag?',tagrs_are_you_sure_delete:'Are you sure you want to delete the tag %s?',tagrs_get_more_your_tags:'get more of your tags',tagrs_get_all_your_tags:'get all of your tags',tagrs_tags_not_loaded:'Tags not loaded!',tagrs_choose_from_tags:'Choose from your tags',tagrs_click_a_tag:'click a tag:',tagrs_no_tags_yet:'You have no tags yet.',tagged_by_you:'Added by You',tagged_by_user:'Added by %s',tagged_by_someone:'Added by a Flickr Member',loading:'Loading...'})},"0.0.1",{requires:["transjax-base"]});YUI.add("query-string-args",function(f){var e=false,c={};function d(){var k=location.search.substring(1).split("&");for(var h=0;h<k.length;h++){var l=k[h].indexOf("=");if(l!==-1){var g=k[h].substring(0,l);var j=k[h].substring(l+1);c[g]=unescape(j)}}e=true}function b(g){if(!f.Lang.isString(g)){return}if(!e){d()}return c[g]}function a(){if(!e){d()}return c}f.queryStringArgs={get:b,get_all:a}},"0.0.1",{requires:[]});YUI.add("flickr-tagrs",function(b){var m="flickr-tagrs";var e=new RegExp("^(.+):(.+)=(.+)$");function o(r){if(r){r.setStyle("display","block")}}function h(r){if(r){r.setStyle("display","none")}}function n(){var r=[m].concat(Array.prototype.slice.apply(arguments));return b.transjax.get.apply(this,r)}function d(r){if(typeof r==="undefined"){return r}return b.Lang.trim(r)}var f=null,l=null;function k(A,D,u,C){var v=D||75,B=u||"\n",z=C||false,y,x,w,E,t;for(y=-1,w=(t=A.split(/\r\n|\n|\r/)).length;++y<w;t[y]+=E){for(E=t[y],t[y]="";E.length>v;t[y]+=E.slice(0,x)+((E=E.slice(x)).length?B:"")){x=z===2||(x=E.slice(0,v+1).match(/\S*(\s)?$/))[1]?v:x.input.length-x[0].length||z===1&&v||x.input.length+(x=E.slice(v).match(/^\S*/)).input.length}}return t.join("\n")}function p(r){return k(r,40,'<span class="breaking-non-space"> </span>',true)}function j(){var s=this,r;this.dialog_html=null;this.tag_box_id="tagadder";this.attached_events=false;this.tagger_content=null;r=b.one(this.tag_box_id);this.add_a_tag=function(){b.tagRS.tagrs_showForm();s.attach_events()};this.show_dialog=function(t){r.setStyle("display","block")};this.attach_events=function(){if(s.attached_events){}s.attached_events=true;b.all("a.tagrs_showpopular").each(function(){this.on("click",function(u){b.tagRS.tagrs_showPopular(35,b.config.flickr.photo.id);u.halt()})});function t(u){b.tagRS.tagrs_addTag(b.config.flickr.photo.id,b.one("#addtagbox").get("value"));u.halt();return false}if(b.one("#tagadderform")){b.one("#addtagbox").on("blur",function(u){b.tagRS.tagrs_updatePopularList(b.config.flickr.photo.id)});b.one("#tagadderform").on("submit",t)}};s.attach_events()}function i(y){var t,s,r,x=null,v=null,w=[],u=null;y=d(y);if(y===""||typeof y==="undefined"){return w}if(y.indexOf(",")!==-1){u=y.split(",");for(t=0;t<u.length;t++){r=d(u[t]);r=r.replace_global('"',"");if(r!==""){w.push(r)}}}else{u=y.split('"');for(t=0;t<u.length;t++){x=d(u[t]);if(t%2===0){v=x.split(" ");for(s=0;s<v.length;s++){if(v[s]!==""){w.push(v[s])}}}else{if(x!==""){w.push(x)}}}}return w}function a(t,s,r){return t.split(s).join(r)}function g(r){return a(r,"<","&lt;")}function q(y){if(!y){return null}var t=[],s=(y.indexOf("?")),w=(s!==-1?y.substring(s+1):y).split("&"),u,x,r,v;for(u=0;u<w.length;u++){x=w[u].indexOf("=");if(x!==-1){r=w[u].substring(0,x);v=w[u].substring(x+1);t[r]=unescape(v)}}return t}b.tagRS={hover_enabled:null,disable_hover_timer:null,enable_hover_timer:null,hover_delay:1000,tagrs_popular:[],tagged_by:true,old_machine_tags:null,global_tag_limit:null,tags:[],tags_raw:[],tags_id:[],tags_name:[],tags_is_owner:[],tags_can_delete:[],assigned_popular_events:false,unsupported:(b.UA.ie&&b.UA.ie<8),last_input_value:null,tag_dialog:null,addTag:function(s,r){this.tags.push(s);this.tags_raw.push(r)},rebuild_tags_for_photo:function(s,w){if(b.config.flickr.photo.id!==s){return}this.tags=[];this.tags_raw=[];this.tags_id=[];this.tags_name=[];this.tags_is_owner=[];this.tags_can_delete=[];var u=null,C=null,z=null,r=null,y=null,x=null,v=null,A=null,B;for(B=0;B<w.length;B++){u=w[B];C=u._content;z=u.raw;r=u.id;y=(u.author_name!==null?u.author_name:"");x=(u.author!==null?u.author:"");v=(b.config.flickr.photo.isOwner||b.config.flickr.user.nsid===x)?true:false;A=(b.config.flickr.user.nsid===x)?true:false;this.tags.push(C);this.tags_raw.push(z);this.tags_id.push(r);this.tags_name.push(y);this.tags_is_owner.push(A);this.tags_can_delete.push(v)}},tagrs_showForm:function(){var r=b.one("#photo-sidebar-tags");if(r&&b.one("#addtagbox")){r.addClass("open");r.vis.animScrollIntoView(true,100);b.one("#addtagbox").focus();this.tagrs_startAutoComplete()}},tagrs_startAutoComplete:function(){var r=this;if(b.config.flickr.flags.enable_tag_selecta){b.use("tag-selecta",function(u){var t=new u.TagSelecta("#addtagbox",{maxResultsDisplayed:5,fetchDataImmediately:true,loadTransparently:true,focusOnFetch:false,selectFirstItem:false,allowFormSubmit:true,hideNoTagsMessage:true});t.on(["TagSelecta:resultSelect","TagSelecta:resultClick"],function(v){t.skip(v);u.tagRS.tagrs_addTag(u.config.flickr.photo.id,v.tagClean)});u.Array.each(r.tags,function(v){t.skip(v)})})}else{if(b.one("#tagSuggestions")&&window.TagCompleteWidget){var s=new TagCompleteWidget(b.one("#addtagbox"),b.one("#tagSuggestions"),b.config.flickr.user.nsid);s.completer.startLoading()}}this.tagrs_startAutoComplete=function(){}},tagrs_hideForm:function(){this.tagrs_clearForm();b.one("#photo-sidebar-tags").removeClass("open")},tagrs_clearForm:function(){var r=b.one("#addtagbox");if(r&&r.get("value")){last_input_value=r.get("value");r.set("value","")}},tagrs_addTag:function(t,r){if(r===""){return false}this.tagrs_clearForm();var s=b.one("#tagadder"),v={};function u(z){var y=(z.data.stat==="ok");function x(E){var I=(E.data.stat==="ok"),G,A,F="",D="",C=0,H=0,B;if(I){G=E.data.photo.tags.tag;b.tagRS.rebuild_tags_for_photo(b.config.flickr.photo.id,G);A=b.config.flickr.photo;for(var J=0;J<G.length;J++){if(e.test(G[J].raw)){H++;D+=b.tagRS.tagrs_rebuildTagsHTML(b.config.flickr.photo.id,b.tagRS.tags_id[J],b.tagRS.tags[J],b.tagRS.tags_raw[J],b.tagRS.tags_name[J],b.tagRS.tags_is_owner[J],b.tagRS.tags_can_delete[J],(J===G.length-1))}else{C++;F+=b.tagRS.tagrs_rebuildTagsHTML(b.config.flickr.photo.id,b.tagRS.tags_id[J],b.tagRS.tags[J],b.tagRS.tags_raw[J],b.tagRS.tags_name[J],b.tagRS.tags_is_owner[J],b.tagRS.tags_can_delete[J],(J===G.length-1))}}if(!b.one("#thetags")){B=document.createElement("ul");B.id="thetags";b.one("#tags-box").appendChild(B)}b.one("#thetags").set("innerHTML",F);h(b.one("#thetags"));if(b.one("#themachinetags")){b.one("#themachinetags").set("innerHTML",D)}b.tagRS.tagrs_toggle_displays(C,H);o(b.one("#thetags"));b.tagRS.assign_pop_and_delete_handlers()}}if(y){b.flickrAPI.callMethod("flickr.photos.getInfo",{photo_id:t},x)}else{var w=b.transjax.get("tagrs_tag_not_added");if(z.data.code===2){w=n("tagrs_max_limit_short",b.tagRS.global_tag_limit,b.tagRS.global_tag_limit);b.one("#addtagbox").set("value",last_input_value);b.global_dialog.create_dialog('<div class="bd"><p>'+w+'</p><div><p style="margin-top:0.5em"><button id="tag-limit-ok" class="Butt">'+n("ok").toUpperCase()+"</button></p></div></div>");b.one("#tag-limit-ok").on("click",function(){b.global_dialog.hide()});b.global_dialog.show()}}}b.flickrAPI.callMethod("flickr.photos.addTags",{photo_id:t,tags:r},{success:u,failure:u});return false},tagrs_rebuildTagsHTML:function(t,u,B,z,A,r,s,x){var w=e.test(z),v='<li id="tagdiv'+u+'" class="tag-element'+(s?" can_delete":"")+(x?" last":"")+(w?" stats":"")+'">'+(!w?'<span class="tag-wrapper">':""),y;y=' class="tag-item ywa-track" data-ywa-name="Tag(s)" data-tag="'+B+'" data-photo-owner-screenname="'+A+'"';if(b.tagRS.tagged_by){if(r){v+='<a href="'+b.config.flickr.photo.ownersUrl+"tags/"+B+'/" '+y+">"+p(g(z))+"</a>"}else{if(A!==""){v+='<a href="'+b.config.flickr.photo.ownersUrl+"tags/"+B+'/" title="'+n("tagged_by_user",g(A))+'"'+y+">"+p(g(z))+"</a>"}else{v+='<a href="'+b.config.flickr.photo.ownersUrl+"tags/"+B+'/" title="'+n("tagged_by_someone")+'"'+y+">"+p(g(z))+"</a>"}}}else{v+='<a href="'+b.config.flickr.photo.ownersUrl+"tags/"+B+'/"'+y+">"+p(g(z))+"</a>"}if(s){v+='<a href="'+b.config.flickr.photo.url+"?magic_cookie="+b.config.flickr.magic_cookie+"&deletetag="+u+'" title="'+n("tagrs_delete_this_tag")+'" class="tag_delete delete-x"><span>[x]</span></a>'}else{}v+=(!w?"</span>":"")+"</li>";return v},tagrs_removeTag:function(v,t,s,u){function r(z){if(z.data.stat==="ok"){b.tagRS.tagrs_removedTag(v,t,s)}else{var x=z.data,w=n("tagrs_tag_not_deleted"),y=(typeof x.err!=="undefined"?x.err:null);if(y&&y[0].msg){w+=" "+y[0].msg}b.log("removeTag fail?")}}if(window.confirm(n("tagrs_are_you_sure_delete",decodeURIComponent(u)))){b.flickrAPI.callMethod("flickr.photos.removeTag",{tag_id:t},r);return false}else{return false}},tagrs_removedTag:function(v,x,B){var w=0,A=0,t,z=0,y=b.one("#tagdiv"+x);h(y);if(b.one("#thetags")){t=b.all("#thetags li");t.each(function(){if(this.getStyle("display")!=="none"){w++}})}if(b.one("#themachinetags")){t=b.all("#themachinetags li");t.each(function(){if(this.getStyle("display")!=="none"){A++}})}b.tagRS.tagrs_toggle_displays(w,A);b.tagRS.tagrs_setPopularUnUsedIfNotInInput(B);var u=b.tagRS.tagrs_whereIsThisTagInHere(b.tagRS.tags,B),s=0;for(s=0;s<u.length;s++){b.tagRS.tags.splice(u[s],1);b.tagRS.tags_raw.splice(u[s],1)}y.remove()},tagrs_clearTags:function(){b.one("#thetags").set("innerHTML","")},tagrs_updatePopularList:function(s){var x=b.one("#addtagbox"),v=[],u=((b.config.flickr.photo&&b.tagRS.tags)?b.tagRS.tags:[]),r=((b.config.flickr.photo&&b.tagRS.tags_raw)?b.tagRS.tags_raw:[]),z=0,B,w,A,y;if(x.value){v=i(x.value)}else{}for(z=0;z<b.tagRS.tagrs_popular.length;z++){B=b.tagRS.tagrs_popular[z];w=b.tagRS.tagrs_whereIsThisTagInHere(u,B);A=b.tagRS.tagrs_whereIsThisTagInHere(r,B);y=b.tagRS.tagrs_whereIsThisTagInHere(v,B);if(w.length===0&&A.length===0&&y.length===0){b.tagRS.tagrs_setPopularUnUsed(B)}else{b.tagRS.tagrs_setPopularUsed(B)}}},tagrs_showPopular:function(u,t){var s=b.one("#addtagbox"),r=[],x,v;if(s.value){r=i(s.value)}u=(u===undefined)?35:u;x=b.one("#tagpopular");v=null;x.set("innerHTML","<i>"+n("loading")+"</i>");function w(C){var D=C.data,G=(D.stat==="ok"),y,I,z,H,A,F,E,B;if(G){b.tagRS.tagrs_popular=[];y=D.who.tags.tag;if(y.length===0){v=n("tagrs_no_tags_yet")}else{I=null;z=null;v=n("tagrs_click_a_tag");for(H=0;H<y.length;H++){z=y[H];I=z._content;b.tagRS.tagrs_popular.push(I);v+=' <a href="#" id="popTags'+I+'" class="pop-tag tag-item">'+I+"</a>"}if(y.length>u){v+='<br><br><a id="tagrs_show_more" href="#">'+n("tagrs_get_more_your_tags")+'</a> | <a href="#" id="tagrs_show_all">'+n("tagrs_get_all_your_tags")+"</a>"}}x.set("innerHTML",v);A=b.one("#tagrs_show_more");if(A){A.on("click",function(J){b.tagRS.tagrs_showPopular(u+35,b.config.flickr.photo.id);J.halt();return false})}F=b.one("#tagrs_show_all");if(F){F.on("click",function(J){b.tagRS.tagrs_showPopular(u+2000,b.config.flickr.photo.id);J.halt();return false})}b.tagRS.tagrs_updatePopularList(t)}else{E=n("tagrs_tags_not_loaded");B=typeof(D.err!=="undefined"?D.err:null);if(B&&B[0].msg){E+=" "+B[0].msg}alert(E)}b.tagRS.assign_pop_and_delete_handlers()}b.flickrAPI.callMethod("flickr.tags.getListUserPopular",{count:u+1},w)},tagrs_setPopularUsed:function(r){var s=b.one("#popTags"+r);if(!s){b.log("could not find #popTags"+r);return}s.replaceClass("tagrsUnUsed","tagrsUsed")},tagrs_setPopularUnUsed:function(r){var s=b.one("#popTags"+r);if(!s){b.log("could not find #popTags"+r);return}s.replaceClass("tagrsUsed","tagrsUnUsed")},tagrs_setPopularUnUsedIfNotInInput:function(r){var u=b.one("#popTags"+r),t,s,v;if(!u){return}t=b.one("#addtagbox");s=i(t.value);v=b.tagRS.tagrs_whereIsThisTagInHere(s,r);if(v.length>0){return}b.tagRS.tagrs_setPopularUnUsed(r)},tagrs_toggleTagInInput:function(u,w){var x=((b.config.flickr.photo&&b.tagRS.tags)?b.tagRS.tags:[]),A=b.one("#addtagbox"),y=[],v,B="",s,z,C;if(A.get("value")){y=i(A.get("value"))}v=b.tagRS.tagrs_whereIsThisTagInHere(y,u);if(v.length===0){if(b.tagRS.tagrs_whereIsThisTagInHere(x,u).length===0){y.unshift(u)}b.tagRS.tagrs_setPopularUsed(u)}else{for(s=0;s<v.length;s++){y.splice(v[s],1)}b.tagRS.tagrs_setPopularUnUsed(u)}z=b.one("#popTags"+u);if(z){z.blur()}B="";for(C=0;C<y.length;C++){B+=(y[C].indexOf(" ")===-1)?y[C]:'"'+y[C]+'"';if(C+1<y.length){B+=" "}}A.set("value",B)},tagrs_whereIsThisTagInHere:function(w,v){var s=[],u,r;for(u=0;u<w.length;u++){r=w[u];if(v.toLowerCase()===r.replace(" ","").toLowerCase()){s.unshift(u)}}return s},tagrs_toggle_displays:function(s,r){if(!s&&!r){o(b.one("#thetags"));h(b.one("#machine_tag_toggle"));h(b.one("#themachinetags"))}if(s&&!r){o(b.one("#thetags"));h(b.one("#machine_tag_toggle"));h(b.one("#themachinetags"))}if(!s&&r){h(b.one("#thetags"));h(b.one("#machine_tag_toggle"));o(b.one("#themachinetags"));h(b.one("#machine_tag_toggle_show"));h(b.one("#machine_tag_toggle_hide"))}if(s&&r&&b.tagRS.old_machine_tags!==r){o(b.one("#thetags"));o(b.one("#machine_tag_toggle"));o(b.one("#themachinetags"));h(b.one("#machine_tag_toggle_show"));o(b.one("#machine_tag_toggle_hide"))}if(b.one("#span_machine_tags_show_count")){b.one("#span_machine_tags_show_count").set("innerHTML",r)}if(b.one("#span_machine_tags_hide_count")){b.one("#span_machine_tags_hide_count").set("innerHTML",r)}b.tagRS.old_machine_tags=r},tagrs_toggle_machine_tags:function(){if(b.one("#machine_tag_toggle_show")&&b.one("#machine_tag_toggle_hide")){if(b.one("#machine_tag_toggle_show").getAttribute("display")==="none"){b.tagRS.tagrs_hide_machine_tags()}else{b.tagRS.tagrs_show_machine_tags()}}return false},tagrs_show_machine_tags:function(r){h(b.one("#machine_tag_toggle_show"));o(b.one("#machine_tag_toggle_hide"));o(b.one("#themachinetags"));r.halt();return false},tagrs_hide_machine_tags:function(r){o(b.one("#machine_tag_toggle_show"));h(b.one("#machine_tag_toggle_hide"));h(b.one("#themachinetags"));r.halt();return false},machine_tag_toggle_init:function(){if(b.one("#machine_tag_toggle_show")){b.one("#machine_tag_toggle_show").on("click",b.tagRS.tagrs_show_machine_tags);b.one("#machine_tag_toggle_hide").on("click",b.tagRS.tagrs_hide_machine_tags)}},assign_pop_and_delete_handlers:function(){b.all("#photo-sidebar-tags a").on("click",function(v){var w=null,r,u,s,t;if(v.currentTarget.hasClass("pop-tag")){w=v.currentTarget.get("innerHTML");b.tagRS.tagrs_toggleTagInInput(w,b.config.flickr.photo.id);v.preventDefault();return false}else{if(v.currentTarget.hasClass("tag_delete")){w=v.currentTarget.previous("a").get("innerHTML");r=v.currentTarget.get("href");u=q(r);s=null;if(u&&u.deletetag){s=u.deletetag}if(s){t=decodeURI(v.currentTarget.previous("a").getAttribute("data-tag"));b.tagRS.tagrs_removeTag(b.config.flickr.photo.id,s,w,'"'+t+'"');v.halt();return false}}}})},init:function(s){if(typeof s!=="undefined"){this.old_machine_tags=(typeof s.old_machine_tags!=="undefined"?s.old_machine_tags:0);this.global_tag_limit=(typeof s.global_tag_limit!=="undefined"?s.global_tag_limit:999)}if(!b.one("#photo-sidebar-tags")){return false}if(!this.tag_dialog){this.tag_dialog=document.createElement("div");var u=document.getElementById("tag-global-search-template").innerHTML;u=u.replace("<!--","").replace("-->","");this.tag_dialog.innerHTML=u}function y(z){b.modalTagRS.add_a_tag();z.preventDefault()}b.all("#tagadderlink a.tagadderlink").on("click",y);b.tagRS.assign_pop_and_delete_handlers();b.tagRS.machine_tag_toggle_init();function t(){if(!b.tagRS.hover_enabled){b.tagRS.enable_hover_timer=null;var z=b.one("#photo-sidebar-tags");if(!z){return false}z.addClass("hover_enabled");b.tagRS.hover_enabled=true}}function v(){if(b.tagRS.hover_enabled){var z=b.one("#photo-sidebar-tags");if(!z){return false}z.removeClass("hover_enabled");b.tagRS.hover_enabled=false}}function w(z){if(!this.contains(z.relatedTarget,this)){if(b.tagRS.disable_hover_timer){window.clearTimeout(b.tagRS.disable_hover_timer);b.tagRS.disable_hover_timer=null}if(!b.tagRS.hover_enabled&&!b.tagRS.enable_hover_timer){b.tagRS.enable_hover_timer=window.setTimeout(t,b.tagRS.hover_delay)}}}function x(z){if(!this.contains(z.relatedTarget,this)){if(b.tagRS.enable_hover_timer){window.clearTimeout(b.tagRS.enable_hover_timer);b.tagRS.enable_hover_timer=null}if(b.tagRS.hover_enabled&&!b.tagRS.disable_hover_timer){v()}}}b.one("#thetags-wrapper").on("mouseover",w);b.one("#thetags-wrapper").on("mouseout",x);b.one("#themachinetags-wrapper").on("mouseover",w);b.one("#themachinetags-wrapper").on("mouseout",x);function r(J,D,I){var A=0,G=16,E=4,z=b.DOM.winWidth(),H=J.getXY()[0],F,C,B,K;offset=parseInt((-f/2)+(D.get("offsetWidth")/2)+A,10);if((H+f)>(z-E)){F=offset;offset-=((H+f)-z)+E;K=J.one(".wedge");K.setStyle("marginLeft",(F-offset-16)+"px")}J.setStyle("marginLeft",offset+"px");C=parseInt(J.get("offsetHeight"),10);B=(Math.max(60,(C+G))*-1);if(C){J.setStyle("marginTop",B+"px")}}if(!b.tagRS.unsupported){b.delegate("mouseover",function(E){var z=E.target,F,B,C,H,A,D,I,J,G;F=E.target.ancestor("li");if(!F){return true}else{F=F.one("div.tag-global-search")}if(!F){H=b.one(document.createElement("div"));C=b.tagRS.tag_dialog.innerHTML;H.set("innerHTML",C);A=H.one("a.user_tag_search");A.setAttribute("href",E.target.get("href"));A.setAttribute("title",A.get("title").replace("%s",'"'+E.target.get("innerHTML")+'"'));A.setAttribute("title",A.get("title").replace("%s",E.target.getAttribute("data-photo-owner-screenname")));D=H.one("a.global_tag_search");D.setAttribute("href","/photos/tags/"+E.target.getAttribute("data-tag")+"/");D.setAttribute("title",D.get("title").replace("%s",'"'+E.target.get("innerHTML")+'"'));I=H.one(".added-by");J=(z.getAttribute("title")||z.getAttribute("data-addedby"));if(J){I.set("innerHTML",J)}I.setStyle("display",J?"block":"none");G=E.target.ancestor("li").appendChild(H.one("div"));r(H,z,E);F=b.one(G)}if(!F.hasClass("repositioned")){if(!f){f=F.get("offsetWidth");l=F.get("offsetHeight")}if(z.get("title")!==""){z.setAttribute("data-addedby",z.get("title"));z.set("title","")}if(!f){return true}r(F,z,E);F.addClass("repositioned")}},"#photo-sidebar-tags","a.tag-item")}else{b.one("#photo-sidebar-tags").addClass("hover_disabled")}}};var c={};b.modalTagRS=new j()},"0.0.1",{requires:["event","event-delegate","node","photo","query-string-args","node-visibility","flickr-tagrs-transjax"]});YUI.add("photo-sidebar-not-owner-transjax",function(a){a.transjax.add("photo-sidebar-not-owner",{svn_bump:"",saving:'Saving...',api_success:'Success!',api_failure:'There was a problem saving that setting. Please reload the page and try again.',photo_flagged:'This photo has been flagged',video_flagged:'This video has been flagged'})},"0.0.1",{requires:["transjax-base"]});YUI.add("photo-sidebar-not-owner",function(a){function g(k){if(!a.Lang.isObject(k)){k={}}a.all("#flag-this-photo-link").on("click",j);a.delegate("click",i,"body","#global_dialog .owner-submit");a.delegate("click",f,"body","#global_dialog .owner-cancel");return{}}function j(k){k.preventDefault();a.global_dialog.remove_existing_dialog();a.global_dialog.show({loading:true,modal:true});switch(k.target.get("id")){case"flag-icon":case"flag-this-photo-link":case"flag-display":e("/fragment.gne?name=photo_flag_fragment&photo="+a.config.flickr.photo.id,c);break}}function i(k){k.preventDefault();switch(k.target.get("id")){case"flag-photo-submit":h("flickr.moderation.flagPhoto",d(),null,a.one("#flag-display"),b);break}}function f(k){k.preventDefault();a.global_dialog.remove_existing_dialog();a.global_dialog.hide()}function e(k,n,m){m=m||300;var l={on:{}};l.on.success=function(r,q,p){a.global_dialog.remove_existing_dialog();a.global_dialog.create_dialog(q.responseText,{width:m}).show({loading:false,modal:true});n(r,q,p)};a.io(k,l)}function h(p,m,k,o,n){a.global_dialog.remove_existing_dialog();a.global_dialog.show({loading:true,modal:true});a.flickrAPI.callMethod(p,m,{success:function(r,q){l(true,r.params)},failure:function(r,q){l(false,r.params)}});function l(s,r){var q='<span class="short-msg-'+(s?"success":"warning")+'"></span>';var t=a.transjax.get("photo-sidebar-not-owner",s?"api_success":"api_failure");a.global_dialog.remove_existing_dialog();a.global_dialog.create_dialog(q+t,{width:"auto"}).show({loading:false,modal:true,short_message:true});setTimeout(function(){a.global_dialog.hide()},2500);n(s,r,k,o)}}function c(m,l,k){}function d(){var k=a.one("#flag-checkbox").get("checked");var l={photo_id:a.config.flickr.photo.id};if(k){l.offensive="1"}return l}function b(m,l,k,n){if(l.offensive==="1"){n.set("innerHTML",a.transjax.get("photo-sidebar-not-owner",a.config.flickr.photo.is_video?"video_flagged":"photo_flagged"))}}a.photoSidebarNotOwner=g},"0.0.1",{requires:["photo-sidebar","gallery-flickr-api","photo-sidebar-not-owner-transjax","global-dialog"]});YUI.add("photo-geolocation-transjax",function(a){a.transjax.add("photo-geolocation",{error_cant_save_location_woops:"Woops. We could not save your location. Please try again a little later.",error_cant_save_location_homer:"Oh dear. We could not save your location. Please try again a little later.",message_edit_photo_by_drag_pinwin_instruction:"To update this photo's location, drag-and-drop the thumbnail on to a new spot on the map",message_your_photo_is_currently_in:"Your photo is currently in",message_add_photo_by_drag_pinwin_instruction:"Drag-and-drop this photo to choose a location",error_map_cant_load:"D'oh. The map could not be loaded. Please try again later.",error_could_not_update_page:"D'oh. There was a problem updating the page. If you would like, you can refresh your browser to see your shiny new photo location.",error_problem_api:"Oh dear. There seems to be a problem. Would you please try again in a little while.",label_geoperms_template_map_anyone:"Anyone can see where it was taken",label_geoperms_template_map_contacts:"Only your contacts can see where it was taken",label_geoperms_template_map_friends_family:"Only your friends and family can see where it was taken",label_geoperms_template_map_friends:"Only your friends can see where it was taken",label_geoperms_template_map_family:"Only your family can see where it was taken",label_geoperms_template_map_you:"Only you can see where it was taken",link_view_larger_map:"View on a larger map",link_see_nearby_photos:"See nearby photos and videos",message_geofences_upsell_title:"More options for geo privacy",message_geofences_upsell:'Flickr allows you to create hotspots called <b>geofences</b> with specific privacy settings. These are useful for locations such as "home" or "school" or anywhere else you would like to make more private than your global default. Check out your geo privacy page in Your Account Settings for details.',button_visit_settings_page:"VISIT SETTINGS PAGE",button_close:"CLOSE",message_here_be_draggons:"Here be dragons",message_locatio_was_removed:"The location information has been removed from this photo.",message_loading:"Loading...",message_searching:"Searching...",exif_optin_message:"Would you like to place all future uploads with location data on a map?",yes:"YES",no:"NO"})},"0.0.1",{requires:["transjax-base"]});YUI.add("photo-geolocation",function(e){var l=e.YUI2,c=2,a=900,k="story-geopanel",m=null,r="/photo_geopanel_fragment.gne",g=30000,p=null,q={},n={get:function(){},set:function(){}},h={};e.config.geolocation={};function i(){e.io(r,{method:"POST",data:"",timeout:g,on:{success:function(t,v,A){m=e.one(document.getElementById(k));m.set("innerHTML",v.responseText);m.one("div.close").on("click",function(){e.global_dialog.hide();e.contextManager.unset("map-modal");if(e.config.geolocation.prompt_for_geo_exif_when_closing_map){f()}else{if(e.config.geolocation.prompt_for_geo_exif_pref_when_closing_map){d()}else{if(e.config.geolocation.prompt_for_geofence_when_closing_map){j()}}}});n=new e.FlickrMap();var u=n.getDefaultPhotoData("geo"),z=n.getDefaultPhotoData("woe"),B=n.getDefaultPhotoData("sizes");n.set("photo",{id:e.config.flickr.photo.id,geo:u,woe:z,sizes:B,is_owner:n.getDefaultPhotoData("is_owner")});n.set("_centerVisible",true);var y=m.one(".map"),C=m.hasClass("editing"),s=(u&&e.Lang.isNumber(u.latitude)&&e.Lang.isNumber(u.longitude)),w=(z),x=m.one("input[name=visitor_alpha2countrycode_from_ip]");n.set("visitor_alpha2countrycode_from_ip",x.getAttribute("value"));e.global_dialog.show();n.on("flickrMap:apiFailure",function(){var D=e.transjax.get("photo-geolocation","error_problem_api");e.global_dialog.create_alert_dialog(D,function(){return true})});n.on("flickrMap:setInteractive",function(){e.photoGeolocation.dissableLocationSearch(!n.get("interactive"))});if(e.config.flickrMap.enable_sidebar_zeus_map){n.on("flickrMap:locationPickerDragEnd",function(){e.photoGeolocation.promptForWoeCorrection(n.get("temp_location"),n.get("temp_accuracy"),{viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(n.get("location_source")===1)?1:0,edit_mode:n.get("edit_mode")})});n.on("flickrMap:mapZoomLevelChanged",function(){if(e.photoGeolocation.isEditable()){e.photoGeolocation.promptForWoeCorrection(n.get("temp_location"),n.get("temp_accuracy"),{viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),edit_mode:n.get("edit_mode"),force_accuracy:false,force_location:false})}});n.on("flickrMap:easter-egg-search",function(D){e.photoGeolocation.promptForWoeCorrection(D.location,D.accuracy,{viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,edit_mode:n.get("edit_mode"),center_map:true});n.destroyDialog()})}n.on("flickrMap:locationSelected",function(D){var E=n.geoPermissionMap[D.perm_viewgeo];E.photo_id=e.config.flickr.photo.id;e.flickrAPI.callMethod("flickr.photos.geo.setLocation",{photo_id:e.config.flickr.photo.id,lat:D.geo.latitude,lon:D.geo.longitude,accuracy:D.geo.accuracy},{success:function(G){e.flickrAPI.callMethod("flickr.photos.geo.setPerms",E,{success:function(J){e.photoGeolocation.enableLoadingState(false);n.setDefaultPhotoData("geo",n.get("photo.geo"));n.setDefaultPhotoData("woe",n.get("photo.woe"));n.setDefaultPhotoData("perm_viewgeo",n.get("perm_viewgeo"));n.set("photo.sizes",n.getDefaultPhotoData("sizes"));var I=n.getDefaultPhotoData("geo"),H=n.getDefaultPhotoData("woe");if(e.config.flickrMap.enable_sidebar_zeus_map){n.hideDialog()}e.photoGeolocation.disableEditMode();if(n.get("photo.updateWoeId")||n.get("photo.batch")){if(!n.get("photo.batch")){e.flickrAPI.callMethod("flickr.photos.geo.correctLocation",{photo_id:e.config.flickr.photo.id,woe_id:H.woeid})}else{e.flickrAPI.callMethod("flickr.photos.geo.batchCorrectLocation",{lat:I.latitude,lon:I.longitude,accuracy:I.accuracy,woe_id:H.woeid})}}e.photoGeolocation.syncGeopanelPhotoInfo();e.photoGeolocation.syncPhotoPage()},failure:function(I){var H=e.transjax.get("photo-geolocation","error_cant_save_location_woops");e.photoGeolocation.enableLoadingState(false);e.global_dialog.set_spinner(false);e.global_dialog.create_alert_dialog(H,function(){return true})}})},failure:function(H){var G=e.transjax.get("photo-geolocation","error_cant_save_location_homer");e.photoGeolocation.enableLoadingState(false);e.global_dialog.set_spinner(false);e.global_dialog.create_alert_dialog(G,function(){return true})}})});n.on("flickrMap:locationRemoved",function(D){n.setDefaultPhotoData("geo",{});n.setDefaultPhotoData("woe",null);e.photoGeolocation.syncPhotoPage();e.contextManager.unset("map-modal");e.global_dialog.create_alert_dialog(e.transjax.get("photo-geolocation","message_locatio_was_removed"),function(){return true})});n.on("flickrMap:centerInView",function(){var D=m.one(".edit-instruction");if(D){D.set("innerHTML",e.transjax.get("photo-geolocation","message_edit_photo_by_drag_pinwin_instruction"))}});n.on("flickrMap:centerNotInView",function(){if(w){var G=m.one(".edit-instruction"),D=0,I=[],J="",E=n.getDefaultPhotoData("woe"),K=E.breadcrumb;for(var H in K){if(K.hasOwnProperty(H)){I.push(K[H])}}I.reverse();if(I.length>2){J+=I[0].name;J+=", "+I[1].name;J+=", "+I[2].name}else{if(I.length>1){J+=I[0].name;J+=", "+I[1].name}else{if(I.length>0){J+=I[0].name}}}if(G&&J.length){G.set("innerHTML",e.transjax.get("photo-geolocation","message_your_photo_is_currently_in")+" "+J)}}});n.createMap(y,n.hasGEO()?[n.get("photo.geo.latitude"),n.get("photo.geo.longitude")]:null,n.hasGEO()?n.get("photo.geo.accuracy"):null,function(){if(!e.config.flickr.user.enable_alternate_map_type&&e.config.flickrMap.enable_alternate_tiles_plugin){n.plug(e.YahooMapAlternateTilesPlugin)}else{if(!e.config.flickr.user.enable_alternate_map_type){n.plug(e.OSMingPlugin)}}if(e.config.flickrMap&&e.config.flickrMap.enable_albi){n.plug(e.AlbiPlugin)}n.showZoomControl();n.showViewTypeControl();if(e.config.flickrMap.enable_sidebar_zeus_map){n.set("default_location_picker_anchor","#"+k+" .locationconfirm-overlay-wrapper .edit_instruction")}else{n.set("default_location_picker_anchor","#"+k+" .edit-instruction")}if(s){n.setFocusPoint([u.latitude,u.longitude],u.accuracy);n.showFocusPointViewer([n.get("photo")])}if(C){e.photoGeolocation.enableEditMode({message:e.transjax.get("photo-geolocation","message_add_photo_by_drag_pinwin_instruction")})}e.global_dialog.set_spinner(false);e.global_dialog.reposition();e.photoGeolocation.syncGeopanelPhotoInfo()});p=n},failure:function(v,u,s){var t=e.transjax.get("photo-geolocation","error_map_cant_load");e.global_dialog.set_spinner(false);e.global_dialog.create_alert_dialog(t,function(){return true})}},"arguments":{}})}function b(s){if(e.config.flickr.flags.enable_geo_exif_backfill&&e.config.flickr.user.geo_exif_backfill&&e.config.flickr.user.geo_exif_backfill.in_progress){return}e.contextManager.set("map-modal");e.config.geolocation.search_initialized=null;e.global_dialog.remove_existing_dialog();e.global_dialog.create_dialog('<div id="'+k+'"></div>');if(s){e.one("#"+k).addClass("editing")}e.global_dialog.set_spinner(true);e.global_dialog.set_modal(true);e.global_dialog.set_width(a);e.use("autocomplete-2-5-1","flickr-map","gallery-flickr-api","photo-geolocation-css",function(t){i()})}function o(){var t=m.one(".search form"),s=t.one("input[name=location]");t.on("submit",function(w){w.preventDefault();var v=m.one(".search_results");function x(z){var y=m.one(".search_results");if(!y){m.append('<div class="search_results">...</div>');y=m.one(".search_results");y.delegate("click",function(A){u(parseFloat(A.target.getAttribute("data-lat")),parseFloat(A.target.getAttribute("data-lon")),A.target.getAttribute("data-accuracy"));y.setStyle("display","none")},"ul li");m.on("click",function(A){if(!y.ancestor("#"+A.target.getAttribute("id"),true)){y.setStyle("display","none")}})}else{y.setStyle("display","block")}y.setStyle("position","absolute");y.setStyle("backgroundColor","#fff");y.setStyle("border","solid 1px #fff");y.setXY([s.getX(),s.getY()+s.get("offsetHeight")+10]);if(z){y.set("innerHTML",z)}return y}function u(z,A,y){n.set("temp_location",[z,A]);n.set("temp_accuracy",y);if(e.config.flickrMap.enable_sidebar_zeus_map){e.photoGeolocation.promptForWoeCorrection(n.get("temp_location"),n.get("temp_accuracy"),{viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(n.get("location_source")===1)?1:0,edit_mode:n.get("edit_mode")})}else{n.location_picker.confirmGeoprivacyIsSet(n.location_picker.confirmLocation,[n.get("temp_location"),n.get("temp_accuracy"),confirm_options={viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(n.get("location_source")===1)?1:0,edit_mode:n.get("edit_mode"),center_map:true}])}}x('<div class="loading-message">'+e.transjax.get("photo-geolocation","message_searching")+"</div>");n.freeformLocationSearch(s.get("value"),function(z){if(!z.locations.length){x("Unable to locate that location.")}else{if(z.locations.length>1){var C=x(),B="<ul>",D='<li data-lat="{lat}" data-lon="{lon}" data-accuracy="{accuracy}">{title}, {sub_title}</li>';for(var A=0,y=z.locations.length;y>A;A++){B+=e.substitute(D,z.locations[A])}B+="</ul>";C.set("innerHTML",B)}else{m.one(".search_results").setStyle("display","none");u(parseFloat(z.locations[0].lat),parseFloat(z.locations[0].lon),z.locations[0].accuracy)}}})});e.config.geolocation.search_initialized=true}function j(){var t,s,u;e.contextManager.set("geofences-upsell");t={hd:"<h3>"+e.transjax.get("photo-geolocation","message_geofences_upsell_title")+"</h3>",bd:e.transjax.get("photo-geolocation","message_geofences_upsell")};s=function(w,v){e.global_dialog.hide();e.global_dialog.remove_existing_dialog();e.contextManager.unset("geofences-upsell");if(w){e.global_dialog.show({loading:true,modal:true});window.location.href="/account/geo/privacy/"}};u={CONFIRM:e.transjax.get("photo-geolocation","button_visit_settings_page"),CANCEL:e.transjax.get("photo-geolocation","button_close"),width:500};e.global_dialog.create_confirmation_dialog(t,s,u);e.flickrAPI.callMethod("flickr.prefs.setPrefs",{geofences_has_seen_upsell_message:1});e.config.flickr.user.geofences_has_seen_upsell_message=true;e.config.geolocation.prompt_for_geofence_when_closing_map=false}function d(){var t,s,u;e.contextManager.set("geo-exif-prompt");t=e.transjax.get("photo-geolocation","exif_optin_message");s=function(w,v){e.global_dialog.hide();e.global_dialog.remove_existing_dialog();e.contextManager.unset("geo-exif-prompt");if(w){e.flickrAPI.callMethod("flickr.prefs.setPrefs",{prefs_import_geoexif:1})}};u={CONFIRM:e.transjax.get("photo-geolocation","yes"),CANCEL:e.transjax.get("photo-geolocation","no")};e.global_dialog.create_confirmation_dialog(t,s,u);e.config.geolocation.has_seen_geo_exif_prompt=true;e.config.geolocation.prompt_for_geo_exif_when_closing_map=false}function f(){e.global_dialog.show({loading:true,modal:true});e.use("geo-exif-backfill",function(s){s.global_dialog.hide();s.geoExifBackfill.openPanel()});e.config.geolocation.has_seen_geo_exif_prompt=true;e.config.geolocation.prompt_for_geo_exif_when_closing_map=false}e.photoGeolocation={view_modes:["just-map","has-sidebar"],view_mode_id:null,init:function(s,t){e.config.flickrMap=e.config.flickrMap||{};if(F.actionQueue){F.actionQueue.photoGeolocation={display:function(){b()}};F.actionQueue.module_loaded("photoGeolocation")}if(F.actionQueue){F.actionQueue.photoGeolocationEdit={display:function(){b(true)}};F.actionQueue.module_loaded("photoGeolocationEdit")}return e.all(s).on("click",e.photoGeolocation.onGeolocationTriggerClickEvent)},setViewMode:function(u){var w=this.view_modes,v=m.one(".location-overlay-wrapper");if(e.Lang.isNumber(u)&&u>-1){for(var t=0,s=w.length;s>t;t++){var x=w[t];v.removeClass(x)}v.addClass(w[u]);this.view_mode_id=u}},dissableLocationSearch:function(u){var t=m.one("form[name=location_search]"),s=(u===false)?false:true;t.all("input").set("disabled",s);t.one("button").set("disabled",s)},syncPhotoPage:function(){e.io("/photo_story_fragment.gne",{method:"POST",data:"deferImages=0&id="+e.config.flickr.photo.id,timeout:g,on:{success:function(u,t,s){e.one("#photo-story").set("innerHTML",t.responseText);e.photoGeolocation.init("#photo-story .photo-story-geopanel-trigger");e.photoSidebar.story.refresh()},failure:function(v,u,s){var t=e.transjax.get("photo-geolocation","error_could_not_update_page");n.showDialog(t)}},"arguments":{Y:e}})},syncGeopanelPhotoInfo:function(){var s,E,u,y;s=e.one("#"+k);if(!s){return}E=s.one(".woe-breadcrumb");u=n.getDefaultPhotoData("geo");y=n.get("temp_accuracy");function v(){E.set("innerHTML","&nbsp;/&nbsp;"+e.transjax.get("photo-geolocation","message_here_be_draggons"))}function A(I,J){if(I){if(J==="neighbourhood"&&n.getDefaultPhotoData("owner")&&n.getDefaultPhotoData("owner")==="95769700@N00"&&(e.config.flickr.user.nsid==="95769700@N00"||e.config.flickr.user.admin_user)&&I.name.substring(0,4)!=="West"){var H=I.name;I.name="West (Formerly known as "+H+")"}I.type=J;E.append(e.substitute(t,I))}}if(e.Lang.isNumber(u.latitude)&&e.Lang.isNumber(u.longitude)){var B=s.one(".latlon"),x=s.one(".links"),D=n.getDefaultPhotoData("woe")||{},w=D.breadcrumb,z=n.getDefaultPhotoData("date_taken").substring(0,4),t='&nbsp;/&nbsp;<a class="place place-{type} ywa-track" data-ywa-name="Location, Taken in, Places" href="/places{url}">{name}</a>',C="{latitude}, {longitude}",G='<a href="/photos/{pathalias}/{id}/map/">{label_view_larger_map}</a> &#8226; <a href="/photos/{pathalias}/{id}/nearby/">{label_view_near}</a>';E.set("innerHTML","");if(n.osming&&n.osming.isBurningMan([u.latitude,u.longitude],z)){E.set("innerHTML",'&nbsp;/&nbsp;<a href="http://www.flickr.com/places/United+States/Nevada/Trego">Black Rock City (Burning Man '+z+")</a>")}else{if(w&&w.country){A(w.country,"country");A(w.region,"region");A(w.locality,"locality");A(w.neighbourhood,"neighbourhood")}else{if(n.getDefaultPhotoData("woe")){v()}else{E.set("innerHTML","")}}}if(e.Lang.isNumber(u.latitude)&&e.Lang.isNumber(u.longitude)){B.set("innerHTML",e.substitute(C,{latitude:u.latitude,longitude:u.longitude}))}else{B.set("innerHTML","&nbsp;")}x.set("innerHTML",e.substitute(G,e.merge(n.get("photo"),{label_view_larger_map:e.transjax.get("photo-geolocation","link_view_larger_map"),label_view_near:e.transjax.get("photo-geolocation","link_see_nearby_photos"),pathalias:n.getDefaultPhotoData("pathalias")||n.getDefaultPhotoData("owner")})))}else{v()}},onGeolocationTriggerClickEvent:function(s){if(s){s.preventDefault()}if(s.target.hasClass("add")){b(true)}else{b()}},getMapInstance:function(){return p},confirm_fragment_callback:function(w){var t=w,x=this.getMapInstance(),u=this,v=m.one(".map_control_panel .bodystuff");this.updateConfirmFragmentFormDefaults();if(t.center_map&&x.get("temp_location")){x.centerOnLocation(x.get("temp_location"))}else{if(t.center_map&&!x.get("temp_location")){e.log("promptForWoe called with center_map argument but there is no temp_location on the flickr-map module","error","photo-geolocation")}}if(t.force_accuracy&&x.get("temp_accuracy")){x.throttledSetAccuracy(x.get("temp_accuracy"))}else{if(t.force_accuracy&&!x.get("temp_accuracy")){e.log("promptForWoe called with force_accuracy argument but there is no temp_accuracy on the flickr-map module","error","photo-geolocation")}}if(!e.config.geolocation.search_initialized){o()}var y=v.one(".CancelButt"),z=v.one(".DeleteButt"),B=v.one("form.flickrmap_locationconfirm"),s=v.one("span.is-from-cache-value");if(y){y.on("click",function(C){C.preventDefault();if(x.hasGEO()){e.photoGeolocation.disableEditMode()}else{if(x.location_picker.isVisible()){x.set("temp_location",[]);x.set("temp_accuracy",null);x.location_picker.syncPosition(x.location_picker.getDefaultXY())}}if(!e.config.flickrMap.enable_sidebar_zeus_map){x.destroyDialog()}})}if(z){if(x.get("photo.id")){z.on("click",function(C){C.preventDefault();e.photoGeolocation.enableLoadingState(true);e.flickrAPI.callMethod("flickr.photos.geo.removeLocation",{photo_id:x.get("photo.id")},function(){x.set("photo",null);x.fire("flickrMap:locationRemoved",x.get("photo"))})})}else{e.log("No photo id available to send to removeLocation method","error","flickrMap")}}if(B){if(v){var A=v.all("select");A.each(function(C){C.removeAttribute("disabled")})}if(x.get("temp_accuracy")&&x.get("temp_accuracy")<8){this.setUserMessage('<div class="msg-icon"></div>Far out! (not in a good way). We recommend zooming-in further to show more detail on the map.',"alert")}B.on("submit",function(E){E.preventDefault();x.set("photo.geo.latitude",x.get("temp_location")[0]);x.set("photo.geo.longitude",x.get("temp_location")[1]);x.set("photo.geo.accuracy",x.get("temp_accuracy"));x.set("perm_viewgeo",B.one("select[name=save_perm_viewgeo]").get("value"));e.photoGeolocation.enableLoadingState(true);x.destroyDialog();var D="",C=x.get("photo.id");B.all("select, input").each(function(G){if(G.get("type")!=="radio"){D+=G.get("name")+"="+G.get("value")+"&"}});B.all("select:checked, input:checked").each(function(G){D+=G.get("name")+"="+G.get("value")+"&"});e.io("/flickrmap_locationconfirm_fragment.gne",{method:"POST",data:D,timeout:30000,on:{success:function(K,J,G){if(J.responseText){var I=e.JSON.parse(J.responseText);if(!I.woe){I.woe={woeid:null}}x.set("photo",I);x.set("photo.id",C);e.flickrAPI.callMethod("flickr.people.geo.setLocation",{lat:x.get("photo.geo.latitude"),lon:x.get("photo.geo.longitude"),accuracy:x.get("photo.geo.accuracy"),context:"last"});x.fire("flickrMap:locationSelected",x.get("photo"));e.config.geolocation=e.config.geolocation||{};if(e.config.flickr.flags.enable_geo_exif_backfill&&e.config.flickr.user.geo_exif_backfill&&!e.config.flickr.user.geo_exif_backfill.prompt_opt_out&&!e.config.geolocation.has_seen_geo_exif_prompt&&(e.config.flickr.user.geo_exif_backfill.eligible_photo_count>1||e.config.flickr.user.geo_exif_backfill.auto_import_disabled)){if(e.config.flickr.user.geo_exif_backfill.eligible_photo_count>1){e.config.geolocation.prompt_for_geo_exif_when_closing_map=true}else{e.config.geolocation.prompt_for_geo_exif_pref_when_closing_map=true}}else{if(!e.config.flickr.user.has_geofences&&!e.config.flickr.user.geofences_has_seen_upsell_message){e.config.geolocation.prompt_for_geofence_when_closing_map=true}}}else{e.log("No data received","error","flickrMap");var H=e.transjax.get("flickr-map","error_problem_finding_location");x.showDialog(H)}},failure:function(J,I,G){var H=e.transjax.get("flickr-map","error_problem_finding_location");x.showDialog(H)}},"arguments":{}})})}},postDefaultPermissionCheckWoeCorrection:function(E,t,z){var D=this.getMapInstance(),v=D.location_picker;if(e.Lang.isArray(E)&&E[0]&&E[1]){var s=e.config.flickrMap,y=arguments,B={},A=this;t=t||D.getBestAccuracy(t);D.set("temp_location",E);var C={edit_mode:D.setEditMode()};var u="",x=D.getDialogNode();B={photo_id:D.get("photo.id"),latitude:E[0],longitude:E[1],accuracy:t,magic_cookie:e.config.flickrAPI.auth_hash,viewgeo:(D.get("edit_mode")===1)?D.get("photo.permDefaultViewgeo"):D.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(D.get("location_source")===1)?1:0,edit_mode:D.get("edit_mode"),center_map:true};if(z){B=e.merge(B,z,C)}for(var w in B){if(B.hasOwnProperty(w)){u+=w+"="+B[w]+"&"}}u=u.substring(0,u.length-1);v.setLoading(v);if(x){var G=x.all("select");G.each(function(H){H.setAttribute("disabled",true)})}e.io("/flickrmap_locationconfirm_fragment.gne",{method:"POST",data:u,timeout:300000,on:{success:function(J,I,H){if(D.location_picker){e.photoGeolocation.enableLoadingState(false)}e.once("photo-geolocation:control-panel-show",function(){A.hideModalDiolog();e.global_dialog.set_spinner(false);A.confirm_fragment_callback(B)});A.showControlPanel(I.responseText)},failure:function(K,J,H){var I=e.transjax.get("flickr-map","error_problem_finding_location");e.global_dialog.set_spinner(false);D.showDialog(I)}},"arguments":{}})}},promptForWoeCorrection:function(s,x,y){var v=this,u=arguments,t=this.getMapInstance(),w=t.location_picker;if(w.isUserGeoprivacySet()){v.postDefaultPermissionCheckWoeCorrection.apply(v,u)}else{this.showModalDiolog(e.transjax.get("photo-geolocation","message_loading"));w.promptUserToSetGeoDefault(this.getModalDiologNode());t.once("flickrMap:setUserViewGeo",function(){v.postDefaultPermissionCheckWoeCorrection.apply(v,u)})}},updateConfirmFragmentFormDefaults:function(){var v=this.getMapInstance(),w=v.get("photo");if(w){var s=m.one(".map_control_panel .bodystuff"),y=(s)?s.one("select[name=save_woe]"):null,u=v.getDefaultPhotoData("date_taken").substring(0,4);if(v.YahooMapAlternateTiles&&v.YahooMapAlternateTiles._selected_tile_type==="flickr_burningman_earth"){var x=y.ancestor(),t=y._node;t.parentNode.removeChild(t);x.set("innerHTML",'<b>Black Rock City</b><input type="hidden" name="save_woe" value="2507768">')}if(v.hasWOE()&&s&&y){y.set("value",w.woe.woeid)}}},enableEditMode:function(s){var t=n.getDefaultPhotoData("geo");n.setEditMode();e.photoGeolocation.setTitle(n.get("edit_mode"));if(n.getDefaultPhotoData("is_owner")){s=s||{};var w=m.one(".map-location-picker"),u=n.location_picker,x=m.one(".focus_point"),v={viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(n.get("location_source")===1)?1:0,edit_mode:n.get("edit_mode")};if(x&&x.setStyle){x.setStyle("display","none")}if(s.message){m.one(".edit-instruction").set("innerHTML",s.message)}m.addClass("editing");if(u){u.create()}else{if(e.config.flickrMap.enable_sidebar_zeus_map){n.plug(e.LocationPickerPlugin3)}else{n.plug(e.LocationPickerPlugin)}}n.hideFocusPointViewer();n.enableEditMode();if(!e.config.flickrMap.enable_sidebar_zeus_map){if(!e.config.geolocation.search_initialized){o()}}if(n.hasGEO()||(n.get("location_source")&&n.get("location_source")===1)){if(n.hasGEO()){n.set("temp_location",[n.get("photo.geo.latitude"),n.get("photo.geo.longitude")])}if(!n.hasGEO()){n.set("photo.geo",{})}if(e.config.flickrMap.enable_sidebar_zeus_map){this.promptForWoeCorrection(n.get("temp_location"),n.get("temp_accuracy"),{viewgeo:(n.get("edit_mode")===1)?n.get("photo.permDefaultViewgeo"):n.get("perm_viewgeo"),force_accuracy:true,is_exif_suggestion:(n.get("location_source")===1)?1:0,edit_mode:n.get("edit_mode")})}else{n.location_picker.confirmGeoprivacyIsSet(n.location_picker.confirmLocation,[n.get("temp_location"),n.get("photo.geo.accuracy"),v])}}else{n.location_picker.confirmGeoprivacyIsSet(n.destroyDialog)}}},disableEditMode:function(){n.setEditMode(null);var t=m.one(".map-location-picker"),u=m.one(".focus_point");if(t){n.location_picker.destroy()}n.disableEditMode();m.removeClass("editing");var s=[n.get("photo.geo.latitude"),n.get("photo.geo.longitude")];if(e.config.flickrMap.enable_sidebar_zeus_map){e.once("photo-geolocation:control-panel-hide",function(){n.centerOnLocation(s,false,{accuracy:n.get("temp_accuracy")});n.setFocusPoint(s,n.get("temp_accuracy"));n.showFocusPointViewer()});this.hideControlPanel()}else{n.centerOnLocation(s,false,{accuracy:n.get("photo.geo.accuracy")});n.setFocusPoint(s);n.showFocusPointViewer()}},isEditable:function(){return m.hasClass("editing")},getModalDiologNode:function(){return m.one(".modal-body")},repositionModalDiolog:function(){var u=m.get("offsetHeight"),t=m.one(".modal-body"),s=t.get("offsetHeight"),v=(u-s)/2;if(v<58){e.log("The photo-geolocation panel's internal modal has gone above the max height limit. It will be resized to fit","info","photo-geolocation");v=58;t.setStyle("height",(u-(v*2)))}t.setStyle("margin",parseInt(v,10)+"px 0");t.setStyle("visibility","visible")},showModalDiolog:function(u){var t=m.one(".modal-container");if(!t){m.append('<div class="modal-container"></div>');t=m.one(".modal-container")}var s=m.one(".modal-body");if(!s){m.append('<div class="modal-body"></div>');s=m.one(".modal-body")}m.all(".modal-container, .modal-body").setStyle("display","block");if(u){s.set("innerHTML",u)}e.later(50,this,function(){this.repositionModalDiolog()})},disableModalDiologActions:function(){m.all(".modal-body button").set("disabled",true)},hideModalDiolog:function(){m.all(".modal-container, .modal-body").setStyle("display","none")},getControlPanelNode:function(){return m.one(".map_control_panel .bodystuff")},showControlPanel:function(s){n.getRootNode().setStyle("width","580px");n.getRootNode().setStyle("height","438px");this.setViewMode(1);var t=this,u=m.one(".map_control_panel .bodystuff");n.updateSize();u.set("innerHTML",s);e.fire("photo-geolocation:control-panel-show")},hideControlPanel:function(){var s=this.getMapInstance();s.getRootNode().setStyle("width","899px");s.getRootNode().setStyle("height","399px");this.setViewMode(0);e.fire("photo-geolocation:control-panel-hide")},enableLoadingState:function(s){var u=this.getControlPanelNode();n.location_picker.setLoading(s);if(u){var t=u.all("form select, form button");t.set("disabled",s)}},setUserMessage:function(u,s){var v=this.getControlPanelNode(),t=v.one("div.messaging");if(t){if(u){t.setStyle("display","block");t.addClass(s);t.set("innerHTML",u)}else{t.setStyle("display","none");t.setAttribute("className","messaging");t.set("innerHTML","")}}else{e.log("Unable to show the "+s+' message:"'+u+'" because the messaging div was not found',"warn","photo-geolocation")}},setTitle:function(t){var s=null;m.all(".head .mode-title h3").setStyle("display","none");if(t){s=m.one(".head .mode-title h3.title-add");if(s){s.setStyle("display","block")}else{e.log('"Add" title element could not be found. Title of geopanel will be blank',"error","photo-geolocation")}}else{s=m.one(".head .mode-title h3.title-edit");if(s){s.setStyle("display","block")}else{e.log('"Edit" title element could not be found. Title of geopanel will be blank',"error","photo-geolocation")}}}}},"a-000",{requires:F.config.modules["photo-geolocation"].requires||[],optional:F.config.modules["photo-geolocation"].optional||[]});YUI.add("flickr-tooltips",function(a){var q=null,g=null,b=0,k=null,c=null,n=null;function h(){q=document.createElement("div");g=document.createElement("div");q.style.display="none";q.style.zIndex="200000";document.body.appendChild(q);q.appendChild(g)}function m(s,u,v,r,z){var t,B,C,A;s=a.one(s);z=z||"ToolTip";if(!q){h()}if(s.getStyle("visibility")==="hidden"){return}q.className=z;if(b){if(k===s._node){d();return}d()}r=(r===undefined)?"":r;v+=r.length;n=document.getElementById(u);g.innerHTML=n.innerHTML+r;g.style.width="auto";q.style.display="block";q.style.visibility="hidden";if(z!=="ToolTipSmall"){w=150;if(v>200){w=300}else{if(v>100){w=200}}g.style.width=w+"px"}t=q.offsetWidth;C=s.getX();A=s.getY();if(z==="ToolTipSmall"){C-=Math.round((t-s.get("offsetWidth"))/2)-5;if(s._node.tip_placement==="below"){A+=s.get("offsetHeight")+10}else{A-=22}}else{A+=20}B=f()-40;if(C+t>B){C=B-t}C=Math.max(10,C);q.style.left=C+"px";q.style.top=A+"px";b=1;q.style.display="block";q.style.visibility="visible";k=s._node;document.onmousedown=l}function l(s){var r=e(s);if(r===k||(o(r)&&j(r))){document.onmousedown=function(){}}else{d()}}function d(r){if(r){if(k!==r){return}}document.onmousedown=function(){};if(!q){return false}b=0;q.style.display="none";k="null";return false}function j(r){var s=r;while(s){if(s===q){return 1}s=s.parentNode}return 0}function o(r){var s=r;while(s){if(s.href){return 1}s=s.parentNode}return 0}function i(){if(window.innerHeight){return window.innerHeight}else{if(document.documentElement.clientHeight){return document.documentElement.clientHeight}else{if(document.body.clientHeight){return document.body.clientHeight}}}}function f(){if(window.innerWidth){return window.innerWidth}else{if(document.documentElement.clientWidth){return document.documentElement.clientWidth}else{if(document.body.clientWidth){return document.body.clientWidth}}}}function e(r){if(r&&r.target){return r.target}if(r&&r.srcElement){return r.srcElement}if(window.event){return window.event.srcElement}return null}function p(){window.show_tooltip=m}a.tooltips={init:p}},"0.0.1",{requires:["node","event","event-delegate"]});YUI.add("personmenu-transjax",function(b){var a={svn_bump:"",error_timeout:'Uh oh! There was a problem contacting the server.',error_getting:'Uh oh! There was a problem getting data from the server.'};b.transjax.add("personmenu",a)},"0.0.1",{requires:["transjax-base"]});YUI.add("personmenu-rapid",function(a){a.on("personmenu:show",function(b){if(b){a.rapidTracker.addModules(b)}})},"0.0.1",{requires:F.config.modules["personmenu-rapid"].requires||[]});YUI.add("personmenu",function(c){var u,H,o,y,d,Q,A,x,F,S;function O(U){if(!O.is_init){H={open_on_icon_click:false,get_data_on_arrow_hover:true,show_delay:100,hide_delay:500,spinner_delay:200,io_timeout:10000,io_cache_ttl:120000,zeus:false};if(!c.Lang.isObject(U)){U={}}H=c.mix(U,H);u=c.one("body");if(c.config.flickr.user.nsid||c.config.flickr.flags.enable_grease){u.on("mouseover",b);u.on("mouseout",b);u.on("click",t);c.on("resize",t);c.on("contact_changer:change",L);c.on("contact_changer:open",M);c.on("contextManager:contextSet",g)}O.is_init=true}}function h(V){var U,W;if(!h.cache){h.cache=new c.CacheSimple()}U=h.cache;if(c.Lang.isString(V)){W=U.retrieve(V);if(W&&W.response&&(new Date()).getTime()<W.payload.expires){return W.response}else{return null}}else{return U}}function f(U,V){if(!c.Lang.isString(U)){return false}h().add(U,V,{expires:(new Date()).getTime()+H.io_cache_ttl});return true}function n(U){f(U,null)}function B(U){return(function(){var V;return function(){var Y,Z,X,W;if(!V||arguments.length!==V.length){Y=true}else{X=Array.prototype.slice.call(arguments);W=Array.prototype.slice.call(V);for(Z in X){if(X.hasOwnProperty(Z)){if(X[Z]!==W[Z]){Y=true;break}}}}if(Y){U.apply(this,arguments)}V=arguments}}())}function l(U){if(c.Lang.isString(U)){U=c.one(U)}if(!U instanceof c.Node){return false}return U}function b(U){if(!U.target.hasClass("personmenu-trigger")){return}switch(U.type){case"mouseover":if((d||A)&&Q){return}C(U.target);break;case"mouseout":N();break}}function L(U){n(U.nsid)}function z(U){switch(U.type){case"mouseover":T();if(H.get_data_on_arrow_hover){if(c.one(".personmenu .personmenu-arrow")&&(U.target.test(".personmenu .personmenu-arrow")||c.one(".personmenu .personmenu-arrow").contains(U.target))){if(!d&&!h(o)){P(o)}}}break;case"mouseout":if(!d&&!A){I()}break;case"click":if(c.one(".personmenu .personmenu-arrow")&&(U.target.test(".personmenu .personmenu-arrow")||c.one(".personmenu .personmenu-arrow").contains(U.target))){U.preventDefault();w()}else{if(H.zeus&&(c.one(".personmenu .personmenu-more")&&(U.target.test(".personmenu .personmenu-more")||c.one(".personmenu .personmenu-more").contains(U.target)))){if(!d){U.preventDefault();U.halt();k()}}else{if(H.open_on_icon_click&&c.one(".personmenu .personmenu-icon-link")&&(U.target.test(".personmenu .personmenu-icon-link")||c.one(".personmenu .personmenu-icon-link").contains(U.target))){if(!d){U.preventDefault();k()}}else{if(c.one(".personmenu .personmenu-relationship-change")&&(U.target.test(".personmenu .personmenu-relationship-change")||c.one(".personmenu .personmenu-relationship-change").contains(U.target))){if(c.config.modules["contact-changer"]){U.preventDefault();s()}c.use("contact-changer",function(W){i();W.contact_changer.show(o)})}else{if(c.one(".personmenu .photos-trigger")&&U.target.test(".personmenu .photos-trigger")){var V=U.target.ancestor("li").one(".photos");if(V){U.preventDefault();V.toggleClass("photos-open")}}else{c.fire("personmenu:navigate",{id:p().get("id"),url:U.target.get("href")})}}}}}break}}function t(U){if(U.type==="click"){if(H.open_on_icon_click&&U.target.hasClass("personmenu-trigger")){U.preventDefault();U.halt();k(U.target)}else{if(Q&&!c.one(".personmenu").contains(U.target)){M()}}}if(U.type==="resize"){if(Q){m(y)}}}function g(U){if(U.newVal!==""){M()}}function T(){if(F){window.clearTimeout(F);F=null}}function N(){if(x){window.clearTimeout(x);x=null}}function C(U){T();N();if(Q&&!H.zeus){r(U)}else{x=window.setTimeout(function(){x=null;r(U)},H.show_delay)}}function I(){if(!F){F=window.setTimeout(function(){F=null;M()},H.hide_delay)}}function j(V){var U;V=l(V);U=V.get("data-defer-src")||V.get("src");return U}function R(V){var U;V=l(V);U=a(V);return U?"/photos/"+U:false}function a(W){var V,U;V=j(W);U=V.split("#")[1];return J(U)?U:false}function J(U){return(/^[0-9]+@N[0-9]{2}$/).test(U)}function p(){var U;if(!p.menu){if(H.zeus){U='<div class="personmenu personmenu-hidden personmenu-zeus"><div class="personmenu-hd"><a data-track="icon-link" href="" class="personmenu-icon-link rapidnofollow"><img class="personmenu-icon"></a><span class="personmenu-spinner"></span><span class="personmenu-name"></span></div><div class="personmenu-bd"></div></div>'}else{U='<div class="personmenu personmenu-hidden"><div class="personmenu-hd rapidnofollow"><a data-track="icon-link" href="" class="personmenu-icon-link rapidnofollow"><span class="personmenu-spinner"></span><img class="personmenu-icon"></a><a data-track="show-menu" href="" class="rapidnofollow personmenu-arrow" role="button"><span></span></a></div><span class="personmenu-hd-shadow"></span><div class="personmenu-bd"></div><span class="personmenu-bd-border-blocker"></span></div>'}c.one("body").append(U);p.menu=c.one(".personmenu");p.menu.on("mouseover",z);p.menu.on("mouseout",z);p.menu.on("click",z)}return p.menu}function w(){if(d){r()}else{k()}}function q(U,V){if(U){p().one(".personmenu-icon-link").set("href",U)}if(V){p().one(".personmenu-icon").set("src",V)}}q=B(q);function s(){A=true;p().addClass("personmenu-spinning");if(H.zeus){if(p().one(".personmenu-spinner")){p().one(".personmenu-spinner").addClass("personmenu-spinner-on")}}else{S=window.setTimeout(function(){p().one(".personmenu-spinner").addClass("personmenu-spinner-on");S=null},H.spinner_delay)}}function i(){A=false;if(S){window.clearTimeout(S);S=null}p().removeClass("personmenu-spinning");if(p().one(".personmenu-spinner")){p().one(".personmenu-spinner").removeClass("personmenu-spinner-on")}}function G(){Q=true;p().removeClass("personmenu-hidden")}function M(){Q=false;p().addClass("personmenu-hidden")}function m(U){var V,W;V=U.getXY();W=H.zeus?8:6;V[0]-=parseInt((48-U.get("width"))/2,10)+W;V[1]-=parseInt((48-U.get("height"))/2,10)+W;p().setStyle("position","absolute");p().setStyle("left",V[0]+"px");p().setStyle("top",V[1]+"px")}function D(U){var W,Y;W=R(U);Y=j(U);q(W,Y);if(H.zeus){var V=a(U);var X='<ul><li><a href="/people/'+V+'" class="personmenu-item">Profile</a></li><li><a href="'+W+'" class="personmenu-item">Photostream</a></li><li class="personmenu-sep-bottom"><a href="/photos/'+V+'/favorites" class="personmenu-item">Favorites</a></li><li><a href="" class="personmenu-item personmenu-more">More...</a></li></ul>';p().one(".personmenu-bd").set("innerHTML",X);p().one(".personmenu-name").set("innerHTML",V)}}D=B(D);function P(U){var X,W,V;P.in_progress_nsids=P.in_progress_nsids||{};X=P.in_progress_nsids;W={success:function(ab,aa,Y){var Z=aa.responseText;if(Z){f(Y,Z)}if(A&&o===Y){E(Y)}},failure:function(aa,Z,Y){if(A&&o===Y){if(Z.statusText==="timeout"){e(c.transjax.get("personmenu","error_timeout"))}else{e(c.transjax.get("personmenu","error_getting"))}}},end:function(Z,Y){delete X[Y]}};V="/personmenu_fragment.gne?nsid="+U+"&magic_cookie="+c.config.flickr.magic_cookie;if(H.zeus){V=V+"&zeus=1"}if(X[U]){return false}X[U]=U;c.io(V+"&cachebust="+(new Date()).getTime(),{timeout:H.io_timeout,on:W,"arguments":U})}function E(U){var V=h(U);if(V){if(H.zeus){p().set("innerHTML",V)}else{p().one(".personmenu-bd").set("innerHTML",V)}i();var W=y.getAttribute("data-menu-id");if(W){p().set("id",W)}else{W=false}c.fire("personmenu:show",W);v()}else{s();P(U)}}function e(V){var U='<div class="alert">'+V+"</div>";p().one(".personmenu-bd").set("innerHTML",U);i();v()}function r(U){var V;U=l(U)||y;if(!U){return false}y=U;V=a(U);if(!V){return false}o=V;i();K();D(U);m(U);G();if(H.zeus&&!h(V)){P(V)}return true}function k(U){var V;U=l(U)||y;if(!U){return false}y=U;V=a(U);if(!V){return false}o=V;r(U);E(V);return true}function K(){p().addClass("personmenu-closed");p().removeClass("personmenu-open");d=false}function v(){p().removeClass("personmenu-closed");p().addClass("personmenu-open");d=true;p().one(".personmenu-bd").vis.animScrollIntoView()}c.personmenu={init:O,showClosed:r,showOpen:k,hide:M}},"0.0.1",{requires:["node","anim","anim-scroll","node-visibility","event-custom","cache-simple","io-base","personmenu-transjax","personmenu-css"],optional:["contact-changer"]});YUI.add("flickr",function(b){function a(){if(b.config.flickr.flags.enable_grease||b.config.flickr.user&&b.config.flickr.user.nsid){b.personmenu.init()}if(b.config.flickr.sharing.use_share_this_v3){b.use("share-this-v3-menu",function(c){c.shareThisV3Menu.init()});if(b.config.flickr.sharing.share_immediately_service){b.use("share-this-v3-dialog",function(c){var d=c.config.flickr.sharing.share_immediately_service;c.shareThisV3Dialog.share_by_service(d.service_id,d.service_type_id)})}}if(b.config.flickr.flags.enable_tumblr_trackr){b.use("tumblr-trackr",function(c){c.tumblrTrackr.init()})}b.tooltips.init();if(b.config.flickr.flags.enable_sitekey_fetcher){window.setInterval(function(){if(b.config.flickrAPI&&b.config.flickrAPI.api_key){b.use("gallery-flickr-api",function(d){var f,c,e;f="flickr.site.getKey";c={};e={success:function(g){if(g&&g.data&&g.data.key&&g.data.key._content&&d.Lang.isString(g.data.key._content)){d.config.flickrAPI.api_key=g.data.key._content}},failure:function(g){}};d.flickrAPI.callMethod(f,c,e)})}},7*60*60*1000)}}b.flickr=a},"0.0.1",{requires:F.config.modules.flickr.requires||[],optional:F.config.modules.flickr.optional||[]});YUI.add("share-menu-transjax",function(b){var a=null;b.transjax.add("share-menu",{menu_fragment_error:"Sorry, there was a problem loading the sharing menu.",services_fragment_error:"Sorry, we couldn't find any services for you to share with.",grab_the_link_fragment_error:'There was an error',share_blog_no_blogs:"Sorry, we couldn't find any blogs for your account.",share_blog_choose_blog:"Choose a blog below:",sharing_email_error:"Oops! That doesn't look like a real email address. Try again?",sharing_no_contact:"Hmm... we couldn't find %s in your contacts list. Do you want to try entering their email address instead?",sharing_no_member:"Hmm... we couldn't find %s on Flickr. Do you want to try entering their email address instead?",uber_contact_list_default_text:"screen name, real name, or email",uber_contact_list_max_results:"Showing [results_shown] of [total_results] results. <a href='[url]'>See all...</a>",uber_contact_list_no_realname:"No real name given",generating_guest_pass_msg:"Generating Guest Pass...",sharing_initial_instructions:"Enter email addresses or a contact's screen name",sharing_instructions_one_added:"1 recipient so far... add another?",sharing_instructions_many_added:"%s recipients so far... add another?",sharing_msg_over_limit:"Please limit your message to %s characters or fewer.",spam_url_warning:"Hey! A URL or phrase that you tried to post has been used for abuse on Flickr before. (ex. SPAM) If that's you, stop it! If that's not you, sorry, but you can't post it.",spam_share_warning:"Slow down, partner! To protect the Flickr community against spam, we place a few restrictions on new accounts. You can read more about these restrictions in <a href=\'http://www.flickr.com/help/website/#870679\'>this FAQ</a>.",status_sending_msg:"Sending message..."})},"0.0.1",{requires:["transjax-base"]});YUI.add("flanal",function(b){function a(d,f,c){var e="/flanal_event.gne?target="+d+"&title="+f+"&rand="+Math.random();c=c||{};if(c.sync){b.use("io",function(g){g.io(e,{sync:true})})}else{(new Image()).src=e}b.log(d+" ("+f+")","info","flanal")}b.flanal=a},"0.0.1",{requires:F.config.modules.flanal.requires||[],optional:F.config.modules.flanal.optional||[]});YUI.add("share-this-v3-dialog-transjax",function(a){a.transjax.add("share-this-v3-dialog",{try_again_later:"D'oh! That didn't work. Please try again later.",following_flickr_waiting:"Following...",following_flickr_success:"Awesome, you're following <a href='http://twitter.com/Flickr' target='_blank'>@Flickr</a>!"})},"0.0.1",{requires:["transjax-base"]});YUI.add("share-this-v3-service-email-transjax",function(a){a.transjax.add("share-this-v3-service-email",{email_field_default_text:"screen name, real name, or email",send_an_email:"Send an email to this address",no_realname:"No real name given",sharing_email_error:"Oops! That doesn't look like a real email address. Try again?",sharing_no_contact:"Hmm... we couldn't find %s in your contacts list. Do you want to try entering their email address instead?"})},"0.0.1",{requires:["transjax-base"]});YUI.add("share-this-v3-service-twitter-transjax",function(a){a.transjax.add("share-this-v3-service-twitter",{over_limit_1:"%s whoa!",over_limit_5:"%s too much!",over_limit_10:"%s less is more!",over_limit_20:"%s way over!",over_limit_30:"%s booooring!"})},"0.0.1",{requires:["transjax-base"]});YUI.add("share-this-v3-services",function(e){var d={};function c(f){d[f.name]=f}function b(){return d}function a(g){var f,h;for(f in d){if(d.hasOwnProperty(f)){if(d[f].id===g){h=true;break}}}return h?d[f]:undefined}e.shareThisV3Services={add_service:c,get_services:b,get_service:a}},"0.0.1",{requires:[]});YUI.add("share-this-v3-service-blogger",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"blogger",id:3,setup_url:"/share.gne?action=setup&service_type_id=3",use_popup:true,popup_params:{width:780,height:480},default_text:null,on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);b.shareThisV3Dialog.fetch_sharing_fragment({on_complete:function(){b.shareThisV3Dialog.refresh_dialog_state();b.fire("shareDialog:servicesAuthComplete")}})},on_show_screen:{setup:function(){b.log("blogger: setup screen")},setup_choose_a_blog:function(){b.log("blogger: setup_choose_a_blog()")},share:function(){b.log("blogger: share screen");var d=b.shareThisV3Dialog.get_current_service(),e=b.shareThisV3Dialog.service_helpers;b.global_dialog.show();var c=b.one("#blogger-text");d.default_text=c.getAttribute("data-default-text");c.on("focus",b.shareThisV3Dialog.service_helpers.maybeClearText);c.on("blur",b.shareThisV3Dialog.service_helpers.maybeRestoreText);e.addDescriptionEvents(b.one("#share-this-v3-dialog .add-object-description"),c)},share_confirmblog:function(){b.log("share_confirmblog()");b.global_dialog.show()}},on_auth_failed:function(){b.log("on_auth_failed");set_dialog_state("state-setup state-setup-error");b.global_dialog.reposition()},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#blogger-text")})},share_chooseblog:function(){b.global_dialog.hide();b.global_dialog.set_loading(true)}},misc:{maybe_highlight_endpoint:function(f){var g=f.target,h=f.target.getAttribute("data-default-url"),c=f.target.get("value"),d=c.indexOf(h);if(d!==-1){b.shareThisV3Dialog.service_helpers.setSelectionRange(b.Node.getDOMNode(g),d,d+h.length)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-email",function(c){c.config.flickr.user.apiURL=null;var q=c.shareThisV3Services,o,h={},v=false,p="#share-form-email",k=false;function a(){if(!v){c.shareThisV3Dialog.service_helpers.disableForm(c.one(p));v=true}}function g(){if(v){c.shareThisV3Dialog.service_helpers.enableForm(c.one(p));v=false}}function u(){var x=c.shareThisV3Dialog.service_helpers,z=x.is_guestpass_required(),y=x.is_guestpass_automatic(),w=s(),A=false;if(!z||y){if(w){g()}else{a()}}else{if(!w){a()}else{A=x.is_guestpass_chosen();if(A){g()}else{a()}}}}function s(){var w=c.one("#sharing-email-input"),y=w.get("value"),x=(m(y)||j());return x}function n(){var z=b();var x=c.shareThisV3Dialog.get_form_params();z=c.merge(z,x);var w=c.one("#email-text");var y=w.get("value");if(y&&y!==w.getAttribute("data-default-text")){z.message_text=y}return z}if(!q){c.log("Y.shareThisV3Services null/undefined?")}else{q.add_service({name:"email",id:130,default_text:null,on_show_screen:{share:function(){var z=c.shareThisV3Dialog.service_helpers,x=c.one("#sharing-email-input"),y=c.one("#email-text"),w=c.shareThisV3Dialog.get_current_service();k=false;w.default_text=y.getAttribute("data-default-text");y.on("focus",z.maybeClearText);y.on("blur",z.maybeRestoreText);c.one("#to-flickr").set("value","");c.one("#to-email").set("value","");h={};add_by_email=function(A){if(r()){i();c.global_dialog.reposition()}};o=new c.BoSelecta3(x,{showSubtitle:true,showIcon:true,maxResultsDisplayed:4,includeAddressBook:!!(c.config.flickr.user.nsid),searchOnUsername:true,searchOnRealname:true,searchOnEmail:true,searchOnPathAlias:true,showTotalResults:true,allowNoContacts:true,defaultText:c.transjax.get("share-this-v3-service-email","email_field_default_text"),purgeFormOnDataFailure:false,focusOnFetch:true,fetchDataImmediately:true,selectFirstItem:true,allowFormSubmit:false,hideNoContactMessage:true,enableGlobalSearch:false,zeroResultsMessages:[{message:"<span>"+c.transjax.get("share-this-v3-service-email","send_an_email")+"</span>",className:"bs-send-email-link",onclick:add_by_email,validator:function(A){var B=A.getQuery(),C=(t(B)&&m(B)&&!A.searchingGlobally);return C}}],apiURL:(c.config.flickr.user.nsid?x.getAttribute("data-api-url"):null)});o.on("BoSelecta:resultSelect",d);o.on("BoSelecta:resultClick",d);c.one(p).one('.Butt[type="submit"]').on("mousedown",function(A){k=true});c.one(p).on("submit",i);if(z.is_guestpass_required()){c.all('#guestpass-box input[type="checkbox"]').on("click",u)}v=false;a();c.one("#sharing-email-input").on("keyup",u);c.delegate("click",f,"#bo-selecta-results-box","a.delete-x")}},on_submit_form:{share:function(w){var x=b();c.one("#to-flickr").set("value",x.to_flickr||null);c.one("#to-email").set("value",x.to_email||null);if(c.config.flickr.flags.enable_grease&&!c.config.flickr.user.nsid){w.preventDefault();return false}else{c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one("#email-text")})}}}})}function d(w){if(typeof h[(w.n?w.n:w.e)]==="undefined"){h[(w.n?w.n:w.e)]=w;o.skipContact(w);var x=c.one("#bo-selecta-results-box"),z,y;liEl=document.createElement("li");liEl.innerHTML=(w.n)?'<p nsid="'+w.n+'"><span class="name"><img src="'+w.i+'" width="24" height="24" class="BuddyIconX" nsid="'+w.n+'" id="pt-icon-'+w.n+'"><strong class="username">'+o._sanitizeString(w.u)+'</strong><span class="realname">'+(w.r?o._sanitizeString(w.r):c.transjax.get("share-this-v3-service-email","no_realname"))+'</span></span><span class="controls"><a href="#" class="delete-x" class="pt-remove" id="pt-remove-'+w.n+'"><span>[x]</span></a></span></p>':'<p email="'+o._sanitizeString(w.e)+'" class="email-contact"><span class="name"><img src="'+w.i+'" width="16" height="16" class="BuddyIconX bs-email-icon"><strong class="username email">'+o._sanitizeString(w.e)+'</strong></span><span class="controls"><a href="#" class="delete-x" class="pt-remove" id="pt-remove-'+o._sanitizeString(w.e)+'"><span>[x]</span></a></span></p>';x.appendChild(liEl);x.addClass("not-empty");if(c.is_ie){x.setStyle("display","block")}y=x.all("li.last");if(y){y.each(function(){this.removeClass("last")})}c.one(liEl).addClass("last");if(x.getElementsByTagName("li").length>5){x.addClass("overflow")}x.set("scrollTop",x.get("scrollHeight"))}setTimeout(function(){o.clear(true)},1);u();c.global_dialog.reposition();if(typeof e!=="undefined"){e.preventDefault()}return false}function i(B){var C=o.getQuery(),x=c.one("#sharing-email-input"),A,w,z,y;w=C.replace(/([\;\s]+)/g,",");A=w.split(",");if(!A.length){return l(false,B)}else{for(z=0,y=A.length;z<y;z++){if(A[z]){x.set("value",A[z]);l(true,B)}}x.set("value","")}}function l(z,B){var A=o.getQuery();if(r(z)){var x={e:o.getQuery()};if(typeof h[x.e]==="undefined"){h[x.e]=x;var y=c.one("#bo-selecta-results-box");var w=document.createElement("li");w.innerHTML='<p email="'+o._sanitizeString(x.e)+'" class="email-contact"><span class="name"><img src="/images/icon_unread.gif" width="16" height="16" class="BuddyIconX bs-email-icon"><strong class="username email">'+o._sanitizeString(x.e)+'</strong></span><span class="controls"><a href="#" class="pt-remove delete-x" id="pt-remove-'+o._sanitizeString(x.e)+'"><span>[x]</span></a></span></p>';y.appendChild(w);y.addClass("not-empty");if(c.UA.ie){y.setStyle("display","block")}y.all("li").removeClass("last");c.one(w).addClass("last");if(y.all("li").size()>5){y.addClass("overflow")}y.set("scrollTop",y.get("scrollHeight"));o.clear(true)}u()}if(B&&A&&!k){B.halt();return false}else{if(c.config.flickr.flags.enable_grease&&!c.config.flickr.user.nsid){c.use("grease",function(D){var C=n();D.grease.shareV3(C);D.grease.authenticate(function(E){})});if(B){B.preventDefault()}return false}}}function m(w){var x=/^[a-z_0-9\.\-\+\']+@[a-z_0-9\.\-\+]+\.[a-z]/i;return x.test(w)}function t(x){var w=/\.|@/;return w.test(x)}function r(w){var x=o.getQuery();if(x!==""){if(!m(x)){var y=c.config.flickr.flags.enable_grease?c.transjax.get("share-this-v3-service-email","sharing_email_error",x):c.transjax.get("share-this-v3-service-email","sharing_no_contact",x);if(t(x)){y=c.transjax.get("share-this-v3-service-email","sharing_email_error")}if(!w){alert(y)}return false}else{return true}}return false}function f(A){A.halt();var z=A.target.ancestor("p");var B=z.getAttribute("nsid")?z.getAttribute("nsid"):z.getAttribute("email");o.unskipContact(h[B]);delete h[B];var w=z.get("parentNode");var x=c.one("#bo-selecta-results-box");x.removeChild(w);o.clear(true);var y=x.all("li");if(y.size()===0){x.removeClass("not-empty");if(c.is_ie){x.setStyle("display","")}}else{y.removeClass("last");if(y.size()){x.all("li:list-child").addClass("last")}}if(y.size()<=5){x.removeClass("overflow")}u()}function b(){var z={},x=[],y=[],w;for(w in h){if(h.hasOwnProperty(w)){if(h[w].n){y.push(h[w].n)}else{if(h[w].e){x.push(h[w].e)}}}}if(x.length>0){z.to_email=x.join()}if(y.length>0){z.to_flickr=y.join()}return z}function j(){var w=b();return(w.to_email||w.to_flickr)}},"0.0.1",{requires:F.config.modules["share-this-v3-service-email"].requires||[],optional:F.config.modules["share-this-v3-service-email"].optional||[]});YUI.add("share-this-v3-service-facebook",function(a){var g=a.shareThisV3Services;var b,c,l,o,h,k,e;var m=false;var n="#share-form-facebook";var f="#guestpass-box";var d=false;function j(){c=a.one(n);l=a.one(f);o=a.shareThisV3Dialog.service_helpers.is_guestpass_required();h=a.shareThisV3Dialog.service_helpers.is_guestpass_automatic();k=null;e=0;if(!o||h){if(m){a.shareThisV3Dialog.service_helpers.enableForm(c);m=false}return false}if(l){k=l.all('input[type="checkbox"]');if(k){k.each(function(){if(this.get("checked")){e++}});if(e&&m){a.shareThisV3Dialog.service_helpers.enableForm(c);m=false}else{if(!e&&!m){a.shareThisV3Dialog.service_helpers.disableForm(c);m=true}}}else{}}}function i(){a.all(f+' input[type="checkbox"]').on("change",j)}if(!g){a.log("Y.shareThisV3Services null/undefined?")}else{g.add_service({name:"facebook",id:128,setup_url:"/share.gne?action=setup&service_type_id=128",use_popup:true,signed_out_url:"/share.gne?action=signedOutShare&service_type_id=128",popup_params:{width:780,height:500},default_text:null,setup_only:false,share_signed_out:function(s){var q=a.shareThisV3Dialog.get_current_service(),p="&"+a.shareThisV3Dialog.get_share_this_data(true).join("&"),r=q.signed_out_url+"&"+p;a.shareThisV3Dialog.webCirca1999(r,{width:640,height:320});return false},on_window_closed:function(){var p=a.shareThisV3Dialog.get_current_service();a.log("auth (maybe) complete for "+p.name);if(p.setup_only){a.shareThisV3Dialog.service_helpers.setupOnly()}else{a.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){a.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){if(m){m=false;a.shareThisV3Dialog.service_helpers.enableForm(c)}var p=a.one("#facebook-text");var q=a.shareThisV3Dialog.get_current_service();q.default_text=p.getAttribute("data-default-text");p.on("focus",a.shareThisV3Dialog.service_helpers.maybeClearText);p.on("blur",a.shareThisV3Dialog.service_helpers.maybeRestoreText);i();j();a.log("on_show_screen.share()")}},on_submit_form:{share:function(){a.shareThisV3Dialog.service_helpers.maybeClearText({target:a.one("#facebook-text")})}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-livejournal",function(d){var b=d.shareThisV3Services;var c,e,a;if(!b){d.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"livejournal",id:5,use_setup_dialog:true,default_text:null,on_show_screen:{setup:function(){d.log("livejournal: setup screen");var f=d.shareThisV3Dialog.get_current_service();c=d.one("#lj-setup-api-endpoint");e=d.one("#lj-setup-username");a=d.one("#lj-setup-password");if(a){a.on("focus",f.misc.set_password_field)}if(e){e.on("keypress",f.misc.update_endpoint_url);e.on("keyup",f.misc.update_endpoint_url)}},setup_choose_a_blog:function(){d.log("livejournal: setup_choose_a_blog()")},share:function(){var g=d.shareThisV3Dialog.get_current_service(),h=d.shareThisV3Dialog.service_helpers,f=d.one("#livejournal-text");g.default_text=f.getAttribute("data-default-text");f.on("focus",h.maybeClearText);f.on("blur",h.maybeRestoreText);h.addDescriptionEvents(d.one("#share-this-v3-dialog .add-object-description"),f)},password:function(){var g=d.shareThisV3Dialog.get_current_service(),f=d.one("#lj-setup-password");if(f){f.focus()}}},on_submit_form:{share:function(){d.shareThisV3Dialog.service_helpers.maybeClearText({target:d.one("#livejournal-text")})}},on_auth_failed:function(){d.shareThisV3Dialog.set_dialog_state("state-setup state-setup-error");d.global_dialog.reposition()},misc:{update_endpoint_url:function(f){c.set("value",c.getAttribute("data-default-url").replace("%s",e.get("value")))},set_password_field:function(f){var g=f.target;if(g){d.shareThisV3Dialog.service_helpers.setPasswordField(g)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-tumblr",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"tumblr",id:12,setup_url:"/share.gne?action=setup&service_type_id=12",use_popup:true,popup_params:{width:920,height:600},signed_out_url:"/share.gne?action=signedOutShare&service_type_id=12",default_text:null,share_signed_out:function(g){var d=b.shareThisV3Dialog.get_current_service(),c="&"+b.shareThisV3Dialog.get_share_this_data(true).join("&"),f=d.signed_out_url+c;b.shareThisV3Dialog.webCirca1999(f,{width:788,height:375});return false},on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);if(c.setup_only){b.shareThisV3Dialog.fetch_sharing_fragment()}else{b.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){b.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){b.log("on_show_screen:share");b.global_dialog.show();var d=b.shareThisV3Dialog.get_current_service(),f=b.shareThisV3Dialog.service_helpers,c=b.one("#tumblr-text"),e=b.one("#tumblr-butt-post");if(!c){b.log("Warn: could not find textarea");return false}f.addDescriptionEvents(b.one("#share-this-v3-dialog .add-object-description"),c);f.addMoreOptionsEvents();d.default_text=c.getAttribute("data-default-text");c.on("focus",f.maybeClearText);c.on("blur",f.maybeRestoreText)}},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#tumblr-text")})},setup_choose_a_blog:function(){b.global_dialog.hide();b.global_dialog.set_loading(true)}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-twitter",function(b){var a=b.shareThisV3Services;if(!a){b.log("Y.shareThisV3Services null/undefined?")}else{a.add_service({name:"twitter",id:9,setup_url:"/share.gne?action=setup&service_type_id=9",use_popup:true,popup_params:{width:780,height:500},signed_out_url:"/share.gne?action=signedOutShare&service_type_id=9",max_tweet_length:140,default_text:null,flickr_shorturl_length:null,over_limit_classname:"over-limit",share_signed_out:function(g){var d=b.shareThisV3Dialog.get_current_service(),c="&"+b.shareThisV3Dialog.get_share_this_data(true).join("&"),f=d.signed_out_url+c;b.shareThisV3Dialog.webCirca1999(f,{width:780,height:425});return false},on_window_closed:function(){var c=b.shareThisV3Dialog.get_current_service();b.log("auth (maybe) complete for "+c.name);if(c.setup_only){b.shareThisV3Dialog.service_helpers.setupOnly()}else{b.shareThisV3Dialog.fetch_sharing_fragment()}},on_auth_failed:function(){b.log("D'oh, auth did not work, or something. Retry?")},on_show_screen:{share:function(){b.log("on_show_screen:share");var i=b.shareThisV3Dialog.get_current_service();var j=b.one("#tweet-text"),c=b.one("#tweet-characters"),k=null,e=false,f,l,g={"1":"over_limit_1","5":"over_limit_5","10":"over_limit_10","20":"over_limit_20","30":"over_limit_30"},h=b.one("#twitter-butt-post");if(!j){b.log("Warn: could not find textarea");return false}i.max_tweet_length=parseInt(j.getAttribute("data-available-chars"),10);i.default_text=j.getAttribute("data-default-text");function d(){var n=parseInt(j.get("value").length,10),m=(i.max_tweet_length-i.flickr_shorturl_length-parseInt(n,10)),o;if(!isNaN(m)&&m!==k){k=m;if(m<0&&!e){e=true;c.addClass(i.over_limit_classname);h.replaceClass("Butt","DisabledButt");h.set("disabled",true)}else{if(m>=0&&e){e=false;c.removeClass(i.over_limit_classname);h.replaceClass("DisabledButt","Butt");h.set("disabled",false);c.setStyle("fontSize","11px")}}if(m>=0){c.set("innerHTML",m)}else{o=Math.abs(m);if(o>=1&&o<5){f="1";l=1}else{if(o>=5&&o<10){f="5";l=1.25}else{if(o>=10&&o<20){f="10";l=1.5}else{if(o>=20&&o<30){f="20";l=1.75}else{if(o>=30){f="30";l=2}}}}}over_limit_string=b.transjax.get("share-this-v3-service-twitter",g[f],m);c.set("innerHTML",over_limit_string);c.setStyle("fontSize",Math.min(32,parseInt(11*l+(o>30?(o-30)/10:0),10))+"px")}}else{if(isNaN(m)){c.setStyle("display","none")}}}b.shareThisV3Dialog.service_helpers.addMoreOptionsEvents();j.on("focus",b.shareThisV3Dialog.service_helpers.maybeClearText);j.on("focus",d);j.on("blur",b.shareThisV3Dialog.service_helpers.maybeRestoreText);j.on("keyup",d);j.on("change",d);d()},success:function(){var f=b.one(".flickr-follow-yes");var d=b.one(".flickr-follow-no");if(f&&d){f.on("click",e);d.on("click",e)}function e(k){var j=k.target.getAttribute("data-action");var i=b.shareThisV3Dialog.get_current_service();var g=[];g.push("action="+j);g.push("service_type_id=9");g.push("service_id="+i.service_id);g.push("magic_cookie="+b.config.flickr.magic_cookie);g=g.join("&");var h="/share.gne";if(j=="followFlickr"){b.one("#follow-flickr").set("innerHTML",'<p class="follow-working">'+b.transjax.get("share-this-v3-dialog","following_flickr_waiting")+"</p>")}else{b.one("#follow-flickr").remove();b.one(".follow-flickr-headline").remove()}b.io(h,{method:"POST",data:g,on:{complete:function(n,l,m){if(c(l.responseText)){b.one("#follow-flickr").set("innerHTML",'<p class="follow-error">'+b.transjax.get("share-this-v3-dialog","try_again_later")+"</p>")}else{if(j=="followFlickr"){b.one("#follow-flickr").set("innerHTML",'<p class="follow-success">'+b.transjax.get("share-this-v3-dialog","following_flickr_success")+"</p>")}}}}});k.preventDefault();return}function c(g){return(g&&g.match(/state-error/i))}}},on_submit_form:{share:function(){b.shareThisV3Dialog.service_helpers.maybeClearText({target:b.one("#tweet-text")})}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-wordpress",function(c){var b=c.shareThisV3Services;function a(){var e=c.one("#share-form-wordpress"),g=c.one("#wp-setup-api-endpoint"),d=c.one("#wp-setup-username"),f=false;if(d.get("value")!==""&&g.get("value")!==""){f=true}if(f){c.shareThisV3Dialog.service_helpers.enableForm(e)}else{c.shareThisV3Dialog.service_helpers.disableForm(e)}}if(!b){c.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"wordpress",id:7,use_setup_dialog:true,default_text:null,on_show_screen:{setup:function(){c.log("wordpress: setup screen");var e=c.shareThisV3Dialog.get_current_service(),f=c.one("#wp-setup-api-endpoint"),d=c.one("#wp-setup-username");if(f){f.on("focus",e.misc.maybe_highlight_endpoint);f.focus();f.on("keypress",a);f.on("keyup",a)}if(d){d.on("keypress",a);d.on("keyup",a)}a()},setup_choose_a_blog:function(){c.log("wordpress: choose_a_blog()")},share:function(){c.log("wordpress: share screen");var g=c.shareThisV3Dialog.service_helpers,e=c.shareThisV3Dialog.get_current_service(),d=c.one("#wordpress-text"),f=c.one("#wordpress-subject");c.global_dialog.set_loading(false);c.global_dialog.show();e.default_text=d.getAttribute("data-default-text");g.addDescriptionEvents(c.one("#share-this-v3-dialog .add-object-description"),d);d.on("focus",g.maybeClearText);d.on("blur",g.maybeRestoreText);if(f){f.focus()}},password:function(){c.log("wordpress: password screen");var e=c.shareThisV3Dialog.get_current_service(),d=c.one("#wp-setup-password");if(d){d.focus()}}},on_submit_form:{share:function(){c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one("#wordpress-text")})},setup_choose_a_blog:function(){c.global_dialog.hide();c.global_dialog.set_loading(true)}},on_auth_failed:function(){c.log("on_auth_failed");set_dialog_state("state-setup state-setup-error");c.global_dialog.reposition();c.log("setup screen shown - now what, complain?")},misc:{maybe_highlight_endpoint:function(g){var h=g.target,i=g.target.getAttribute("data-default-url"),d=g.target.get("value"),f=d.indexOf(i);if(f!==-1){c.shareThisV3Dialog.service_helpers.setSelectionRange(c.Node.getDOMNode(h),f,f+i.length)}}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-service-yahoo-pulse",function(c){var b=c.shareThisV3Services,d="#pulse-text",a;if(!b){c.log("Y.shareThisV3Services null/undefined?")}else{b.add_service({name:"yahoo",id:129,default_text:null,flickr_shorturl_length:null,share_signed_out:function(f){},on_show_screen:{share:function(){c.log("on_show_screen:share");var f=c.shareThisV3Dialog.get_current_service(),e=c.one(d);f.default_text=e.getAttribute("data-default-text");e.on("focus",c.shareThisV3Dialog.service_helpers.maybeClearText);e.on("blur",c.shareThisV3Dialog.service_helpers.maybeRestoreText)}},on_submit_form:{share:function(){c.shareThisV3Dialog.service_helpers.maybeClearText({target:c.one(d)});c.fire("shareDialog:servicesAuthComplete")}}})}},"0.0.1",{requires:["share-this-v3-services"]});YUI.add("share-this-v3-dialog",function(c){var O=null;var L=null;var S=null;var b=null;var z=null;var B=null;var C=[];var n="state-";var Q="share-this-v3-dialog";var d=(function(){var ac="#guestpass-box",ag="data-required",ad="data-auto-guestpass";function ai(){var an=c.one(ac);if(!an){return false}return(an.getAttribute(ag)==="true")}function ak(){var ap=c.one(ac),an=(ap?ap.all('input[type="checkbox"]'):null),ao=false;if(an){an.each(function(){if(this.get("checked")){ao=true}})}return ao}function U(){var an=c.one(ac);if(!an){return false}return(an.getAttribute(ad)==="true")}var aa={setup:function(){},share:function(){if(c.one(ac)){r()}},success:function(){c.use("flanal",function(an){an.flanal("flickr.sharing."+B.name+"_share_complete",B.name+"_share_complete")})}};function aj(){v();M()}function V(){if(typeof B.setup_only!=="undefined"&&B.setup_only){c.global_dialog.hide();c.global_dialog.set_loading(true);setTimeout(function(){window.location.href="/account/?tab=extend"},20);return true}else{return false}}function Z(ao){var an=ao.target,ap=an.get("value");if(ap===B.default_text){an.set("value","");an.removeClass("default-text");if(typeof updateWhileTyping!=="undefined"){updateWhileTyping()}}}function al(an){}function af(at){var ar=at,ao=ar.get("type");if(ao!=="password"){if(c.UA.ie){var aq=c.Node.getDOMNode(ar),ap=aq.cloneNode(true),an;ap.type="password";ap.value="";an=aq.parentNode.insertBefore(ap,aq);aq.parentNode.removeChild(aq);setTimeout(function(){try{an.focus()}catch(au){}},10)}else{ar.set("type","password");ar.set("value","")}}}function ae(ao,ap,aq){if(ao.setSelectionRange){ao.focus();ao.setSelectionRange(ap,aq)}else{if(ao.createTextRange){var an=ao.createTextRange();an.collapse(true);an.moveEnd("character",aq);an.moveStart("character",ap);an.select()}}}function Y(an){var ao=(an?an:c.one("#share-this-v3-dialog textarea.share-object-description"));if(ao){return(ao.get("value"))}}function am(an,ap){Z({target:an});var aq=Y(),ao=an.get("value");if(aq){an.set("value",(ao?ao+"\n\n":"")+aq)}ap.preventDefault();return false}function ah(ao,an){if(ao){ao.on("click",function(ap){c.shareThisV3Dialog.service_helpers.addObjectDescription(an,ap);ap.target.ancestor(".add-description").addClass("description-added")})}}function W(){var ao=c.one("#share-this-v3-dialog"),ap=ao.one(".more-options"),an=ao.one(".more-options-toggler");if(ap&&an&&an.one("a")){an.one("a").on("click",function(aq){aq.preventDefault();ap.toggleClass("more-options-open");an.toggleClass("more-options-toggler-open")})}}function T(ao){var an=ao.all('input[type="submit"]');an.each(function(){this.replaceClass("Butt","DisabledButt");this.setAttribute("disabled","disabled")})}function X(ao){var an=ao.all('input[type="submit"]');an.each(function(){this.replaceClass("DisabledButt","Butt");this.removeAttribute("disabled")})}function ab(){c.global_dialog.remove_existing_dialog();c.global_dialog.set_loading(false);c.global_dialog.create_alert_dialog("<b>"+c.transjax.get("share-this-v3-dialog","try_again_later")+"</b>",function(){c.global_dialog.hide()})}return{assign_events:aj,addDescriptionEvents:ah,addObjectDescription:am,addMoreOptionsEvents:W,disableForm:T,enableForm:X,genericError:ab,is_guestpass_automatic:U,is_guestpass_chosen:ak,is_guestpass_required:ai,on_show_screen:aa,maybeClearText:Z,maybeRestoreText:al,setupOnly:V,setPasswordField:af,setSelectionRange:ae}}());var k={};function q(U){var V,T=null;U=parseInt(U,10);for(V in k){if(k.hasOwnProperty(V)&&k[V].id===U){T=k[V].name;break}}return T}function P(T){var U,W=[],V={object_id:y(),owner_nsid:a(),object_type:w()};if(!T){return V}for(U in V){if(V.hasOwnProperty(U)){W.push(U+"="+V[U])}}return W}function y(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.id}else{return null}}function a(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.owner_nsid}else{return null}}function w(){if(c.config&&c.config.flickr&&c.config.flickr.sharing&&c.config.flickr.sharing.object){return c.config.flickr.sharing.object.type}else{return null}}function D(){var U=c.one("#share-this-v3-dialog"),T=null;if(U){T=U.getAttribute("data-state")}return T}function l(V){var U="#share-this-dialog-state",T;if(c.one(U)){c.one(U).setAttribute("class",V)}if(V&&V.length>n.length){V=V.substr(n.length);if(V!=="working"){m()}T=c.one("#share-this-v3-dialog .auto-focus");if(T){T.focus()}if(d.on_show_screen&&d.on_show_screen[V]){d.on_show_screen[V]()}if(B&&B.on_show_screen&&B.on_show_screen[V]){B.on_show_screen[V]()}}}function A(){l("state-setup")}function H(){function U(W){return(parseInt(W.get("offsetHeight"),10)-20)}var T={left:c.one("#global-dialog-container .left-item"),right:c.one("#global-dialog-container .right-item")},V={};if(T.left&&T.right){V={left:U(T.left),right:U(T.right)};if(V.left>V.right){T.right.setStyle("minHeight",V.left+"px")}else{T.left.setStyle("minHeight",V.right+"px")}}c.global_dialog.reposition()}function i(T){j()}function p(T){C.push(T)}function m(){for(var T=C.length;T--;){C[T].detach()}C=[]}function r(){p(c.all('#guestpass-box input[type="checkbox"]').on("click",i))}function M(){p(c.all("#global-dialog-container form.share-form").on("submit",o))}function v(){var T="#global-dialog-container a, #global-dialog-container input";function U(W){var V=W.target;if(V&&(V.hasClass("close-x")||V.hasClass("CancelButt")||V.hasClass("dismissDialog"))){c.global_dialog.hide();W.preventDefault();if(c.contextManager){c.contextManager.unset(Q)}return false}}c.all(T).on("click",U)}function I(){B.needs_setup=true;if(B.on_auth_failed){B.on_auth_failed()}}function K(W,X,T){var V;if(B&&B.needs_setup){if(X.responseText){c.one("#share-this-v3-dialog").get("parentNode").set("innerHTML",X.responseText);V=D();if(V&&V.match(/share/i)){c.fire("shareDialog:servicesAuthComplete")}l(V)}else{var U=d.setupOnly();if(!U){I()}}}else{if(G(X.responseText)){if(c.one("#share-this-v3-dialog")){c.one("#share-this-v3-dialog").get("parentNode").set("innerHTML",X.responseText);V=D();l(V)}else{d.genericError()}}else{d.genericError()}}d.assign_events()}function E(){var T=D();if(T){l(T)}}function o(V){var W=V.target,U,T;if(W.hasClass("scrumjax-exclude")){c.global_dialog.hide();c.global_dialog.set_loading(true);return true}if(B){T=D();if(T){U=T.substr(n.length);if(B.on_submit_form&&B.on_submit_form[U]){B.on_submit_form[U](V)}}}c.use("io-form",function(){var X={method:"POST",form:{id:W.getAttribute("id"),useDisabled:false},on:{success:K,failure:K,timeout:K}};if(B&&B.setup_only){l("state-working setup-only")}else{l("state-working")}var Y=W.getAttribute("action");if(!Y){Y=W.getAttribute("data-ie-action")}if(c.one("#"+W.getAttribute("id"))){c.io(Y,X)}});V.preventDefault();return false}function G(T){return(T&&T.match(/share\-this\-v3/i))}function e(W,U,V,T){var Y={success:function(ad,ab,ac){var Z=ab.responseText,aa;if(G(Z)){c.global_dialog.remove_existing_dialog();c.global_dialog.create_dialog(Z);aa=D();c.global_dialog.show({modal:true,width:(!c.UA.ie||c.config.is_zeus?422:440)});if(V&&V.on_complete){V.on_complete()}else{l(aa)}c.global_dialog.reposition();c.global_dialog.set_loading(false);c.global_dialog.set_modal(true);d.assign_events()}else{if(B&&B.setup_only){d.setupOnly()}else{d.genericError()}}},failure:function(ab,Z,aa){if(Z.statusText==="timeout"){if(B&&B.needs_auth&&B.on_auth_failed){B.on_auth_failed()}}else{if(B&&B.needs_auth&&B.on_auth_failed){B.on_auth_failed()}else{c.global_dialog.hide();d.genericError()}}}};var X=(typeof T!=="undefined"?T:Y);c.global_dialog.set_loading(true);c.io(W,{method:"POST",data:U,on:X,"arguments":U})}function x(U){var W=(U||null),V="/share.gne",T=[];T.push("action=delete");if(U.service_id){T.push("service_id="+U.service_id)}if(U.service_type_id){T.push("service_type_id="+U.service_type_id)}T.push("cachebust="+(new Date()).getTime());T=T.join("&");W={on_complete:function(){var Y=c.one("#share-confirm-delete");if(Y){try{Y.focus()}catch(X){}}p(c.one("#global-dialog-container form.scrumjax-exclude").on("submit",o))}};e(V,T,W)}function h(U){var W=(U||null),V="/share.gne",T=[];T.push("action=retrieve_fragments");if(B.needs_setup){T.push("fragments[]=dialog-setup")}else{T.push("fragments[]=dialog-share")}if(L){T.push("service_name="+L)}if(S){T.push("object_id="+S)}if(b){T.push("object_type="+b)}if(z){T.push("owner_nsid="+z)}T.push("cachebust="+(new Date()).getTime());if(B){if(B.setup_only){T.push("setup_only=1")}if(B.service_id){T.push("service_id="+B.service_id)}if(B.service_type_id){T.push("service_type_id="+B.service_type_id)}}T=T.join("&");e(V,T,W)}function j(U){var W=(U||null),V="/share.gne",T=[];T.push("action=retrieve_fragments");T.push("fragments[]=dialog-share-thumbnails");if(L){T.push("service_name="+L)}if(S){T.push("object_id="+S)}if(b){T.push("object_type="+b)}if(z){T.push("owner_nsid="+z)}if(B){if(B.service_id){T.push("service_id="+B.service_id)}if(B.service_type_id){T.push("service_type_id="+B.service_type_id)}}c.one("#global_dialog").all("input.gp-type:checked").each(function(Y){T.push(Y.getAttribute("name")+"=1")});T=T.join("&");W={on_complete:function(){}};var X={success:function(ab,Z,aa){var Y=Z.responseText;c.one("#share-this-thumbnail").get("parentNode").set("innerHTML",Y)}};c.one("#share-this-thumbnail-loading").setStyle("display","block");e(V,T,W,X)}function g(V,Y,U,W,T){if(c.contextManager){c.contextManager.set(Q)}S=y();b=w();z=a();L=q(Y);if(!k[L]){return false}else{B=k[L]}var X=T?T.altKey:false;if(!X&&c.config&&c.config.flickr&&c.config.flickr.user&&c.config.flickr.user.nsid){}else{if(!X&&typeof global_nsid!=="undefined"&&global_nsid){}else{if(B.share_signed_out){B.share_signed_out(T);T.preventDefault();return false}}}c.fire("flickr-menus:hide");B.needs_setup=U;B.service_id=V;B.service_type_id=Y;B.setup_only=W;if(U){if(B.use_popup&&B.setup_url){s(B.setup_url,B.popup_params,function(){if(B.on_window_closed){B.on_window_closed();c.fire("shareDialog:servicesAuthComplete")}})}else{if(B.use_setup_dialog){h({on_complete:function(){if(B.needs_setup){A()}}})}else{h({on_complete:function(){if(B.needs_setup){A()}}})}}return false}else{h()}return false}function u(){return B}function N(){c.global_dialog.set_loading(true)}function t(T){if(O&&O.closed){T()}else{setTimeout(function(){t(T)},1000)}}function s(V,T,W){var X,U=[];for(X in T){if(T.hasOwnProperty(X)){U.push(X+"="+T[X])}}U.push("resizable=1");U.push("scrollbars=1");try{O=window.open(V,"newWindow",U.join(","));if(O.focus){O.focus()}}catch(Y){return true}if(W){N();t(W)}return false}function f(){var U={},T;U.service_type_id=c.one("#form_service_type_id").get("value");U.object_type=c.one("#form_object_type").get("value");U.object_id=c.one("#form_object_id").get("value");T=c.one("#form_owner_nsid");if(T){U.owner_nsid=T.get("value")}return U}function R(U){var W=[];for(var V in U){if(U.hasOwnProperty(V)){W.push(V+"="+encodeURIComponent(U[V]))}}var T={method:"POST",data:W.join("&"),on:{complete:function(Z,X){var Y=X.responseText;if(G(Y)){c.global_dialog.create_dialog(Y).show({modal:true,width:(!c.UA.ie||c.config.is_zeus?422:440)});v()}else{c.shareThisV3Dialog.service_helpers.genericError()}}}};c.io("/share.gne",T)}function J(){if(c.shareThisV3Services){k=c.shareThisV3Services.get_services()}}J();c.shareThisV3Dialog={assign_dialog_dismiss_events:v,confirm_delete:x,do_share_action:R,fetch_sharing_fragment:h,get_current_service:u,get_form_params:f,init:J,refresh_dialog_state:E,services:k,service_helpers:d,get_share_this_data:P,share_by_service:g,set_dialog_state:l,show_setup_state:A,webCirca1999:s}},"0.0.1",{requires:F.config.modules["share-this-v3-dialog"].requires||[],optional:F.config.modules["share-this-v3-dialog"].optional||[]});YUI.add("share-this-v3-triggers",function(c){function b(d){d.on("click",a)}function a(j){var f,m,k,i,n,l,d,g,h;f=j.target.ancestor("a.share-dialog-action",true);if(!f&&j.target.hasClass("Butt")){f=j.target.one("a.share-dialog-action")}if(!f){return}k=f.getAttribute("data-service-id");i=f.getAttribute("data-service-type-id");if(!i){j.preventDefault();return}l=f.getAttribute("data-setup-only");d=(f.getAttribute("data-service-needs-setup")==="true");if(!d&&j.shiftKey){c.log("Allowing set-up override");d=true}if(!l){m=c.shareThisV3Services.get_service(parseInt(i,10));n=m&&m.name&&m.name.replace(/[^a-zA-Z0-9_\-]/g,"_");if(n){if(c.config.flickr.user.nsid){if(d){h=n+"_button_needs_setup"}else{h=n+"_button_already_setup"}}else{h=n+"_button_signed_out"}g="flickr.sharing_triggers."+h;c.flanal(g,h)}}c.shareThisV3Dialog.share_by_service(k,i,d,l,j);j.preventDefault();return false}c.shareThisV3Triggers={listen:b,handleClick:a}},"0.0.1",{requires:F.config.modules["share-this-v3-triggers"].requires||[],optional:F.config.modules["share-this-v3-triggers"].optional||[]});YUI.add("share-this-v3-menu",function(d){var a,c,f,i="share-options-open",k="share-options-deferred",r="share-options-placeholder",A="share-menu",n={},g=false;function y(){var G,H;a=d.one("#share-menu-v3");if(!a){d.log("share menu v3:: WARN: Could not find menuNode","error","share-this-v3-menu")}f=d.one("#share-buttons, #button-bar");if(f){d.shareThisV3Triggers.listen(f);if(!d.config.flickr.is_touch_device){G=f.on("mouseover",function(I){if(D().contains(I.target)){G.detach();m()}})}}if(a){a.on("click",w);a.on("mousedown",l);a.on("mouseup",E);if(!d.config.flickr.is_touch_device){a.on("mouseover",d.betterThrottle(function(J){var I=J.target.ancestor("li."+k,true);if(I){m(I)}},100))}B();H=new d.Popover({srcNode:"#share-menu-v3",visible:false,width:"400px"});H.on("visibleChange",function(I){if(I.newVal){C();m()}});H.render();c=d.menus.add({id:"share-menu-v3",popover:H,context:A,button_node:D()})}d.on("shareDialog:servicesAuthComplete",function(){if(c){c.hide()}e();window.setTimeout(function(){h(["buttons","menu-services"],{reload:true})},1000)});if(d.config.flickr.sharing.shareability_is_unknown){h(["buttons","menu-full"])}if(d.config.flickr.page_type==="photo"){d.after("PhotoData:is_publicChange",p);d.after("PhotoData:is_friendChange",p);d.after("PhotoData:is_familyChange",p);d.after("PhotoData:safety_levelChange",p);d.after("PhotoData:licenseChange",p);d.after("PhotoData:is_badChange",p);d.after("PhotoData:content_typeChange",p)}if(F.actionQueue&&d.Lang.isObject(F.actionQueue)){F.actionQueue["share-this-v3-more-button"]={display_share:function(){if(c){c.show()}}};F.actionQueue.module_loaded("share-this-v3-more-button")}d.fire("shareMenu:initialized");g=true}function p(G){h(["buttons","menu-full"],{reload:true})}p=d.betterThrottle(p,20,window,true);function l(G){if(G.target.test("#share-options-grablink-input")||G.target.test(".embed-markup")){G.target.select()}}function E(G){if(G.target.test("#share-options-grablink-input")||G.target.test(".embed-markup")){G.preventDefault()}}function w(G){if(G.target.test("#share-options-grablink-input")||G.target.test(".embed-markup")){G.target.select();G.preventDefault()}else{if(G.target.ancestor("li.share-options div.share-options-header",true)){G.preventDefault();b(G.target.ancestor("li"))}else{if(G.target.ancestor(".share-more-ways",true)){G.preventDefault();a.one(".share-services-small").toggleClass("share-hidden")}else{if(G.target.ancestor("ul.share-options-list li, ul.share-services li, ul.share-services-small li",true)){d.shareThisV3Triggers.handleClick(G)}else{if(G.target.ancestor("form#grab-link input",true)){x(G)}else{if(G.target.ancestor("form#sharing-get-html-form input",true)){t(G)}}}}}}}function C(G){G=G||a.one("."+i);if(G&&G.getAttribute("data-panel-name")==="services"){z(G)}}function o(){d.use("viewing-party-invitation-creator",function(I){if(I.one("#party-context-type")&&I.one("#party-context-id")){var G=I.one("#party-context-type").get("value"),H=I.one("#party-context-id").get("value");I.ViewingPartyInvitationCreator.init(G,H)}})}function m(G){G=G||a.one("."+i);if(G&&G.hasClass(k)){if(G.get("id")==="share-options-grablink"){h(["menu-grab-the-link"])}else{if(G.get("id")==="share-options-services"){h(["menu-services"])}}G.removeClass(k)}}function b(H){var L,G,Q,N,S,I,R,P,K,O,J,T,M;if(!H||H.hasClass(i)){return false}Q=a.one("."+i);C(Q);m(H);G=H.one(".share-options-header");L=H.one(".share-options-inner");L.setStyle("display","block");I=L.get("offsetHeight")+parseInt(L.getComputedStyle("marginTop"),10)+parseInt(L.getComputedStyle("marginBottom"),10)+G.get("offsetHeight")+parseInt(G.getComputedStyle("marginTop"),10)+parseInt(G.getComputedStyle("marginBottom"),10);P=new d.Anim({node:H,to:{height:I},duration:0.42,easing:d.Easing.easeBoth});P.on("end",function(){H.setStyle("height","");H.addClass(i)});if(!d.UA.ie||d.UA.ie>=8){K=new d.Anim({node:G,from:{backgroundColor:"#0063DC",color:"#ffffff"},to:{backgroundColor:"#ffffff",color:"#000000"},duration:0.42,easing:d.Easing.easeBoth});K.on("end",function(){G.setStyle("backgroundColor","");G.setStyle("color","")})}if(Q){S=Q.one(".share-options-header");N=Q.one(".share-options-inner");R=S.get("offsetHeight")+parseInt(S.getComputedStyle("marginTop"),10)+parseInt(S.getComputedStyle("marginBottom"),10);O=new d.Anim({node:Q,to:{height:R},duration:0.25,easing:d.Easing.easeBoth});O.on("end",function(){Q.setStyle("height","");Q.removeClass(i);N.setStyle("display","none")});if(!d.UA.ie||d.UA.ie>=8){J=new d.Anim({node:S,from:{backgroundColor:"#ffffff",color:"#000000"},to:{backgroundColor:"#F6F6F6",color:"#0063dc"},duration:0.25,easing:d.Easing.easeBoth});J.on("end",function(){S.setStyle("backgroundColor","");S.setStyle("color","")})}O.run();if(J){J.run()}}T=H.getAttribute("data-panel-name");if(T==="party"){o()}P.run();if(K){K.run()}C(H);M={services:1,link:2,embed:3,party:0};if(T&&M[T]){if(b.pending){window.clearTimeout(b.pending);b.pending=undefined}b.pending=window.setTimeout(function(){d.flickrAPI.callMethod("flickr.prefs.setPrefs",{share_this_panel:M[T]})},2000)}}function D(){return f.one(".share-dropdown-arrow")}function j(){var G,I,H;G=a.one("#share-options-grablink-input");I=a.one("#short-url input");if(I){H=I.get("checked")?I.getAttribute("data-url-short"):I.getAttribute("data-url-long")}if(H){G.set("value",H)}}function x(G){if(G.target.get("id")==="gp-short-url"){j()}else{if(G.target.hasClass("gp-type")){if(a.one("form#grab-link input.gp-type:checked")){a.one("#gp-add-button").replaceClass("DisabledButt","Butt")}else{a.one("#gp-add-button").replaceClass("Butt","DisabledButt")}}else{if(G.target.get("id")==="gp-add-button"){G.preventDefault();if(!G.target.hasClass("DisabledButt")){window.setTimeout(function(){h(["menu-grab-the-link"],{reload:true,guestpass:true})},10)}}}}}function t(G){if(G.target.get("id")==="code-type-bbcode"||G.target.get("id")==="code-type-html"){u()}}function u(){var H,K,J,G,I,L;H={html:{Thumbnail:"share-options-embed-textarea-t",Square:"share-options-embed-textarea-sq",Small:"share-options-embed-textarea-s",Medium:"share-options-embed-textarea-m","Medium 640":"share-options-embed-textarea-z",Large:"share-options-embed-textarea-l",Original:"share-options-embed-textarea-o"},bbcode:{Thumbnail:"share-options-embed-textarea-t-bbcode",Square:"share-options-embed-textarea-sq-bbcode",Small:"share-options-embed-textarea-s-bbcode",Medium:"share-options-embed-textarea-m-bbcode","Medium 640":"share-options-embed-textarea-z-bbcode",Large:"share-options-embed-textarea-l-bbcode",Original:"share-options-embed-textarea-o-bbcode"}};K={html:0,bbcode:1};J={Square:1,Thumbnail:2,Small:3,Medium:4,"Medium 640":5,Large:6,Original:7};G=d.one("#sharing_size").get("value");I=d.one("#code-type-bbcode").get("checked")?"bbcode":"html";L=H[I][G];d.all(".embed-markup").each(function(M){M.setStyle("display","none")});d.one("#"+L).setStyle("display","block");if(u.pending){window.clearTimeout(u.pending);u.pending=undefined}u.pending=window.setTimeout(function(){d.flickrAPI.callMethod("flickr.prefs.setPrefs",{photo_embed_type:K[I],photo_embed_size:J[G]})},2000)}function v(){var H=D();if(!a||!H){return false}var G=H.getXY();a.setXY([G[0]+(parseInt(H.get("offsetWidth"),10)/2)-87,G[1]+38])}function B(){if(!n.embed_size_change_handle&&d.one("#sharing_size")){n.embed_size_change_handle=d.one("#sharing_size").on("change",function(G){u()})}}function q(){d.Object.each(n,function(H,G){if(H&&H.detach){H.detach();n[G]=undefined}})}function e(){var G=f.all(".share-this-v3");if(G&&G.size()){G.each(function(J){var H=J.one(".Butt, .DisabledButt"),I;if(H){H.removeClass("Butt").addClass("DisabledButt share-disabled");I=H.one("a");if(I){I.removeAttribute("data-service-type-id");I.removeAttribute("data-service-id");I.removeAttribute("data-service-needs-setup")}}})}}function s(H,J,N){var O="...",K=N.get("innerHTML"),L=K.match(/\.\.\./),G=K.length-(L?3:0),M=8,I=H.get("offsetWidth");if(I>J&&G>M){N.set("innerHTML",K.substr(0,K.length-(L?4:1))+O);checkLabel.apply(this,arguments)}H.setAttribute("data-truncated",1)}function z(G){if(G&&G.one("li")){var H=G.one("li").get("offsetWidth"),I=G.all(".service-username");if(I){I.each(function(){if(!this.getAttribute("data-truncated")){s(this,H,this.one(".service-truncated"))}})}}}function h(G,L){var I,K,N=[],J="/share.gne",H=[],M;if(!G){return false}if(d.Lang.isString(G)){G=[G]}if(!d.Lang.isArray(G)){return false}L=L||{};K={buttons:{on:{start:function(){e();return true},success:function(O){var P;if(f){P=d.Node.create(O);if(P){f.all(".share-this-v3").remove();f.append(P);c.set("button_node",D())}}}}},"menu-grab-the-link":{on:{start:function(){if(L.reload){if(!I["menu-grab-the-link"].placeholder_node){I["menu-grab-the-link"].placeholder_node=a.one("#share-options-grablink ."+r);if(!I["menu-grab-the-link"].placeholder_node){I["menu-grab-the-link"].placeholder_node=a.one("#share-options-grablink .share-options-inner")}}if(L.guestpass){H.push("guestpass=1");I["menu-grab-the-link"].placeholder_node.all("form#grab-link input.gp-type:checked").each(function(O){H.push(O.getAttribute("name")+"=1")})}I["menu-grab-the-link"].loaded=false;I["menu-grab-the-link"].placeholder_node.addClass(r);I["menu-grab-the-link"].placeholder_node.set("innerHTML","")}if(I["menu-grab-the-link"].loaded){return false}if(a.one("form#grab-link")){I["menu-grab-the-link"].loaded=true;return false}if(!I["menu-grab-the-link"].placeholder_node){I["menu-grab-the-link"].placeholder_node=a.one("#share-options-grablink ."+r);if(!I["menu-grab-the-link"].placeholder_node){d.log("Missing placeholder node","error","share-this-v3-menu");return false}}I["menu-grab-the-link"].placeholder_node.set("innerHTML","").addClass(r);return true},success:function(O){I["menu-grab-the-link"].loaded=true;I["menu-grab-the-link"].placeholder_node.set("innerHTML",O);if(L.guestpass){if(d.config.flickr.page_type==="photo"&&d.config.flickr.photo){d.use("photo-data",function(Q){var P=Q.PhotoData.get(Q.config.flickr.photo.id);if(P){P.increment("guestpass_count")}})}}},failure:function(){I["menu-grab-the-link"].placeholder_node.set("innerHTML",d.transjax.get("share-menu","grab_the_link_fragment_error"))},complete:function(){I["menu-grab-the-link"].placeholder_node.removeClass(r)}}},"menu-services":{on:{start:function(){if(L.reload){if(!I["menu-services"].placeholder_node){I["menu-services"].placeholder_node=a.one("#share-options-services ."+r);if(!I["menu-services"].placeholder_node){I["menu-services"].placeholder_node=a.one("#share-options-services .share-options-inner")}}I["menu-services"].loaded=false;I["menu-services"].placeholder_node.addClass(r);I["menu-services"].placeholder_node.set("innerHTML","")}if(I["menu-services"].loaded){return false}if(a.one("ul.share-services")){I["menu-services"].loaded=true;return false}if(!I["menu-services"].placeholder_node){I["menu-services"].placeholder_node=a.one("#share-options-services ."+r);if(!I["menu-services"].placeholder_node){d.log("Missing placeholder node","error","share-this-v3-menu");return false}}return true},success:function(O){I["menu-services"].loaded=true;I["menu-services"].placeholder_node.removeClass(r);I["menu-services"].placeholder_node.set("innerHTML",O)},failure:function(Q,P,O){I["menu-services"].placeholder_node.set("innerHTML",d.transjax.get("share-menu","services_fragment_error"))},complete:function(){I["menu-services"].placeholder_node.removeClass(r)}}},"menu-full":{on:{start:function(){q();return true},success:function(O){if(a){a.set("innerHTML",O)}B()}}}};if(!h.memo){h.memo={};d.Object.each(K,function(P,O){h.memo[O]={}})}I=h.memo;d.Array.each(G,function(Q,O){var P;if(I[Q].running){return false}P=K[Q].on.start.apply(window);if(P){N.push(Q)}});if(N.length===0){return false}if(d.config.flickr.sharing.object.id){H.push("object_id="+d.config.flickr.sharing.object.id)}if(d.config.flickr.sharing.object.type){H.push("object_type="+d.config.flickr.sharing.object.type)}if(d.config.flickr.sharing.object.owner_nsid){H.push("owner_nsid="+d.config.flickr.sharing.object.owner_nsid);H.push("object_owner_nsid="+d.config.flickr.sharing.object.owner_nsid)}H.push("cachebust="+(new Date()).getTime());H.push("action=retrieve_fragments");d.Array.each(N,function(O){H.push("fragments[]="+O)});H=H.join("&");J=J+"?"+H;M={on:{success:function(Q,P){var O=P.responseText.split("<!-- Fragment -->");d.Array.each(N,function(S,R){if(d.Lang.isFunction(K[S].on.success)){K[S].on.success.apply(window,[O[R]])}if(d.Lang.isFunction(K[S].on.complete)){K[S].on.complete.apply(window,[])}I[S].running=false})},failure:function(Q,P){var O=arguments;d.Array.each(N,function(R){if(d.Lang.isFunction(K[R].on.failure)){K[R].on.failure.apply(window,O)}if(d.Lang.isFunction(K[R].on.complete)){K[R].on.complete.apply(window,[])}I[R].running=false})}}};d.Array.each(N,function(O){I[O].running=true});d.io(J,M)}d.shareThisV3Menu={init:y,show:function(){c.show()},openPanel:b,initialized:g}},"0.0.1",{requires:F.config.modules["share-this-v3-menu"].requires||[],optional:F.config.modules["share-this-v3-menu"].optional||[]});